remote procedure HandleNewINDClassmCode(var record NewINVc,integer); //Edit***************************Sasha2,16:02 16.12.2015
external procedure ExtractObj(string,var Integer,var string);
remote procedure HandleNewIN2DClassCode(var record NewINVc, integer);
remote procedure HandleNewIN2DClassSubGroup(var record NewINVc, integer);
remote procedure HandleNewIN2DClassProductNameCode(var record NewINVc, integer);
remote procedure HandleNewIN2DClassBTRxType(var record NewINVc, integer); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 9:46 19.09.2020
remote procedure NewBPIColor2SClassArrayOnOpen(var Array string,var Integer,string,string,string);
remote procedure NewINBPIOdour2SClassArrayOnOpen(var Array string,var Integer,string,string,string); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger15:29 01.10.2018
remote procedure NewINBPIStrap2SClassArrayOnOpen(var Array string,var Integer,string,string); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger15:29 01.10.2018
remote procedure NewINBPIStone2SClassArrayOnOpen(var Array string,var Integer,string,string,string); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger
remote procedure NewINBPICut2SClassArrayOnOpen(var Array string,var Integer,string,string); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger
remote procedure NewINBPIWeight2SClassArrayOnOpen(var Array string,var Integer,string,string); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger
remote procedure NewINBPIClarity2SClassArrayOnOpen(var Array string,var Integer,string,string); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger
remote procedure NewINBPIPlating2SClassArrayOnOpen(var Array string,var Integer,string,string,string); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger
remote procedure NewINBPISex2SClassArrayOnOpen(var Array string,var Integer,string,string,string); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger
remote procedure NewINBPIUse2SClassArrayOnOpen(var Array string,var Integer,string,string); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger
remote procedure NewINBPISize2SClassArrayOnOpen(var Array string,var Integer,string,string); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger
remote procedure NewINBPIShape2SClassArrayOnOpen(var Array string,var Integer,string,string); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger
remote procedure NewINBPIMaterial2SClassArrayOnOpen(var Array string,var Integer,string,string,string); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger
remote procedure NewINBPICategory2SClassArrayOnOpen(var Array string,var Integer,string,string); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger15:31 01.10.2018
remote procedure NewINBPIColor2SClassArrayOnOpen(var Array string,var Integer,string,string); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger15:31 01.10.2018
remote procedure NewIN2Length2SClassArrayOnOpen(var Array string,var Integer,string); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 14:56 19.09.2020
remote procedure NewIN2BPIWidth2SClassArrayOnOpen(var Array string,var Integer,string); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 15:57 19.09.2020
remote procedure NewIN2Height2SClassArrayOnOpen(var Array string,var Integer,string); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 15:57 19.09.2020
remote procedure NewIN2Diameter2SClassArrayOnOpen(var Array string,var Integer,string); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 15:57 19.09.2020
remote procedure NewIN2BPIVolume2SClassArrayOnOpen(var Array string,var Integer,string); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 15:57 19.09.2020
remote procedure NewIN2Weight2SClassArrayOnOpen(var Array string,var Integer,string); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 15:57 19.09.2020
remote procedure NewIN2ItemSizeSClassArrayOnOpen(var Array string,var Integer,string); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 14:53 24.09.2020
remote procedure NewIN2UnitOfMeasurementSClassArrayOnOpen(var Array string,var Integer,string); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 14:53 24.09.2020
remote procedure NewIN2AllMaterialsSClassArrayOnOpen(var Array string,var Integer,string); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 14:53 24.09.2020
remote procedure NewIN2CountInSetSClassArrayOnOpen(var Array string,var Integer,string); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 14:53 24.09.2020
remote procedure NewIN2DiamondsCaratSClassArrayOnOpen(var Array string,var Integer,string); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 14:53 24.09.2020
remote procedure NewIN2ComplicationsSClassArrayOnOpen(var Array string,var Integer,string); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 14:53 24.09.2020
remote procedure NewIN2StrapColourCodeSClassArrayOnOpen(var Array string,var Integer,string); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 14:53 24.09.2020
remote procedure NewIN2StrapMatSClassArrayOnOpen(var Array string,var Integer,string); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 14:53 24.09.2020
remote procedure NewIN2ClockFaceColourCodeSClassArrayOnOpen(var Array string,var Integer,string); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 14:53 24.09.2020
remote procedure NewIN2ClockFaceMaterialCodeSClassArrayOnOpen(var Array string,var Integer,string); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 14:53 24.09.2020
remote procedure NewIN2CaseDiameterSClassArrayOnOpen(var Array string,var Integer,string); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 14:53 24.09.2020
remote procedure NewIN2WatchMechanismSClassArrayOnOpen(var Array string,var Integer,string); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 14:53 24.09.2020
remote procedure NewIN2PowerReserveSClassArrayOnOpen(var Array string,var Integer,string); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 14:53 24.09.2020
remote procedure NewIN2PWaterResistantSClassArrayOnOpen(var Array string,var Integer,string); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 14:53 24.09.2020
remote procedure NewIN2StoneScattA2SClassArrayOnOpen(var Array string,var Integer,string); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 14:53 24.09.2020
remote procedure NewIN2FillingSClassArrayOnOpen(var Array string,var Integer,string); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 14:53 24.09.2020
remote procedure NewIN2HighSClassArrayOnOpen(var Array string,var Integer,string); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 14:53 24.09.2020
remote procedure NewIN2Life2SClassArrayOnOpen(var Array string,var Integer,string); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 14:53 24.09.2020
remote procedure NewIN2MicrowaveSafeSClassArrayOnOpen(var Array string,var Integer,string); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 14:53 24.09.2020
remote procedure NewIN2MatchesKitchenStoveSClassArrayOnOpen(var Array string,var Integer,string); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 14:53 24.09.2020
remote procedure NewIN2LimitedGoodSClassArrayOnOpen(var Array string,var Integer,string); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 14:53 24.09.2020
remote procedure NewIN2WarrantyClassArrayOnOpen(var Array string,var Integer,string); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 14:53 24.09.2020
remote procedure NewIN2AddProdDescSClassArrayOnOpen(var Array string,var Integer,string); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 14:53 24.09.2020
remote procedure NewIN2CareSClassArrayOnOpen(var Array string,var Integer,string); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 14:53 24.09.2020
remote procedure NewIN2SctrchresistantSClassArrayOnOpen(var Array string,var Integer,string); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 14:53 24.09.2020
remote procedure NewIN2ProdFeatSClassArrayOnOpen(var Array string,var Integer,string); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 14:53 24.09.2020





remote function string 100 remotegetrecordseq(record GlobalItemVc);
remote procedure HandleNewINDClassmVendor(var record NewINVc,integer); //Edit***************************ABR,16:02 14.05.2019
remote procedure HandleNewINDClassmAltCode(var record NewINVc,integer);
remote procedure NextM4SerialNumber(string,var string);
external procedure NextNumber(string,var string);//Edit***************************ABR,16:02 14.05.2019
remote function boolean CompanyIsJWLikeCompany(Integer);
remote procedure CheckItemCC(var record newINVc, integer);
remote procedure INCatSClassArrayOnOpen(var Array string,var Integer); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger11:55 06.08.2018
remote procedure HandleNewIN2DClassSubGroupAfterCode(var record NewINVc, integer);
remote function string 255 CheckNewRowInCompanies(row newINVc);
SetLangMode(LangRussian,"RUS",0);
global 
function boolean StrInArr(string str,array string  arr)
begin
integer cnt,i;
boolean fl;
fl=false;
for(i=0;i<arr.length;i=i+1) begin
	if(str==arr[i]) then begin
		fl = true;
	end;
end;	
StrInArr = fl;
return;
end;

procedure NormalizeName(var string name)
begin
string 200 newclassname,c;
integer i,lenth,zercnt;
  
  lenth = len(name);
  for(i=0;i<lenth;i=i+1)begin
  	if((asc(mid(name,i,1))>31 and asc(mid(name,i,1))<127) or (asc(mid(name,i,1))>1039 and asc(mid(name,i,1))<1111))then begin
  		if(mid(name,i,1)!="\"")then begin
  		newclassname = newclassname & mid(name,i,1);
  		end;
  	end;
  end;
  name = newclassname;
return;
end;

global
function boolean NewINDClassmAlternativeCodeEFAfter(integer wn,integer rownr,integer changed)
begin
	integer i,mtrw;
	record NewINVc newINr;	
	boolean res;
	
	if(changed>0)then begin
		getwindowrecord(wn,newINr);
		if(rownr>-1)then begin
			HandleNewINDClassmAltCode(newINr,rownr);
		end else begin
			//
		end;
		putwindowrecord(wn,newINr);
	end;
	NewINDClassmAlternativeCodeEFAfter = res;
return;
end; 

global
function boolean NewINDClassmConsgTypeEFAfter(integer wn,integer rownr,integer changed)
begin
	integer i,mtrw;
	record NewINVc newINr;	
	row NewINVc newINrw;	
	boolean res;
	
	if(changed>0)then begin
		getwindowrecord(wn,newINr);
		if(rownr>-1)then begin
			matrowget(newINr,rownr,newINrw);
			if(newINrw.ConsgType==0) then begin
					newINrw.SerNrf = 2;
				end else begin
					newINrw.SerNrf = 0;
			end;
			matrowput(newINr,rownr,newINrw);
		end else begin
			//
		end;
		putwindowrecord(wn,newINr);
	end;
	NewINDClassmConsgTypeEFAfter = res;
return;
end; 

//Edit***************************Sasha2,12:00 16.12.2015 {
global
function boolean NewINDClassmCodeEFAfter(integer wn,integer rownr,integer changed)
begin
	integer i,mtrw;
	record NewINVc newINr;	
	boolean res;
	
	if(changed>0)then begin
		getwindowrecord(wn,newINr);
		if(rownr>-1)then begin
			HandleNewINDClassmCode(newINr,rownr);
		end else begin
			//
		end;
		putwindowrecord(wn,newINr);
	end;
	NewINDClassmCodeEFAfter = res;
return;
end; //Edit***************************Sasha2,12:00 16.12.2015 }

global
function boolean NewINDClassmNameEFAfter(integer wn,integer rownr,integer changed)
begin
	integer i,mtrw;
	record NewINVc newINr;
	row NewINVc newINrw;	
	boolean res;
	
	if(changed>0)then begin
		getwindowrecord(wn,newINr);
		if(rownr>-1)then begin
			matrowget(newINr,rownr,newINrw);
				NormalizeName(newINrw.Name);
			matrowput(newINr,rownr,newINrw);
		end else begin
			NormalizeName(newINr.Name);
		end;
		putwindowrecord(wn,newINr);
	end;
	NewINDClassmNameEFAfter = res;
return;
end;

global 
function boolean NewIN2DClassVendorCodeEFAfter(integer wn,integer rownr,integer changed)
begin
	integer i,mtrw,oldComp,CompQty;
	record NewINVc newINr;
	record INVc OldINr,tmpINr;
	row NewINVc newINrw,newIN2rw;
	boolean res,testf,TrHs;
	record BPIBrandVc BBr;
	string 200 new,old;
	
	if(changed>0)then begin
		getwindowrecord(wn,newINr);
		if(rownr>-1)then begin
			//HandleNewINDClassmVendor(newINr,rownr);
				BBr.Code = newINr.Brand;
				If(ReadFirstMain(BBr,1,true)) then begin
						CheckItemCC(newINr,rownr);
				end;
		end else begin
			//
		end;
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassVendorCodeEFAfter = res;
return;
end; //Edit***************************ABR,14:30 14.05.2019 }

global
function boolean NewIN2DClassBrandEFAfter(integer wn,integer changed)
begin
  record NewINVc newINr;
	record BPIBrandVc BPIBr;	
	boolean res, TrHs;
	integer i;
	record BPIBrandVc BBr;
	
  TrHs = true;
	if(changed!=0)then begin
		getwindowrecord(wn,newINr);
    BPIBr.Code = newINr.Brand;
		if (readfirstmain(BPIBr,1,true)) then begin
      newINr.Brand = BPIBr.Code;
    end
    else begin
      BPIBr.Name = newINr.Brand;
      if (readfirstkey("Name",BPIBr,1,true)) then begin
        newINr.Brand = BPIBr.Code;
      end;
    end;
		for(i=0;i<matrowcnt(newINr);i=i+1) begin
			BBr.Code = newINr.Brand;
			If(ReadFirstMain(BBr,1,true)) then begin
				CheckItemCC(newINr,i);
			end;
		end;
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassBrandEFAfter = res;
  return;
end;

/// РґР»СЏ РјР°С‚СЂРёС†С‹
global
function boolean NewIN2DClassBrandSCEFAfter(integer wn,integer rownr,integer changed)
begin
	integer i,mtrw;
	record NewINVc newINr;
  record BPIBrandVc BPIBr;
	row NewINVc newINrw;	
	boolean res, TrHs;
  
  TrHs = true;
	
	if(changed!=0)then begin
		getwindowrecord(wn,newINr);
    matrowget(newINr,rownr,newINrw);
		if(newINrw.BrandSC != newINr.Brand) then begin
			messagebox(0,"‘трока" & rownr & "несоответствие брендов");
		end;	
    BPIBr.Code = newINrw.BrandSC;
    if (readfirstmain(BPIBr,1,true)) then begin
      newINrw.BrandSC = BPIBr.Code;
    end
    else begin
      BPIBr.Name = newINrw.BrandSC;
      if (readfirstkey("Name",BPIBr,1,true)) then begin
        newINrw.BrandSC = BPIBr.Code;
      end;
    end;
    matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassBrandSCEFAfter = res;
return;
end;

global
function boolean NewINDClassBrandEFAfter(integer wn,integer changed)
begin
  record NewINVc newINr;
	record DIVc DIr;	
	boolean res, TrHs;
	
  TrHs = true;
	if(changed!=0)then begin
		getwindowrecord(wn,newINr);
    DIr.Name = newINr.Brand;
		if (readfirstKey("Name",DIr,1,true)) then begin
			if(DIr.CType=="BRAND") then begin
				newINr.Brand = DIr.Code;
				res = true;
			end;	
    end else begin
			DIr.CType = "BRAND";
			DIr.Code = newINr.Brand;
			if(ReadFirstKey("CType",DIr,2,true)) then begin
				res = true;
			end;
		end;
		putwindowrecord(wn,newINr);
	end;
	NewINDClassBrandEFAfter = res;
  return;
end;

/// РґР»СЏ РјР°С‚СЂРёС†С‹
global
function boolean NewINDClassBrandSCEFAfter(integer wn,integer rownr,integer changed)
begin
	integer i,mtrw;
	record NewINVc newINr;
  record BPIBrandVc BPIBr;
	row NewINVc newINrw;	
	boolean res, TrHs;
	record DIVc DIr;	
	
	getwindowrecord(wn,newINr);
   matrowget(newINr,rownr,newINrw);
	if(changed!=0)then begin
    DIr.Name = newINrw.BrandSC;
		if (readfirstKey("Name",DIr,1,true)) then begin
			if(DIr.CType=="BRAND") then begin
				newINrw.BrandSC = DIr.Code;
				res = true;
			end;	
    end else begin
			DIr.CType = "BRAND";
			DIr.Code = newINrw.BrandSC;
			if(ReadFirstKey("CType",DIr,2,true)) then begin
				res = true;
			end;
		end;
		if(newINrw.BrandSC != newINr.Brand and nonblank(newINr.Brand)) then begin
			messagebox(0,"‘трока " & rownr & " несоответствие брендов");
		end;	
    matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewINDClassBrandSCEFAfter = res;
return;
end;

global
function boolean NewIN2DClassCollectionEFAfter(integer wn,integer rownr,integer changed)
begin
	integer i,mtrw;
	record NewINVc newINr;
  record BPICollectionVc BPIColr;
	row NewINVc newINrw;	
  boolean res, TrHs;
  
  TrHs = true;
	
	if(changed!=0)then begin
		getwindowrecord(wn,newINr);
    matrowget(newINr,rownr,newINrw);
    if (readfirstmain(BPIColr,1,true)) then begin
      newINrw.Collection = BPIColr.Code;
    end
    else begin
      BPIColr.Name = newINrw.Collection;
      if (readfirstkey("Name",BPIColr,1,true)) then begin
        newINrw.Collection = BPIColr.Code;
      end;
    end;
    matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassCollectionEFAfter = res;
return;
end;

global
function boolean NewINDClassclassif30EFAfter(integer wn,integer rownr,integer changed)
begin
	integer i,mtrw;
	record NewINVc newINr;
  record BPICollectionVc BPIColr;
	row NewINVc newINrw;	
  boolean res, TrHs;
	record DIVc DIr;
  
  TrHs = true;
	
	if(changed!=0)then begin
		getwindowrecord(wn,newINr);
    matrowget(newINr,rownr,newINrw);
    DIr.Name = newINrw.classif30;
		if (readfirstKey("Name",DIr,1,true)) then begin
			if(DIr.CType=="MODEL") then begin
				newINrw.classif30 = DIr.Code;
				res = true;
			end;	
    end else begin
			DIr.CType = "MODEL";
			DIr.Code = newINrw.classif30;
			if(readfirstKey("CType",DIr,2,true)) then begin
					res = true;
			end;	
		end;
    matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewINDClassclassif30EFAfter = res;
return;
end;

global
function boolean NewINDClassCategoryEFAfter(integer wn,integer rownr,integer changed)
begin
	integer i,mtrw;
	record NewINVc newINr;
	row NewINVc newINrw;	
  boolean res, TrHs;
  array string 255 asnt;
	integer acnt;
  TrHs = true;
	
	if(changed!=0)then begin
		getwindowrecord(wn,newINr);
    matrowget(newINr,rownr,newINrw);
    INCatSClassArrayOnOpen(asnt,acnt);
		for(i=0;i<acnt;i=i+1) begin
			if(newINrw.Category==Right(asnt[i],len(asnt[i])-16))then begin
				newINrw.Category = left(asnt[i],4);
				res = true;
			end;
			if(newINrw.Category==left(asnt[i],4)) then begin
				res = true;
			end;
		end;
    matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewINDClassCategoryEFAfter = res;
return;
end;

global
function boolean NewIN2DClassGroupClEFAfter(integer wn,integer rownr,integer changed)
begin
	integer i,mtrw;
	record NewINVc newINr;
  record BPIGroupVc BPIGr;
	row NewINVc newINrw;	
  boolean res, TrHs;
  
  TrHs = true;
	
	if(changed!=0)then begin
		getwindowrecord(wn,newINr);
    matrowget(newINr,rownr,newINrw);
    BPIGr.Code = newINrw.GroupCl;
    if (readfirstmain(BPIGr,1,true)) then begin
      newINrw.GroupCl = BPIGr.Code;
    end
    else begin
      BPIGr.Name = newINrw.GroupCl;
      if (readfirstkey("Name",BPIGr,1,true)) then begin
        newINrw.GroupCl = BPIGr.Code;
      end;
    end;
    matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassGroupClEFAfter = res;
return;
end;

global
function boolean NewINDClassGroupClEFAfter(integer wn,integer rownr,integer changed)
begin
	integer i,mtrw;
	record NewINVc newINr;
  record BPIGroupVc BPIGr;
	row NewINVc newINrw;	
  boolean res, TrHs;
  record ITVc ITr;
  TrHs = true;
	
	if(changed!=0)then begin
		getwindowrecord(wn,newINr);
    matrowget(newINr,rownr,newINrw);
    ITr.Comment = newINrw.GroupCl;
		if (readfirstKey("Comment",ITr,1,true)) then begin
			newINrw.GroupCl = ITr.Code;	
			res = true;
    end else begin
			ITr.Code = newINrw.Code;
			if(ReadFirstMain(ITr,1,true)) then begin
				res = true;
			end;
		end;
    matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewINDClassGroupClEFAfter = res;
return;
end;

global
function boolean NewINDClassGroupEFAfter(integer wn,integer changed)
begin
	integer i,mtrw;
	record NewINVc newINr;
  record BPIGroupVc BPIGr;
	row NewINVc newINrw;	
  boolean res, TrHs;
  record ITVc ITr;
  TrHs = true;
	
	if(changed!=0)then begin
		getwindowrecord(wn,newINr);
    ITr.Comment = newINr.Group;
		if (readfirstKey("Comment",ITr,1,true)) then begin
			newINr.Group = ITr.Code;
			res = true;
    end else begin
			ITr.Code = newINr.Group;
			if(ReadFirstMain(ITr,1,true)) then begin
				res = true;
			end;	
		end;
		putwindowrecord(wn,newINr);
	end;
	NewINDClassGroupEFAfter = res;
return;
end;

global
function boolean NewIN2DClassSubGroupClEFAfter(integer wn,integer rownr,integer changed, var record NewINVc newINr)
begin
	integer i,mtrw;
  record BPISubGroupVc BPISubGr;
  record NewClassSetVc NewClassSetr;
	row NewINVc newINrw;	
  row NewClassSetVc NewClassSetrw;
  boolean res, TrHs;
  
  TrHs = true;
  
	if(changed!=0)then begin
		if (wn!=-1) then begin
			getwindowrecord(wn,newINr);
		end;
    matrowget(newINr,rownr,newINrw);
      BPISubGr.Name = newINrw.SubGroupCl;
      if (readfirstkey("Name",BPISubGr,1,true)) then begin
        newINrw.SubGroupCl = BPISubGr.Code;
				matrowput(newINr,rownr,newINrw);
				putwindowrecord(wn,newINr);
      end;
		if (wn!=-1) then begin
			GetWindowRecord(wn,NewINr);
		end;
    HandleNewIN2DClassSubGroup(newINr,rownr);
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassSubGroupClEFAfter = res;
return;
end;




global
function boolean NewIN2DClassProductNameCodeEFAfter(integer wn,integer rownr,integer changed, var record NewINVc newINr)
begin
	integer i,mtrw;
	record BtrxProductNameVc BtrxProductNamer;
  record NewClassSetVc NewClassSetr;
	row NewINVc newINrw;	
  row NewClassSetVc NewClassSetrw;
  boolean res, TrHs;
  
  TrHs = true;
  
	if(changed!=0)then begin
		if (wn!=-1) then begin
			getwindowrecord(wn,newINr);
		end;
		matrowget(newINr,rownr,newINrw);
		if (nonblank(NewINrw.ProductNameCode)) then begin
			BtrxProductNamer.Name = newINrw.ProductNameCode;
			if (readfirstkey("Name",BtrxProductNamer,1,true)) then begin
				newINrw.ProductNameCode = BtrxProductNamer.Code;
				matrowput(newINr,rownr,newINrw);
				putwindowrecord(wn,newINr);
			end;
		end;
		if (wn!=-1) then begin
			GetWindowRecord(wn,NewINr);
		end;
		HandleNewIN2DClassBTRxType (newINr,rownr);
		// HandleNewIN2DClassProductNameCode(newINr,rownr);
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassProductNameCodeEFAfter = res;
return;
end;


global
function boolean NewIN2DClassclassif31EFAfter(integer wn,integer rownr,integer changed)
begin
	integer i,mtrw,ni;
	record NewINVc newINr;
  record BPICategoryVc BPICatr;
	row NewINVc newINrw;
	array string 255 name;
  boolean res, TrHs;
  
  TrHs = true;
	
	if(changed!=0)then begin
		getwindowrecord(wn,newINr);
    matrowget(newINr,rownr,newINrw);
    BPICatr.Code = newINrw.GroupCl;
    if (readfirstmain(BPICatr,1,true)) then begin
      newINrw.classif31 = BPICatr.Code;
    end
    else begin
      BPICatr.Name = newINrw.classif31;
      if (readfirstkey("Name",BPICatr,1,true)) then begin
        newINrw.classif31 = BPICatr.Code;
      end;
    end;
		NewINBPICategory2SClassArrayOnOpen(name,ni,NewINrw.GroupCl,NewINrw.SubGroupCl);
		if(name.length==0) then begin
			newINrw.classif31 = "";
		end else begin	
			if(!StrInArr(newINrw.classif31,name)) then begin
				newINrw.classif31 = "*";
			end;	
		end;
    matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
    
	end;
	NewIN2DClassclassif31EFAfter = res;
return;
end;


global
function boolean NewIN2DClassMaterialEFAfter(integer wn,integer rownr,integer changed)
begin
	integer i,mtrw,ni;
	record NewINVc newINr;
  record BPIMaterialVc BPIMatr;
	row NewINVc newINrw;
	array string 255 name;
  boolean res, TrHs;
  
  TrHs = true;
	
	if(changed!=0)then begin
		getwindowrecord(wn,newINr);
    matrowget(newINr,rownr,newINrw);
    BPIMatr.Code = newINrw.Material;
    if (readfirstmain(BPIMatr,1,true)) then begin
      newINrw.Material = BPIMatr.Code;
    end
    else begin
      BPIMatr.Name = newINrw.Material;
      if (readfirstkey("Name",BPIMatr,1,true)) then begin
        newINrw.Material = BPIMatr.Code;
      end;
    end;
		NewINBPIMaterial2SClassArrayOnOpen(name,ni,NewINrw.GroupCl,NewINrw.SubGroupCl,NewINrw.ProductNameCode);
		if(name.length==0) then begin
			newINrw.Material = "";
		end else begin	
			if(!StrInArr(newINrw.Material,name) or blank(newINrw.Material)) then begin
				if (!StrInArr("",name)) then begin
					newINrw.Material = "*";
				end;
				if (StrInArr("",name) and blank(newINrw.Material)) then begin
					newINrw.Material = "*";
				end;
			end;	
		end;
    matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassMaterialEFAfter = res;
return;
end;


global
function boolean NewIN2DClassColorEFAfter(integer wn,integer rownr,integer changed)
begin
	integer i,mtrw,ni;
	record NewINVc newINr;
  record BPIColorVc BPICor;
	row NewINVc newINrw;	
  boolean res, TrHs;
	array string 255 name;
  
	
	if(changed!=0)then begin
		getwindowrecord(wn,newINr);
    matrowget(newINr,rownr,newINrw);
    BPICor.Code = newINrw.Color;
    if (readfirstmain(BPICor,1,true)) then begin
      newINrw.Color = BPICor.Code;
    end
    else begin
      BPICor.Name = newINrw.Color;
      if (readfirstkey("Name",BPICor,1,true)) then begin
        newINrw.Color = BPICor.Code;
      end;
    end;
		NewBPIColor2SClassArrayOnOpen(name,ni,NewINrw.GroupCl,NewINrw.SubGroupCl,NewINrw.ProductNameCode);
		if(name.length==0) then begin
			newINrw.Color = "";
		end else begin	
			if(!StrInArr(newINrw.Color,name) or blank(newINrw.Color)) then begin
				if (!StrInArr("",name)) then begin
					newINrw.Color = "*";
				end;
				if (StrInArr("",name) and blank(newINrw.Color)) then begin
					newINrw.Color = "*";
				end;
			end;	
		end;
    matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassColorEFAfter = res;
return;
end;

global
function boolean NewINDClassColourEFAfter(integer wn,integer rownr,integer changed)
begin
	integer i,mtrw,ni;
	record NewINVc newINr;
  record BPIColorVc BPICor;
	row NewINVc newINrw;	
  boolean res, TrHs;
	array string 255 name;
  record DIVc DIr;
	
	if(changed!=0)then begin
		getwindowrecord(wn,newINr);
    matrowget(newINr,rownr,newINrw);
    DIr.Name = newINrw.Colour;
		if (readfirstKey("Name",DIr,1,true)) then begin
			if(DIr.CType=="COLOUR") then begin
				newINrw.Colour = DIr.Code;
				res = true;
			end;	
		end else begin
			DIr.CType = "COLOUR";
			DIr.Code = newINrw.Colour;
			if(readfirstKey("CType",DIr,2,true)) then begin
					res = true;
			end;	
		end;
    matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewINDClassColourEFAfter = res;
return;
end;

global
function boolean NewIN2DClassShapeCutEFAfter(integer wn,integer rownr,integer changed)
begin
	integer i,mtrw,ni;
	record NewINVc newINr;
  record BPIShapeVc BPIShaper;
	row NewINVc newINrw;	
  boolean res, TrHs;
  array string 255 name;
	
  TrHs = true;
	
	if(changed!=0)then begin
		getwindowrecord(wn,newINr);
    matrowget(newINr,rownr,newINrw);
    BPIShaper.Code = newINrw.ShapeCut;
    if (readfirstmain(BPIShaper,1,true)) then begin
      newINrw.ShapeCut = BPIShaper.Code;
    end
    else begin
      BPIShaper.Name = newINrw.ShapeCut;
      if (readfirstkey("Name",BPIShaper,1,true)) then begin
        newINrw.ShapeCut = BPIShaper.Code;
      end;
    end;
		NewINBPIShape2SClassArrayOnOpen(name,ni,NewINrw.GroupCl,NewINrw.SubGroupCl);
		if(name.length==0) then begin
			newINrw.ShapeCut = "";
		end else begin	
			if(!StrInArr(newINrw.ShapeCut,name)) then begin
				newINrw.ShapeCut = "*";
			end;
		end;		
    matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassShapeCutEFAfter = res;
return;
end;


global
function boolean NewIN2DClassSizeClEFAfter(integer wn,integer rownr,integer changed)
begin
	integer i,mtrw,ni;
	record NewINVc newINr;
  record BPISizeVc BPISizer;
	row NewINVc newINrw;	
  boolean res, TrHs;
  array string 255 name;
	
  TrHs = true;
	
	if(changed!=0)then begin
		getwindowrecord(wn,newINr);
    matrowget(newINr,rownr,newINrw);
    BPISizer.Code = newINrw.SizeCl;
    if (readfirstmain(BPISizer,1,true)) then begin
      newINrw.SizeCl = BPISizer.Code;
    end
    else begin
      BPISizer.Name = newINrw.SizeCl;
      if (readfirstkey("Name",BPISizer,1,true)) then begin
        newINrw.SizeCl = BPISizer.Code;
      end;
    end;
		NewINBPISize2SClassArrayOnOpen(name,ni,NewINrw.GroupCl,NewINrw.SubGroupCl);
		if(name.length==0) then begin
			newINrw.SizeCl = "";
		end else begin	
			if(!StrInArr(newINrw.SizeCl,name)) then begin
				newINrw.SizeCl = "*";
			end;	
		end;
    matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassSizeClEFAfter = res;
return;
end;

global
function boolean NewIN2DClassUseClEFAfter(integer wn,integer rownr,integer changed)
begin
	integer i,mtrw,ni;
	record NewINVc newINr;
  record BPIUseVc BPIUser;
	row NewINVc newINrw;	
  boolean res, TrHs;
  array string 255 name;
	
  TrHs = true;
	
	if(changed!=0)then begin
		getwindowrecord(wn,newINr);
    matrowget(newINr,rownr,newINrw);
    BPIUser.Code = newINrw.UseCl;
    if (readfirstmain(BPIUser,1,true)) then begin
      newINrw.UseCl = BPIUser.Code;
    end
    else begin
      BPIUser.Name = newINrw.UseCl;
      if (readfirstkey("Name",BPIUser,1,true)) then begin
        newINrw.UseCl = BPIUser.Code;
      end;
    end;
		NewINBPIUse2SClassArrayOnOpen(name,ni,NewINrw.GroupCl,NewINrw.SubGroupCl);
		if(name.length==0) then begin
			newINrw.UseCl = "";
		end else begin	
			if(!StrInArr(newINrw.UseCl,name)) then begin
				newINrw.UseCl = "*";
			end;	
		end;
    matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassUseClEFAfter = res;
return;
end;


global
function boolean NewIN2DClassSexClEFAfter(integer wn,integer rownr,integer changed)
begin
	integer i,mtrw,ni;
	record NewINVc newINr;
  record BPISexVc BPISexr;
	row NewINVc newINrw;	
  boolean res, TrHs;
  array string 255 name;
  TrHs = true;
	
	if(changed!=0)then begin
		getwindowrecord(wn,newINr);
    matrowget(newINr,rownr,newINrw);
    BPISexr.Code = newINrw.SexCl;
    if (readfirstmain(BPISexr,1,true)) then begin
      newINrw.SexCl = BPISexr.Code;
    end
    else begin
      BPISexr.Name = newINrw.SexCl;
      if (readfirstkey("Name",BPISexr,1,true)) then begin
        newINrw.SexCl = BPISexr.Code;
      end;
    end;
		NewINBPISex2SClassArrayOnOpen(name,ni,NewINrw.GroupCl,NewINrw.SubGroupCl,NewINrw.ProductNameCode);
		if(name.length==0) then begin
			newINrw.SexCl = "";
		end else begin	
			if(!StrInArr(newINrw.SexCl,name) or blank(newINrw.SexCl)) then begin
				if (!StrInArr("",name)) then begin
					newINrw.SexCl = "*";
				end;
				if (StrInArr("",name) and blank(newINrw.SexCl)) then begin
					newINrw.SexCl = "*";
				end;
			end;	
		end;
    matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassSexClEFAfter = res;
return;
end;



global
function boolean NewIN2DClassPlatingClEFAfter(integer wn,integer rownr,integer changed)
begin
	integer i,mtrw,ni;
	record NewINVc newINr;
  record BPIPlatingVc BPIPlatr;
	row NewINVc newINrw;	
  boolean res, TrHs;
  array string 255 name;
	
  TrHs = true;
	
	if(changed!=0)then begin
		getwindowrecord(wn,newINr);
    matrowget(newINr,rownr,newINrw);
    BPIPlatr.Code = newINrw.PlatingCl;
    if (readfirstmain(BPIPlatr,1,true)) then begin
      newINrw.PlatingCl = BPIPlatr.Code;
    end
    else begin
      BPIPlatr.Name = newINrw.PlatingCl;
      if (readfirstkey("Name",BPIPlatr,1,true)) then begin
        newINrw.PlatingCl = BPIPlatr.Code;
      end;
    end;
		NewINBPIPlating2SClassArrayOnOpen(name,ni,NewINrw.GroupCl,NewINrw.SubGroupCl,NewINrw.ProductNameCode);
		if(name.length==0) then begin
			newINrw.PlatingCl = "";
		end else begin	
			if(!StrInArr(newINrw.PlatingCl,name) or blank(newINrw.PlatingCl)) then begin
				if (!StrInArr("",name)) then begin
					newINrw.PlatingCl = "*";
				end;
				if (StrInArr("",name) and blank(newINrw.PlatingCl)) then begin
					newINrw.PlatingCl = "*";
				end;
			end;
		end;
    matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassPlatingClEFAfter = res;
return;
end;


global
function boolean NewIN2DClassClaritySCEFAfter(integer wn,integer rownr,integer changed)
begin
	integer i,mtrw,ni;
	record NewINVc newINr;
  record BPIClarityVc BPIClar;
	row NewINVc newINrw;	
  boolean res, TrHs;
  array string 255 name;
	
  TrHs = true;
	
	if(changed!=0)then begin
		getwindowrecord(wn,newINr);
    matrowget(newINr,rownr,newINrw);
    BPIClar.Code = newINrw.ClaritySC;
    if (readfirstmain(BPIClar,1,true)) then begin
      newINrw.ClaritySC = BPIClar.Code;
    end
    else begin
      BPIClar.Name = newINrw.ClaritySC;
      if (readfirstkey("Name",BPIClar,1,true)) then begin
        newINrw.ClaritySC = BPIClar.Code;
      end;
    end;
		NewINBPIClarity2SClassArrayOnOpen(name,ni,NewINrw.GroupCl,NewINrw.SubGroupCl);
		if(name.length==0) then begin
			newINrw.ClaritySC = "";
		end else begin	
			if(!StrInArr(newINrw.ClaritySC,name)) then begin
				newINrw.ClaritySC = "*";
			end;	
		end;
    matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassClaritySCEFAfter = res;
return;
end;

global
function boolean NewIN2DClassWeightClEFAfter(integer wn,integer rownr,integer changed)
begin
	integer i,mtrw,ni;
	record NewINVc newINr;
  record BPIWeightVc BPIWeightr;
	row NewINVc newINrw;	
  boolean res, TrHs;
  array string 255 name;
  TrHs = true;
	
	if(changed!=0)then begin
		getwindowrecord(wn,newINr);
    matrowget(newINr,rownr,newINrw);
    BPIWeightr.Code = newINrw.WeightCl;
    if (readfirstmain(BPIWeightr,1,true)) then begin
      newINrw.WeightCl = BPIWeightr.Code;
    end
    else begin
      BPIWeightr.Name = newINrw.WeightCl;
      if (readfirstkey("Name",BPIWeightr,1,true)) then begin
        newINrw.WeightCl = BPIWeightr.Code;
      end;
    end;
		NewINBPIWeight2SClassArrayOnOpen(name,ni,NewINrw.GroupCl,NewINrw.SubGroupCl);
		if(name.length==0) then begin
			newINrw.WeightCl = "";
		end else begin	
			if(!StrInArr(newINrw.WeightCl,name)) then begin
				newINrw.WeightCl = "*";
			end;	
		end;
    matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassWeightClEFAfter = res;
return;
end;

global
function boolean NewIN2DClassCutClEFAfter(integer wn,integer rownr,integer changed)
begin
	integer i,mtrw,ni;
	record NewINVc newINr;
  record BPICutVc BPICutr;
	row NewINVc newINrw;	
  boolean res, TrHs;
  array string 255 name;
	
  TrHs = true;
	
	if(changed!=0)then begin
		getwindowrecord(wn,newINr);
    matrowget(newINr,rownr,newINrw);
    BPICutr.Code = newINrw.CutCl;
    if (readfirstmain(BPICutr,1,true)) then begin
      newINrw.CutCl = BPICutr.Code;
    end
    else begin
      BPICutr.Name = newINrw.CutCl;
      if (readfirstkey("Name",BPICutr,1,true)) then begin
        newINrw.CutCl = BPICutr.Code;
      end;
    end;
		NewINBPICut2SClassArrayOnOpen(name,ni,NewINrw.GroupCl,NewINrw.SubGroupCl);
		if(name.length==0) then begin
			newINrw.CutCl = "";
		end else begin	
			if(!StrInArr(newINrw.CutCl,name)) then begin
				newINrw.CutCl = "*";
			end;	
		end;
    matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassCutClEFAfter = res;
return;
end;

global
function boolean NewIN2DClassStoneClEFAfter(integer wn,integer rownr,integer changed)
begin
	integer i,mtrw,ni;
	record NewINVc newINr;
  record BPIStoneVc BPIStoner;
	row NewINVc newINrw;	
  boolean res, TrHs;
  array string 255 name;
  TrHs = true;
	
	if(changed!=0)then begin
		getwindowrecord(wn,newINr);
    matrowget(newINr,rownr,newINrw);
    BPIStoner.Code = newINrw.StoneCl;
    if (readfirstmain(BPIStoner,1,true)) then begin
      newINrw.StoneCl = BPIStoner.Code;
    end
    else begin
      BPIStoner.Name = newINrw.StoneCl;
      if (readfirstkey("Name",BPIStoner,1,true)) then begin
        newINrw.StoneCl = BPIStoner.Code;
      end;
    end;
		NewINBPIStone2SClassArrayOnOpen(name,ni,NewINrw.GroupCl,NewINrw.SubGroupCl,NewINrw.ProductNameCode);
		if(name.length==0) then begin
			newINrw.StoneCl = "";
		end else begin	
			if(!StrInArr(newINrw.StoneCl,name) or blank(newINrw.StoneCl)) then begin
				if (!StrInArr("",name)) then begin
					newINrw.StoneCl = "*";
				end;
				if (StrInArr("",name) and blank(newINrw.StoneCl)) then begin
					newINrw.StoneCl = "*";
				end;
			end;	
		end;
    matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassStoneClEFAfter = res;
return;
end;

global
function boolean NewIN2DClassStrapEFAfter(integer wn,integer rownr,integer changed)
begin
	integer i,mtrw,ni;
	record NewINVc newINr;
  record BPIStrapVc BPIStrapr;
	row NewINVc newINrw;	
  boolean res, TrHs;
  array string 255 name;
	
  TrHs = true;
	
	if(changed!=0)then begin
		getwindowrecord(wn,newINr);
    matrowget(newINr,rownr,newINrw);
    BPIStrapr.Code = newINrw.Strap;
    if (readfirstmain(BPIStrapr,1,true)) then begin
      newINrw.Strap = BPIStrapr.Code;
    end
    else begin
      BPIStrapr.Name = newINrw.Strap;
      if (readfirstkey("Name",BPIStrapr,1,true)) then begin
        newINrw.Strap = BPIStrapr.Code;
      end;
    end;
		NewINBPIStrap2SClassArrayOnOpen(name,ni,NewINrw.GroupCl,NewINrw.SubGroupCl);
		if(name.length==0) then begin
			newINrw.Strap = "";
		end else begin	
			if(!StrInArr(newINrw.Strap,name)) then begin
				newINrw.Strap = "*";
			end;	
		end;
    matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassStrapEFAfter = res;
return;
end;


global
function boolean NewIN2DClassOdourClFAfter(integer wn,integer rownr,integer changed)
begin
	integer i,mtrw,ni;
	record NewINVc newINr;
  record BPIOdourVc BPIOdourr;
	row NewINVc newINrw;	
  boolean res, TrHs;
  array string 255 name;
  TrHs = true;
	
	if(changed!=0)then begin
		getwindowrecord(wn,newINr);
    matrowget(newINr,rownr,newINrw);
    BPIOdourr.Code = newINrw.OdourCl;
    if (readfirstmain(BPIOdourr,1,true)) then begin
      newINrw.OdourCl = BPIOdourr.Code;
    end else begin
      BPIOdourr.Name = newINrw.OdourCl;
      if (readfirstkey("Name",BPIOdourr,1,true)) then begin
        newINrw.OdourCl = BPIOdourr.Code;
      end;
    end;
		NewINBPIOdour2SClassArrayOnOpen(name,ni,NewINrw.GroupCl,NewINrw.SubGroupCl,NewINrw.ProductNameCode);
		if(name.length==0) then begin
			newINrw.OdourCl = "";
		end else begin	
			if(!StrInArr(newINrw.OdourCl,name) or blank(newINrw.OdourCl)) then begin
				if (!StrInArr("",name)) then begin
					newINrw.OdourCl = "*";
				end;
				if (StrInArr("",name) and blank(newINrw.OdourCl)) then begin
					newINrw.OdourCl = "*";
				end;
			end;	
		end;
    matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassOdourClFAfter = res;
return;
end;




global
function boolean NewIN2DClassLength2EFAfter(integer wn,integer rownr,integer changed, var record NewINVc newINr)
begin
	integer i,mtrw,ni;
	row NewINVc newINrw;	
  boolean res, TrHs;
  array string 255 name, clstr;
	val strval;
	
  TrHs = true;
	
	if(changed!=0)then begin
		if (newINr.SerNr==-1) then begin
			getwindowrecord(wn,newINr);
		end;
    matrowget(newINr,rownr,newINrw);    
		NewIN2Length2SClassArrayOnOpen(name,ni,NewINrw.ProductNameCode);
		strval = stringToVal(newINrw.Length2,M4Val);
		if(name.length==0) then begin
			newINrw.Length2 = "";
		end else begin	
			if(strval<0.1 or strval>100) then begin
				newINrw.Length2 = "*";
			end else begin
				newINrw.Length2 = strval;
				newINrw.Length2 = left (newINrw.Length2,len(newINrw.Length2)-1);
			end;
		end;
    matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassLength2EFAfter = res;
return;
end;







global
function boolean NewIN2DClassWidth2EFAfter(integer wn,integer rownr,integer changed, var record NewINVc newINr)
begin
	integer i,mtrw,ni;
	row NewINVc newINrw;	
  boolean res, TrHs;
  array string 255 name;
	val strval;
	
  TrHs = true;
	
	if(changed!=0)then begin
		if (newINr.SerNr==-1) then begin
			getwindowrecord(wn,newINr);
		end;
    matrowget(newINr,rownr,newINrw);    
		NewIN2BPIWidth2SClassArrayOnOpen(name,ni,NewINrw.ProductNameCode);
		strval = stringToVal(newINrw.Width2,M4Val);
		if(name.length==0) then begin
			newINrw.Width2 = "";
		end else begin	
			if(strval<0.1 or strval>100) then begin
				newINrw.Width2 = "*";
			end else begin
				newINrw.Width2 = strval;
				newINrw.Width2 = left (newINrw.Width2,len(newINrw.Width2)-1);
			end;
		end;
    matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassWidth2EFAfter = res;
return;
end;

global
function boolean NewIN2DClassHeight2EFAfter(integer wn,integer rownr,integer changed, var record NewINVc newINr)
begin
	integer i,mtrw,ni;
	row NewINVc newINrw;	
  boolean res, TrHs;
  array string 255 name;
	val strval;
	
  TrHs = true;
	
	if(changed!=0)then begin
		if (newINr.SerNr==-1) then begin
			getwindowrecord(wn,newINr);
		end;
    matrowget(newINr,rownr,newINrw);    
		NewIN2Height2SClassArrayOnOpen(name,ni,NewINrw.ProductNameCode);
		strval = stringToVal(newINrw.Height2,M4Val);
		if(name.length==0) then begin
			newINrw.Height2 = "";
		end else begin	
			if(strval<0.1 or strval>100) then begin
				newINrw.Height2 = "*";
			end else begin
				newINrw.Height2 = strval;
				newINrw.Height2 = left (newINrw.Height2,len(newINrw.Height2)-1);
			end;			
		end;
    matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassHeight2EFAfter = res;
return;
end;


global
function boolean NewIN2DClassDiameter2EFAfter(integer wn,integer rownr,integer changed, var record NewINVc newINr)
begin
	integer i,mtrw,ni;
	row NewINVc newINrw;	
  boolean res, TrHs;
  array string 255 name;
	val strval;
	
  TrHs = true;
	
	if(changed!=0)then begin
		if (newINr.SerNr==-1) then begin
			getwindowrecord(wn,newINr);
		end;
    matrowget(newINr,rownr,newINrw);    
		NewIN2Diameter2SClassArrayOnOpen(name,ni,NewINrw.ProductNameCode);
		strval = stringToVal(newINrw.Diameter2,M4Val);
		if(name.length==0) then begin
			newINrw.Diameter2 = "";
		end else begin	
			if(strval<0.1 or strval>100) then begin
				newINrw.Diameter2 = "*";
			end else begin
				newINrw.Diameter2 = strval;
				newINrw.Diameter2 = left (newINrw.Diameter2,len(newINrw.Diameter2)-1);
			end;	
		end;
    matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassDiameter2EFAfter = res;
return;
end;





global
function boolean NewIN2DClassVolume2EFAfter(integer wn,integer rownr,integer changed, var record NewINVc newINr)
begin
	integer i,mtrw,ni;
	row NewINVc newINrw;	
  boolean res, TrHs;
  array string 255 name;
	val strval;
	
  TrHs = true;
	
	if(changed!=0)then begin
		if (newINr.SerNr==-1) then begin
			getwindowrecord(wn,newINr);
		end;
    matrowget(newINr,rownr,newINrw);    
		NewIN2BPIVolume2SClassArrayOnOpen(name,ni,NewINrw.ProductNameCode);
		strval = stringToVal(newINrw.Volume2,M4Val);
		if(name.length==0) then begin
			newINrw.Volume2 = "";
		end else begin	
			if(strval<0.1 or strval>100) then begin
				newINrw.Volume2 = "*";
			end else begin
				newINrw.Volume2 = strval;
				newINrw.Volume2 = left (newINrw.Volume2,len(newINrw.Volume2)-1);
			end;	
		end;
    matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassVolume2EFAfter = res;
return;
end;

global
function boolean NewIN2DClassWeight2EFAfter(integer wn,integer rownr,integer changed, var record NewINVc newINr)
begin
	integer i,mtrw,ni;
	row NewINVc newINrw;	
  boolean res, TrHs;
  array string 255 name;
	val strval;
	
  TrHs = true;
	
	if(changed!=0)then begin
		if (newINr.SerNr==-1) then begin
			getwindowrecord(wn,newINr);
		end;
    matrowget(newINr,rownr,newINrw);    
		NewIN2Weight2SClassArrayOnOpen(name,ni,NewINrw.ProductNameCode);
		strval = stringToVal(newINrw.Weight2,M4Val);
		if(name.length==0) then begin
			newINrw.Weight2 = "";
		end else begin	
			if(strval<0.1 or strval>100) then begin
				newINrw.Weight2 = "*";
			end else begin
				newINrw.Weight2 = strval;
				newINrw.Weight2 = left (newINrw.Weight2,len(newINrw.Weight2)-1);
			end;	
		end;
		matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassWeight2EFAfter = res;
return;
end;

global
function boolean NewIN2DClassItemSizeEFAfter(integer wn,integer rownr,integer changed, var record NewINVc newINr)
begin
	integer i,mtrw,ni;
	row NewINVc newINrw;	
  boolean res, TrHs;
  array string 255 name;
	val strval;
	
  TrHs = true;
	
	if(changed!=0)then begin
		if (newINr.SerNr==-1) then begin
			getwindowrecord(wn,newINr);
		end;
    matrowget(newINr,rownr,newINrw);    
		NewIN2ItemSizeSClassArrayOnOpen(name,ni,NewINrw.ProductNameCode);
		strval = stringToVal(newINrw.ItemSize,M4Val);
		if(name.length==0) then begin
			newINrw.ItemSize = "";
		end else begin	
			if(strval<0.1 or strval>100) then begin
				newINrw.ItemSize = "*";
			end else begin
				newINrw.ItemSize = strval;
				newINrw.ItemSize = left (newINrw.ItemSize,len(newINrw.ItemSize)-1);
			end;	
		end;
		matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassItemSizeEFAfter = res;
return;
end;

global
function boolean NewIN2DClassUnitOfMeasurementEFAfter(integer wn,integer rownr,integer changed, var record NewINVc newINr)
begin
	integer i,mtrw,ni;
  record BPIOdourVc BPIOdourr;
	row NewINVc newINrw;	
  boolean res, TrHs;
  array string 255 name;
  TrHs = true;
		
	if(changed!=0)then begin
		if (newINr.SerNr==-1) then begin
			getwindowrecord(wn,newINr);
		end;
    matrowget(newINr,rownr,newINrw);    
		NewIN2UnitOfMeasurementSClassArrayOnOpen(name,ni,NewINrw.ProductNameCode);
		if(name.length==0) then begin
			newINrw.UnitOfMeasurement = "";
		end;
		matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassUnitOfMeasurementEFAfter = res;
return;
end;

global
function boolean NewIN2DClassAllMaterialsEFAfter(integer wn,integer rownr,integer changed, var record NewINVc newINr)
begin
	integer i,mtrw,ni;
  record BtrxAllMaterialsVc Btrxr;
	row NewINVc newINrw;	
  boolean res, TrHs;
  array string 255 name;
  TrHs = true;
	
	if(changed!=0)then begin
		if (newINr.SerNr==-1) then begin
			getwindowrecord(wn,newINr);
		end;
    matrowget(newINr,rownr,newINrw);
    Btrxr.Code = newINrw.AllMaterials;
    if (readfirstmain(Btrxr,1,true)) then begin
      newINrw.AllMaterials = Btrxr.Code;
    end else begin
      Btrxr.Name = newINrw.AllMaterials;
      if (readfirstkey("Name",Btrxr,1,true)) then begin
        newINrw.AllMaterials = Btrxr.Code;
      end;
    end;
		NewIN2AllMaterialsSClassArrayOnOpen(name,ni,NewINrw.ProductNameCode);
		if(name.length==0) then begin
			newINrw.AllMaterials = "";
		end else begin	
			if(!StrInArr(newINrw.AllMaterials,name) or blank(newINrw.AllMaterials)) then begin
				if (!StrInArr("",name)) then begin
					newINrw.AllMaterials = "*";
				end;
				if (StrInArr("",name) and blank(newINrw.AllMaterials)) then begin
					newINrw.AllMaterials = "*";
				end;
			end;	
		end;
    matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassAllMaterialsEFAfter = res;
return;
end;


global
function boolean NewIN2DClassCountInSetEFAfter(integer wn,integer rownr,integer changed, var record NewINVc newINr)
begin
	integer i,mtrw,ni;
  record BPIOdourVc BPIOdourr;
	row NewINVc newINrw;	
  boolean res, TrHs;
  array string 255 name;
	val strval;
  TrHs = true;
		
	if(changed!=0)then begin
		if (newINr.SerNr==-1) then begin
			getwindowrecord(wn,newINr);
		end;
    matrowget(newINr,rownr,newINrw);    
		NewIN2CountInSetSClassArrayOnOpen(name,ni,NewINrw.ProductNameCode);
		strval = stringToVal(newINrw.CountInSet,M4Val);
		if(name.length==0) then begin
			newINrw.CountInSet = "";
		end else begin	
			if(strval<1 or strval>100) then begin
				newINrw.CountInSet = "*";
			end else begin
				newINrw.CountInSet = strval;
				newINrw.CountInSet = left (newINrw.CountInSet,len(newINrw.CountInSet)-3);
			end;	
		end;
		matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassCountInSetEFAfter = res;
return;
end;

global
function boolean NewIN2DClassDiamondsCaratEFAfter(integer wn,integer rownr,integer changed, var record NewINVc newINr)
begin
	integer i,mtrw,ni;
  record BPIOdourVc BPIOdourr;
	row NewINVc newINrw;	
  boolean res, TrHs;
  array string 255 name;
	val strval;
	
  TrHs = true;
	
	if(changed!=0)then begin
		if (newINr.SerNr==-1) then begin
			getwindowrecord(wn,newINr);
		end;
    matrowget(newINr,rownr,newINrw);
		NewIN2DiamondsCaratSClassArrayOnOpen(name,ni,NewINrw.ProductNameCode);
		strval = stringToVal(newINrw.DiamondsCarat,M4Val);
		if(name.length==0) then begin
			newINrw.DiamondsCarat = "";
		end else begin	
			if (newINrw.DiamondsCarat!=">5") then begin
				if((strval<0.1 or strval>5)) then begin
					newINrw.DiamondsCarat = "*";
				end else begin
					newINrw.DiamondsCarat = strval;
					newINrw.DiamondsCarat = left(newINrw.DiamondsCarat,len(newINrw.DiamondsCarat)-1);
				end;
			end;
		end;
    matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassDiamondsCaratEFAfter = res;
return;
end;

global
function boolean NewIN2DClassComplicationsEFAfter(integer wn,integer rownr,integer changed, var record NewINVc newINr)
begin
	integer i,mtrw,ni;
  record BtrxComplicationsVc Btrxr;
	row NewINVc newINrw;	
  boolean res, TrHs;
  array string 255 name;
  TrHs = true;
	
	if(changed!=0)then begin
		if (newINr.SerNr==-1) then begin
			getwindowrecord(wn,newINr);
		end;
    matrowget(newINr,rownr,newINrw);
    Btrxr.Code = newINrw.Complications;
    if (readfirstmain(Btrxr,1,true)) then begin
      newINrw.Complications = Btrxr.Code;
    end
    else begin
      Btrxr.Name = newINrw.Complications;
      if (readfirstkey("Name",Btrxr,1,true)) then begin
        newINrw.Complications = Btrxr.Code;
      end;
    end;
		NewIN2ComplicationsSClassArrayOnOpen(name,ni,NewINrw.ProductNameCode);
		if(name.length==0) then begin
			newINrw.Complications = "";
		end else begin	
			if(!StrInArr(newINrw.Complications,name) or blank(newINrw.Complications)) then begin
				if (!StrInArr("",name)) then begin
					newINrw.Complications = "*";
				end;
				if (StrInArr("",name) and blank(newINrw.Complications)) then begin
					newINrw.Complications = "*";
				end;
			end;	
		end;
    matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassComplicationsEFAfter = res;
return;
end;

global
function boolean NewIN2DClassStrapColourCodeEFAfter(integer wn,integer rownr,integer changed, var record NewINVc newINr)
begin
	integer i,mtrw,ni;
  record BtrxColourVc Btrxr;
	row NewINVc newINrw;	
  boolean res, TrHs;
  array string 255 name;
  TrHs = true;
	
	if(changed!=0)then begin
		if (newINr.SerNr==-1) then begin
			getwindowrecord(wn,newINr);
		end;
    matrowget(newINr,rownr,newINrw);
    Btrxr.Code = newINrw.StrapColourCode;
    if (readfirstmain(Btrxr,1,true)) then begin
      newINrw.StrapColourCode = Btrxr.Code;
    end
    else begin
      Btrxr.Name = newINrw.StrapColourCode;
      if (readfirstkey("Name",Btrxr,1,true)) then begin
        newINrw.StrapColourCode = Btrxr.Code;
      end;
    end;
		NewIN2StrapColourCodeSClassArrayOnOpen(name,ni,NewINrw.ProductNameCode);
		if(name.length==0) then begin
			newINrw.StrapColourCode = "";
		end else begin	
			if(!StrInArr(newINrw.StrapColourCode,name) or blank(newINrw.StrapColourCode)) then begin
				if (!StrInArr("",name)) then begin
					newINrw.StrapColourCode = "*";
				end;
				if (StrInArr("",name) and blank(newINrw.StrapColourCode)) then begin
					newINrw.StrapColourCode = "*";
				end;
			end;	
		end;
    matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassStrapColourCodeEFAfter = res;
return;
end;

global
function boolean NewIN2DClassStrapMatEFAfter(integer wn,integer rownr,integer changed, var record NewINVc newINr)
begin
	integer i,mtrw,ni;
  record BtrxMaterialVc BTRxr;
	row NewINVc newINrw;	
  boolean res, TrHs;
  array string 255 name;
  TrHs = true;
	
	if(changed!=0)then begin
		if (newINr.SerNr==-1) then begin
			getwindowrecord(wn,newINr);
		end;
    matrowget(newINr,rownr,newINrw);
    BTRxr.Code = newINrw.StrapMat;
    if (readfirstmain(BTRxr,1,true)) then begin
      newINrw.StrapMat = BTRxr.Code;
    end
    else begin
      BTRxr.Name = newINrw.StrapMat;
      if (readfirstkey("Name",BTRxr,1,true)) then begin
        newINrw.StrapMat = BTRxr.Code;
      end;
    end;
		NewIN2StrapMatSClassArrayOnOpen(name,ni,NewINrw.ProductNameCode);
		if(name.length==0) then begin
			newINrw.StrapMat = "";
		end else begin	
			if(!StrInArr(newINrw.StrapMat,name) or blank(newINrw.StrapMat)) then begin
				if (!StrInArr("",name)) then begin
					newINrw.StrapMat = "*";
				end;
				if (StrInArr("",name) and blank(newINrw.StrapMat)) then begin
					newINrw.StrapMat = "*";
				end;
			end;
		end;
    matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassStrapMatEFAfter = res;
return;
end;




global
function boolean NewIN2DClassClockFaceColourCodeEFAfter(integer wn,integer rownr,integer changed, var record NewINVc newINr)
begin
	integer i,mtrw,ni;
  record BtrxColourVc BTRxr;
	row NewINVc newINrw;	
  boolean res, TrHs;
  array string 255 name;
  TrHs = true;
	
	if(changed!=0)then begin
		if (newINr.SerNr==-1) then begin
			getwindowrecord(wn,newINr);
		end;
    matrowget(newINr,rownr,newINrw);
    BTRxr.Code = newINrw.ClockFaceColourCode;
    if (readfirstmain(BTRxr,1,true)) then begin
      newINrw.ClockFaceColourCode = BTRxr.Code;
    end
    else begin
      BTRxr.Name = newINrw.ClockFaceColourCode;
      if (readfirstkey("Name",BTRxr,1,true)) then begin
        newINrw.ClockFaceColourCode = BTRxr.Code;
      end;
    end;
		NewIN2ClockFaceColourCodeSClassArrayOnOpen(name,ni,NewINrw.ProductNameCode);
		if(name.length==0) then begin
			newINrw.ClockFaceColourCode = "";
		end else begin	
			if(!StrInArr(newINrw.ClockFaceColourCode,name) or blank(newINrw.ClockFaceColourCode)) then begin
				if (!StrInArr("",name)) then begin
					newINrw.ClockFaceColourCode = "*";
				end;
				if (StrInArr("",name) and blank(newINrw.ClockFaceColourCode)) then begin
					newINrw.ClockFaceColourCode = "*";
				end;
			end;
		end;
    matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassClockFaceColourCodeEFAfter = res;
return;
end;





global
function boolean NewIN2DClassClockFaceMaterialCodeEFAfter(integer wn,integer rownr,integer changed, var record NewINVc newINr)
begin
	integer i,mtrw,ni;
  record BtrxMaterialVc BTRxr;
	row NewINVc newINrw;	
  boolean res, TrHs;
  array string 255 name;
  TrHs = true;
	
	if(changed!=0)then begin
		if (newINr.SerNr==-1) then begin
			getwindowrecord(wn,newINr);
		end;
    matrowget(newINr,rownr,newINrw);
    BTRxr.Code = newINrw.ClockFaceMaterialCode;
    if (readfirstmain(BTRxr,1,true)) then begin
      newINrw.ClockFaceMaterialCode = BTRxr.Code;
    end
    else begin
      BTRxr.Name = newINrw.ClockFaceMaterialCode;
      if (readfirstkey("Name",BTRxr,1,true)) then begin
        newINrw.ClockFaceMaterialCode = BTRxr.Code;
      end;
    end;
		NewIN2ClockFaceMaterialCodeSClassArrayOnOpen(name,ni,NewINrw.ProductNameCode);
		if(name.length==0) then begin
			newINrw.ClockFaceMaterialCode = "";
		end else begin	
			if(!StrInArr(newINrw.ClockFaceMaterialCode,name) or blank(newINrw.ClockFaceMaterialCode)) then begin
				if (!StrInArr("",name)) then begin
					newINrw.ClockFaceMaterialCode = "*";
				end;
				if (StrInArr("",name) and blank(newINrw.ClockFaceMaterialCode)) then begin
					newINrw.ClockFaceMaterialCode = "*";
				end;
			end;
		end;
    matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassClockFaceMaterialCodeEFAfter = res;
return;
end;

global
function boolean NewIN2DClassCaseDiameterEFAfter(integer wn,integer rownr,integer changed, var record NewINVc newINr)
begin
	integer i,mtrw,ni;
  record BPIOdourVc BPIOdourr;
	row NewINVc newINrw;	
  boolean res, TrHs;
  array string 255 name;
	val strval;
	
  TrHs = true;
	
	if(changed!=0)then begin
		if (newINr.SerNr==-1) then begin
			getwindowrecord(wn,newINr);
		end;
    matrowget(newINr,rownr,newINrw);
		NewIN2CaseDiameterSClassArrayOnOpen(name,ni,NewINrw.ProductNameCode);
		strval = StringToVal(newINrw.CaseDiameter,M4Val);
		if(name.length==0) then begin
			newINrw.CaseDiameter = "";
		end else begin	
			if(strval<0.1 or strval>100) then begin
				newINrw.CaseDiameter = "*";
			end else begin
				newINrw.CaseDiameter = strval;
				newINrw.CaseDiameter = left (newINrw.CaseDiameter,len(newINrw.CaseDiameter)-1);
			end;	
		end;
    matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassCaseDiameterEFAfter = res;
return;
end;

global
function boolean NewIN2DClassWatchMechanismEFAfter(integer wn,integer rownr,integer changed, var record NewINVc newINr)
begin
	integer i,mtrw,ni;
  record BtrxWatchMechanVc BTRxr;
	row NewINVc newINrw;	
  boolean res, TrHs;
  array string 255 name;
  TrHs = true;
	
	if(changed!=0)then begin
		if (newINr.SerNr==-1) then begin
			getwindowrecord(wn,newINr);
		end;
    matrowget(newINr,rownr,newINrw);
    BTRxr.Code = newINrw.WatchMechanism;
    if (readfirstmain(BTRxr,1,true)) then begin
      newINrw.WatchMechanism = BTRxr.Code;
    end
    else begin
      BTRxr.Name = newINrw.WatchMechanism;
      if (readfirstkey("Name",BTRxr,1,true)) then begin
        newINrw.WatchMechanism = BTRxr.Code;
      end;
    end;
		NewIN2WatchMechanismSClassArrayOnOpen(name,ni,NewINrw.ProductNameCode);
		if(name.length==0) then begin
			newINrw.WatchMechanism = "";
		end else begin	
			if(!StrInArr(newINrw.WatchMechanism,name) or blank(newINrw.WatchMechanism)) then begin
				if (!StrInArr("",name)) then begin
					newINrw.WatchMechanism = "*";
				end;
				if (StrInArr("",name) and blank(newINrw.WatchMechanism)) then begin
					newINrw.WatchMechanism = "*";
				end;
			end;
		end;
    matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassWatchMechanismEFAfter = res;
return;
end;

global
function boolean NewIN2DClassPowerReserveEFAfter(integer wn,integer rownr,integer changed, var record NewINVc newINr)
begin
	integer i,mtrw,ni;
  record BtrxPowerReserveVc BTRxr;
	row NewINVc newINrw;	
  boolean res, TrHs;
  array string 255 name;
  TrHs = true;
	
	if(changed!=0)then begin
		if (newINr.SerNr==-1) then begin
			getwindowrecord(wn,newINr);
		end;
    matrowget(newINr,rownr,newINrw);
    BTRxr.Code = newINrw.PowerReserve;
    if (readfirstmain(BTRxr,1,true)) then begin
      newINrw.PowerReserve = BTRxr.Code;
    end
    else begin
      BTRxr.Name = newINrw.PowerReserve;
      if (readfirstkey("Name",BTRxr,1,true)) then begin
        newINrw.PowerReserve = BTRxr.Code;
      end;
    end;
		NewIN2PowerReserveSClassArrayOnOpen(name,ni,NewINrw.ProductNameCode);
		if(name.length==0) then begin
			newINrw.PowerReserve = "";
		end else begin	
			if(!StrInArr(newINrw.PowerReserve,name) or blank(newINrw.PowerReserve)) then begin
				if (!StrInArr("",name)) then begin
					newINrw.PowerReserve = "*";
				end;
				if (StrInArr("",name) and blank(newINrw.PowerReserve)) then begin
					newINrw.PowerReserve = "*";
				end;
			end;
		end;
    matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassPowerReserveEFAfter = res;
return;
end;

global
function boolean NewIN2DClassWaterResistantEFAfter(integer wn,integer rownr,integer changed, var record NewINVc newINr)
begin
	integer i,mtrw,ni;
  record BtrxWaterResistantVc BTRxr;
	row NewINVc newINrw;	
  boolean res, TrHs;
  array string 255 name;
  TrHs = true;
	
	if(changed!=0)then begin
		if (newINr.SerNr==-1) then begin
			getwindowrecord(wn,newINr);
		end;
    matrowget(newINr,rownr,newINrw);
    BTRxr.Code = newINrw.WaterResistant;
    if (readfirstmain(BTRxr,1,true)) then begin
      newINrw.WaterResistant = BTRxr.Code;
    end
    else begin
      BTRxr.Name = newINrw.WaterResistant;
      if (readfirstkey("Name",BTRxr,1,true)) then begin
        newINrw.WaterResistant = BTRxr.Code;
      end;
    end;
		NewIN2PWaterResistantSClassArrayOnOpen(name,ni,NewINrw.ProductNameCode);
		if(name.length==0) then begin
			newINrw.WaterResistant = "";
		end else begin	
			if(!StrInArr(newINrw.WaterResistant,name) or blank(newINrw.WaterResistant)) then begin
				if (!StrInArr("",name)) then begin
					newINrw.WaterResistant = "*";
				end;
				if (StrInArr("",name) and blank(newINrw.WaterResistant)) then begin
					newINrw.WaterResistant = "*";
				end;
			end;
		end;
    matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassWaterResistantEFAfter = res;
return;
end;

global
function boolean NewIN2DClassStoneScattA2EFAfter(integer wn,integer rownr,integer changed, var record NewINVc newINr)
begin
	integer i,mtrw,ni;
  record BPIOdourVc BPIOdourr;
	row NewINVc newINrw;	
  boolean res, TrHs;
  array string 255 name;
	val strval;
	
  TrHs = true;
	
	if(changed!=0)then begin
		if (newINr.SerNr==-1) then begin
			getwindowrecord(wn,newINr);
		end;
    matrowget(newINr,rownr,newINrw);
		NewIN2StoneScattA2SClassArrayOnOpen(name,ni,NewINrw.ProductNameCode);
		strval = StringToVal(newINrw.StoneScattA2,M4Val);
		if(name.length==0) then begin
			newINrw.StoneScattA2 = "";
		end else begin	
			if (newINrw.StoneScattA2!=">5") then begin
				if((strval<0.1 or strval>5)) then begin
					newINrw.StoneScattA2 = "*";
				end else begin
					newINrw.StoneScattA2 = strval;
					newINrw.StoneScattA2 = left(newINrw.StoneScattA2,len(newINrw.StoneScattA2)-1);
				end;
			end;
		end;
    matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassStoneScattA2EFAfter = res;
return;
end;

global
function boolean NewIN2DClassFillingEFAfter(integer wn,integer rownr,integer changed, var record NewINVc newINr)
begin
	integer i,mtrw,ni;
  record BtrxFillingVc BTRxr;
	row NewINVc newINrw;	
  boolean res, TrHs;
  array string 255 name;
  TrHs = true;
	
	if(changed!=0)then begin
		if (newINr.SerNr==-1) then begin
			getwindowrecord(wn,newINr);
		end;
    matrowget(newINr,rownr,newINrw);
    BTRxr.Code = newINrw.Filling;
    if (readfirstmain(BTRxr,1,true)) then begin
      newINrw.Filling = BTRxr.Code;
    end
    else begin
      BTRxr.Name = newINrw.Filling;
      if (readfirstkey("Name",BTRxr,1,true)) then begin
        newINrw.Filling = BTRxr.Code;
      end;
    end;
		NewIN2FillingSClassArrayOnOpen(name,ni,NewINrw.ProductNameCode);
		if(name.length==0) then begin
			newINrw.Filling = "";
		end else begin	
			if(!StrInArr(newINrw.Filling,name) or blank(newINrw.Filling)) then begin
				if (!StrInArr("",name)) then begin
					newINrw.Filling = "*";
				end;
				if (StrInArr("",name) and blank(newINrw.Filling)) then begin
					newINrw.Filling = "*";
				end;
			end;
		end;
    matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassFillingEFAfter = res;
return;
end;

global
function boolean NewIN2DClassMicrowaveSafeEFAfter(integer wn,integer rownr,integer changed, var record NewINVc newINr)
begin
	integer i,mtrw,ni;
  record BtrxMicrowaveProtectVc BTRxr;
	row NewINVc newINrw;	
  boolean res, TrHs;
  array string 255 name;
  TrHs = true;
	
	if(changed!=0)then begin
		if (newINr.SerNr==-1) then begin
			getwindowrecord(wn,newINr);
		end;
    matrowget(newINr,rownr,newINrw);
    BTRxr.Code = newINrw.MicrowaveSafe;
    if (readfirstmain(BTRxr,1,true)) then begin
      newINrw.MicrowaveSafe = BTRxr.Code;
    end
    else begin
      BTRxr.Name = newINrw.MicrowaveSafe;
      if (readfirstkey("Name",BTRxr,1,true)) then begin
        newINrw.MicrowaveSafe = BTRxr.Code;
      end;
    end;
		NewIN2MicrowaveSafeSClassArrayOnOpen(name,ni,NewINrw.ProductNameCode);
		if(name.length==0) then begin
			newINrw.MicrowaveSafe = "";
		end else begin	
			if(!StrInArr(newINrw.MicrowaveSafe,name) or blank(newINrw.MicrowaveSafe)) then begin
				if (!StrInArr("",name)) then begin
					newINrw.MicrowaveSafe = "*";
				end;
				if (StrInArr("",name) and blank(newINrw.MicrowaveSafe)) then begin
					newINrw.MicrowaveSafe = "*";
				end;
			end;
		end;
    matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassMicrowaveSafeEFAfter = res;
return;
end;

global
function boolean NewIN2DClassMatchesKitchenStoveEFAfter(integer wn,integer rownr,integer changed, var record NewINVc newINr)
begin
	integer i,mtrw,ni;
  record BtrxStoveCompatVc BTRxr;
	row NewINVc newINrw;	
  boolean res, TrHs;
  array string 255 name;
  TrHs = true;
	
	if(changed!=0)then begin
		if (newINr.SerNr==-1) then begin
			getwindowrecord(wn,newINr);
		end;
    matrowget(newINr,rownr,newINrw);
    BTRxr.Code = newINrw.MatchesKitchenStove;
    if (readfirstmain(BTRxr,1,true)) then begin
      newINrw.MatchesKitchenStove = BTRxr.Code;
    end
    else begin
      BTRxr.Name = newINrw.MatchesKitchenStove;
      if (readfirstkey("Name",BTRxr,1,true)) then begin
        newINrw.MatchesKitchenStove = BTRxr.Code;
      end;
    end;
		NewIN2MatchesKitchenStoveSClassArrayOnOpen(name,ni,NewINrw.ProductNameCode);
		if(name.length==0) then begin
			newINrw.MatchesKitchenStove = "";
		end else begin	
			if(!StrInArr(newINrw.MatchesKitchenStove,name) or blank(newINrw.MatchesKitchenStove)) then begin
				if (!StrInArr("",name)) then begin
					newINrw.MatchesKitchenStove = "*";
				end;
				if (StrInArr("",name) and blank(newINrw.MatchesKitchenStove)) then begin
					newINrw.MatchesKitchenStove = "*";
				end;
			end;
		end;
    matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassMatchesKitchenStoveEFAfter = res;
return;
end;

global
function boolean NewIN2DClassLimitedGoodEFAfter(integer wn,integer rownr,integer changed, var record NewINVc newINr)
begin
	integer i,mtrw,ni;
	row NewINVc newINrw;	
  boolean res, TrHs;
  array string 255 name;
  TrHs = true;
	
	if(changed!=0)then begin
		if (newINr.SerNr==-1) then begin
			getwindowrecord(wn,newINr);
		end;
    matrowget(newINr,rownr,newINrw);
		NewIN2LimitedGoodSClassArrayOnOpen(name,ni,NewINrw.ProductNameCode);
		if(name.length==0) then begin
			newINrw.LimitedGood = "";
		end else begin	
			if(!StrInArr(newINrw.LimitedGood,name)) then begin
				newINrw.LimitedGood = "*";
			end;	
		end;
    matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassLimitedGoodEFAfter = res;
return;
end;

global
function boolean NewIN2DClassWarrantyEFAfter(integer wn,integer rownr,integer changed, var record NewINVc newINr)
begin
	integer i,mtrw,ni;
	row NewINVc newINrw;	
  boolean res, TrHs;
  array string 255 name;
  TrHs = true;
	
	if(changed!=0)then begin
		if (newINr.SerNr==-1) then begin
			getwindowrecord(wn,newINr);
		end;
    matrowget(newINr,rownr,newINrw);
		NewIN2WarrantyClassArrayOnOpen(name,ni,NewINrw.ProductNameCode);
		if(name.length==0) then begin
			newINrw.OdourCl = "";
		end else begin	
			if(!StrInArr(newINrw.OdourCl,name)) then begin
				newINrw.OdourCl = "*";
			end;	
		end;
    matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassWarrantyEFAfter = res;
return;
end;


global
function boolean NewIN2DClassAddProdDescEFAfter(integer wn,integer rownr,integer changed, var record NewINVc newINr)
begin
	integer i,mtrw,ni;
	row NewINVc newINrw;	
  boolean res, TrHs;
  array string 255 name;
  TrHs = true;
	
	if(changed!=0)then begin
		if (newINr.SerNr==-1) then begin
			getwindowrecord(wn,newINr);
		end;
    matrowget(newINr,rownr,newINrw);
		NewIN2WarrantyClassArrayOnOpen(name,ni,NewINrw.ProductNameCode);
		if(name.length==0) then begin
			newINrw.AddProdDesc = "";
		end else begin	
			if(blank(newINrw.AddProdDesc)) then begin
				newINrw.AddProdDesc = "*";
			end;	
		end;
    matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassAddProdDescEFAfter = res;
return;
end;




global
function boolean NewIN2DClassCareEFAfter(integer wn,integer rownr,integer changed, var record NewINVc newINr)
begin
	integer i,mtrw,ni;
	row NewINVc newINrw;	
  boolean res, TrHs;
  array string 255 name;
  TrHs = true;
	
	if(changed!=0)then begin
		if (newINr.SerNr==-1) then begin
			getwindowrecord(wn,newINr);
		end;
    matrowget(newINr,rownr,newINrw);
		NewIN2CareSClassArrayOnOpen(name,ni,NewINrw.ProductNameCode);
		if(name.length==0) then begin
			newINrw.Care = "";
		end else begin	
			if(blank(newINrw.Care)) then begin
				newINrw.Care = "*";
			end;	
		end;
    matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassCareEFAfter = res;
return;
end;

global
function boolean NewIN2DClassSctrchresistantEFAfter(integer wn,integer rownr,integer changed, var record NewINVc newINr)
begin
	integer i,mtrw,ni;
	row NewINVc newINrw;	
  boolean res, TrHs;
  array string 255 name;
  TrHs = true;
	
	if(changed!=0)then begin
		if (newINr.SerNr==-1) then begin
			getwindowrecord(wn,newINr);
		end;
    matrowget(newINr,rownr,newINrw);
		NewIN2SctrchresistantSClassArrayOnOpen(name,ni,NewINrw.ProductNameCode);
		if(name.length==0) then begin
			newINrw.Sctrchresistant = "";
		end else begin	
			if(!StrInArr(newINrw.Sctrchresistant,name)) then begin
				newINrw.Sctrchresistant = "*";
			end;	
		end;
    matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassSctrchresistantEFAfter = res;
return;
end;

global
function boolean NewIN2DClassProdFeatEFAfter(integer wn,integer rownr,integer changed, var record NewINVc newINr)
begin
	integer i,mtrw,ni;
	row NewINVc newINrw;	
  boolean res, TrHs;
  array string 255 name;
  TrHs = true;
	
	if(changed!=0)then begin
		if (newINr.SerNr==-1) then begin
			getwindowrecord(wn,newINr);
		end;
    matrowget(newINr,rownr,newINrw);
		NewIN2ProdFeatSClassArrayOnOpen(name,ni,NewINrw.ProductNameCode);
		if(name.length==0) then begin
			newINrw.ProdFeat = "";
		end else begin	
			if(!StrInArr(newINrw.ProdFeat,name)) then begin
				newINrw.ProdFeat = "*";
			end;	
		end;
    matrowput(newINr,rownr,newINrw);
		putwindowrecord(wn,newINr);
	end;
	NewIN2DClassProdFeatEFAfter = res;
return;
end;







global
function boolean NewIN2DClassCodeEFAfter(integer wn,integer rownr,integer changed)
begin
	integer i,cnt;
	record NewINVc newINr;	
	boolean res;
	record BPISubGroupVc BPISubGr;
	row NewINVc newINrw;

	if(changed>0 and CurrentCompany!=18)then begin
		GetWindowRecord(wn,newINr);
		if(rownr>-1)then begin
			HandleNewIN2DClassCode(newINr,rownr);
		end;
		BPISubGr.Name = newINrw.SubGroupCl;
      if (readfirstkey("Name",BPISubGr,1,true)) then begin
        newINrw.SubGroupCl = BPISubGr.Code;
				matrowput(newINr,rownr,newINrw);
      end;
		putwindowrecord(wn,newINr);	
		GetWindowRecord(wn,NewINr);
    HandleNewIN2DClassSubGroupAfterCode(newINr,rownr);
		PutWindowRecord(wn,newINr);
	end;
	if(changed>0 and CurrentCompany==18)then begin
		GetWindowRecord(wn,newINr);
		if(rownr>-1)then begin
			matrowget(newINr,rownr,newINrw);
			if(NewINrw.ConsgType!=3 and NewINrw.ConsgType!=4) then begin
				HandleNewIN2DClassCode(newINr,rownr);
			end;	
			matrowput(newINr,rownr,newINrw);
		end;
		putwindowrecord(wn,newINr)	
	end;
  NewIN2DClassCodeEFAfter = res;
  return;
end;

global
function boolean NewIN2DClassConsgTypeEFAfter(integer wn,integer rownr,integer changed)
begin
	integer i,cnt;
	record NewINVc newINr,newIN2r;	
	boolean res;
	record BPISubGroupVc BPISubGr;
	row NewINVc newINrw,newIN2rw;

	if(changed>0 and CurrentCompany==18)then begin
		GetWindowRecord(wn,newINr);
		if(rownr>-1)then begin
			if (WindowState(wn)==Rs_update) then begin
				GetPrevWindowRecord(wn,newIN2r);
				matrowget(newINr,rownr,newINrw);
				matrowget(newIN2r,rownr,newIN2rw);
				if((newIN2rw.ConsgType==3 or newIN2rw.ConsgType==4) and (newINrw.ConsgType!=3 and newINrw.ConsgType!=4)) then begin
					newINrw.Code = "";
				end;
			end;	
			if (WindowState(wn)==Rs_insert) then begin
				matrowget(newINr,rownr,newINrw);
				if(newINrw.ConsgType!=3 and newINrw.ConsgType!=4) then begin
					newINrw.Code = "";
				end;
			end;
		end;
		matrowput(newINr,rownr,newINrw);
		PutWindowRecord(wn,newINr);
	end;
  NewIN2DClassConsgTypeEFAfter = res;
  return;
end;



global
function Boolean NewINDClassAfterEditField(Integer wn,string fieldname,Integer fn, Integer rownr,Integer changed)
BEGIN
  Boolean res;
  res = true;
  switch (fieldname) begin
    case "Code": res = NewINDClassmCodeEFAfter(wn,rownr,changed); //Edit***************************Sasha2,12:00 16.12.2015
    case "Name": res = NewINDClassmNameEFAfter(wn,rownr,changed);
		case "AlternativeCode": res = NewINDClassmAlternativeCodeEFAfter(wn,rownr,changed);
		case "ConsgType": res = NewINDClassmConsgTypeEFAfter(wn,rownr,changed);
		case "Brand": res = NewINDClassBrandEFAfter(wn,changed);
		case "BrandSC": res = NewINDClassBrandSCEFAfter(wn,rownr,changed);
		case "GroupCl": res = NewINDClassGroupClEFAfter(wn,rownr,changed); 
		case "Group": res = NewINDClassGroupEFAfter(wn,changed);
		case "Colour": res = NewINDClassColourEFAfter(wn,rownr,changed);
		case "classif30": res = NewINDClassclassif30EFAfter(wn,rownr,changed);
		case "Category": res = NewINDClassCategoryEFAfter(wn,rownr,changed);
  end;
  NewINDClassAfterEditField = res;
  RETURN;
END;

global
function Boolean NewIN2DClassAfterEditField(Integer wn,string fieldname,Integer fn, Integer rownr,Integer changed)
BEGIN
  Boolean res;
	record NewINVc NewINr, blankNewINr;
  res = true;
	GetWindowRecord(wn,NewINr);
	switch (fieldname) begin
		
		case "Code": res = NewIN2DClassCodeEFAfter(wn,rownr,changed); 
		case "Brand": res = NewIN2DClassBrandEFAfter(wn,changed);
		case "BrandSC": res = NewIN2DClassBrandSCEFAfter(wn,rownr,changed);
		case "Collection": res = NewIN2DClassCollectionEFAfter(wn,rownr,changed);
		case "GroupCl": res = NewIN2DClassGroupClEFAfter(wn,rownr,changed);
		case "SubGroupCl": if(NewINr.Brand!="BRND0046")then begin res = NewIN2DClassSubGroupClEFAfter(wn,rownr,changed, blankNewINr); end;
		case "ProductNameCode": res = NewIN2DClassProductNameCodeEFAfter(wn,rownr,changed, blankNewINr);
		case "classif31": res = NewIN2DClassclassif31EFAfter(wn,rownr,changed);
		case "Material": res = NewIN2DClassMaterialEFAfter(wn,rownr,changed);
		case "Color": res = NewIN2DClassColorEFAfter(wn,rownr,changed);
		case "ShapeCut": res = NewIN2DClassShapeCutEFAfter(wn,rownr,changed);
		case "SizeCl": res = NewIN2DClassSizeClEFAfter(wn,rownr,changed);
		case "UseCl": res = NewIN2DClassUseClEFAfter(wn,rownr,changed);
		case "SexCl": res = NewIN2DClassSexClEFAfter(wn,rownr,changed);
		case "PlatingCl": res = NewIN2DClassPlatingClEFAfter(wn,rownr,changed);
		case "ClaritySC": res = NewIN2DClassClaritySCEFAfter(wn,rownr,changed);
		case "WeightCl": res = NewIN2DClassWeightClEFAfter(wn,rownr,changed);
		case "CutCl": res = NewIN2DClassCutClEFAfter(wn,rownr,changed);
		case "StoneCl": res = NewIN2DClassStoneClEFAfter(wn,rownr,changed);
		case "Strap": res = NewIN2DClassStrapEFAfter(wn,rownr,changed); 
		case "OdourCl": res = NewIN2DClassOdourClFAfter(wn,rownr,changed);
		case "VendorCode": res = NewIN2DClassVendorCodeEFAfter(wn,rownr,changed);
		case "ConsgType": res = NewIN2DClassConsgTypeEFAfter(wn,rownr,changed);
		case "Length2": res = NewIN2DClassLength2EFAfter(wn,rownr,changed,blankNewINr);
		case "Width2": res = NewIN2DClassWidth2EFAfter(wn,rownr,changed,blankNewINr);
		case "Height2": res = NewIN2DClassHeight2EFAfter(wn,rownr,changed,blankNewINr);
		case "Diameter2": res = NewIN2DClassDiameter2EFAfter(wn,rownr,changed,blankNewINr);
		case "Volume2": res = NewIN2DClassVolume2EFAfter(wn,rownr,changed,blankNewINr);
		case "Weight2": res = NewIN2DClassWeight2EFAfter(wn,rownr,changed,blankNewINr);
		case "ItemSize": res = NewIN2DClassItemSizeEFAfter(wn,rownr,changed,blankNewINr);
		case "UnitOfMeasurement": res = NewIN2DClassUnitOfMeasurementEFAfter(wn,rownr,changed,blankNewINr);
		case "AllMaterials": res = NewIN2DClassAllMaterialsEFAfter(wn,rownr,changed,blankNewINr);
		case "CountInSet": res = NewIN2DClassCountInSetEFAfter(wn,rownr,changed,blankNewINr);
		case "DiamondsCarat": res = NewIN2DClassDiamondsCaratEFAfter(wn,rownr,changed,blankNewINr);
		case "Complications": res = NewIN2DClassComplicationsEFAfter(wn,rownr,changed,blankNewINr);
		case "StrapColourCode": res = NewIN2DClassStrapColourCodeEFAfter(wn,rownr,changed,blankNewINr);
		case "StrapMat": res = NewIN2DClassStrapMatEFAfter(wn,rownr,changed,blankNewINr);
		case "ClockFaceColourCode": res = NewIN2DClassClockFaceMaterialCodeEFAfter(wn,rownr,changed,blankNewINr);
		case "ClockFaceMaterialCode": res = NewIN2DClassCaseDiameterEFAfter(wn,rownr,changed,blankNewINr);
		case "CaseDiameter": res = NewIN2DClassCaseDiameterEFAfter(wn,rownr,changed,blankNewINr);
		case "WatchMechanism": res = NewIN2DClassWatchMechanismEFAfter(wn,rownr,changed,blankNewINr);
		case "PowerReserve": res = NewIN2DClassPowerReserveEFAfter(wn,rownr,changed,blankNewINr);
		case "WaterResistant": res = NewIN2DClassWaterResistantEFAfter(wn,rownr,changed,blankNewINr);
		case "StoneScattA2": res = NewIN2DClassStoneScattA2EFAfter(wn,rownr,changed,blankNewINr);
		case "Filling": res = NewIN2DClassFillingEFAfter(wn,rownr,changed,blankNewINr);
		case "MicrowaveSafe": res = NewIN2DClassMicrowaveSafeEFAfter(wn,rownr,changed,blankNewINr);
		case "MatchesKitchenStove": res = NewIN2DClassMatchesKitchenStoveEFAfter(wn,rownr,changed,blankNewINr);
		case "LimitedGood": res = NewIN2DClassLimitedGoodEFAfter(wn,rownr,changed,blankNewINr);
		case "Warranty": res = NewIN2DClassWarrantyEFAfter(wn,rownr,changed,blankNewINr);
		case "AddProdDesc": res = NewIN2DClassAddProdDescEFAfter(wn,rownr,changed,blankNewINr);
		case "Care": res = NewIN2DClassCareEFAfter(wn,rownr,changed,blankNewINr);
		case "Sctrchresistant": res = NewIN2DClassSctrchresistantEFAfter(wn,rownr,changed,blankNewINr);
		case "ProdFeat": res = NewIN2DClassProdFeatEFAfter(wn,rownr,changed,blankNewINr);
	end;
  NewIN2DClassAfterEditField = res;
  RETURN;
END;

global
function Boolean NewINDClassActiveEditField(Integer wn,string fieldname,Integer fn,Integer wnst,Integer rownr,Integer changed)
begin
	record NewINVc newINr;
	boolean res;
	
	res = true;
	
	getwindowrecord(wn,newINr);
	
	if(newINr.OKFlag==1)then begin
		res = false;
		if(fieldname=="OKFlag")then begin
			res = true;
		end;
	end;
	
	
	NewINDClassActiveEditField = res;
	
return;
end;


global
function Boolean NewIN2DClassActiveEditField(Integer wn,string fieldname,Integer fn,Integer wnst,Integer rownr,Integer changed)
begin
	record NewINVc newINr;
	row NewINVc newINrw;
	boolean res;
	record ConsCompBlock CCB;

	
	BlockLoad(CCB);
	res = true;
	
	getwindowrecord(wn,newINr);
	if(CCB.OKFlag!=0) then begin
		if(rownr>-1) then begin
			matrowget(newINr,rownr,newINrw);
			if(fieldname=="Code" and newINrw.ConsgType!=3 and newINrw.ConsgType!=4) then begin
				res = false;
			end;
			if((newINrw.ConsgType==3 or newINrw.ConsgType==4) and fieldname=="ConsgType") then begin 
				res = false;
			end;	
		end;	

		if(Blank(newINr.Brand) and fieldname!="Brand" and fieldname!="Group" and rownr>-1) then begin 
			res = false;
			MessageBox(0,"Џоле Brand должен быть заполнен!");
		end;	
		if(fieldname=="Brand" or fieldname=="Group") then begin
			res = true;
		end;
	end;	
	/*if(left(currentuser,2)=="SA")then begin
		res = true;
	end;*/
	
	NewIN2DClassActiveEditField = res;
	
return;
end;



global updating procedure ExportINToOthDsm()
begin
record NewINVc newINr;
record NewINVc OthCompnewINr;
integer wn;
integer curcomp;

curcomp = currentcompany;
wn=CurWindow;
GetWindowRecord(wn,newINr);
	if(CurrentCompany == 4) then begin
		SetCompany(25,false);
		RecordNew(OthCompnewINr);
		RecordCopy(OthCompnewINr,newINr);
		OthCompnewINr.SerNr = NextSerNr("NewINVc",currentdate,-1,false,""); 	
		OthCompnewINr.OKFlag=0;
		RecordStore(OthCompnewINr,true);
		SetCompany(curcomp,false);
	end else begin 
		SetCompany(4,false);
		RecordNew(OthCompnewINr);
		RecordCopy(OthCompnewINr,newINr);
		OthCompnewINr.SerNr = NextSerNr("NewINVc",currentdate,-1,false,""); 	
		OthCompnewINr.OKFlag=0;
		RecordStore(OthCompnewINr,true);
		SetCompany(curcomp,false);
	end;	
return;
end;

global procedure SortbySub()
begin 
record newINVc nINr;
integer wn;

wn = curwindow;
getwindowrecord(wn,nINr);
SortRows(nINr,"SubGroupCl",true);
putwindowrecord(wn,nINr);
return;
end;

global procedure CheckCCItemsInCompanies()
begin 
record newINVc nINr;
row newINVc newINrw;
record INVc testINr;
integer wn,CompQty,i,j,oldCompany,qty;
string 255 Company;

wn = curwindow;
getwindowrecord(wn,nINr);
qty = matrowcnt(nINr);
for (i=0;i<qty;i=i+1) begin
	matrowget(nINr,i,newINrw);
	Company = CheckNewRowInCompanies(newINrw);
	if(nonblank(Company)) then begin
		messagebox(0, "’овар " & newINrw.VendorCode & "в строке " & i+1 &" уже существует в компаниЯх " & Company);
	end;
end;
return;
end;


global procedure GIServerSequenceDsm()
begin
	integer wn;
	record GlobalItemVc GIr,origGIr;
	
	wn = curwindow;
	getwindowrecord(wn,GIr);
	
	messagebox(0,remotegetrecordseq(GIr));

return;
end;

/*global 
function boolean CheckChangesCodeNewINVc(Integer rownr)
begin
boolean res;
integer wn;

res = true;
wn = curwindow;
if(!NewINDClassCategoryEFAfter(wn,rownr,1)) then begin
	res = false;
	messagebox(0,"Ќе найдена категориЯ в строке - " & rownr);
end;

if(!NewINDClassclassif30EFAfter(wn,rownr,1)) then begin
	res = false;
	messagebox(0,"Ќе найдена модель в строке - " & rownr);
end;

if(!NewINDClassColourEFAfter(wn,rownr,1)) then begin
	res = false;
	messagebox(0,"Ќе найден цвет в строке - " & rownr);
end;

if(!NewINDClassGroupEFAfter(wn,1)) then begin
	res = false;
	messagebox(0,"Ќе найдена группа");
end;

if(!NewINDClassBrandEFAfter(wn,1)) then begin
	res = false;
	messagebox(0,"Ќе найден бренд");
end;

if(!NewINDClassBrandSCEFAfter(wn,rownr,2)) then begin
	res = false;
	messagebox(0,"Ќе найден бренд в строке - " & rownr);
end;

CheckChangesCodeNewINVc = res;

return;
end;*/
//server-only
external function val AbsoluteVal(val);
external function roundmode SetRoundModeD(Integer);
external procedure NoDupObjs(string,var string);
external procedure ExtractObj(string,var Integer,var string);
remote procedure NextM4SerialNumber(string,var string);
remote function boolean CompanyIsJWLikeCompany(Integer);
external procedure StripSpace(var string,string); //Edit_________________ABR 16.10 10:10; 
external procedure PUSumUp(var record PUVc);
external function Boolean GetItemPurchasePriceDiscount(string,string,Date,string,string,val,string,string,string,string,Integer,Boolean,val,val,val,val,val,
         var record INVc,var record PIVc,var Boolean,var val,var string,var val,var string,var string,var Boolean,var string);
external function Boolean GetFirstPurchaseItem2(string,string,string,var record PIVc);
external procedure CurValToOtherCur(Date,string,val,string,var val,roundmode);
external function val DivRateToBase1(string,val,val,val,val,val,val,roundmode);
external procedure GetItemVATCode(string,Integer,var string,Boolean);
external function Boolean GetFirstPurchaseItem(string,string,string,var record PIVc);
external function roundmode GetCostRoundMode(record RoundBlock);
external function string 255 FillupTaxMatrix(Integer,string,string,string,string,string,var record TaxMatrixVc); 
external function string 255 FindINObjects(string,string);
external function val MulRateToBase1(var string,val,val,val,val,val,val,roundmode);
external procedure PUCalcPerc(val,string,var val); 
external procedure DivPIFactor(val,val,var val);
external procedure FindPUStockAcc(string,record CostAccBlock,string,string,string,record INVc,Integer,var string,var string,Boolean);
external procedure PUCalcCostPrice(string,val,Integer,Integer,string,string,
                                   val,val,val,val,val,
                                   val,val,val,val,val,val,
                                   string,var val,val,var val,string,Integer); //Edit***************************Sasha2,13:04 08.04.2015
external updating procedure UpdateGlobalItem(var record INVc); // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger10:31 21.08.2018
external updating procedure CreateNewGlobalItem(var record INVc);// Edit ************************** BPI Ukraine - KramarAlexandr - Wednesday, 26 December 2018 12:42:52
external procedure GetPriceItem(string,var val,var val);
external function string 255 StrReplace(string,string,string);// Edit ************************** BPI Ukraine - KramarAlexandr - Tuesday, 19 March 2019 14:26:14
external function Boolean SetInSet2(string,string);
external procedure StripEndingSpaces(var string);
external procedure ExtractObjWithSeparator(string,string,Boolean,var Integer,var string);
external procedure AddAreaAfterArea(var area,area);
external procedure LogProcTime(string,longint);
external updating procedure SendAsyncUpdateContactToCRM(var record CUVc);
external procedure NextCode(string,var string);
external procedure CheckFlush(var Integer,Integer);
external procedure FillClassInM4Text(var record GlobalItemVc, string, string, string, string, 
																																			string, string, string, area);
external procedure FillClassInM4TextWithTP(var record GlobalItemVc, string, string, string, string, 
																																			string, string, string, area, longint, string);
external updating procedure CreateChiccoGlobalItem(string, string, string, string, boolean);  // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 9:22 16.10.2020
external updating procedure CreateExtProvGlobalItem(string, string, string, string, boolean, string, boolean, string, boolean, string, boolean, longint);  // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 9:22 16.10.2020
external updating procedure Instock0(string);
external function boolean NewIN2DClassProductNameCodeEFAfter(integer,integer,integer,var record NewINVc);
external function boolean NewIN2DClassSubGroupClEFAfter(integer,integer,integer,var record NewINVc);
remote procedure CheckItemCC(var record newINVc, integer);
external updating procedure CreateTPGlobalItem(string, string, string, array string, vector string);  // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger
external updating procedure SetReffItem(string, string);  // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 11:40 18.02.2021
external updating procedure CreateGlobalSet(string,string,val,string);  // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 18:06 19.02.2021
external procedure TimeStamps(var row GlobalItemVc,val,string); //Edit **********************************************Vas-P	06/07/2021
external procedure GIWasUpdated(record GlobalItemVc,record GlobalItemVc,string);	//Edit **********************************************Vas-P	14/07/2021

SetLangMode(LangRussian,"RUS",0); 





global updating procedure SaveGI(Record GlobalItemVc GIr)
begin
	record GlobalItemVc LogGIr;

	recordcopy(LogGIr,GIr);
	GIWasUpdated(GIr,LogGIr," GIWasUpdatedlog 102");
	RecordStore(GIr,true);
	
return;
end;






procedure PUVc_FillRow(var record PUVc PUr,Integer rownr)		//Edit-----------Dima 25.12.2014
BEGIN
  Boolean res;
  record CostAccBlock CostAccRec;
  record PIVc PIr;
  record INVc INr;
  row PUVc PUrw;
  Boolean chrsum;
  string 60 sz,msk,mskrep,pcstr,tstr;
  val t,p,s,t2;
  record SysFormatBlock SFb;
  string 200 varsubset,location;
  Boolean infoundf;
  record RoundBlock Roundb;
  string 20 stockacc,purchacc;
  record LocationVc Locr;
  record MainStockBlock MSb;
  Boolean nomoreremotecalls,pifound;
  record TaxMatrixVc TMr;
  string 255 taxtemplatecode,vatcode,descstr;
  val price,reb;
  
  MatRowGet(PUr,rownr,PUrw); 

  infoundf = GetItemPurchasePriceDiscount(PUr.VECode,PUr.Location,PUr.TransDate,PUr.CurncyCode,PUrw.ArtCode,PUrw.Quant,
                                   PUr.Location,"","","",0,true,
                                   PUr.FrRate,PUr.ToRateB1,PUr.ToRateB2,PUr.BaseRate1,PUr.BaseRate2,
                                   INr,PIr,pifound,price,descstr,reb,vatcode,purchacc,nomoreremotecalls,taxtemplatecode);
  if (infoundf) then begin
    BlockLoad(SFb);
    BlockLoad(CostAccRec);    
    BlockLoad(Roundb);    
    BlockLoad(MSb);
    Locr.Code = PUr.Location;
    if (blank(Locr.Code)) then begin
      Locr.Code = MSb.MainStock;
    end;
    ReadFirstMain(Locr,1,true);
		
    pcstr = "";
		/*
    if (GetFirstPurchaseItem(PUrw.ArtCode,PUr.Location,PUr.VECode,PIr)) then begin
      if (PIr.CurncyCode==PUr.CurncyCode) then begin
		if (blank(PUrw.UPrice)) then begin
     	   PUrw.UPrice = PIr.PurPrice;
		   p = PIr.PurPrice;
		end else begin
		   p =  PUrw.UPrice;
		end;
        
      end else begin
        CurValToOtherCur(PUr.TransDate,PIr.CurncyCode,PIr.PurPrice,PUr.CurncyCode,t,GetCostRoundMode(Roundb));
        PUrw.UPrice = t;  
        p = PUrw.UPrice;
      end;          
      PUrw.CountryOfOrg = PIr.OrgCountry;
      PUrw.CustomsCost = PIr.PurchaseCost;
      PUrw.VEItemCode = PIr.VEItemCode;
      PUrw.VEUnit = PIr.VEUnit;
      PUrw.CountryOfOrg = PIr.OrgCountry;
      if (INr.PriceFactor!=0) then begin
        p = p/INr.PriceFactor;
      end;
    end else begin
      PUrw.Spec = INr.Name;
		if (blank(PUrw.UPrice)) then begin
		      PUrw.UPrice = INr.InPrice;
			 p = INr.InPrice;
		end else begin
		      p = PUrw.UPrice;
		end;
      if (INr.PriceFactor!=0) then begin
        p = p/INr.PriceFactor;
      end;
      p = DivRateToBase1(PUr.CurncyCode,p,PUr.FrRate,PUr.ToRateB1,PUr.ToRateB2,PUr.BaseRate1,PUr.BaseRate2,GetCostRoundMode(Roundb));
    end;*/ 
    PUrw.VATCode = PUr.VEVATCode;    
    if (blank(PUrw.VATCode)) then begin
      GetItemVATCode(PUrw.ArtCode,PUr.ExportFlag,tstr,false);
      PUrw.VATCode = tstr;
    end;
    PUrw.TaxTemplateCode = FillupTaxMatrix(1,PUr.BranchID,PUr.VECode,"","",taxtemplatecode,TMr);
    PUrw.Coefficient = INr.UnitCoefficient;
    //PUrw.InPrice = INr.InPrice;
    PUrw.ArtCode = INr.Code;
    PUrw.Spec = INr.Name;
    PUrw.Objects = FindINObjects(INr.Objects,INr.Group);
    //PUrw.UPrice = p;
    PUrw.UnitXval = INr.Width;
    PUrw.UnitYval = INr.Height;
    PUrw.UnitZval = INr.Depth;
    PUrw.UnitCode = INr.Unittext;
    location = PUrw.Location;
    if (blank(location)) then begin
      location = PUr.Location;
    end;
    if (Locr.RequirePos!=0) then begin
      PUrw.PosCode = Locr.WHMDefPUPosCode;
    end;

    //t2 = MulRateToBase1(PUr.CurncyCode,p,PUr.FrRate,PUr.ToRateB1,PUr.ToRateB2,PUr.BaseRate1,PUr.BaseRate2,GetCostRoundMode(Roundb));
    //PUCalcPerc(t2,PUrw.CustomsCost,t2);
    pcstr = ValToString(t2,M45Val,SFb.thousSep,SFb.decimalPt,0);
    PUrw.CustomsCost = pcstr;
    //PUrw.BasePrice = INr.UPrice1;
    tstr = INr.ExtraCost;
    PUrw.Extra = tstr;
    PUrw.PIFactor = PIr.PIFactor;
    PUrw.StockType = PIr.DefStockType;
    /*if (PUrw.PIFactor!=0) then begin
      PUrw.UPrice = PUrw.UPrice/PUrw.PIFactor;
    end;*/
    //DivPIFactor(PUrw.Quant,PUrw.PIFactor,t);
    PUrw.VEQuant = t;
    
    if (blank(PUrw.Location)) then begin
      //FindPUStockAcc(PUr.VECode,CostAccRec,PUrw.CostAcc,PUrw.CredAcc,PUr.Location,INr,PUrw.StockType,stockacc,purchacc,true);
    end else begin
      //FindPUStockAcc(PUr.VECode,CostAccRec,PUrw.CostAcc,PUrw.CredAcc,PUrw.Location,INr,PUrw.StockType,stockacc,purchacc,true);
    end;
    PUrw.CostAcc = stockacc;
    PUrw.CredAcc = purchacc;

    PackRowFieldMatrix(PUrw,"TaxMatrix",TMr);
    MatRowPut(PUr,rownr,PUrw);
    chrsum = true;
    res = true;
  end;
	/*
  if (chrsum) then begin
    PUCalcCostPrice(PUrw.ArtCode,PUrw.UPrice,PUr.InclVAT,PUr.NoTAXonVAT,PUrw.Extra,PUr.CurncyCode,
                    PUr.FrRate,PUr.ToRateB1,PUr.ToRateB2,PUr.BaseRate1,PUr.BaseRate2,
                    PUrw.ShipCost,PUrw.RowCost1,PUrw.RowCost2,PUrw.RowCost3,PUrw.RowCost4,PUrw.RowCost5,
                    PUrw.CustomsCost,p,PUrw.Quant,s,PUrw.VATCode,PUr.ExportFlag);
    PUrw.CostPrice = p;
    PUrw.Sum = s;
  end;*/
  MatRowPut(PUr,rownr,PUrw);    

  RETURN;
END;

Global updating procedure FillNamesIm()
begin
record INVc INr;
record GlobalItemVc GIr,LogGIr;
row INVc INrw;
string 255 code;
array string 255 names,codes;
integer i,oldComp,j,CompQty;
record CompaniesBlock Compb;
row CompaniesBlock Comprw;		
	BlockLoad(Compb);
	
	logtext(0,"FillNamesIm start");
	CompQty = matrowcnt(Compb);
	
	oldComp = currentcompany;
		while (TestEOF()==false) begin
			code = importfield;
			//logtext(0,code);
			for (i=0;i<1;i=i+1) begin
				codes[i] = importfield;
			end;
			for (i=0;i<1;i=i+1) begin
				names[i] = importfield;
			end;
			for (j=0;j<CompQty;j=j+1)begin
				matrowget(Compb,j,Comprw);
				if(Comprw.ActiveStatus==0 and (!CompanyIsJWLikeCompany(j+1) or j+1==3) and j+1!=10)then begin
					setcompany(j+1,false);
					INr.Code = code;
					if(ReadFirstMain(INr,1,true)) then begin
						for (i=0;i<1;i=i+1) begin
							if(nonblank(names[i])) then begin
								matrowget(INr,i,INrw);
								INrw.LangCode = codes[i];
								INrw.Text = names[i];
								matrowput(INr,i,INrw);
							end;
						end;
						// logtext(0,INr.Code);
						RecordStore(INr,true);
						GIr.Code = INr.GlobalArtCode;
						if(ReadFirstkey("Code",GIr,1,true)) then begin
							recordcopy(LogGIr,GIr);
							for (i=0;i<1;i=i+1) begin
								if(nonblank(names[i])) then begin
									if(codes[i]=="RUS") then begin GIr.NameRUS = names[i]; end;
									if(codes[i]=="AZ") then begin GIr.NameAZ = names[i]; end;
								end;
							end;
							GIWasUpdated(GIr,LogGIr," GIWasUpdatedlog 103");
							RecordStore(GIr,true);
						end;
					end;	
	
				end;
			end;	
		NextImportLine(true);
		end;
	setcompany(oldComp,false);
	logtext(0,"FillNamesIm finish");
 return;
end;

Global updating procedure FillPresIm()
begin
	record PLVc PLr;
	Integer i,j,oldComp,CompQty;
	array string 255 sfield;
	record GlobalItemVc GIr,LogGIr;
	string 5 flag;
	record INVc INr;
	record PLDefVc PLDr;
	val price, calcprice, calcrebate;		
	record CurncyCodeVc Curncyr;
	string 255 tstr,code;
	record CompaniesBlock Compb;
	row CompaniesBlock Comprw;		
	BlockLoad(Compb);
	
	
	CompQty = matrowcnt(Compb);
	
		oldComp = currentcompany;
		while (TestEOF()==false) begin
			code = ImportField; 
			for (i=0;i<26;i=i+1) begin
				sfield[i]=ImportField;
			end;
			for (j=0;j<CompQty;j=j+1)begin
				matrowget(Compb,j,Comprw);
				if(Comprw.ActiveStatus==0 and (!CompanyIsJWLikeCompany(j+1) or j+1==3) and j+1!=10)then begin
					setcompany(j+1,false);
					INr.Code = code;
					if(readfirstmain(INr,1,true)) then begin
						INr.BTRxGiftClass = "";
						for (i=0;i<26;i=i+1) begin
							if(nonblank(sfield[i])) then begin
								INr.BTRxGiftClass = INr.BTRxGiftClass & sfield[i] & ",";
							end;
						end;
						/*INr.BTRxGiftClass = left(INr.BTRxGiftClass,len(INr.BTRxGiftClass) - 1);
						RecordStore(INr,true);*/
					
						GIr.Code = INr.GlobalArtCode;
						if(readfirstKey("Code",GIr,1,true)) then begin
							recordcopy(LogGIr,GIr);
							GIr.BTRxGiftClass = "";
							for (i=0;i<26;i=i+1) begin
								if(nonblank(sfield[i])) then begin								
									GIr.BTRxGiftClass = GIr.BTRxGiftClass & sfield[i] & ",";
								end;
							end;
							GIr.BTRxGiftClass = left(GIr.BTRxGiftClass,len(GIr.BTRxGiftClass) - 1);
							GIWasUpdated(GIr,LogGIr," GIWasUpdatedlog 104");
							RecordStore(GIr,true);
						end;
					end;
				end;
			end;	
		NextImportLine(true);
		end;
	setcompany(oldComp,false);
 return;
end;

Global updating procedure ImportPLIn()
begin
	record PLVc PLr;
	Integer i;
	array string 255 sfield;
	string 5 flag;
	record INVc INr;
	record PLDefVc PLDr;
	val price, calcprice, calcrebate;		
	record CurncyCodeVc Curncyr;
	string 50 tstr;
		
		while (TestEOF()==false) begin
		  for (i=0;i<5;i=i+1) begin
        sfield[i]=ImportField;
        tstr = "";
				StripSpace(tstr,sfield[i]); //Edit_________________ABR 16.10 10:10;
				sfield[i] = tstr;
      end;
      INr.Code = sfield[1];
      if(readfirstmain(INr,1,true))then begin
        PLDr.Code = sfield[0];
        if(readfirstmain(PLDr,1,true))then begin
          if(nonblank(sfield[2]))then begin
            price = evaltoval(sfield[2]);
            if(price>0)then begin
              recordnew(PLr);
              PLr.PLCode = PLDr.Code;
              PLr.ArtCode = INr.Code;
              PLr.Comment = INr.Name;
              PLr.ExVatPrice = price;
              Curncyr.CurncyCode = sfield[3];
              if(readfirstmain(Curncyr,1,true))then begin
              	PLr.CurncyCode = Curncyr.CurncyCode;
              end;
              if(nonblank(sfield[4]) and INr.SerNrf!=0)then begin
              	PLr.SerialNr = sfield[4];
              end;
              if(RecordInsert(PLr,true))then begin
								//GetPriceItem(INr.Code,calcprice,calcrebate);
							end;
            end;            
          end;
        end;
      end else begin
      	INr.AlternativeCode = sfield[1];
      	if(readfirstKey("AlternativeCode",INr,1,true))then begin
					PLDr.Code = sfield[0];
					if(readfirstmain(PLDr,1,true))then begin
						if(nonblank(sfield[2]))then begin
							price = evaltoval(sfield[2]);
							if(price>0)then begin
								recordnew(PLr);
								PLr.PLCode = PLDr.Code;
								PLr.ArtCode = INr.Code;
								PLr.Comment = INr.Name;
								PLr.ExVatPrice = price;
								Curncyr.CurncyCode = sfield[3];
								if(readfirstmain(Curncyr,1,true))then begin
									PLr.CurncyCode = Curncyr.CurncyCode;
								end;
								if(nonblank(sfield[4]) and INr.SerNrf!=0)then begin
									PLr.SerialNr = sfield[4];
								end;
								if(RecordInsert(PLr,true))then begin
									//GetPriceItem(INr.Code,calcprice,calcrebate);
								end;
							end;            
						end;
					end;
				end else begin
					INr.BarCode = sfield[1];
					if(readfirstKey("BarCode",INr,1,true))then begin
						PLDr.Code = sfield[0];
						if(readfirstmain(PLDr,1,true))then begin
							if(nonblank(sfield[2]))then begin
								price = evaltoval(sfield[2]);
								if(price>0)then begin
									recordnew(PLr);
									PLr.PLCode = PLDr.Code;
									PLr.ArtCode = INr.Code;
									PLr.Comment = INr.Name;
									PLr.ExVatPrice = price;
									Curncyr.CurncyCode = sfield[3];
									if(readfirstmain(Curncyr,1,true))then begin
										PLr.CurncyCode = Curncyr.CurncyCode;
									end;
									if(nonblank(sfield[4]) and INr.SerNrf!=0)then begin
										PLr.SerialNr = sfield[4];
									end;
									if(RecordInsert(PLr,true))then begin
										//GetPriceItem(INr.Code,calcprice,calcrebate);
									end;
								end;            
							end;
						end;
					end;
				end;
      end;
      NextImportLine(true);
		end;

 return;
end;

Global updating procedure ImportPLCurIn()
begin
	record PLVc PLr;
	Integer i;
	array string 255 sfield;
	string 5 flag;
	record INVc INr;
	record PLDefVc PLDr;
	val price;		
	record CurncyCodeVc Curncyr;
	string 50 tstr,plcode,item,curncy;
		
		while (TestEOF()==false) begin
		  plcode = ImportField;
		  item = ImportField;
		  curncy = ImportField;
		  
		  if(nonblank(plcode) and nonblank(item) and nonblank(curncy))then begin
		  	PLr.PLCode = plcode;
		  	PLr.ArtCode = item;
		  	if(readfirstmain(PLr,2,true))then begin
		  		PLr.CurncyCode = curncy;
		  		recordstore(PLr,true);
		  	end;
		  end;
		  
      NextImportLine(true);
		end;

 return;
end;


Global updating procedure ImportDiskTableIn()
begin
	record CUVc CUr,oldCUr;
	record RebVc Rebr;
	integer i;
	string 255 sfield0,sfield1;
	
		while (TestEOF()==false) begin
			sfield0 = "";
			sfield1 = "";
			sfield0=ImportField;
			sfield1=ImportField;
      CUr.Code = sfield0;
      if(readfirstmain(CUr,1,true))then begin
        Rebr.Code = sfield1;
        if(readfirstmain(Rebr,1,true))then begin
          if(CUr.RebCode!=Rebr.Code)then begin
          	recordcopy(oldCUr,CUr);
          	CUr.RebCode = Rebr.Code;
          	recordUpdate(oldCUr,CUr,true);
          end;
        end;
      end;
      NextImportLine(true);
		end;

 return;
end;

procedure FormatString(var string field)// Edit ***** 20 June 2013 15:17:00 Larisa
begin
	string 255 tempfield,s;
	integer i,ns;
	
	tempfield = field;
	field = "";
	for (i=0;i<len(tempfield);i=i+1) begin
		s = mid(tempfield,i,1);
		ns = asc(s);
		if(ns>=32 and ns<=126)then begin
			if(ns!=34)then begin
				field = field & s;
			end;
		end;
		if(ns>=1040 and ns<=1103)then begin
			field = field & s;
		end;
	end;
	return;
end;// Edit ***** 20 June 2013 15:17:00 Larisa

global
procedure FormatUpperCaseCode(var string field)// Edit ***** 20 June 2013 15:17:00 Larisa
begin
	string 255 tempfield,s;
	integer i,ns;
	
	tempfield = UpperCase(field);
	field = "";
	for (i=0;i<len(tempfield);i=i+1) begin
		s = mid(tempfield,i,1);
		ns = asc(s);
		if(ns>=32 and ns<=96)then begin
			if(ns!=34 and ns!=44 and ns!=58)then begin
				if(ns==32)then begin
					field = field & chr(95);
				end else begin
					field = field & s;
				end;
			end;
		end;
		if(ns>=123 and ns<=126)then begin
			field = field & s;
		end;
		if(ns>=1040 and ns<=1071)then begin
			field = field & s;
		end;
	end;
	return;
end;// Edit ***** 20 June 2013 15:17:00 Larisa

updating procedure ReturnCodeClassification(var string classification)// Edit ***** 21 June 2013 10:39:00 Larisa
begin
	Integer cnt;
	record DIVc DIr;
	
	if(nonblank(classification))then begin
		DIr.Code = classification;
		if(ReadFirstMain(DIr,1,true)==false)then begin
			DIr.Name = classification;
			if(ReadFirstKey("Name",DIr,1,true)==false)then begin
				cnt = CountRecords("DIVc");
				RecordNew(DIr);
				LCntDIr:;
				DIr.Code = cnt+1;
				if(ReadFirstMain(DIr,1,true))then begin
					cnt = cnt + 1;
					goto LCntDIr;
				end;
				DIr.Code = cnt+1;
				DIr.Name = classification;
				classification = DIr.Code;
				RecordStore(DIr,true);
			end else begin
				classification = DIr.Code;
			end;
		end else begin
			classification = DIr.Code;
		end;
		
	end;
	return;
end;// Edit ***** 21 June 2013 10:39:00 Larisa

Global updating procedure ImportMyINIn()
begin
	record INVc INr;
	record RebVc Rebr;
	record ITVc ITr;
	integer i;
	string 255 sfield0,sfield1,sfield2,sfield3,sfield4,ressfield4,alternat,color,size;
		
	while (TestEOF()==false) begin
		sfield0 = "";
		sfield1 = "";
		sfield2 = "";
		alternat = "";
		color = "";
		size = "";
		sfield3 = "";
		sfield4 = "";
		ressfield4 = "";
		sfield0 = ImportField;
		if(nonblank(sfield0))then begin
			FormatUpperCaseCode(sfield0);
			sfield1 = ImportField;
			if(nonblank(sfield1))then begin
				FormatString(sfield1);
			end;
			sfield2 = ImportField;
			if(nonblank(sfield2))then begin
				FormatString(sfield2);
			end;
			alternat = ImportField;
			color = ImportField;
			size = ImportField;
			sfield3 = ImportField;
			if(nonblank(sfield3))then begin//validate group
				ITr.Code = sfield3;
				if(ReadFirstMain(ITr,1,true)==false)then begin
					ITr.Comment = sfield3;
					if(ReadFirstKey("Comment",ITr,1,true)==false)then begin
						sfield3 = "";
					end else begin
						sfield3 = ITr.Code;
					end;
				end else begin
					sfield3 = ITr.Code;
				end;
			end;//validate group
			sfield4 = ImportField;
			if(nonblank(sfield4))then begin
				FormatString(sfield4);
				ReturnCodeClassification(sfield4);
				UpperCase(sfield4);
			end;
			while(nonblank(sfield4))begin
				if(nonblank(ressfield4))then begin
					ressfield4 = ressfield4 & "," & sfield4;
				end else begin
					ressfield4 = ressfield4 & sfield4;
				end;
				sfield4 = ImportField;
				if(nonblank(sfield4))then begin
					FormatString(sfield4);
					ReturnCodeClassification(sfield4);
					UpperCase(sfield4);
				end;
			end;
			INr.Code = sfield0;
			if(ReadFirstMain(INr,1,true))then begin
				if(nonblank(sfield1))then begin
					INr.Name = sfield1;
				end;
				if(nonblank(sfield2))then begin
					INr.BarCode = sfield2;
				end;
				if(nonblank(alternat))then begin
					INr.AlternativeCode = alternat;
				end;
				if(nonblank(color))then begin
					INr.Colour = color;
				end;
				if(nonblank(size))then begin
					INr.Size = size;
				end;
				if(nonblank(sfield3))then begin
					INr.Group = sfield3;
				end;
				if(nonblank(ressfield4))then begin
					INr.DispGroups = ressfield4;
				end;
				recordStore(INr,True);
			end else begin
				if(nonblank(sfield1))then begin
					recordNew(INr);
					INr.Code = sfield0;
					INr.Name = sfield1;
					INr.BarCode = sfield2;
					INr.AlternativeCode = alternat;
					INr.Colour = color;
					INr.Size = size;
					INr.Group = sfield3;
					INr.DispGroups = ressfield4;
					recordStore(INr,true);
				end;//if nonblank(sfield1)
			end;//if RFM INr
		end;//if nonblank(sfield0)
		NextImportLine(true);
	end;
	return;
end;


global updating procedure ImportDIVcIn()
begin
	record DIVc DIr;
	integer i;
	string 255 sfield0,color,size;
	boolean TrHs;
	string 255 CType, CFirstCode;
	vector boolean NameCreatef;
	
	i = 0;
	TrHs = true;
	while (TestEOF()==false) begin
		sfield0 = "";
		sfield0 = ImportField;
		FormatUpperCaseCode(sfield0);
		if(nonblank(sfield0) and i==0)then begin 
			CType = sfield0;
		end;
		if(nonblank(sfield0) and i==1)then begin 
			CFirstCode = sfield0;
		end;
		if(blank(sfield0) and i==0)then begin 
			TrHs = false;
		end;
		if(blank(sfield0) and i==1)then begin 
			TrHs = false;
		end;
		if(i>1 and TrHs and NameCreatef[sfield0]!=true)then begin
			if(i>2)then begin
				RecordNew(DIr);
				NextM4SerialNumber(CFirstCode,DIr.Code);
				CFirstCode = DIr.Code;
				NameCreatef[sfield0] = true;
			end else begin
				RecordNew(DIr);
				DIr.Code = CFirstCode;
				NameCreatef[sfield0] = true;
			end;
			DIr.CType = CType;
			Dir.Name = sfield0;
			recordStore(DIr,True);
			//logtext(0,DIr.Code);
		end;
		NextImportLine(true);
		i = i + 1;
	end;
	return;
end;







global updating procedure ImportColourIdeaIn()
begin
	record DIVc DIr;
	integer i;
	string 255 sfield0,color,size;
	boolean TrHs, TrHs2;
	string 255 CType, CFirstCode;
	vector boolean NameCreatef;
	
	i = 0;
	TrHs = true;
	while (TestEOF()==false) begin
		sfield0 = "";
		sfield0 = ImportField;
		CType = "COLOUR";
		TrHs2 = true;
		DIr.Code = "CL99999";
		while(loopbackkey("Code",DIr,1,TrHs2))begin
			if(nonblank(DIr.Code) and left(DIr.Code,2)=="CL")then begin CFirstCode = DIr.Code; /*logtext(0,DIr.Code & "Old Code");*/ end;
			TrHs2 = false;
		end;
		ResetLoop(DIr);
		DIr.Name = sfield0;
		if(!ReadFirstKey("Name",DIr,1,true))then begin
			RecordNew(DIr);
			if(blank(CFirstCode))then begin
				CFirstCode = "CL00000";
			end;
			NextM4SerialNumber(CFirstCode,DIr.Code);
			CFirstCode = DIr.Code;
			DIr.CType = CType;
			Dir.Name = sfield0;
			if(recordStore(DIr,True))then begin
			end;
		end else begin
			//logtext(0,DIr.Name & "___" & DIr.CType & "___" & sfield0);
		end;
		NextImportLine(true);
		i = i + 1;
	end;
	return;
end;





global updating procedure ImportINDISPColourModelIdeaIn()
begin
	record INVc INr;
	record DIVc DIr;
	integer i, pos;
	string 255 sfield0,sfield1,sfield2,color,size;
	boolean TrHs, TrHs2;
	string 255 CType, CFirstCode, ClassStr, Class;
	vector boolean NameCreatef;
	
	i = 0;
	TrHs = true;
	while (TestEOF()==false) begin
		sfield0 = "";
		sfield1 = "";
		sfield2 = "";
		sfield0 = ImportField;
		sfield1 = ImportField;
		INr.Code = sfield0;
		if(ReadfirstMain(INr,1,true))then begin
			if(nonblank(sfield1))then begin
				TrHs2 = true;
				DIr.Name = sfield1;
				while(LoopKey("Name",DIr,1,TrHs2))begin
					if(DIr.Name!=sfield1)then begin TrHs2 = false; end;
					if(DIr.CType=="COLOUR" and TrHs2)then begin
						TrHs2 = false;
						INr.Colour = DIr.Code;
						INr.DispGroups = INr.DispGroups & "," & DIr.Code;
					end;
				end;
				pos = 0;
				ClassStr = INr.DispGroups;
				INr.DispGroups = "";
				Class = "";
				ExtractObj(ClassStr,pos,Class);
				while (nonblank(Class)) begin
					if (!NameCreatef[Class & "_" & INr.Code]) then begin
						NameCreatef[Class & "_" & INr.Code] = true;
						if (NonBlank(INr.DispGroups)) then begin
							INr.DispGroups = INr.DispGroups & ",";
						end;
						INr.DispGroups = INr.DispGroups & Class;
					end;
					ExtractObj(ClassStr,pos,Class);
				end;
				resetloop(DIr);
			end else begin
				INr.Colour = "";
				pos = 0;
				ClassStr = INr.DispGroups;
				INr.DispGroups = "";
				Class = "";
				ExtractObj(ClassStr,pos,Class);
				while (nonblank(Class)) begin
					DIr.Code = Class;
					if (ReadFirstMain(DIr,1,true)) then begin
						if(DIr.CType!="COLOUR" and !NameCreatef[Class & "_" & INr.Code])then begin
							NameCreatef[Class & "_" & INr.Code] = true;
							if (NonBlank(INr.DispGroups)) then begin
								INr.DispGroups = INr.DispGroups & ",";
							end;
							INr.DispGroups = INr.DispGroups & Class;
						end;
					end;
					ExtractObj(ClassStr,pos,Class);
				end;
			end;
			if(RecordStore(INr,true))then begin
			end;
		end;
		NextImportLine(true);
		i = i + 1;
	end;
	return;
end;



global updating procedure ImportINDISPModelIdeaIn()
begin
	record INVc INr;
	record DIVc DIr;
	integer i;
	string 255 sfield0,sfield1,sfield2,color,size;
	boolean TrHs, TrHs2;
	string 255 CType, CFirstCode;
	vector boolean NameCreatef;
	
	i = 0;
	TrHs = true;
	while (TestEOF()==false) begin
		sfield0 = "";
		sfield1 = "";
		sfield2 = "";
		sfield0 = ImportField;
		sfield2 = ImportField;
		INr.Code = sfield0;
		if(ReadfirstMain(INr,1,true))then begin
			if(nonblank(sfield2))then begin
				TrHs2 = true;
				DIr.Name = sfield2;
				while(LoopKey("Name",DIr,1,TrHs2))begin
					if(DIr.Name!=sfield2)then begin TrHs2 = false; end;
					if(DIr.CType=="MODEL" and TrHs2)then begin
						TrHs2 = false;
						INr.Reference = DIr.Code;
						INr.DispGroups = INr.DispGroups & "," & DIr.Code;
					end;
				end;
				resetloop(DIr);
			end else begin
				INr.Reference = "";
			end;
			if(RecordStore(INr,true))then begin
			end;
		end;
		NextImportLine(true);
		i = i + 1;
	end;
	return;
end;







global updating procedure ImportModelIdeaIn()
begin
	record DIVc DIr;
	integer i;
	string 255 sfield0,color,size;
	boolean TrHs, TrHs2;
	string 255 CType, CFirstCode;
	vector boolean NameCreatef;
	
	i = 0;
	TrHs = true;
	while (TestEOF()==false) begin
		sfield0 = "";
		sfield0 = ImportField;
		CType = "MODEL";
		TrHs2 = true;
		DIr.Code = "ML99999";
		while(loopbackkey("Code",DIr,1,TrHs2))begin
			if(nonblank(DIr.Code) and left(DIr.Code,2)=="ML")then begin CFirstCode = DIr.Code; /*logtext(0,DIr.Code & "Old Code");*/ end;
			TrHs2 = false;
		end;
		ResetLoop(DIr);
		DIr.Name = sfield0;
		if(!ReadFirstKey("Name",DIr,1,true))then begin
			RecordNew(DIr);
			if(blank(CFirstCode))then begin
				CFirstCode = "ML00000";
			end;
			NextM4SerialNumber(CFirstCode,DIr.Code);
			CFirstCode = DIr.Code;
			DIr.CType = CType;
			Dir.Name = sfield0;
			if(recordStore(DIr,True))then begin
			end;
		end else begin
			//logtext(0,DIr.Name & "___" & DIr.CType & "___" & sfield0);
		end;
		NextImportLine(true);
		i = i + 1;
	end;
	return;
end;






global updating procedure ImportCRTbrandIdeaIn()
begin
	record DIVc DIr;
	integer i;
	string 255 sfield0,color,size;
	boolean TrHs, TrHs2;
	string 255 CType, UNUPCName;
	vector boolean NameCreatef;
	string 255 CFirstCode;
	
	i = 0;
	TrHs = true;
	while (TestEOF()==false) begin
		sfield0 = "";
		sfield0 = ImportField;
		UNUPCName = sfield0;
		FormatUpperCaseCode(sfield0);
		CType = "BRAND";
		TrHs2 = true;
		DIr.Code = "C999999999";
		while(loopbackkey("Code",DIr,1,TrHs2))begin
			if(nonblank(DIr.Code) and left(DIr.Code,2)=="C0")then begin CFirstCode = DIr.Code; /*logtext(0,DIr.Code & "Old Code");*/ end;
			TrHs2 = false;
		end;
		DIr.Code = sfield0;
		if(!ReadFirstMain(DIr,1,true))then begin
			RecordNew(DIr);
			if(blank(CFirstCode))then begin
				CFirstCode = "C000000000";
			end;
			NextM4SerialNumber(CFirstCode,DIr.Code);
			CFirstCode = DIr.Code;
			DIr.CType = CType;
			Dir.Name = UNUPCName;
			if(recordStore(DIr,True))then begin
			end;
		end else begin
			logtext(0,DIr.Name & "___" & DIr.CType & "___" & sfield0);
		end;
		NextImportLine(true);
		i = i + 1;
	end;
	return;
end;


global
updating procedure CleanDIMn()
begin
record DIVc DIr;
boolean TrHs;
integer i;
boolean chisla;
	DIr.Code = "";
	while (loopmain(DIr,1,true))begin
		if(DIr.CType!="BRAND" and DIr.CType!="SIZE")then begin
			RecordDelete(DIr);
			StepBack(DIr);
		end;
		if(DIr.CType=="BRAND")then begin
			chisla = true;
			for(i=0;i<len(DIr.Code);i=i+1) begin
				if(ASC(mid(DIr.Code,i,1))<48 or ASC(mid(DIr.Code,i,1))>57)then begin
					chisla = false;
				end;
			end;
			if(!chisla)then begin
				RecordDelete(DIr);
				StepBack(DIr);
			end;
		end;
	end;
	return;
end;




global
updating procedure CleanITMn()
begin
record ITVc ITr;
boolean TrHs;
integer i;
boolean chisla;
	ITr.Code = "";
	while (loopmain(ITr,1,true))begin
		chisla = true;
		for(i=0;i<len(ITr.Code);i=i+1) begin
			if(ASC(mid(ITr.Code,i,1))<48 or ASC(mid(ITr.Code,i,1))>57)then begin
				chisla = false;
			end;
		end;
		if(!chisla)then begin
			RecordDelete(ITr);
			StepBack(ITr);
		end;
	end;
	return;
end;


global updating procedure ImportNormCRTbrandIdeaIn()
begin
	record DIVc DIr;
	integer i;
	string 255 sfield0,sfield1,color,size;
	boolean TrHs, TrHs2;
	string 255 CType, UNUPCName;
	vector boolean NameCreatef;
	
	i = 0;
	TrHs = true;
	while (TestEOF()==false) begin
		sfield0 = "";
		sfield1 = "";
		sfield0 = ImportField;
		sfield1 = trim(ImportField);
		UNUPCName = sfield1;
		FormatUpperCaseCode(sfield0);
		FormatUpperCaseCode(sfield1);
		CType = "BRAND";
		DIr.Code = sfield0;
		if(!ReadFirstMain(DIr,1,true))then begin
			RecordNew(DIr);
			DIr.Code = sfield1;
			DIr.CType = CType;
			Dir.Name = UNUPCName;
			if(recordStore(DIr,True))then begin
			end;
		end else begin
			if(DIr.CType=="BRAND")then begin
				recorddelete(DIr);
				RecordNew(DIr);
				DIr.Code = sfield1;
				DIr.CType = CType;
				Dir.Name = UNUPCName;
				if(recordStore(DIr,True))then begin
					logtext(0,DIr.Name & "___" & DIr.CType & "___" & sfield0);
				end;
			end;
		end;
		NextImportLine(true);
		i = i + 1;
	end;
	return;
end;








global updating procedure IMportINMainStockIn()
begin
	record INVc INr;
	integer i;
	boolean TrHs;
	string 50 code,maincode;
	
	TrHs = true;
	while (TestEOF()==false) begin
		code = ImportField;
		INr.Code=code;
		if(ReadFirstMain(INr,1,true)) then begin
			INr.OutOfOrder = 0;
			RecordStore(INr,True);
		end;
		NextImportLine(true);
	end;
	return;
end;




global updating procedure ImportContactsIDIn()
begin
	record INVc INr, OldInr;
	row INVc INrw;
	record DIVc DIr,OldDIr;
	integer i;
	string 255 sfield0,sfield1,sfield2,sfield3,sfield4,sfield5,sfield6,sfield7,sfield8,sfield9,sfield10,sfield11,sfield12,sfield13,INCODE;
	boolean TrHs, testf;
	string 255 suf;
	
	while (TestEOF()==false) begin
		sfield0 = "";
		sfield1 = "";
		sfield2 = "";
		sfield3 = "";
		sfield4 = "";
		sfield5 = "";
		sfield6 = "";
		sfield7 = "";
		sfield8 = "";
		sfield9 = ""; 
		sfield10 = "";
		sfield11 = "";
		sfield12 = "";
		sfield0 = ImportField;
		sfield1 = ImportField;
		sfield2 = ImportField;
		sfield3 = ImportField;
		sfield4 = ImportField;
		sfield5 = ImportField;
		sfield6 = ImportField;
		sfield7 = ImportField;
		sfield8 = ImportField;
		sfield9 = ImportField;
		sfield10 = ImportField;
		sfield11 = ImportField;
		sfield12 = ImportField;
		INr.Code = sfield0;
		if(ReadFirstMain(INr,1,true))then begin
			RecordCopy(OldInr,INr);
			INr.SN = sfield0;
			INr.SNOne = sfield1;
			INr.AlternativeCode = sfield2;
			DIr.Name = sfield3;
			if(readfirstKey("Name",DIr,1,true))then begin 
				INr.Reference = DIr.Code; 
			end else begin
				if(nonblank(sfield3))then begin
					DIr.Code = "ML99999";
					TrHs = true;
					while(LoopBackKey("Code",DIr,1,TrHs))begin
						if(left(DIr.Code,2)=="ML")then begin
							recordnew(DIr);
							suf = StringToInt(right(DIr.Code,5))+1;
							if(len(suf)<5)then begin
								for (i=0;i<(5-len(suf));i=i+1) begin
									suf = "0" & suf;
								end;
							end;
							DIr.Code = left(DIr.Code,2) & suf;
							DIr.Name = sfield3;
							DIr.CType = "MODEL";
							OldDir.Code = DIr.Code;
							if(readfirstmain(OldDir,1,true)==false)then begin
								if (RECORDSTORE(DIr,true)==false) then begin
									INr.Reference = DIr.Code; 
								end;
							end;
						end;
						TrHs = false;
					end;
				end;
			end;
			INr.Name = sfield4;
			INrw.Text = sfield5;
			matrowput(INr,0,INrw);
			DIr.Name = sfield6;
			if(readfirstKey("Name",DIr,1,true))then begin 
				INr.Colour = DIr.Code; 
			end else begin
				if(nonblank(sfield6))then begin
					DIr.Code = "CL99999";
					TrHs = true;
					while(LoopBackKey("Code",DIr,1,TrHs))begin
						if(left(DIr.Code,2)=="ML")then begin
							recordnew(DIr);
							suf = StringToInt(right(DIr.Code,5))+1;
							if(len(suf)<5)then begin
								for (i=0;i<(5-len(suf));i=i+1) begin
									suf = "0" & suf;
								end;
							end;
							DIr.Code = left(DIr.Code,2) & suf;
							DIr.Name = sfield6;
							DIr.CType = "COLOUR";
							OldDir.Code = DIr.Code;
							if(readfirstmain(OldDir,1,true)==false)then begin
								if (RECORDSTORE(DIr,true)==false) then begin
									INr.Reference = DIr.Code; 
								end;
							end;
						end;
						TrHs = false;
					end;
				end;
			end;
			INr.Unittext = sfield7;
			DIr.Name = sfield8;
			while (LoopKey("Name",DIr,1,TrHs))begin 
				if(sfield8==DIr.Name)then begin
					testf = true;
					for (i=0;i<len(DIr.Code);i=i+1)begin
						if(Asc(mid(DIr.Code,i,1))<=48 or Asc(mid(DIr.Code,i,1))>=57)then begin testf = false; end;
					end;
					if(testf==true)then begin
						INr.DispGroups = DIr.Code;
					end;
				end else begin
					TrHs = false;
				end;
			end;
			ResetLoop(DIr);
			INr.Category = sfield9;
			INr.CompletCode = sfield10;
			INr.LastPurchPrice2 = StringToVal(sfield11,M4Val);
			INr.LastPurchCurncyCode = "EUR";
			INr.InPrice = StringToVal(sfield12,M4Val);
			if(RecordUpdate(OldInr,INr,false)==0)then begin end;
		end else begin
			if(nonblank(sfield0))then begin
				RecordNew(INr);
				INr.Code = sfield0;
				INr.SN = sfield0;
				INr.SNOne = sfield1;
				INr.AlternativeCode = sfield2;
				DIr.Name = sfield3;
				if(readfirstKey("Name",DIr,1,true))then begin 
					INr.Reference = DIr.Code; 
				end else begin
					if(nonblank(sfield3))then begin
						DIr.Code = "ML99999";
						TrHs = true;
						while(LoopBackKey("Code",DIr,1,TrHs))begin
							if(left(DIr.Code,2)=="ML")then begin
								recordnew(DIr);
								suf = StringToInt(right(DIr.Code,5))+1;
								if(len(suf)<5)then begin
									for (i=0;i<(5-len(suf));i=i+1) begin
										suf = "0" & suf;
									end;
								end;
								DIr.Code = left(DIr.Code,2) & suf;
								DIr.Name = sfield3;
								DIr.CType = "MODEL";
								OldDir.Code = DIr.Code;
								if(readfirstmain(OldDir,1,true)==false)then begin
									if (RECORDSTORE(DIr,true)==false) then begin
										INr.Reference = DIr.Code; 
									end;
								end;
							end;
							TrHs = false;
						end;
					end;
				end;
				INr.Name = sfield4;
				INrw.Text = sfield5;
				matrowput(INr,0,INrw);
				DIr.Name = sfield6;
				if(readfirstKey("Name",DIr,1,true))then begin 
					INr.Colour = DIr.Code; 
				end else begin
					if(nonblank(sfield6))then begin
						DIr.Code = "CL99999";
						TrHs = true;
						while(LoopBackKey("Code",DIr,1,TrHs))begin
							if(left(DIr.Code,2)=="ML")then begin
								recordnew(DIr);
								suf = StringToInt(right(DIr.Code,5))+1;
								if(len(suf)<5)then begin
									for (i=0;i<(5-len(suf));i=i+1) begin
										suf = "0" & suf;
									end;
								end;
								DIr.Code = left(DIr.Code,2) & suf;
								DIr.Name = sfield6;
								DIr.CType = "COLOUR";
								OldDir.Code = DIr.Code;
								if(readfirstmain(OldDir,1,true)==false)then begin
									if (RECORDSTORE(DIr,true)==false) then begin
										INr.Reference = DIr.Code; 
									end;
								end;
							end;
							TrHs = false;
						end;
					end;
				end;
				INr.Unittext = sfield7;
				DIr.Name = sfield8;
				while (LoopKey("Name",DIr,1,TrHs))begin 
					if(sfield8==DIr.Name)then begin
						testf = true;
						for (i=0;i<len(DIr.Code);i=i+1)begin
							if(Asc(mid(DIr.Code,i,1))<=48 or Asc(mid(DIr.Code,i,1))>=57)then begin testf = false; end;
						end;
						if(testf==true)then begin
							INr.DispGroups = DIr.Code;
						end;
					end else begin
						TrHs = false;
					end;
				end;
				ResetLoop(DIr);
				INr.Category = sfield9;
				INr.CompletCode = sfield10;
				INr.LastPurchPrice2 = StringToVal(sfield11,M4Val);
				INr.LastPurchCurncyCode = "EUR";
				INr.InPrice = StringToVal(sfield12,M4Val);
				RecordInsert(INr,false);
			end;
		end;
		NextImportLine(true);
	end;
	return;
end;







global updating procedure ImportContactsIDfrCRTVIn()
begin
	record INVc INr, OldInr;
	row INVc INrw;
	record DIVc DIr,OldDir;
	integer i;
	string 255 sfield0,sfield1,sfield2,sfield3,sfield4,sfield5,sfield6,sfield7,sfield8,sfield9,sfield10,sfield11,sfield12,sfield13,sfield14,INCODE;
	record ITVc ITr;
	boolean TrHs, testf;
	string 255 suf;
	
	while (TestEOF()==false) begin
		sfield0 = "";
		sfield1 = "";
		sfield2 = "";
		sfield3 = "";
		sfield4 = "";
		sfield5 = "";
		sfield6 = "";
		sfield7 = "";
		sfield8 = "";
		sfield9 = ""; 
		sfield10 = "";
		sfield11 = "";
		sfield12 = "";
		sfield13 = "";
		sfield0 = ImportField;
		sfield1 = ImportField;
		sfield2 = ImportField;
		sfield3 = ImportField;
		sfield4 = ImportField;
		sfield5 = ImportField;
		sfield6 = ImportField;
		sfield14 = ImportField;
		sfield7 = ImportField;
		sfield8 = ImportField;
		sfield9 = ImportField;
		sfield10 = ImportField;
		sfield11 = ImportField;
		sfield12 = ImportField;
		sfield13 = ImportField;
		INr.Code = sfield0;
		if(ReadFirstMain(INr,1,true))then begin
			//RecordCopy(OldInr,INr);
			/*INr.SN = sfield0;
			INr.SNOne = sfield1;
			INr.AlternativeCode = sfield2;
			DIr.Name = sfield3;
			if(readfirstKey("Name",DIr,1,true))then begin 
				INr.Reference = DIr.Code; 
			end else begin
				DIr.Code = "ML99999";
				TrHs = true;
				while(LoopBackKey("Code",DIr,1,TrHs))begin
					if(left(DIr.Code,2)=="ML")then begin
						recordnew(DIr);
						suf = StringToInt(right(DIr.Code,5))+1;
						if(len(suf)<5)then begin
							for (i=0;i<(5-len(suf));i=i+1) begin
								suf = "0" & suf;
							end;
						end;
						DIr.Code = left(DIr.Code,2) & suf;
						DIr.Name = sfield3;
						DIr.CType = "MODEL";
						OldDir.Code = DIr.Code;
						if(readfirstmain(OldDir,1,true)==false)then begin
							if (RECORDSTORE(DIr,true)==false) then begin
								INr.Reference = DIr.Code; 
							end;
						end;
					end;
					TrHs = false;
				end;
			end;*/
			INr.Name = sfield4;
			/*INrw.Text = sfield5;
			matrowput(INr,0,INrw);
			DIr.Name = sfield6;
			if(readfirstKey("Name",DIr,1,true))then begin 
				INr.Colour = DIr.Code; 
			end else begin
				DIr.Code = "CL99999";
				TrHs = true;
				while(LoopBackKey("Code",DIr,1,TrHs))begin
					if(left(DIr.Code,2)=="ML")then begin
						recordnew(DIr);
						suf = StringToInt(right(DIr.Code,5))+1;
						if(len(suf)<5)then begin
							for (i=0;i<(5-len(suf));i=i+1) begin
								suf = "0" & suf;
							end;
						end;
						DIr.Code = left(DIr.Code,2) & suf;
						DIr.Name = sfield6;
						DIr.CType = "COLOUR";
						OldDir.Code = DIr.Code;
						if(readfirstmain(OldDir,1,true)==false)then begin
							if (RECORDSTORE(DIr,true)==false) then begin
								INr.Reference = DIr.Code; 
							end;
						end;
					end;
					TrHs = false;
				end;
			end;
			INr.Unittext = sfield7;
			TrHs = true;
			DIr.Name = sfield8;
			while (LoopKey("Name",DIr,1,TrHs))begin 
				if(sfield8==DIr.Name)then begin
					testf = false;
					for (i=0;i<len(DIr.Code);i=i+1)begin
						if(Asc(mid(DIr.Code,i,1))<=48 or Asc(mid(DIr.Code,i,1))>=57)then begin testf = true; end;
					end;
					if(testf==true)then begin
						INr.DispGroups = DIr.Code;
					end;
				end else begin
					TrHs = false;
				end;
			end;
			ResetLoop(DIr);*/
			/*ITr.Comment = sfield8;
			if(readfirstKey("Comment",ITr,1,true))then begin 
				INr.Group = ITr.Code; 
			end;*/
			/*INr.Category = sfield9;
			INr.CompletCode = sfield10;
			INr.LastPurchPrice2 = StringToVal(sfield11,M4Val);
			INr.LastPurchCurncyCode = "EUR";
			INr.InPrice = StringToVal(sfield12,M4Val);
			INr.IDOldINNr = sfield13;
			DIr.Name = sfield14;
			if(readfirstKey("Name",DIr,1,true))then begin 
				INr.Size = DIr.Code; 
			end else begin
				INr.Size = sfield14;
			end;*/
			//if(RecordUpdate(OldInr,INr,false)==0)then begin end;
			recordstore(INr,true);
		end else begin
			if(nonblank(sfield0))then begin
				RecordNew(INr);
				INr.Code = sfield0;
				INr.SN = sfield0;
				INr.SNOne = sfield1;
				INr.AlternativeCode = sfield2;
				DIr.Name = sfield3;
				if(readfirstKey("Name",DIr,1,true))then begin 
					INr.Reference = DIr.Code; 
				end else begin
					DIr.Code = "ML99999";
					TrHs = true;
					while(LoopBackKey("Code",DIr,1,TrHs))begin
						if(left(DIr.Code,2)=="ML")then begin
							recordnew(DIr);
							suf = StringToInt(right(DIr.Code,5))+1;
							if(len(suf)<7)then begin
								for (i=0;i<(7-len(suf));i=i+1) begin
									suf = "0" & suf;
								end;
							end;
							DIr.Code = left(DIr.Code,2) & suf;
							DIr.Name = sfield3;
							DIr.CType = "MODEL";
							
							if (RECORDSTORE(DIr,true)==false) then begin
								INr.Reference = DIr.Code; 
							end;
						end;
						TrHs = false;
					end;
				end;
				INr.Name = sfield4;
				INrw.Text = sfield5;
				matrowput(INr,0,INrw);
				DIr.Name = sfield6;
				if(readfirstKey("Name",DIr,1,true))then begin 
					INr.Colour = DIr.Code; 
				end else begin
					DIr.Code = "CL99999";
					TrHs = true;
					while(LoopBackKey("Code",DIr,1,TrHs))begin
						if(left(DIr.Code,2)=="ML")then begin
							recordnew(DIr);
							suf = StringToInt(right(DIr.Code,5))+1;
							if(len(suf)<7)then begin
								for (i=0;i<(7-len(suf));i=i+1) begin
									suf = "0" & suf;
								end;
							end;
							DIr.Code = left(DIr.Code,2) & suf;
							DIr.Name = sfield6;
							DIr.CType = "COLOUR";
							if(readfirstmain(OldDir,1,true)==false)then begin
								if (RECORDSTORE(DIr,true)==false) then begin
									INr.Reference = DIr.Code; 
								end;
							end;
						end;
						TrHs = false;
					end;
				end;
				INr.Unittext = sfield7;
				DIr.Name = sfield8;
				while (LoopKey("Name",DIr,1,TrHs))begin 
					if(sfield8==DIr.Name)then begin
						testf = false;
						for (i=0;i<len(DIr.Code);i=i+1)begin
							if(Asc(mid(DIr.Code,i,1))<=48 or Asc(mid(DIr.Code,i,1))>=57)then begin testf = true; end;
						end;
						if(testf==true)then begin
							INr.DispGroups = DIr.Code;
						end;
					end else begin
						TrHs = false;
					end;
				end;
				ResetLoop(DIr);
				/*
				ITr.Comment = sfield8;
				if(readfirstKey("Comment",ITr,1,true))then begin 
					INr.Group = ITr.Code; 
				end;*/
				INr.Category = sfield9;
				INr.CompletCode = sfield10;
				INr.LastPurchPrice2 = StringToVal(sfield11,M4Val);
				INr.LastPurchCurncyCode = "EUR";
				INr.InPrice = StringToVal(sfield12,M4Val);
				INr.IDOldINNr = sfield13;
				DIr.Name = sfield14;
				if(readfirstKey("Name",DIr,1,true))then begin 
					INr.Size = DIr.Code; 
				end else begin
					INr.Size = sfield14;
				end;
				RecordInsert(INr,false);
			end;
		end;
		NextImportLine(true);
	end;
	return;
end;



global updating procedure ImportBrandsIDIn()
begin
	record DIVc DIr, OldDIr;
	record CUVc CUr, OldCUr;
	integer i;
	string 255 sfield0,sfield1,sfield2,sfield3,sfield4,sfield5,sfield6,sfield7,sfield8,sfield9,sfield10,sfield11,sfield12,sfield13,sfield14;
	
	while (TestEOF()==false) begin
		sfield0 = "";
		sfield1 = "";
		sfield2 = "";
		sfield3 = "";
		sfield4 = "";
		sfield5 = "";
		sfield6 = "";
		sfield0 = ImportField;
		sfield1 = ImportField;
		sfield2 = ImportField;
		sfield3 = ImportField;
		sfield4 = ImportField;
		sfield5 = ImportField;
		sfield6 = ImportField;
		DIr.Code = sfield0;
		if(!ReadFirstMain(DIr,1,true))then begin
			if(nonblank(sfield0))then begin
				RecordNew(DIr);
				DIr.Code = sfield0;
				DIr.Name = sfield1;
				Dir.CType = "BRAND";
				RecordInsert(DIr,false);
			end;
		end;
		CUr.Code = sfield0;
		if(ReadFirstMain(CUr,1,true))then begin
			RecordCopy(OldCUr,CUr);
			CUr.Name = sfield1;
			CUr.InvAddr1 = sfield2;
			CUr.Person = sfield3;
			CUr.Phone = sfield4;
			CUr.eMail = sfield5;
			Cur.PlanShipDays = StringToInt(sfield6);
			if(RecordUpdate(OldCUr,CUr,false)==0)then begin end;
		end else begin
			if(nonblank(sfield0))then begin
				RecordNew(CUr);
				CUr.Code = sfield0;
				CUr.Name = sfield1;
				CUr.InvAddr1 = sfield2;
				CUr.Person = sfield3;
				CUr.Phone = sfield4;
				CUr.eMail = sfield5;
				Cur.PlanShipDays = StringToInt(sfield6);
				RecordInsert(CUr,false);
			end;
		end;
		NextImportLine(true);
	end;
	return;
end;







global updating procedure ReImportBrandsGIIn()
begin
	record GlobalItemVc GIr, GI2r, GI3r;
	record CUVc CUr, OldCUr;
	integer i, cnt;
	string 255 sfield0,sfield1,sfield2,sfield3,sfield4,sfield5,sfield6,sfield7,sfield8,sfield9,sfield10,sfield11,sfield12,sfield13,sfield14;
	boolean testf;
	record INVc INr;
	array string 255 codes, brnds;
	
	SetCompany (1,false);
	while (TestEOF()==false) begin
		codes[i] = ImportField;
		brnds[i] = ImportField;
		i=i+1;
		NextImportLine(true);
	end;
	
	cnt = i;
	
	for (i=0;i<cnt;i=i+1) begin
		sfield0 = "";
		sfield1 = "";
		testf = false;
		sfield0 = codes[i];
		sfield1 = brnds[i];
		GIr.Code = "BRND0139" & "_" & sfield0;
		if(ReadFirstMain(GIr,1,true))then begin
			testf = true;
		end;
		
		// if (sfield1=="KOSTA BODA" and testf) then begin
			// GI2r.Code = "BRND0210" & "_" & sfield0;
			// if(ReadFirstMain(GI2r,1,true))then begin
				// RecordDelete(GI2r);
				GI3r.Code = "BRND0139" & "_" & sfield0;
				if(ReadFirstMain(GI3r,1,true))then begin
					GI3r.Code = "BRND0210" & "_" & sfield0;
					GI3r.BPIBrand = "BRND0210";
					GI3r.Brand = "KOSTA BODA";
					recordStore(GI3r,true);
				end;
			// end;
			SetCompany(4,false);
			INr.Code = sfield0;
			if (ReadFirstMain(INr,1,true)) then begin
				INr.GlobalArtCode = "BRND0210" & "_" & sfield0;
				recordStore(INr,true);
			end;
			SetCompany(5,false);
			INr.Code = sfield0;
			if (ReadFirstMain(INr,1,true)) then begin
				INr.GlobalArtCode = "BRND0210" & "_" & sfield0;
				recordStore(INr,true);
			end;
		// end;
		ResetCompany(1);
	end;
	
	
	return;
end;












global updating procedure IMportINMainIn()
begin
	record INVc INr,oldINr;
	record GlobalItemVc GIr;
	integer i,curc;
	boolean TrHs,foundf;
	string 50 code,maincode;
	
	curc = currentcompany;
	
	TrHs = true;
	while (TestEOF()==false) begin
		code = ImportField;
		INr.Code=code;
		if(ReadFirstMain(INr,1,true)) then begin
			if(INr.MainCode!=INr.Code)then begin
				INr.MainCode = ImportField;
				oldINr.Code = INr.MainCode;
				if(readfirstmain(oldINr,1,true))then begin
					GIr.HansaCode = oldINr.Code;
					if(readfirstkey("HansaCode",GIr,1,true)==false)then begin
						CreateNewGlobalItem(oldINr);
						recordstore(oldINr,true);
					end;
					GIr.HansaCode = code;
					foundf = false;
					if(readfirstkey("HansaCode",GIr,1,true))then begin
						UpdateGlobalItem(INr);
					end else begin
						CreateNewGlobalItem(INr);
					end;
					RecordStore(INr,True);
				end;
			end;
		end;
		NextImportLine(true);
	end;
	//resetcompany(curc);
	return;
end;







global updating procedure IMportINMainIn()
begin
	record INVc INr,oldINr;
	record GlobalItemVc GIr;
	integer i,curc;
	boolean TrHs,foundf;
	string 50 code,maincode;
	
	curc = currentcompany;
	
	TrHs = true;
	while (TestEOF()==false) begin
		code = ImportField;
		INr.Code=code;
		if(ReadFirstMain(INr,1,true)) then begin
			if(INr.MainCode!=INr.Code)then begin
				INr.MainCode = ImportField;
				oldINr.Code = INr.MainCode;
				if(readfirstmain(oldINr,1,true))then begin
					GIr.HansaCode = oldINr.Code;
					if(readfirstkey("HansaCode",GIr,1,true)==false)then begin
						CreateNewGlobalItem(oldINr);
						recordstore(oldINr,true);
					end;
					GIr.HansaCode = code;
					foundf = false;
					if(readfirstkey("HansaCode",GIr,1,true))then begin
						UpdateGlobalItem(INr);
					end else begin
						CreateNewGlobalItem(INr);
					end;
					RecordStore(INr,True);
				end;
			end;
		end;
		NextImportLine(true);
	end;
	//resetcompany(curc);
	return;
end;




Global updating procedure ImportABCINIn()
begin
	record INVc INr;
	record RebVc Rebr;
	record ITVc ITr;
	integer i;
	string 255 sfield0,sfield1,sfield2,sfield3,sfield4,sfield5,sfield6,sfield7,color,size;
		
	while (TestEOF()==false) begin
		sfield0 = "";
		sfield1 = "";
		sfield2 = "";
		sfield3 = "";
		sfield4 = "";
		sfield5 = "";
		sfield6 = "";
		sfield0 = ImportField;
		if(nonblank(sfield0))then begin
			FormatUpperCaseCode(sfield0);
			sfield1 = ImportField;
			if(nonblank(sfield1))then begin
				FormatUpperCaseCode(sfield1);
				if(sfield1!="A" and sfield1!="B" and sfield1!="C" and sfield1!="E")then begin
					sfield1 = "";
				end;
			end;
			sfield2 = ImportField;
			if(nonblank(sfield2))then begin
				FormatUpperCaseCode(sfield2);
				if(sfield2!="S" and sfield2!="X" and sfield2!="Y" and sfield2!="Z")then begin
					sfield2 = "";
				end;
			end;
			sfield3 = ImportField;
			if(nonblank(sfield3))then begin
				FormatUpperCaseCode(sfield3);
				if(sfield3!="C" and sfield3!="D")then begin
					sfield3 = "";
				end;
			end;
			sfield4 = ImportField;
			sfield5 = ImportField;
			if(nonblank(sfield5))then begin
				FormatUpperCaseCode(sfield5);
				if(sfield5!="S" and sfield5!="L")then begin
					sfield5 = "";
				end;
			end;
			sfield6 = ImportField;
			//logtext(0,sfield0 & " <> " & sfield1 & " <> " & sfield2 & " <> " & sfield3 & " <> " & sfield4 & " <> " & sfield5);
			INr.Code = sfield0;
			if(ReadFirstMain(INr,1,true))then begin
				if(nonblank(sfield1))then begin
					INr.ItemCat = sfield1;
				end;
				if(nonblank(sfield2))then begin
					INr.SubItemCat = sfield2;
				end;
				if(nonblank(sfield3))then begin
					INr.TypeSeasNeeds = sfield3;
				end;
				if(nonblank(sfield4))then begin
					INr.LeadTime = sfield4;
				end;
				if(nonblank(sfield5))then begin
					INr.LifeCicle = sfield5;
				end;
				if(nonblank(sfield6))then begin
					INr.SeasonalReorderMonth = sfield6;
				end;
				recordStore(INr,True);
			end;//if RFM INr
		end;//if nonblank(sfield0)
		NextImportLine(true);
	end;
	return;
end;

















global updating procedure AddInchesMn(record RcVc RepSpec)
begin
	record INVc INr;
	longint curtick;
	
	curtick = getcurtick();
	while(loopmain(INr,1,true))begin
		INr.Unittext = "?";
		INr.UpdateCost = 1;
		recordStore(INr,true);
	end;
	LogProcTime("AddInchesMn",getcurtick()-curtick); 
return;
end;


global
updating procedure FillStructIn()
BEGIN
record INVc INr;
integer oldComp;
integer i,CompQty;
boolean TrHs;
string 255 code,rec;
	
	compQty = 32;
	while (TestEOF()==false) begin
		code = ImportField;
		rec = importfield;
		for (i=0;i<CompQty;i=i+1)begin
			if((!CompanyIsJWLikeCompany(i+1) or i+1==3) and i+1!=10 and i+1!=32)then begin
				SetCompany(i+1,false);
				INr.Code = code;
				if(ReadFirstMain(INr,1,true)) then begin
					INr.Recepy = rec;
					if(RecordStore(INr,true)) then begin
					end;
				end;
			end;
		end;
		if (NextImportLine(true)) then begin end;
	end;
	setcompany(oldComp,false);
  RETURN;
END;

global
updating procedure ImpCLOut()
BEGIN


    RegisterImport("ITVc2");

  RETURN;
END;


global
updating procedure ImpDocVc()
BEGIN

    RegisterImport("doc3");

  RETURN;
END;




global
updating procedure INImportCostsIn()		//Edit----------------------Dima  10.02.2015
begin
  record INVc INr;
  string 70 code;
  string 15 cost;



	while (TestEOF()==false) begin
			code = ImportField;
			cost = ImportField;
	
			if(nonblank(code) and nonblank(cost)) then begin

				INr.Code = code;				
				if (ReadFirstMain(INr,1,true)) then begin
					INr.InPrice = StringToVal(cost,M4Val);
					RecordStore(INr,true);
				end;
			end;								
				
			if (NextImportLine(true)) then begin end;
	end;		

return;
end;



global
updating procedure ImportOfRegister(record RcVc RepSpec)	//Edit----------------------Dima  28.05.2015
BEGIN
string 100 tag;
boolean first;
		if(first==false)then begin
			tag = ImportField;
		end;
		
		logtext(0,"ImportOfRegister tag " & tag);
		if(first==false)then begin
			first = true;
			RegisterImport(tag);
    end;
  RETURN;
END;



global
updating procedure ImportOfRegisterRewriting(record RcVc RepSpec)	//Edit----------------------Dima  28.05.2015
BEGIN
string 100 tag;
string 50 registerVc;
	record LocClVc LocClr,oldLocClr;
	record INVc INr;
	record CLInVc CLInr;
	record CLOutVc CLOutr;
	record IPVc IPr;
	record OPVc OPr;
	record IVVc IVr;
	record VIVc VIr;
	record POVc POr;
	record SHVc SHr;
	record PUVc PUr;
	record SDVc SDr;
	record StockMovVc StockMovr;
	record RetVc Retr;
	record RetPUVc RetPUr;
	record ORVc ORr;
	record TRVc TRr;
	record FBVc FBr;
	record ItemHistVc IHr;
	record ItemStatusVc ISr;
	record AccVc Accr;
	record DocVc Docr;
	record ObjVc Objr;
	record CLCorspVc CLCorspr;
	
	registerVc = UpperCase(RepSpec.f1);
	tag = ImportField;

	if (nonblank(registerVc))	then begin
		while (NextImportLine(false)) begin
			switch(registerVc) begin
				case "LOCCLVC": 					 	
 			  	  ImportOneRecord(LocClr,tag);
 			  	  oldLocClr.Code = LocClr.Code;
 			  	  if (ReadFirstMain(oldLocClr,1,true)) then begin  	  
							RecordUpdate(oldLocClr,LocClr,false);
						end else begin
							RecordStore(LocClr,false);
						end;
				case "DocVc": 					 	
 			  	  ImportOneRecord(Docr,tag);
 			  	  RecordStore(Docr,true);
				
				case "INVC": 					 	
 			  	  ImportOneRecord(INr,tag);
 			  	  RecordStore(INr,true);
 			  	  
				case "CLINVC": 					 	
 			  	  ImportOneRecord(CLInr,tag);
 			  	  RecordStore(CLInr,true); 
 			  	  
				case "CLOUTVC": 					 	
 			  	  ImportOneRecord(CLOutr,tag);
 			  	  RecordStore(CLOutr,true); 
 			  	  
				case "IPVC": 					 	
 			  	  ImportOneRecord(IPr,tag);
 			  	  RecordStore(IPr,true); 
 			  	  
				case "OPVC": 					 	
 			  	  ImportOneRecord(OPr,tag);
 			  	  RecordStore(OPr,true); 
 			  	  
				case "IVVC": 					 	
 			  	  ImportOneRecord(IVr,tag);
 			  	  RecordStore(IVr,true); 
 			  	  
				case "VIVC": 					 	
 			  	  ImportOneRecord(VIr,tag);
 			  	  RecordStore(VIr,true); 
 			  	  
				case "POVC": 					 	
 			  	  ImportOneRecord(POr,tag);
 			  	  RecordStore(POr,true); 
 			  	  
				case "PUVC": 					 	
 			  	  ImportOneRecord(PUr,tag);
 			  	  RecordStore(PUr,true); 
 			  	  
				case "SDVC": 					 	
 			  	  ImportOneRecord(SDr,tag);
 			  	  RecordStore(SDr,true); 
 			  	  
				case "STOCKMOVVC": 					 	
 			  	  ImportOneRecord(StockMovr,tag);
 			  	  RecordStore(StockMovr,true); 
 			  	  
				case "RETVC": 					 	
 			  	  ImportOneRecord(Retr,tag);
 			  	  RecordStore(Retr,true); 
 			  	  
				case "RETPUVC": 					 	
 			  	  ImportOneRecord(RetPUr,tag);
 			  	  RecordStore(RetPUr,true);
 			  	  
				case "ORVC": 					 	
 			  	  ImportOneRecord(ORr,tag);
 			  	  RecordStore(ORr,true);
 			  	  
				case "TRVC": 					 	
 			  	  ImportOneRecord(TRr,tag);
 			  	  RecordStore(TRr,true); 
 			  	  
				case "FBVC": 					 	
 			  	  ImportOneRecord(FBr,tag);
 			  	  RecordStore(FBr,true);
 			  	  
				case "ITEMHISTVC": 					 	
 			  	  ImportOneRecord(IHr,tag);
 			  	  RecordStore(IHr,true); 
 			  	  
				case "ITEMSTATUSVC": 					 	
 			  	  ImportOneRecord(ISr,tag);
 			  	  RecordStore(ISr,true);
 			  	  
 			  case "AccVc": 					 	
 			  	  ImportOneRecord(Accr,tag);
 			  	  RecordStore(Accr,true); 
 			  	  
 			  case "ObjVc": 					 	
 			  	  ImportOneRecord(Objr,tag);
 			  	  RecordStore(Objr,true);  	
 			  
 			  case "CLCorspVc": 					 	
 			  	  ImportOneRecord(CLCorspr,tag);
 			  	  RecordStore(CLCorspr,true);  			  	   			  	   			  	  			  	   			  	   			  	   			  	   			  	   			  	   			  	   			  	   			  	   			  	   			  	   			  	   			  	  			  	  
					
			end;
		end;	
  end;  

  RETURN;
END;


Global updating procedure ImportBarCodesIn()
begin
	record INVc INr;
	record RebVc Rebr;
	record ITVc ITr;
	integer i;
	string 255 artcode,barcode;
		
	while (TestEOF()==false) begin
		artcode = ImportField;
		barcode = ImportField;
		if(nonblank(artcode) and nonblank(barcode))then begin
			INr.Code = artcode;
			if(readfirstmain(INr,1,true))then begin
				if(nonblank(INr.BarCode) and INr.BarCode!=barcode)then begin
					INr.BarCode = barcode;
					INr.AlternativeCode = barcode;
					INr.EKNCode = barcode;
					recordstore(INr,true);
				end else begin
					if(blank(INr.BarCode) and nonblank(INr.AlternativeCode) and INr.AlternativeCode!=barcode)then begin
						INr.BarCode = barcode;
						INr.AlternativeCode = barcode;
						INr.EKNCode = barcode;
						recordstore(INr,true);
					end;
				end;
			end;
		end;
		
		NextImportLine(true);
	end;
	return;
end;

global 	//Edit***************************Sasha2,11:45 04.07.2017 {
updating procedure HandleCUClassificationIn(integer mode)
begin
  record CUVc CUr;
  record CClassVc CClassr,CClass2r;
  string 20 code;
  string 255 importedClass,importedClassForExchange,newClassList,extractedClass;
  Boolean storeF;
  Integer pos;

	while (TestEOF()==false) begin
			code = ImportField;
			importedClass = UpperCase(ImportField);
			if (mode==1) then begin
			  importedClassForExchange = UpperCase(ImportField);
			end;

			if(nonblank(code)) then begin
				CUr.Code = code;				
				if (ReadFirstMain(CUr,1,true)) then begin
					storeF = false;
					switch (mode) begin
					  case 0: //add classification
					    if (NonBlank(importedClass)) then begin
					      pos = 0;
                ExtractObj(importedClass,pos,extractedClass);
                while (nonblank(extractedClass)) begin
                  CClassr.Code = extractedClass;
                  if (ReadFirstMain(CClassr,1,true) and SetInSet(extractedClass,CUr.Classification)==false) then begin
                    if (NonBlank(CUr.Classification)) then begin
                      CUr.Classification = CUr.Classification & ",";
                    end;
                    CUr.Classification = CUr.Classification & extractedClass;
                    storeF = true;
                  end;
                  ExtractObj(importedClass,pos,extractedClass);
                end;
					    end;
					  case 1: //exchange classification
              pos = 0;
              ExtractObj(importedClass,pos,extractedClass);
              importedClass = extractedClass;
              pos = 0;
              ExtractObj(importedClassForExchange,pos,extractedClass);
              importedClassForExchange = extractedClass;
              
              newClassList = "";
              CClassr.Code = extractedClass;
              CClass2r.Code = importedClassForExchange;
              if (ReadFirstMain(CClassr,1,true) and ReadFirstMain(CClass2r,1,true)) then begin
                if (NonBlank(importedClass) and NonBlank(importedClassForExchange)) then begin
                  pos = 0;
                  ExtractObj(CUr.Classification,pos,extractedClass);
                  while (NonBlank(extractedClass)) begin
                    if (NonBlank(newClassList)) then begin
                      newClassList = newClassList & ",";
                    end;
                    if (extractedClass==importedClass) then begin
                      newClassList = newClassList & importedClassForExchange;
                    end else begin
                      newClassList = newClassList & extractedClass;
                    end;
                    ExtractObj(CUr.Classification,pos,extractedClass);
                  end; 
                  if (newClassList!=CUr.Classification) then begin
                    CUr.Classification = newClassList;
                    storeF = true;
                  end;
                end;
              end;
					  case 2: //remove classification
					    if (NonBlank(importedClass) and NonBlank(CUr.Classification)) then begin
					      pos = 0;
					      newClassList = "";
                ExtractObj(CUr.Classification,pos,extractedClass);
                while (nonblank(extractedClass)) begin
                  if (SetInSet(extractedClass,importedClass)==false) then begin
                    if (NonBlank(newClassList)) then begin
                      newClassList = newClassList & ",";
                    end;
                    newClassList = newClassList & extractedClass;
                  end;
                  ExtractObj(CUr.Classification,pos,extractedClass);
                end;
                if (newClassList!=CUr.Classification) then begin
                  CUr.Classification = newClassList;
                  storeF = true;
                end;
					    end;
					    if (Blank(importedClass) and NonBlank(CUr.Classification)) then begin //clear up CUVc classifications
					      CUr.Classification = "";
                storeF = true;
					    end;
					end;
					if (storeF) then begin
					  RecordStore(CUr,true);
					end;
				end;
			end;								
				
			if (NextImportLine(true)) then begin end;
	end;		

return;
end; //Edit***************************Sasha2,11:45 04.07.2017 }

global 	//Edit***************************Sasha2,11:45 04.07.2017 {
updating procedure AddCUClassificationIn(record RcVc RepSpec)
begin
  
  HandleCUClassificationIn(0);
  
return;
end; //Edit***************************Sasha2,11:45 04.07.2017 }

global 	//Edit***************************Sasha2,11:45 04.07.2017 {
updating procedure ChangeCUClassificationIn(record RcVc RepSpec)
begin
  
  HandleCUClassificationIn(1);
  
return;
end; //Edit***************************Sasha2,11:45 04.07.2017 }

global 	//Edit***************************Sasha2,11:45 04.07.2017 {
updating procedure RemoveCUClassificationIn(record RcVc RepSpec)
begin
  
  HandleCUClassificationIn(2);
  
return;
end; //Edit***************************Sasha2,11:45 04.07.2017 }


global updating procedure ImportIDEACUIn()
begin
	record CUVc CUr;
	string 255 mfrno,mfrname,mfrnameshort;
	string 255 adres,citystate,contact;
	string 255 phone,mail,maxday,minmax;
	string 255 coef,onproj;
	record ObjVc Objr;
	record DIVc DIr;
	
	while (TestEOF()==false) begin
		mfrno = ImportField;
		mfrname = ImportField;
		mfrnameshort = ImportField;
		adres = ImportField;
		citystate = ImportField;
		contact = ImportField;
		phone = ImportField;
		mail = ImportField;
		maxday = ImportField;
		minmax = ImportField;
		coef = ImportField;
		onproj = ImportField;
		
		/*if(nonblank(mfrno))then begin
			CUr.Code = mfrno;
			if(readfirstmain(CUr,1,true))then begin
				CUr.Name = " " & CUr.Name;
				recordstore(CUr,true);
			end;
		end;*/
		
		if(nonblank(mfrno))then begin
			recordnew(CUr);
				CUr.Code = mfrno;
				CUr.VEType = 1;
				CUr.CUType = 0;
				CUr.Name = mfrname;
				if(blank(CUr.Name))then begin
					CUr.Name = "blank_name";
				end;
				CUr.Phone = phone;
				CUr.InvAddr0 = adres;
				CUr.InvAddr1 = citystate;
				CUr.InvAddr2 = contact;
				CUr.Person =contact;
				CUr.SearchKey = mfrnameshort;
				CUr.Comment = coef & "," & onproj;		
				CUr.OnAccount = 1;
				CUr.SelfBilling = 1;
				CUr.VEVATCode = "0%";
				CUr.AccAP = "60";
				CUr.AccCost = "41/01";
				CUr.OnAccAccAP = "64";
				
				Objr.Code = CUr.Code;
				if(readfirstmain(Objr,1,true)==false)then begin
					recordnew(Objr);
					Objr.Code = CUr.Code;
					Objr.Comment = CUr.Name;
					Objr.OTCode = "BRAND";
					recordstore(Objr,true);
				end;
				
				DIr.Code = CUr.Code;
				if(readfirstmain(DIr,1,true)==false)then begin
					recordnew(Objr);
					DIr.Code = CUr.Code;
					DIr.Name = CUr.Name;
					DIr.CType = "BRAND";
					recordstore(DIr,true);
				end;
			
				if(nonblank(maxday))then begin
					CUr.PlanShipDays = stringtoint(maxday);	
				end;
				if(nonblank(minmax))then begin
					CUr.PlanShipDaysMin = stringtoint(minmax);	
				end;
			recordstore(CUr,true);
		end;
		if (NextImportLine(true)) then begin end;
	end;
	
return;
end;



global updating procedure FixIDEAMn()
begin
	record CUVc CUr;
	boolean TrHs,testf;
	
	CUr.Code = "0000001";
	TrHs = true;
	while(loopmain(CUr,1,TrHs))begin
		testf = true;
		if(CUr.Code<"0000001")then begin TrHs = false; testf = false; end;
		if(CUr.Code>"0000424")then begin TrHs = false; testf = false; end;
		if(CUr.VEType==0)then begin testf = false; end;
		if(CUr.Code=="00001")then begin testf = false; end;
		
		
		if(testf)then begin
			//CUr.Name = " " & CUr.Name;
      if (left(CUr.Name,1)==" ") then begin
        CUr.Name = right(CUr.Name,len(CUr.Name)-1);
        CUr.VECat = "IDEA";
      end;
			recordstore(CUr,true);
		end;
	end;
	
	
return;
end;

global 	//Edit***************************Sasha2,11:45 04.07.2017 {
updating procedure ItemsClassificationsImportIn(record RcVc RepSpec)
begin
	record INVc INr;
	string 100 artcode,brand,collection,group,textbrand,dinameu;  
	string 100 subgrp,category,material,color,shape,size,use,sex,plating,clarity,weight,cut,stone,strap,odour;  
  record OldDIVc DIr;
  record ITVc ITr;
  vector boolean difnd;
  vector string 100 itfind,difound;
  boolean testf,tst,itemfounfd,brnotfound,zerrofl,zerrofl2,zerrofl3;
  integer i,ci,curcmp;
  array string 100 abrnd;
  integer acnt;
  record BPIBrandVc BBr;
  vector string 100 vBrandName;
  
  while(loopmain(BBr,1,true))begin
  	vBrandName[BBr.Code] = BBr.Name;
  end;
  
	curcmp = currentcompany;
	
	for(ci=1;ci<29;ci=ci+1)begin
		tst = true;
		if(ci!=3 and CompanyIsJWLikeCompany(ci))then begin
			tst = false;
		end;
		
		if(tst)then begin

			resetloop(ITr);
			ITr.Code = "";
			while(loopmain(ITr,1,true))begin
					dinameu = uppercase(ITr.Comment);
					itfind[ITr.Code] = dinameu;
			end;

			resetloop(DIr);
			DIr.Code = "";
			while(loopmain(DIr,1,true))begin
				if(DIr.CType=="BRAND")then begin
					abrnd[acnt] = DIr.Code;
					difound[DIr.Code] = uppercase(DIr.Name);
					acnt = acnt + 1;
				end;
			end;
		end;
	end;


  
  while (TestEOF()==false) begin
  	itemfounfd = false;
  	artcode = ImportField;
  	textbrand = ImportField;
  	brand = ImportField;
  	collection = ImportField;
  	group = ImportField;
  	subgrp = ImportField;
		category = ImportField;
		material = ImportField;
		color = ImportField;
		shape = ImportField;
		size = ImportField;
		use = ImportField;
		sex = ImportField;
		plating = ImportField;
		clarity = ImportField;
		weight = ImportField;
		cut = ImportField;
		stone = ImportField;
		strap = ImportField;
		odour = ImportField;
		
		for(ci=1;ci<29;ci=ci+1)begin
			tst = true;
			if(ci!=3 and CompanyIsJWLikeCompany(ci))then begin
				tst = false;
			end;
			if(ci==10)then begin
				tst = false;
			end;
			if(ci==11)then begin
				tst = false;
			end;
			if(ci==12)then begin
				tst = false;
			end;
			
			if(tst)then begin
				setcompany(ci,false);
				INr.Code = artcode;
				zerrofl = true;
				zerrofl2 = true;
				zerrofl3 = true;
	lItemsClassificationsImportIn:;
				if(readfirstmain(INr,1,true))then begin
					brnotfound = false;
					itemfounfd = false;
					testf = true;
					if(nonblank(INr.Group))then begin
						if(left(itfind[INr.Group],len(textbrand))!=textbrand)then begin
							testf = false;
						end else begin
							itemfounfd = true;
						end;
					end else begin
						for(i=0;i<acnt;i=i+1)begin
							if(setinset(abrnd[i],INr.OldDispGroups))then begin
								if(left(difound[abrnd[i]],len(textbrand))!=textbrand)then begin
									testf = false;
								end else begin
									itemfounfd = true;	
								end;
							end else begin
								brnotfound = true;
							end;
						end;
					end;
					if(currentcompany==1 and brand=="BRND0171")then begin
						testf = true;
					end;
					if(currentcompany==2 and brand=="BRND0117")then begin
						testf = true;
					end;
					if(currentcompany==4 and brand=="BRND0182")then begin
						testf = true;
					end;
					if(currentcompany==5 and brand=="BRND0153")then begin
						testf = true;
					end;
					if(currentcompany==6 and brand=="BRND0013")then begin
						testf = true;
					end;
					if(currentcompany==25 and brand=="BRND0046")then begin
						testf = true;
					end;
				
					if(blank(INr.Group) and brnotfound and testf==false)then begin
						testf = true;
					end;

					if(nonblank(INr.BPIBrand) and INr.BPIBrand==brand)then begin
						//testf = true;
					end;
					
					if(blank(INr.BPIGroup) and testf==false)then begin
						//logtext(0,currentcompany & chr(9) & INr.Code & chr(9) & INr.Group & chr(9) & vBrandName[brand]);
						/*if(INr.Group=="AL_P" and vBrandName[brand]=="ALEXANDRE TURPAULT ")then begin testf = true; end;
						if(INr.Group=="ALFI" and vBrandName[brand]=="ALFI")then begin testf = true; end;
						if(INr.Group=="AN_AC" and vBrandName[brand]=="KARE")then begin testf = true; end;
						if(INr.Group=="AN_FU" and vBrandName[brand]=="KARE")then begin testf = true; end;
						if(INr.Group=="BEKA" and vBrandName[brand]=="BEKA")then begin testf = true; end;
						if(INr.Group=="BERNP" and vBrandName[brand]=="BERNARDAUD")then begin testf = true; end;
						if(INr.Group=="BOHEM" and vBrandName[brand]=="BOHEMIA")then begin testf = true; end;
						if(INr.Group=="BR" and vBrandName[brand]=="BRABANTIA")then begin testf = true; end;
						if(INr.Group=="BR_K" and vBrandName[brand]=="BRABANTIA")then begin testf = true; end;
						if(INr.Group=="BR_LC" and vBrandName[brand]=="BRABANTIA")then begin testf = true; end;
						if(INr.Group=="BRAB" and vBrandName[brand]=="BRABANTIA")then begin testf = true; end;
						if(INr.Group=="CANDI" and vBrandName[brand]=="CANDINO")then begin testf = true; end;
						if(INr.Group=="CHR_A" and vBrandName[brand]=="CHRISTOFLE")then begin testf = true; end;
						if(INr.Group=="CHR_F" and vBrandName[brand]=="CHRISTOFLE")then begin testf = true; end;
						if(INr.Group=="CHR_P" and vBrandName[brand]=="CHRISTOFLE")then begin testf = true; end;
						if(INr.Group=="CHURC" and vBrandName[brand]=="CHURCHILL")then begin testf = true; end;
						if(INr.Group=="COG_R" and vBrandName[brand]=="COGAL")then begin testf = true; end;
						if(INr.Group=="COG_T" and vBrandName[brand]=="COGAL")then begin testf = true; end;
						if(INr.Group=="CRIST" and vBrandName[brand]=="CHRISTOFLE")then begin testf = true; end;
						if(INr.Group=="D_S_M" and vBrandName[brand]=="SVAD DONDI")then begin testf = true; end;
						if(INr.Group=="D_S_P" and vBrandName[brand]=="SVAD DONDI")then begin testf = true; end;
						if(INr.Group=="DEKOR" and vBrandName[brand]=="DEKORATIEF  ")then begin testf = true; end;
						if(INr.Group=="DG" and vBrandName[brand]=="De Grisogono")then begin testf = true; end;
						if(INr.Group=="DUPON" and vBrandName[brand]=="Dupont")then begin testf = true; end;
						if(INr.Group=="EGIZI" and vBrandName[brand]=="EGIZIA")then begin testf = true; end;
						if(INr.Group=="ESCAD" and vBrandName[brand]=="ESCADA")then begin testf = true; end;
						if(INr.Group=="F_C_T" and vBrandName[brand]=="CHRISTIAN FISCHBACHER")then begin testf = true; end;
						if(INr.Group=="FESTI" and vBrandName[brand]=="FESTINA")then begin testf = true; end;
						if(INr.Group=="FIS_M" and vBrandName[brand]=="CHRISTIAN FISCHBACHER")then begin testf = true; end;
						if(INr.Group=="FIS_P" and vBrandName[brand]=="CHRISTIAN FISCHBACHER")then begin testf = true; end;
						if(INr.Group=="FISL3" and vBrandName[brand]=="CHRISTIAN FISCHBACHER")then begin testf = true; end;
						if(INr.Group=="FISSL" and vBrandName[brand]=="FISSLER")then begin testf = true; end;*/
						
						testf = true;
						
						if(INr.Group=="AN_AC" and vBrandName[brand]=="CRABTREE&EVELYN")then begin testf = false; end;
						if(INr.Group=="AND_A" and vBrandName[brand]=="IVV")then begin testf = false; end;
						if(INr.Group=="ARCA" and vBrandName[brand]=="CRABTREE&EVELYN")then begin testf = false; end;
						if(INr.Group=="ARCA" and vBrandName[brand]=="Dupont")then begin testf = false; end;
						if(INr.Group=="BODUM" and vBrandName[brand]=="Dupont")then begin testf = false; end;
						if(INr.Group=="CHOPA" and vBrandName[brand]=="CRABTREE&EVELYN")then begin testf = false; end;
						if(INr.Group=="COLLE" and vBrandName[brand]=="RALPH LAUREN HOME")then begin testf = false; end;
						if(INr.Group=="CRA_E" and vBrandName[brand]=="IVV")then begin testf = false; end;
						if(INr.Group=="CRA_E" and vBrandName[brand]=="KARE")then begin testf = false; end;
						if(INr.Group=="CRA_E" and vBrandName[brand]=="LE JACQUARD")then begin testf = false; end;
						if(INr.Group=="CRABT" and vBrandName[brand]=="KARE")then begin testf = false; end;
						if(INr.Group=="DUPON" and vBrandName[brand]=="LENOX")then begin testf = false; end;
						if(INr.Group=="KATRI" and vBrandName[brand]=="Dupont")then begin testf = false; end;
						if(INr.Group=="LAMP" and vBrandName[brand]=="HELIOS")then begin testf = false; end;
						if(INr.Group=="LANGN" and vBrandName[brand]=="KARE")then begin testf = false; end;
						if(INr.Group=="LE_JA" and vBrandName[brand]=="Dupont")then begin testf = false; end;
						if(INr.Group=="LE_JA" and vBrandName[brand]=="KATRIN LEUZE")then begin testf = false; end;
						if(INr.Group=="LE_JA" and vBrandName[brand]=="LALIQUE")then begin testf = false; end;
						if(INr.Group=="LIGHT" and vBrandName[brand]=="LALIQUE")then begin testf = false; end;
						if(INr.Group=="LJ_FR" and vBrandName[brand]=="LALIQUE")then begin testf = false; end;
						if(INr.Group=="POINT" and vBrandName[brand]=="Dupont")then begin testf = false; end;
						if(INr.Group=="RAL_M" and vBrandName[brand]=="LENOX")then begin testf = false; end;
						if(INr.Group=="S_H_F" and vBrandName[brand]=="Dupont")then begin testf = false; end;
						if(INr.Group=="SO_KB" and vBrandName[brand]=="TRUDI")then begin testf = false; end;
						if(INr.Group=="SO_KT" and vBrandName[brand]=="TRUDI")then begin testf = false; end;
						if(INr.Group=="SOHER" and vBrandName[brand]=="LENOX")then begin testf = false; end;
						if(INr.Group=="SZ" and vBrandName[brand]=="ADLER")then begin testf = false; end;
						if(INr.Group=="VAN_R" and vBrandName[brand]=="SIA HOME")then begin testf = false; end;
						if(INr.Group=="VAN_R" and vBrandName[brand]=="YVES DELORME")then begin testf = false; end;
						if(INr.Group=="Y_DEL" and vBrandName[brand]=="CRABTREE&EVELYN")then begin testf = false; end;
						if(INr.Group=="Y_DEL" and vBrandName[brand]=="DINH VAN")then begin testf = false; end;
						if(INr.Group=="YDM" and vBrandName[brand]=="LENOX")then begin testf = false; end;
						if(INr.Group=="YDP" and vBrandName[brand]=="LENOX")then begin testf = false; end;
						if(INr.Group=="YDP" and vBrandName[brand]=="SWAROVSKI")then begin testf = false; end;
						
						if(testf==false)then begin
							logtext(0,currentcompany & chr(9) & INr.Code & chr(9) & INr.Group & chr(9) & vBrandName[brand]);
						end;
					end;	
					if(testf)then begin
						INr.BPIBrand = brand;
						INr.BPICollection = collection;
						INr.BPIGroup = group;
						INr.BPISubGroup = subgrp;
						INr.BPICategory = category;
						INr.BPIMaterial = material;
						INr.BPIColor = color;
						INr.BPIShape = shape;
						INr.BPISize = size;
						INr.BPIUse = use;
						INr.BPISex = sex;
						INr.BPIPlating = plating;
						INr.BPIClarity = clarity;
						INr.BPIWeight = weight;
						INr.BPICut = cut;
						INr.BPIStone = stone;
						INr.BPIStrap = strap;
						INr.BPIOdour = odour;
						recordstore(INr,true);
					end;
				end else begin
					/*if(zerrofl)then begin
						INr.Code = "0" & artcode;
						zerrofl = false;
						goto lItemsClassificationsImportIn;
					end;
					if(zerrofl2)then begin
						INr.Code = "00" & artcode;
						zerrofl2 = false;
						goto lItemsClassificationsImportIn;
					end;
					if(zerrofl3)then begin
						INr.Code = "000" & artcode;
						zerrofl3 = false;
						goto lItemsClassificationsImportIn;
					end;*/
				end;
			end;
		
		end;
  	if (NextImportLine(true)) then begin end;
	end;
	resetcompany(curcmp);	
  
return;
end; //Edit***************************Sasha2,11:45 04.07.2017 }


global 	//Edit***************************Sasha2,11:45 04.07.2017 {
updating procedure ImportSuppELevelIn(record RcVc RepSpec)
begin
	record CUVc CUr;
	string 100 cucode,elevel,deltype,supptype,prodtime;
	
	while (TestEOF()==false) begin
		
		cucode = ImportField;
		elevel = ImportField;
		deltype = ImportField;
		supptype = ImportField;
		prodtime = ImportField;
		
		if(nonblank(cucode))then begin
			CUr.Code = cucode;
			if(readfirstmain(CUr,1,true))then begin
				if(nonblank(elevel))then begin
					CUr.ELevel = evaltoval(elevel);
				end;
				if(nonblank(deltype))then begin
					CUr.DeliveryWay = stringtoint(deltype);
				end;
				if(nonblank(supptype))then begin
					CUr.DeliveryFrom = stringtoint(supptype);
				end;
				if(nonblank(prodtime))then begin
					CUr.PlanShipDaysMin = stringtoint(prodtime);
				end;
				recordstore(CUr,true);
			end;
		end;
		
		if (NextImportLine(true)) then begin end;
	end;
	
return;
end;





global 	 // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger13:08 30.04.2019
updating procedure ImportRUSClassVcIn(record RcVc RepSpec)
begin
	record BTRxBrandVc BTRxBrandr;
	record BTRxMaterialVc BTRxMaterialr;
	record BTRxColourVc BTRxColorr;
	record BTRxSizeVc BTRxSizer;
	record BTRxSexVc BTRxSexr;
	record BTRxPlatingVc BTRxPlatingr;
	record BTRxStoneVc BTRxStoner;
	record BTRxStrapVc BTRxStrapr;
	record BTRxOdourVc BTRxOdourr;
	record BtrxInternalCatVc BtrxInternalCatr;
	record BtrxFirstLevelCatVc BtrxFirstLevelCatr;
	record BtrxSecondLevelCatVc BtrxSecondLevelCatr;
	record BtrxThirdLevelCatVc BtrxThirdLevelCatr;
	record BtrxFourthLevelCatVc BtrxFourthLevelCatr;
	record BtrxCertificateVc BtrxCertificater;
	record BtrxWatchMechanVc BtrxWatchMechanr;
	record BtrxPowerReserveVc BtrxPowerReserver;
	record BtrxWatchGradeVc BtrxWatchGrader;
	record BtrxPhoneModelVc BtrxPhoneModelr;
	record BtrxFillingVc BtrxFillingr;
	record BtrxTypeVc BtrxTyper;
	record BtrxWaterResistantVc BtrxWatResr;
	record BtrxStrapMatVc BtrxStrapMatr;
	record BtrxBracelMatVc BtrxBracelMatr;
	record BtrxCollectionVc BtrxCollectionr;
	record BtrxComplicationsVc BtrxComplicationsr;
	record BtrxMicrowaveProtectVc BtrxMicrowaveProtectr;
	record BtrxStoveCompatVc BtrxStoveCompatr;
	record BtrxAllMaterialsVc BtrxAllMaterialsr;
	record BtrxPrecMetalContVc BtrxPrecMetalContr;
	record BtrxCaseDiamVc BtrxCaseDiamr;
	string 100 code,name,rname;
	
	while (TestEOF()==false) begin
		
		code = ImportField;
		name = ImportField;
		rname = "";
		if(nonblank(code))then begin
			BtrxCaseDiamr.Code = code;
			if(readfirstmain(BtrxCaseDiamr,1,true))then begin
				if(nonblank(BtrxCaseDiamr.Name))then begin
					BtrxCaseDiamr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BtrxCaseDiamr,true);
			end;
			BtrxCaseDiamr.Name = code;
			if(readfirstKey("Name",BtrxCaseDiamr,1,true))then begin
				if(nonblank(BtrxCaseDiamr.Name))then begin
					BtrxCaseDiamr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BtrxCaseDiamr,true);
			end;
			BtrxPrecMetalContr.Code = code;
			if(readfirstmain(BtrxPrecMetalContr,1,true))then begin
				if(nonblank(BtrxPrecMetalContr.Name))then begin
					BtrxPrecMetalContr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BtrxPrecMetalContr,true);
			end;
			BtrxPrecMetalContr.Name = code;
			if(readfirstKey("Name",BtrxPrecMetalContr,1,true))then begin
				if(nonblank(BtrxPrecMetalContr.Name))then begin
					BtrxPrecMetalContr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BtrxPrecMetalContr,true);
			end;
			BtrxAllMaterialsr.Code = code;
			if(readfirstmain(BtrxAllMaterialsr,1,true))then begin
				if(nonblank(BtrxAllMaterialsr.Name))then begin
					BtrxAllMaterialsr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BtrxAllMaterialsr,true);
			end;
			BtrxAllMaterialsr.Name = code;
			if(readfirstKey("Name",BtrxAllMaterialsr,1,true))then begin
				if(nonblank(BtrxAllMaterialsr.Name))then begin
					BtrxAllMaterialsr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BtrxAllMaterialsr,true);
			end;
			BtrxCollectionr.Code = code;
			if(readfirstmain(BtrxCollectionr,1,true))then begin
				if(nonblank(BtrxCollectionr.Name))then begin
					BtrxCollectionr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BtrxCollectionr,true);
			end;
			BtrxCollectionr.Name = code;
			if(readfirstKey("Name",BtrxCollectionr,1,true))then begin
				if(nonblank(BtrxCollectionr.Name))then begin
					BtrxCollectionr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BtrxCollectionr,true);
			end;
			BtrxBracelMatr.Code = code;
			if(readfirstmain(BtrxBracelMatr,1,true))then begin
				if(nonblank(BtrxBracelMatr.Name))then begin
					BtrxBracelMatr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BtrxBracelMatr,true);
			end;
			BtrxBracelMatr.Name = code;
			if(readfirstKey("Name",BtrxBracelMatr,1,true))then begin
				if(nonblank(BtrxBracelMatr.Name))then begin
					BtrxBracelMatr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BtrxBracelMatr,true);
			end;
			BtrxStrapMatr.Code = code;
			if(readfirstmain(BtrxStrapMatr,1,true))then begin
				if(nonblank(BtrxStrapMatr.Name))then begin
					BtrxStrapMatr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BtrxStrapMatr,true);
			end;
			BtrxStrapMatr.Name = code;
			if(readfirstKey("Name",BtrxStrapMatr,1,true))then begin
				if(nonblank(BtrxStrapMatr.Name))then begin
					BtrxStrapMatr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BtrxStrapMatr,true);
			end;
			BtrxMicrowaveProtectr.Code = code;
			if(readfirstmain(BtrxMicrowaveProtectr,1,true))then begin
				if(nonblank(BtrxMicrowaveProtectr.Name))then begin
					BtrxMicrowaveProtectr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BtrxMicrowaveProtectr,true);
			end;
			BtrxMicrowaveProtectr.Name = code;
			if(readfirstKey("Name",BtrxMicrowaveProtectr,1,true))then begin
				if(nonblank(BtrxMicrowaveProtectr.Name))then begin
					BtrxMicrowaveProtectr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BtrxMicrowaveProtectr,true);
			end;
			BtrxComplicationsr.Code = code;
			if(readfirstmain(BtrxComplicationsr,1,true))then begin
				if(nonblank(BtrxComplicationsr.Name))then begin
					BtrxComplicationsr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BtrxComplicationsr,true);
			end;
			BtrxComplicationsr.Name = code;
			if(readfirstKey("Name",BtrxComplicationsr,1,true))then begin
				if(nonblank(BtrxComplicationsr.Name))then begin
					BtrxComplicationsr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BtrxComplicationsr,true);
			end;
			BtrxStoveCompatr.Code = code;
			if(readfirstmain(BtrxStoveCompatr,1,true))then begin
				if(nonblank(BtrxStoveCompatr.Name))then begin
					BtrxStoveCompatr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BtrxStoveCompatr,true);
			end;
			BtrxStoveCompatr.Name = code;
			if(readfirstKey("Name",BtrxStoveCompatr,1,true))then begin
				if(nonblank(BtrxStoveCompatr.Name))then begin
					BtrxStoveCompatr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BtrxStoveCompatr,true);
			end;
			BTRxBrandr.Code = code;
			if(readfirstmain(BTRxBrandr,1,true))then begin
				if(nonblank(BTRxBrandr.Name))then begin
					BTRxBrandr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BTRxBrandr,true);
			end;
			BTRxBrandr.Name = code;
			if(readfirstKey("Name",BTRxBrandr,1,true))then begin
				if(nonblank(BTRxBrandr.Name))then begin
					BTRxBrandr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BTRxBrandr,true);
			end;
			BTRxMaterialr.Code = code;
			if(readfirstmain(BTRxMaterialr,1,true))then begin
				if(nonblank(BTRxMaterialr.Name))then begin
					BTRxMaterialr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BTRxMaterialr,true);
			end;
			BTRxMaterialr.Name = code;
			if(readfirstKey("Name",BTRxMaterialr,1,true))then begin
				if(nonblank(BTRxMaterialr.Name))then begin
					BTRxMaterialr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BTRxMaterialr,true);
			end;
			BTRxColorr.Code = code;
			if(readfirstmain(BTRxColorr,1,true))then begin
				if(nonblank(BTRxColorr.Name))then begin
					BTRxColorr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BTRxColorr,true);
			end;
			BTRxColorr.Name = code;
			if(readfirstKey("Name",BTRxColorr,1,true))then begin
				if(nonblank(BTRxColorr.Name))then begin
					BTRxColorr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BTRxColorr,true);
			end;
			BTRxSizer.Code = code;
			if(readfirstmain(BTRxSizer,1,true))then begin
				if(nonblank(BTRxSizer.Name))then begin
					BTRxSizer.NameRUS = name;
					//rname = "";
				end;
				recordstore(BTRxSizer,true);
			end;
			BTRxSizer.Name = code;
			if(readfirstKey("Name",BTRxSizer,1,true))then begin
				if(nonblank(BTRxSizer.Name))then begin
					BTRxSizer.NameRUS = name;
					//rname = "";
				end;
				recordstore(BTRxSizer,true);
			end;
			BTRxSexr.Code = code;
			if(readfirstmain(BTRxSexr,1,true))then begin
				if(nonblank(BTRxSexr.Name))then begin
					BTRxSexr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BTRxSexr,true);
			end;
			BTRxSexr.Name = code;
			if(readfirstKey("Name",BTRxSexr,1,true))then begin
				if(nonblank(BTRxSexr.Name))then begin
					BTRxSexr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BTRxSexr,true);
			end;
			BTRxPlatingr.Code = code;
			if(readfirstmain(BTRxPlatingr,1,true))then begin
				if(nonblank(BTRxPlatingr.Name))then begin
					BTRxPlatingr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BTRxPlatingr,true);
			end;
			BTRxPlatingr.Name = code;
			if(readfirstKey("Name",BTRxPlatingr,1,true))then begin
				if(nonblank(BTRxPlatingr.Name))then begin
					BTRxPlatingr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BTRxPlatingr,true);
			end;
			BTRxStoner.Code = code;
			if(readfirstmain(BTRxStoner,1,true))then begin
				if(nonblank(BTRxStoner.Name))then begin
					BTRxStoner.NameRUS = name;
					//rname = "";
				end;
				recordstore(BTRxStoner,true);
			end;
			BTRxStoner.Name = code;
			if(readfirstKey("Name",BTRxStoner,1,true))then begin
				if(nonblank(BTRxStoner.Name))then begin
					BTRxStoner.NameRUS = name;
					//rname = "";
				end;
				recordstore(BTRxStoner,true);
			end;
			BTRxStrapr.Code = code;
			if(readfirstmain(BTRxStrapr,1,true))then begin
				if(nonblank(BTRxStrapr.Name))then begin
					BTRxStrapr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BTRxStrapr,true);
			end;
			BTRxStrapr.Name = code;
			if(readfirstKey("Name",BTRxStrapr,1,true))then begin
				if(nonblank(BTRxStrapr.Name))then begin
					BTRxStrapr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BTRxStrapr,true);
			end;
			BtrxWatResr.Code = code;
			if(readfirstmain(BtrxWatResr,1,true))then begin
				if(nonblank(BtrxWatResr.Name))then begin
					BtrxWatResr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BtrxWatResr,true);
			end;
			BtrxWatResr.Name = code;
			if(readfirstKey("Name",BtrxWatResr,1,true))then begin
				if(nonblank(BtrxWatResr.Name))then begin
					BtrxWatResr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BtrxWatResr,true);
			end;
			BtrxTyper.Code = code;
			if(readfirstmain(BtrxTyper,1,true))then begin
				if(nonblank(BtrxTyper.Name))then begin
					BtrxTyper.NameRUS = name;
					//rname = "";
				end;
				recordstore(BtrxTyper,true);
			end;
			BtrxTyper.Name = code;
			if(readfirstKey("Name",BtrxTyper,1,true))then begin
				if(nonblank(BtrxTyper.Name))then begin
					BtrxTyper.NameRUS = name;
					//rname = "";
				end;
				recordstore(BtrxTyper,true);
			end;
			BtrxFillingr.Code = code;
			if(readfirstmain(BtrxFillingr,1,true))then begin
				if(nonblank(BtrxFillingr.Name))then begin
					BtrxFillingr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BtrxFillingr,true);
			end;
			BtrxFillingr.Name = code;
			if(readfirstKey("Name",BtrxFillingr,1,true))then begin
				if(nonblank(BtrxFillingr.Name))then begin
					BtrxFillingr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BtrxFillingr,true);
			end;
			BtrxPhoneModelr.Code = code;
			if(readfirstmain(BtrxPhoneModelr,1,true))then begin
				if(nonblank(BtrxPhoneModelr.Name))then begin
					BtrxPhoneModelr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BtrxPhoneModelr,true);
			end;
			BtrxPhoneModelr.Name = code;
			if(readfirstKey("Name",BtrxPhoneModelr,1,true))then begin
				if(nonblank(BtrxPhoneModelr.Name))then begin
					BtrxPhoneModelr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BtrxPhoneModelr,true);
			end;
			BtrxWatchGrader.Code = code;
			if(readfirstmain(BtrxWatchGrader,1,true))then begin
				if(nonblank(BtrxWatchGrader.Name))then begin
					BtrxWatchGrader.NameRUS = name;
					//rname = "";
				end;
				recordstore(BtrxWatchGrader,true);
			end;
			BtrxWatchGrader.Name = code;
			if(readfirstKey("Name",BtrxWatchGrader,1,true))then begin
				if(nonblank(BtrxWatchGrader.Name))then begin
					BtrxWatchGrader.NameRUS = name;
					//rname = "";
				end;
				recordstore(BtrxWatchGrader,true);
			end;
			BtrxPowerReserver.Code = code;
			if(readfirstmain(BtrxPowerReserver,1,true))then begin
				if(nonblank(BtrxPowerReserver.Name))then begin
					BtrxPowerReserver.NameRUS = name;
					//rname = "";
				end;
				recordstore(BtrxPowerReserver,true);
			end;
			BtrxPowerReserver.Name = code;
			if(readfirstKey("Name",BtrxPowerReserver,1,true))then begin
				if(nonblank(BtrxPowerReserver.Name))then begin
					BtrxPowerReserver.NameRUS = name;
					//rname = "";
				end;
				recordstore(BtrxPowerReserver,true);
			end;
			BtrxWatchMechanr.Code = code;
			if(readfirstmain(BtrxWatchMechanr,1,true))then begin
				if(nonblank(BtrxWatchMechanr.Name))then begin
					BtrxWatchMechanr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BtrxWatchMechanr,true);
			end;
			BtrxWatchMechanr.Name = code;
			if(readfirstKey("Name",BtrxWatchMechanr,1,true))then begin
				if(nonblank(BtrxWatchMechanr.Name))then begin
					BtrxWatchMechanr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BtrxWatchMechanr,true);
			end;
			BtrxCertificater.Code = code;
			if(readfirstmain(BtrxCertificater,1,true))then begin
				if(nonblank(BtrxCertificater.Name))then begin
					BtrxCertificater.NameRUS = name;
					//rname = "";
				end;
				recordstore(BtrxCertificater,true);
			end;
			BtrxCertificater.Name = code;
			if(readfirstKey("Name",BtrxCertificater,1,true))then begin
				if(nonblank(BtrxCertificater.Name))then begin
					BtrxCertificater.NameRUS = name;
					//rname = "";
				end;
				recordstore(BtrxCertificater,true);
			end;
			BtrxFourthLevelCatr.Code = code;
			if(readfirstmain(BtrxFourthLevelCatr,1,true))then begin
				if(nonblank(BtrxFourthLevelCatr.Name))then begin
					BtrxFourthLevelCatr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BtrxFourthLevelCatr,true);
			end;
			BtrxFourthLevelCatr.Name = code;
			if(readfirstKey("Name",BtrxFourthLevelCatr,1,true))then begin
				if(nonblank(BtrxFourthLevelCatr.Name))then begin
					BtrxFourthLevelCatr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BtrxFourthLevelCatr,true);
			end;
			BtrxThirdLevelCatr.Code = code;
			if(readfirstmain(BtrxThirdLevelCatr,1,true))then begin
				if(nonblank(BtrxThirdLevelCatr.Name))then begin
					BtrxThirdLevelCatr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BtrxThirdLevelCatr,true);
			end;
			BtrxThirdLevelCatr.Name = code;
			if(readfirstKey("Name",BtrxThirdLevelCatr,1,true))then begin
				if(nonblank(BtrxThirdLevelCatr.Name))then begin
					BtrxThirdLevelCatr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BtrxThirdLevelCatr,true);
			end;
			BtrxSecondLevelCatr.Code = code;
			if(readfirstmain(BtrxSecondLevelCatr,1,true))then begin
				if(nonblank(BtrxSecondLevelCatr.Name))then begin
					BtrxSecondLevelCatr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BtrxSecondLevelCatr,true);
			end;
			BtrxSecondLevelCatr.Name = code;
			if(readfirstKey("Name",BtrxSecondLevelCatr,1,true))then begin
				if(nonblank(BtrxSecondLevelCatr.Name))then begin
					BtrxSecondLevelCatr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BtrxSecondLevelCatr,true);
			end;
			BtrxFirstLevelCatr.Code = code;
			if(readfirstmain(BtrxFirstLevelCatr,1,true))then begin
				if(nonblank(BtrxFirstLevelCatr.Name))then begin
					BtrxFirstLevelCatr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BtrxFirstLevelCatr,true);
			end;
			BtrxFirstLevelCatr.Name = code;
			if(readfirstKey("Name",BtrxFirstLevelCatr,1,true))then begin
				if(nonblank(BtrxFirstLevelCatr.Name))then begin
					BtrxFirstLevelCatr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BtrxFirstLevelCatr,true);
			end;
			BtrxInternalCatr.Code = code;
			if(readfirstmain(BtrxInternalCatr,1,true))then begin
				if(nonblank(BtrxInternalCatr.Name))then begin
					BtrxInternalCatr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BtrxInternalCatr,true);
			end;
			BtrxInternalCatr.Name = code;
			if(readfirstKey("Name",BtrxInternalCatr,1,true))then begin
				if(nonblank(BtrxInternalCatr.Name))then begin
					BtrxInternalCatr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BtrxInternalCatr,true);
			end;
			BTRxOdourr.Code = code;
			if(readfirstmain(BTRxOdourr,1,true))then begin
				if(nonblank(BTRxOdourr.Name))then begin
					BTRxOdourr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BTRxOdourr,true);
			end;
			BTRxOdourr.Name = code;
			if(readfirstKey("Name",BTRxOdourr,1,true))then begin
				if(nonblank(BTRxOdourr.Name))then begin
					BTRxOdourr.NameRUS = name;
					//rname = "";
				end;
				recordstore(BTRxOdourr,true);
			end;
		end;
		rname = "";
		if (NextImportLine(true)) then begin end;
	end;
return;
end;




global 	 // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 10:30 27.08.2019
updating procedure ImportfillOrigItemCodeIn(record RcVc RepSpec)
begin
	record INVc INr;
	string 255 OrCode, INCode;

	while (TestEOF()==false) begin
		INCode = 0;
		OrCode = 0;
	
		INCode = ImportField;
		OrCode = ImportField;
		
		INr.Code = INCode;
		if (ReadFirstMain(INr,1,true)) then begin
			INr.OrigCode = OrCode;
			RecordStore(INr,true);
		end;
		
		INr.AlternativeCode = INCode;
		if (ReadFirstKey("AlternativeCode",INr,1,true)) then begin
			INr.OrigCode = OrCode;
			RecordStore(INr,true);
		end;
		
		
		if (NextImportLine(true)) then begin end;
	end;
return;
end;










global webpublic updating procedure ImportActBrendSectIn()
begin
	record BTRxBrandVc Brandr;
	record BtrxSecondLevelCatVc BtrxSecondLevelCatr, BSLLastCoder;
	boolean crtdf, TrHs;
	string 255 OldCode, BName;
	vector boolean vBName;

	SetCompany(29,false);
	
	
	
	while (TestEOF()==false) begin
		BName = "";
		BName = ImportField;
		vBName[BName] = true;
		if (NextImportLine(true)) then begin end;
	end;
	
	
	
	

	Brandr.Code = "";
	while (loopMain(Brandr,1,true)) begin
		if (vBName[Brandr.Name]) then begin
			vBName[Brandr.Name] = false;
			crtdf = false;
			BSLLastCoder.Name = Brandr.Name;
			BSLLastCoder.Code = "BRST00000";
			TrHs = true;
			while (LoopKey("Name",BSLLastCoder,2,TrHs)) begin
				if (left(BSLLastCoder.Code,4)!="BRST" or BSLLastCoder.Name!=Brandr.Name) then begin TrHs = false; end;
				if (TrHs) then begin
					TrHs = false;
					crtdf = true;
				end;
			end;
			OldCode = "";
			ResetLoop(BSLLastCoder);
			if (!crtdf) then begin
				BSLLastCoder.Code = "BRST99999";
				TrHs = true;
				while (LoopBackKey("Code",BSLLastCoder,1,TrHs)) begin
					if (left(BSLLastCoder.Code,4)=="BRST") then begin
						OldCode = BSLLastCoder.Code;
						TrHs = false;
					end;
				end;
				ResetLoop(BSLLastCoder);
				if(blank(OldCode))then begin OldCode = "BRST00000"; end;
				NextM4SerialNumber(OldCode,BtrxSecondLevelCatr.Code);
				BtrxSecondLevelCatr.Name = Brandr.Name;
				BtrxSecondLevelCatr.NameRUS = Brandr.Name;
				BtrxSecondLevelCatr.NameAZ = Brandr.Name;
				BtrxSecondLevelCatr.PathFrstCode = "BRANDS";
				recordstore(BtrxSecondLevelCatr,true);
				// recordupdate(BtrxSecondLevelCatr,BtrxSecondLevelCatr,true);
			end;
		end;
	end;
return;
end;









global updating procedure SetInstockForExtProvItems()
begin
	record GlobalItemVc GIr;
	row GlobalItemVc GIrw;
	boolean crtdf, TrHs;
	string 255 OldCode, ICODE, IQTY;
	vector val ICODEF;

	SetCompany(29,false);
	
	
	
	while (TestEOF()==false) begin
		ICODE = "";
		ICODE = ImportField;
		IQTY = ImportField;
		ICODEF[ICODE] = stringtoval(IQTY,M4Val);
		GIr.Code = ICODE;
		if (ReadFirstMain(GIr,1,true)) then begin
			 TimeStamps(GIrw,stringtoval(IQTY,M4Val)," TimeStamplog 36");
				GIrw.Instock = stringtoval(IQTY,M4Val);
				GIrw.Code = GIr.Code;
				matrowput(GIr,0,GIrw);
				RecordStore(GIr,true);
		end;
		
		if (NextImportLine(true)) then begin end;
	end;
	
	// GIr.Code = "NOVAS";
	// TrHs = true;
	// while (loopMain(GIr,1,TrHs)) begin
		// if (ICODEF[ICODE]!=blankval) then begin
			// matrowget(GIr,0,GIrw);
			// if (GIrw.Location=="MAIN") then begin
        // TimeStamps(GIrw,ICODEF[ICODE]," TimeStamplog 36");
				// GIrw.Instock = ICODEF[ICODE];
				// GIrw.Code = GIr.Code;
				// matrowput(GIr,0,GIrw);
				// RecordStore(GIr,true);
				// //queued.SaveGI(GIr);
			// end;
		// end;
	// end;
return;
end;






global updating procedure QueuedImportActBrendSectIn(string BrandrName,var record GlobalItemVc GIr)
begin
	record BTRxBrandVc Brandr;
	record BtrxSecondLevelCatVc BtrxSecondLevelCatr, BSLLastCoder;
	boolean crtdf, TrHs;
	string 255 OldCode, BName;
	vector boolean vBName;

	SetCompany(29,false);
	
	
	crtdf = false;
	BSLLastCoder.Name = BrandrName;
	BSLLastCoder.Code = "BRST00000";
	TrHs = true;
	while (LoopKey("Name",BSLLastCoder,2,TrHs)) begin
		if (left(BSLLastCoder.Code,4)!="BRST" or BSLLastCoder.Name!=BrandrName) then begin TrHs = false; end;
		if (TrHs) then begin
			TrHs = false;
			crtdf = true;
		end;
	end;
	OldCode = "";
	ResetLoop(BSLLastCoder);
	if (!crtdf) then begin
		BSLLastCoder.Code = "BRST99999";
		TrHs = true;
		while (LoopBackKey("Code",BSLLastCoder,1,TrHs)) begin
			if (left(BSLLastCoder.Code,4)=="BRST") then begin
				OldCode = BSLLastCoder.Code;
				TrHs = false;
			end;
		end;
		ResetLoop(BSLLastCoder);
		if(blank(OldCode))then begin OldCode = "BRST00000"; end;
		NextM4SerialNumber(OldCode,BtrxSecondLevelCatr.Code);
		BtrxSecondLevelCatr.Name = BrandrName;
		BtrxSecondLevelCatr.NameRUS = BrandrName;
		BtrxSecondLevelCatr.NameAZ = BrandrName;
		BtrxSecondLevelCatr.PathFrstCode = "BRANDS";
		recordstore(BtrxSecondLevelCatr,true);
		if (nonblank(GIr.BTRxGiftClass)) then begin GIr.BTRxGiftClass = GIr.BTRxGiftClass & ","; end;
		GIr.BTRxGiftClass = GIr.BTRxGiftClass & BtrxSecondLevelCatr.Code;
	end;
return;
end;







global updating procedure SaveGIWithoutBrandSect(Record GlobalItemVc GIr)
begin
	record GlobalItemVc LogGIr;
	
	recordcopy(LogGIr,GIr);
	GIWasUpdated(GIr,LogGIr," GIWasUpdatedlog 105");
	RecordStore(GIr,true);
	logtext(0,GIr.Code & " SaveGIWithoutBrandSect");
	
return;
end;









global 	 
webpublic updating procedure WebDeleteCat()
begin
	record BtrxFirstLevelCatVc BtrxFirstLevelCatr, oldFLCr;
	record BtrxSecondLevelCatVc BtrxSecondLevelCatr, oldSLCr;
	record BtrxThirdLevelCatVc BtrxThirdLevelCatr, oldTLCr;
	record BtrxFourthLevelCatVc BtrxFourthLevelCatr, oldFrLCr;
	array string 255 DelFisrtLev, DelSecLev, DelThirdLev, DelFourthLev;
	LongInt i;

	DelFisrtLev[0] = "FILVL0003";
	DelFisrtLev[1] = "FILVL0004";
	
	for (i=0;i<DelFisrtLev.length;i=i+1) begin
		BtrxSecondLevelCatr.Code = "";
		while (LoopMain(BtrxSecondLevelCatr,1,true)) begin
			if (BtrxSecondLevelCatr.PathFrstCode==DelFisrtLev[i]) then begin
				DelSecLev[DelSecLev.length] = BtrxSecondLevelCatr.Code;
				BtrxThirdLevelCatr.Code = "";
				while (LoopMain(BtrxThirdLevelCatr,1,true)) begin
					if (BtrxThirdLevelCatr.PathScndCode==BtrxSecondLevelCatr.Code) then begin
						DelThirdLev[DelThirdLev.length] = BtrxThirdLevelCatr.Code;
						BtrxFourthLevelCatr.Code = "";
						while (LoopMain(BtrxFourthLevelCatr,1,true)) begin
							if (BtrxFourthLevelCatr.PathThirdCode==BtrxThirdLevelCatr.Code) then begin
								DelFourthLev[DelFourthLev.length] = BtrxFourthLevelCatr.Code;
							end;
						end;
						resetloop(BtrxFourthLevelCatr);
					end;
				end;
				resetloop(BtrxThirdLevelCatr);
			end;
		end;
		resetloop(BtrxSecondLevelCatr);
	end;

	for (i=0;i<DelFisrtLev.length;i=i+1) begin
		BtrxFirstLevelCatr.Code = DelFisrtLev[i];
		if (ReadFirstMain(BtrxFirstLevelCatr,1,true)) then begin
			recordDelete(BtrxFirstLevelCatr);
			WebOutString("First Lev Cat  " & BtrxFirstLevelCatr.Name & " (" & BtrxFirstLevelCatr.Code & ") " & BtrxFirstLevelCatr.NameRUS);
			weboutstring("<BR>");
		end;
	end;
	for (i=0;i<DelSecLev.length;i=i+1) begin
		BtrxSecondLevelCatr.Code = DelSecLev[i];
		if (ReadFirstMain(BtrxSecondLevelCatr,1,true)) then begin
			recordDelete(BtrxSecondLevelCatr);
			WebOutString("Second Lev Cat  " & BtrxSecondLevelCatr.Name & " (" & BtrxSecondLevelCatr.Code & ") " & BtrxSecondLevelCatr.NameRUS);
			weboutstring("<BR>");
		end;
	end;
	for (i=0;i<DelThirdLev.length;i=i+1) begin
		BtrxThirdLevelCatr.Code = DelThirdLev[i];
		if (ReadFirstMain(BtrxThirdLevelCatr,1,true)) then begin
			recordDelete(BtrxThirdLevelCatr);
			WebOutString("Third Lev Cat  " & BtrxThirdLevelCatr.Name & " (" & BtrxThirdLevelCatr.Code & ") " & BtrxThirdLevelCatr.NameRUS);
			weboutstring("<BR>");
		end;
	end;
	for (i=0;i<DelFourthLev.length;i=i+1) begin
		BtrxFourthLevelCatr.Code = DelFourthLev[i];
		if (ReadFirstMain(BtrxFourthLevelCatr,1,true)) then begin
			recordDelete(BtrxFourthLevelCatr);
			WebOutString("Fourth Lev Cat  " & BtrxFourthLevelCatr.Name & " (" & BtrxFourthLevelCatr.Code & ") " & BtrxFourthLevelCatr.NameRUS);
			weboutstring("<BR>");
		end;
	end;



return;
end;


global 	 // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 10:30 27.08.2019
updating procedure Import4catIn(record RcVc RepSpec)
begin
	record INVc INr;
	string 255 cat1, cat2, cat3, cat4, cat1Code, cat2Code, cat3Code, cat4Code, OldCode;
	record BtrxFirstLevelCatVc BtrxFirstLevelCatr, oldFLCr;
	record BtrxSecondLevelCatVc BtrxSecondLevelCatr, oldSLCr;
	record BtrxThirdLevelCatVc BtrxThirdLevelCatr, oldTLCr;
	record BtrxFourthLevelCatVc BtrxFourthLevelCatr, oldFrLCr;
	boolean TrHs;

	while (TestEOF()==false) begin
		cat1 = "";
		cat2 = "";
		cat3 = "";
		cat4 = "";
		cat1Code = "";
		cat2Code = "";
		cat3Code = "";
		cat4Code = "";
		
		cat1 = trim(ImportField);
		cat2 = trim(ImportField);
		cat3 = trim(ImportField);
		cat4 = trim(ImportField);
		if (nonblank(cat1) and nonblank(cat2) and nonblank(cat3)) then begin
			OldCode = "";
			BtrxFirstLevelCatr.Name = cat1;
			if (ReadFirstKey("Name",BtrxFirstLevelCatr,1,true)) then begin
				cat1Code = BtrxFirstLevelCatr.Code;
			end else begin
				oldFLCr.Code = "FRLVL9999";
				TrHs = true;
				while (LoopBackKey("Code",oldFLCr,1,TrHs)) begin
						OldCode = oldFLCr.Code;
						TrHs = false;
				end;
				ResetLoop(oldFLCr);
				if(blank(OldCode)) then begin oldCode = "FRLVL0000"; end;
				NextM4SerialNumber(OldCode,BtrxFirstLevelCatr.Code);
				cat1Code = BtrxFirstLevelCatr.Code;
				BtrxFirstLevelCatr.Name = cat1;
				BtrxFirstLevelCatr.NameRUS = "";
				BtrxFirstLevelCatr.NameAZ = "";
				RecordStore(BtrxFirstLevelCatr,true);
			end;
			// _________________________________________________________
			BtrxSecondLevelCatr.Name = cat2;
			TrHs = true;
			while (LoopKey("Name",BtrxSecondLevelCatr,1,TrHs))begin
				if (BtrxSecondLevelCatr.Name != cat2) then begin TrHs = false; end;
				if (TrHs and BtrxSecondLevelCatr.PathFrstCode==cat1Code) then begin
					cat2Code = BtrxSecondLevelCatr.Code;
					TrHs = false;
				end;
			end;
			OldCode = "";
			ResetLoop(BtrxSecondLevelCatr);
			if (blank(cat2Code)) then begin
				oldSLCr.Code = "SCLVL9999";
				TrHs = true;
				while (LoopBackKey("Code",oldSLCr,1,TrHs)) begin
						OldCode = oldSLCr.Code;
						TrHs = false;
				end;
				ResetLoop(oldSLCr);
				if(blank(OldCode)) then begin oldCode = "SCLV0000"; end;
				NextM4SerialNumber(OldCode,BtrxSecondLevelCatr.Code);
				cat2Code = BtrxSecondLevelCatr.Code;
				BtrxSecondLevelCatr.Name = cat2 ;
				BtrxSecondLevelCatr.NameRUS = "";
				BtrxSecondLevelCatr.NameAZ = "";
				BtrxSecondLevelCatr.PathFrstCode = cat1Code; 
				RecordStore(BtrxSecondLevelCatr,true);
			end;
			
			// _________________________________________________________
			
			BtrxThirdLevelCatr.Name = cat3;
			TrHs = true;
			while (LoopKey("Name",BtrxThirdLevelCatr,1,TrHs))begin
				if (BtrxThirdLevelCatr.Name != cat3) then begin TrHs = false; end;
				if (TrHs and BtrxThirdLevelCatr.PathScndCode==cat2Code) then begin
					cat3Code = BtrxThirdLevelCatr.Code;
					TrHs = false;
				end;
			end;
			OldCode = "";
			ResetLoop(BtrxThirdLevelCatr);
			if (blank(cat3Code)) then begin
				oldTLCr.Code = "THLVL9999";
				TrHs = true;
				while (LoopBackKey("Code",oldTLCr,1,TrHs)) begin
						OldCode = oldTLCr.Code;
						TrHs = false;
				end;
				ResetLoop(oldTLCr);
				if(blank(OldCode)) then begin oldCode = "THLVL0000"; end;
				NextM4SerialNumber(OldCode,BtrxThirdLevelCatr.Code);
				cat3Code = BtrxThirdLevelCatr.Code;
				BtrxThirdLevelCatr.Name = cat3 ;
				BtrxThirdLevelCatr.NameRUS = "";
				BtrxThirdLevelCatr.NameAZ = "";
				BtrxThirdLevelCatr.PathScndCode = cat2Code; 
				BtrxThirdLevelCatr.CatSecLvlName = "";
				RecordStore(BtrxThirdLevelCatr,true);
			end;
			
			// _________________________________________________________
			if (nonblank(cat4)) then begin
				BtrxFourthLevelCatr.Name = cat4;
				TrHs = true;
				while (LoopKey("Name",BtrxFourthLevelCatr,1,TrHs))begin
					if (BtrxFourthLevelCatr.Name != cat4) then begin TrHs = false; end;
					if (TrHs and BtrxFourthLevelCatr.PathThirdCode==cat3Code) then begin
						cat4Code = BtrxFourthLevelCatr.Code;
						TrHs = false;
					end;
				end;
				OldCode = "";
				ResetLoop(BtrxFourthLevelCatr);
				if (blank(cat4Code)) then begin
					oldFrLCr.Code = "FRLVL9999";
					TrHs = true;
					while (LoopBackKey("Code",oldFrLCr,1,TrHs)) begin
							OldCode = oldFrLCr.Code;
							TrHs = false;
					end;
					ResetLoop(oldFrLCr);
					if(blank(OldCode)) then begin oldCode = "FRLVL0000"; end;
					NextM4SerialNumber(OldCode,BtrxFourthLevelCatr.Code);
					cat4Code = BtrxFourthLevelCatr.Code;
					BtrxFourthLevelCatr.Name = cat4;
					BtrxFourthLevelCatr.NameRUS = "";
					BtrxFourthLevelCatr.NameAZ = "";
					BtrxFourthLevelCatr.PathThirdCode = cat3Code; 
					BtrxFourthLevelCatr.CatThirdLvlName = "";
					RecordStore(BtrxFourthLevelCatr,true);
				end;
			end;
			// _________________________________________________________
		end;
			
		if (NextImportLine(true)) then begin end;
	end;
return;
end;








global 	 // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger13:08 30.04.2019
updating procedure ImportAZClassVcIn(record RcVc RepSpec)
begin
	record BTRxBrandVc BTRxBrandr;
	record BTRxMaterialVc BTRxMaterialr;
	record BTRxColourVc BTRxColorr;
	record BTRxSizeVc BTRxSizer;
	record BTRxSexVc BTRxSexr;
	record BTRxPlatingVc BTRxPlatingr;
	record BTRxStoneVc BTRxStoner;
	record BTRxStrapVc BTRxStrapr;
	record BTRxOdourVc BTRxOdourr;
	record BtrxInternalCatVc BtrxInternalCatr;
	record BtrxFirstLevelCatVc BtrxFirstLevelCatr;
	record BtrxSecondLevelCatVc BtrxSecondLevelCatr;
	record BtrxThirdLevelCatVc BtrxThirdLevelCatr;
	record BtrxFourthLevelCatVc BtrxFourthLevelCatr;
	record BtrxCertificateVc BtrxCertificater;
	record BtrxWatchMechanVc BtrxWatchMechanr;
	record BtrxPowerReserveVc BtrxPowerReserver;
	record BtrxWatchGradeVc BtrxWatchGrader;
	record BtrxPhoneModelVc BtrxPhoneModelr;
	record BtrxFillingVc BtrxFillingr;
	record BtrxTypeVc BtrxTyper;
	record BtrxWaterResistantVc BtrxWatResr;
	record BtrxStrapMatVc BtrxStrapMatr;
	record BtrxBracelMatVc BtrxBracelMatr;
	record BtrxCollectionVc BtrxCollectionr;
	record BtrxComplicationsVc BtrxComplicationsr;
	record BtrxMicrowaveProtectVc BtrxMicrowaveProtectr;
	record BtrxStoveCompatVc BtrxStoveCompatr;
	record BtrxAllMaterialsVc BtrxAllMaterialsr;
	record BtrxPrecMetalContVc BtrxPrecMetalContr;
	record BtrxCaseDiamVc BtrxCaseDiamr;
	string 100 code,name,rname;
	
	while (TestEOF()==false) begin
		
		code = ImportField;
		name = ImportField;
		rname = "";
		if(nonblank(code))then begin
			BtrxCaseDiamr.Code = code;
			if(readfirstmain(BtrxCaseDiamr,1,true))then begin
				if(nonblank(BtrxCaseDiamr.Name))then begin
					BtrxCaseDiamr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BtrxCaseDiamr,true);
			end;
			BtrxCaseDiamr.Name = code;
			if(readfirstKey("Name",BtrxCaseDiamr,1,true))then begin
				if(nonblank(BtrxCaseDiamr.Name))then begin
					BtrxCaseDiamr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BtrxCaseDiamr,true);
			end;
			BtrxPrecMetalContr.Code = code;
			if(readfirstmain(BtrxPrecMetalContr,1,true))then begin
				if(nonblank(BtrxPrecMetalContr.Name))then begin
					BtrxPrecMetalContr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BtrxPrecMetalContr,true);
			end;
			BtrxPrecMetalContr.Name = code;
			if(readfirstKey("Name",BtrxPrecMetalContr,1,true))then begin
				if(nonblank(BtrxPrecMetalContr.Name))then begin
					BtrxPrecMetalContr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BtrxPrecMetalContr,true);
			end;
			BtrxAllMaterialsr.Code = code;
			if(readfirstmain(BtrxAllMaterialsr,1,true))then begin
				if(nonblank(BtrxAllMaterialsr.Name))then begin
					BtrxAllMaterialsr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BtrxAllMaterialsr,true);
			end;
			BtrxAllMaterialsr.Name = code;
			if(readfirstKey("Name",BtrxAllMaterialsr,1,true))then begin
				if(nonblank(BtrxAllMaterialsr.Name))then begin
					BtrxAllMaterialsr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BtrxAllMaterialsr,true);
			end;
			BtrxCollectionr.Code = code;
			if(readfirstmain(BtrxCollectionr,1,true))then begin
				if(nonblank(BtrxCollectionr.Name))then begin
					BtrxCollectionr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BtrxCollectionr,true);
			end;
			BtrxCollectionr.Name = code;
			if(readfirstKey("Name",BtrxCollectionr,1,true))then begin
				if(nonblank(BtrxCollectionr.Name))then begin
					BtrxCollectionr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BtrxCollectionr,true);
			end;
			BtrxBracelMatr.Code = code;
			if(readfirstmain(BtrxBracelMatr,1,true))then begin
				if(nonblank(BtrxBracelMatr.Name))then begin
					BtrxBracelMatr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BtrxBracelMatr,true);
			end;
			BtrxBracelMatr.Name = code;
			if(readfirstKey("Name",BtrxBracelMatr,1,true))then begin
				if(nonblank(BtrxBracelMatr.Name))then begin
					BtrxBracelMatr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BtrxBracelMatr,true);
			end;
			BtrxStrapMatr.Code = code;
			if(readfirstmain(BtrxStrapMatr,1,true))then begin
				if(nonblank(BtrxStrapMatr.Name))then begin
					BtrxStrapMatr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BtrxStrapMatr,true);
			end;
			BtrxStrapMatr.Name = code;
			if(readfirstKey("Name",BtrxStrapMatr,1,true))then begin
				if(nonblank(BtrxStrapMatr.Name))then begin
					BtrxStrapMatr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BtrxStrapMatr,true);
			end;
			BtrxMicrowaveProtectr.Code = code;
			if(readfirstmain(BtrxMicrowaveProtectr,1,true))then begin
				if(nonblank(BtrxMicrowaveProtectr.Name))then begin
					BtrxMicrowaveProtectr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BtrxMicrowaveProtectr,true);
			end;
			BtrxMicrowaveProtectr.Name = code;
			if(readfirstKey("Name",BtrxMicrowaveProtectr,1,true))then begin
				if(nonblank(BtrxMicrowaveProtectr.Name))then begin
					BtrxMicrowaveProtectr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BtrxMicrowaveProtectr,true);
			end;
			BtrxComplicationsr.Code = code;
			if(readfirstmain(BtrxComplicationsr,1,true))then begin
				if(nonblank(BtrxComplicationsr.Name))then begin
					BtrxComplicationsr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BtrxComplicationsr,true);
			end;
			BtrxComplicationsr.Name = code;
			if(readfirstKey("Name",BtrxComplicationsr,1,true))then begin
				if(nonblank(BtrxComplicationsr.Name))then begin
					BtrxComplicationsr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BtrxComplicationsr,true);
			end;
			BtrxStoveCompatr.Code = code;
			if(readfirstmain(BtrxStoveCompatr,1,true))then begin
				if(nonblank(BtrxStoveCompatr.Name))then begin
					BtrxStoveCompatr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BtrxStoveCompatr,true);
			end;
			BtrxStoveCompatr.Name = code;
			if(readfirstKey("Name",BtrxStoveCompatr,1,true))then begin
				if(nonblank(BtrxStoveCompatr.Name))then begin
					BtrxStoveCompatr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BtrxStoveCompatr,true);
			end;
			BTRxBrandr.Code = code;
			if(readfirstmain(BTRxBrandr,1,true))then begin
				if(nonblank(BTRxBrandr.Name))then begin
					BTRxBrandr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BTRxBrandr,true);
			end;
			BTRxBrandr.Name = code;
			if(readfirstKey("Name",BTRxBrandr,1,true))then begin
				if(nonblank(BTRxBrandr.Name))then begin
					BTRxBrandr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BTRxBrandr,true);
			end;
			BTRxMaterialr.Code = code;
			if(readfirstmain(BTRxMaterialr,1,true))then begin
				if(nonblank(BTRxMaterialr.Name))then begin
					BTRxMaterialr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BTRxMaterialr,true);
			end;
			BTRxMaterialr.Name = code;
			if(readfirstKey("Name",BTRxMaterialr,1,true))then begin
				if(nonblank(BTRxMaterialr.Name))then begin
					BTRxMaterialr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BTRxMaterialr,true);
			end;
			BTRxColorr.Code = code;
			if(readfirstmain(BTRxColorr,1,true))then begin
				if(nonblank(BTRxColorr.Name))then begin
					BTRxColorr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BTRxColorr,true);
			end;
			BTRxColorr.Name = code;
			if(readfirstKey("Name",BTRxColorr,1,true))then begin
				if(nonblank(BTRxColorr.Name))then begin
					BTRxColorr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BTRxColorr,true);
			end;
			BTRxSizer.Code = code;
			if(readfirstmain(BTRxSizer,1,true))then begin
				if(nonblank(BTRxSizer.Name))then begin
					BTRxSizer.NameAZ = name;
					//rname = "";
				end;
				recordstore(BTRxSizer,true);
			end;
			BTRxSizer.Name = code;
			if(readfirstKey("Name",BTRxSizer,1,true))then begin
				if(nonblank(BTRxSizer.Name))then begin
					BTRxSizer.NameAZ = name;
					//rname = "";
				end;
				recordstore(BTRxSizer,true);
			end;
			BTRxSexr.Code = code;
			if(readfirstmain(BTRxSexr,1,true))then begin
				if(nonblank(BTRxSexr.Name))then begin
					BTRxSexr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BTRxSexr,true);
			end;
			BTRxSexr.Name = code;
			if(readfirstKey("Name",BTRxSexr,1,true))then begin
				if(nonblank(BTRxSexr.Name))then begin
					BTRxSexr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BTRxSexr,true);
			end;
			BTRxPlatingr.Code = code;
			if(readfirstmain(BTRxPlatingr,1,true))then begin
				if(nonblank(BTRxPlatingr.Name))then begin
					BTRxPlatingr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BTRxPlatingr,true);
			end;
			BTRxPlatingr.Name = code;
			if(readfirstKey("Name",BTRxPlatingr,1,true))then begin
				if(nonblank(BTRxPlatingr.Name))then begin
					BTRxPlatingr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BTRxPlatingr,true);
			end;
			BTRxStoner.Code = code;
			if(readfirstmain(BTRxStoner,1,true))then begin
				if(nonblank(BTRxStoner.Name))then begin
					BTRxStoner.NameAZ = name;
					//rname = "";
				end;
				recordstore(BTRxStoner,true);
			end;
			BTRxStoner.Name = code;
			if(readfirstKey("Name",BTRxStoner,1,true))then begin
				if(nonblank(BTRxStoner.Name))then begin
					BTRxStoner.NameAZ = name;
					//rname = "";
				end;
				recordstore(BTRxStoner,true);
			end;
			BTRxStrapr.Code = code;
			if(readfirstmain(BTRxStrapr,1,true))then begin
				if(nonblank(BTRxStrapr.Name))then begin
					BTRxStrapr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BTRxStrapr,true);
			end;
			BTRxStrapr.Name = code;
			if(readfirstKey("Name",BTRxStrapr,1,true))then begin
				if(nonblank(BTRxStrapr.Name))then begin
					BTRxStrapr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BTRxStrapr,true);
			end;
			BtrxWatResr.Code = code;
			if(readfirstmain(BtrxWatResr,1,true))then begin
				if(nonblank(BtrxWatResr.Name))then begin
					BtrxWatResr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BtrxWatResr,true);
			end;
			BtrxWatResr.Name = code;
			if(readfirstKey("Name",BtrxWatResr,1,true))then begin
				if(nonblank(BtrxWatResr.Name))then begin
					BtrxWatResr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BtrxWatResr,true);
			end;
			BtrxTyper.Code = code;
			if(readfirstmain(BtrxTyper,1,true))then begin
				if(nonblank(BtrxTyper.Name))then begin
					BtrxTyper.NameAZ = name;
					//rname = "";
				end;
				recordstore(BtrxTyper,true);
			end;
			BtrxTyper.Name = code;
			if(readfirstKey("Name",BtrxTyper,1,true))then begin
				if(nonblank(BtrxTyper.Name))then begin
					BtrxTyper.NameAZ = name;
					//rname = "";
				end;
				recordstore(BtrxTyper,true);
			end;
			BtrxFillingr.Code = code;
			if(readfirstmain(BtrxFillingr,1,true))then begin
				if(nonblank(BtrxFillingr.Name))then begin
					BtrxFillingr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BtrxFillingr,true);
			end;
			BtrxFillingr.Name = code;
			if(readfirstKey("Name",BtrxFillingr,1,true))then begin
				if(nonblank(BtrxFillingr.Name))then begin
					BtrxFillingr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BtrxFillingr,true);
			end;
			BtrxPhoneModelr.Code = code;
			if(readfirstmain(BtrxPhoneModelr,1,true))then begin
				if(nonblank(BtrxPhoneModelr.Name))then begin
					BtrxPhoneModelr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BtrxPhoneModelr,true);
			end;
			BtrxPhoneModelr.Name = code;
			if(readfirstKey("Name",BtrxPhoneModelr,1,true))then begin
				if(nonblank(BtrxPhoneModelr.Name))then begin
					BtrxPhoneModelr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BtrxPhoneModelr,true);
			end;
			BtrxWatchGrader.Code = code;
			if(readfirstmain(BtrxWatchGrader,1,true))then begin
				if(nonblank(BtrxWatchGrader.Name))then begin
					BtrxWatchGrader.NameAZ = name;
					//rname = "";
				end;
				recordstore(BtrxWatchGrader,true);
			end;
			BtrxWatchGrader.Name = code;
			if(readfirstKey("Name",BtrxWatchGrader,1,true))then begin
				if(nonblank(BtrxWatchGrader.Name))then begin
					BtrxWatchGrader.NameAZ = name;
					//rname = "";
				end;
				recordstore(BtrxWatchGrader,true);
			end;
			BtrxPowerReserver.Code = code;
			if(readfirstmain(BtrxPowerReserver,1,true))then begin
				if(nonblank(BtrxPowerReserver.Name))then begin
					BtrxPowerReserver.NameAZ = name;
					//rname = "";
				end;
				recordstore(BtrxPowerReserver,true);
			end;
			BtrxPowerReserver.Name = code;
			if(readfirstKey("Name",BtrxPowerReserver,1,true))then begin
				if(nonblank(BtrxPowerReserver.Name))then begin
					BtrxPowerReserver.NameAZ = name;
					//rname = "";
				end;
				recordstore(BtrxPowerReserver,true);
			end;
			BtrxWatchMechanr.Code = code;
			if(readfirstmain(BtrxWatchMechanr,1,true))then begin
				if(nonblank(BtrxWatchMechanr.Name))then begin
					BtrxWatchMechanr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BtrxWatchMechanr,true);
			end;
			BtrxWatchMechanr.Name = code;
			if(readfirstKey("Name",BtrxWatchMechanr,1,true))then begin
				if(nonblank(BtrxWatchMechanr.Name))then begin
					BtrxWatchMechanr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BtrxWatchMechanr,true);
			end;
			BtrxCertificater.Code = code;
			if(readfirstmain(BtrxCertificater,1,true))then begin
				if(nonblank(BtrxCertificater.Name))then begin
					BtrxCertificater.NameAZ = name;
					//rname = "";
				end;
				recordstore(BtrxCertificater,true);
			end;
			BtrxCertificater.Name = code;
			if(readfirstKey("Name",BtrxCertificater,1,true))then begin
				if(nonblank(BtrxCertificater.Name))then begin
					BtrxCertificater.NameAZ = name;
					//rname = "";
				end;
				recordstore(BtrxCertificater,true);
			end;
			BtrxFourthLevelCatr.Code = code; 
			if(readfirstmain(BtrxFourthLevelCatr,1,true))then begin
				if(nonblank(BtrxFourthLevelCatr.Name))then begin
					BtrxFourthLevelCatr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BtrxFourthLevelCatr,true);
			end;
			BtrxFourthLevelCatr.Name = code;
			if(readfirstKey("Name",BtrxFourthLevelCatr,1,true))then begin
				if(nonblank(BtrxFourthLevelCatr.Name))then begin
					BtrxFourthLevelCatr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BtrxFourthLevelCatr,true);
			end;
			BtrxThirdLevelCatr.Code = code; 
			if(readfirstmain(BtrxThirdLevelCatr,1,true))then begin
				if(nonblank(BtrxThirdLevelCatr.Name))then begin
					BtrxThirdLevelCatr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BtrxThirdLevelCatr,true);
			end;
			BtrxThirdLevelCatr.Name = code;
			if(readfirstKey("Name",BtrxThirdLevelCatr,1,true))then begin
				if(nonblank(BtrxThirdLevelCatr.Name))then begin
					BtrxThirdLevelCatr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BtrxThirdLevelCatr,true);
			end;
			BtrxSecondLevelCatr.Code = code;
			if(readfirstmain(BtrxSecondLevelCatr,1,true))then begin
				if(nonblank(BtrxSecondLevelCatr.Name))then begin
					BtrxSecondLevelCatr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BtrxSecondLevelCatr,true);
			end;
			BtrxSecondLevelCatr.Name = code;
			if(readfirstKey("Name",BtrxSecondLevelCatr,1,true))then begin
				if(nonblank(BtrxSecondLevelCatr.Name))then begin
					BtrxSecondLevelCatr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BtrxSecondLevelCatr,true);
			end;
			BtrxFirstLevelCatr.Code = code;
			if(readfirstmain(BtrxFirstLevelCatr,1,true))then begin
				if(nonblank(BtrxFirstLevelCatr.Name))then begin
					BtrxFirstLevelCatr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BtrxFirstLevelCatr,true);
			end;
			BtrxFirstLevelCatr.Name = code;
			if(readfirstKey("Name",BtrxFirstLevelCatr,1,true))then begin
				if(nonblank(BtrxFirstLevelCatr.Name))then begin
					BtrxFirstLevelCatr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BtrxFirstLevelCatr,true);
			end;
			BtrxInternalCatr.Code = code;
			if(readfirstmain(BtrxInternalCatr,1,true))then begin
				if(nonblank(BtrxInternalCatr.Name))then begin
					BtrxInternalCatr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BtrxInternalCatr,true);
			end;
			BtrxInternalCatr.Name = code;
			if(readfirstKey("Name",BtrxInternalCatr,1,true))then begin
				if(nonblank(BtrxInternalCatr.Name))then begin
					BtrxInternalCatr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BtrxInternalCatr,true);
			end;
			BTRxOdourr.Code = code;
			if(readfirstmain(BTRxOdourr,1,true))then begin
				if(nonblank(BTRxOdourr.Name))then begin
					BTRxOdourr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BTRxOdourr,true);
			end;
			BTRxOdourr.Name = code;
			if(readfirstKey("Name",BTRxOdourr,1,true))then begin
				if(nonblank(BTRxOdourr.Name))then begin
					BTRxOdourr.NameAZ = name;
					//rname = "";
				end;
				recordstore(BTRxOdourr,true);
			end;
		end;
		rname = "";
		if (NextImportLine(true)) then begin end;
	end;
return;
end;








global 	 // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger13:08 30.04.2019
updating procedure ImportReRUSClassVcIn(record RcVc RepSpec)
begin
	record BTRxBrandVc BTRxBrandr;
	record BTRxMaterialVc BTRxMaterialr;
	record BTRxColourVc BTRxColorr;
	record BTRxSizeVc BTRxSizer;
	record BTRxSexVc BTRxSexr;
	record BTRxPlatingVc BTRxPlatingr;
	record BTRxStoneVc BTRxStoner;
	record BTRxStrapVc BTRxStrapr;
	record BTRxOdourVc BTRxOdourr;
	record BtrxInternalCatVc BtrxInternalCatr;
	record BtrxFirstLevelCatVc BtrxFirstLevelCatr;
	record BtrxSecondLevelCatVc BtrxSecondLevelCatr;
	record BtrxThirdLevelCatVc BtrxThirdLevelCatr;
	record BtrxCertificateVc BtrxCertificater;
	record BtrxWatchMechanVc BtrxWatchMechanr;
	record BtrxPowerReserveVc BtrxPowerReserver;
	record BtrxWatchGradeVc BtrxWatchGrader;
	record BtrxPhoneModelVc BtrxPhoneModelr;
	record BtrxFillingVc BtrxFillingr;
	record BtrxTypeVc BtrxTyper;
	record BtrxWaterResistantVc BtrxWatResr;
	string 100 code,name,rname;
	
	while (TestEOF()==false) begin
		
		code = ImportField;
		name = ImportField;
		rname = "";
		if(nonblank(code))then begin
			BTRxBrandr.Code = code;
			if(readfirstmain(BTRxBrandr,1,true))then begin
				if(nonblank(BTRxBrandr.Name))then begin
					rname = BTRxBrandr.Name;
					BTRxBrandr.Name = name;
					BTRxBrandr.NameRUS = rname;
					rname = "";
				end;
				recordstore(BTRxBrandr,true);
			end;
			BTRxMaterialr.Code = code;
			if(readfirstmain(BTRxMaterialr,1,true))then begin
				if(nonblank(BTRxMaterialr.Name))then begin
					rname = BTRxMaterialr.Name;
					BTRxMaterialr.Name = name;
					BTRxMaterialr.NameRUS = rname;
					rname = "";
				end;
				recordstore(BTRxMaterialr,true);
			end;
			BTRxColorr.Code = code;
			if(readfirstmain(BTRxColorr,1,true))then begin
				if(nonblank(BTRxColorr.Name))then begin
					rname = BTRxColorr.Name;
					BTRxColorr.Name = name;
					BTRxColorr.NameRUS = rname;
					rname = "";
				end;
				recordstore(BTRxColorr,true);
			end;
			BTRxSizer.Code = code;
			if(readfirstmain(BTRxSizer,1,true))then begin
				if(nonblank(BTRxSizer.Name))then begin
					rname = BTRxSizer.Name;
					BTRxSizer.Name = name;
					BTRxSizer.NameRUS = rname;
					rname = "";
				end;
				recordstore(BTRxSizer,true);
			end;
			BTRxSexr.Code = code;
			if(readfirstmain(BTRxSexr,1,true))then begin
				if(nonblank(BTRxSexr.Name))then begin
					rname = BTRxSexr.Name;
					BTRxSexr.Name = name;
					BTRxSexr.NameRUS = rname;
					rname = "";
				end;
				recordstore(BTRxSexr,true);
			end;
			BTRxPlatingr.Code = code;
			if(readfirstmain(BTRxPlatingr,1,true))then begin
				if(nonblank(BTRxPlatingr.Name))then begin
					rname = BTRxPlatingr.Name;
					BTRxPlatingr.Name = name;
					BTRxPlatingr.NameRUS = rname;
					rname = "";
				end;
				recordstore(BTRxPlatingr,true);
			end;
			BTRxStoner.Code = code;
			if(readfirstmain(BTRxStoner,1,true))then begin
				if(nonblank(BTRxStoner.Name))then begin
					rname = BTRxStoner.Name;
					BTRxStoner.Name = name;
					BTRxStoner.NameRUS = rname;
					rname = "";
				end;
				recordstore(BTRxStoner,true);
			end;
			BTRxStrapr.Code = code;
			if(readfirstmain(BTRxStrapr,1,true))then begin
				if(nonblank(BTRxStrapr.Name))then begin
					rname = BTRxStrapr.Name;
					BTRxStrapr.Name = name;
					BTRxStrapr.NameRUS = rname;
					rname = "";
				end;
				recordstore(BTRxStrapr,true);
			end;
			BtrxWatResr.Code = code;
			if(readfirstmain(BtrxWatResr,1,true))then begin
				if(nonblank(BtrxWatResr.Name))then begin
					rname = BtrxWatResr.Name;
					BtrxWatResr.Name = name;
					BtrxWatResr.NameRUS = rname;
					rname = "";
				end;
				recordstore(BtrxWatResr,true);
			end;
			BtrxTyper.Code = code;
			if(readfirstmain(BtrxTyper,1,true))then begin
				if(nonblank(BtrxTyper.Name))then begin
					rname = BtrxTyper.Name;
					BtrxTyper.Name = name;
					BtrxTyper.NameRUS = rname;
					rname = "";
				end;
				recordstore(BtrxTyper,true);
			end;
			BtrxFillingr.Code = code;
			if(readfirstmain(BtrxFillingr,1,true))then begin
				if(nonblank(BtrxFillingr.Name))then begin
					rname = BtrxFillingr.Name;
					BtrxFillingr.Name = name;
					BtrxFillingr.NameRUS = rname;
					rname = "";
				end;
				recordstore(BtrxFillingr,true);
			end;
			BtrxPhoneModelr.Code = code;
			if(readfirstmain(BtrxPhoneModelr,1,true))then begin
				if(nonblank(BtrxPhoneModelr.Name))then begin
					rname = BtrxPhoneModelr.Name;
					BtrxPhoneModelr.Name = name;
					BtrxPhoneModelr.NameRUS = rname;
					rname = "";
				end;
				recordstore(BtrxPhoneModelr,true);
			end;
			BtrxWatchGrader.Code = code;
			if(readfirstmain(BtrxWatchGrader,1,true))then begin
				if(nonblank(BtrxWatchGrader.Name))then begin
					rname = BtrxWatchGrader.Name;
					BtrxWatchGrader.Name = name;
					BtrxWatchGrader.NameRUS = rname;
					rname = "";
				end;
				recordstore(BtrxWatchGrader,true);
			end;
			BtrxPowerReserver.Code = code;
			if(readfirstmain(BtrxPowerReserver,1,true))then begin
				if(nonblank(BtrxPowerReserver.Name))then begin
					rname = BtrxPowerReserver.Name;
					BtrxPowerReserver.Name = name;
					BtrxPowerReserver.NameRUS = rname;
					rname = "";
				end;
				recordstore(BtrxPowerReserver,true);
			end;
			BtrxWatchMechanr.Code = code;
			if(readfirstmain(BtrxWatchMechanr,1,true))then begin
				if(nonblank(BtrxWatchMechanr.Name))then begin
					rname = BtrxWatchMechanr.Name;
					BtrxWatchMechanr.Name = name;
					BtrxWatchMechanr.NameRUS = rname;
					rname = "";
				end;
				recordstore(BtrxWatchMechanr,true);
			end;
			BtrxCertificater.Code = code;
			if(readfirstmain(BtrxCertificater,1,true))then begin
				if(nonblank(BtrxCertificater.Name))then begin
					rname = BtrxCertificater.Name;
					BtrxCertificater.Name = name;
					BtrxCertificater.NameRUS = rname;
					rname = "";
				end;
				recordstore(BtrxCertificater,true);
			end;
			BtrxThirdLevelCatr.Code = code;
			if(readfirstmain(BtrxThirdLevelCatr,1,true))then begin
				if(nonblank(BtrxThirdLevelCatr.Name))then begin
					rname = BtrxThirdLevelCatr.Name;
					BtrxThirdLevelCatr.Name = name;
					BtrxThirdLevelCatr.NameRUS = rname;
					rname = "";
				end;
				recordstore(BtrxThirdLevelCatr,true);
			end;
			BtrxSecondLevelCatr.Code = code;
			if(readfirstmain(BtrxSecondLevelCatr,1,true))then begin
				if(nonblank(BtrxSecondLevelCatr.Name))then begin
					rname = BtrxSecondLevelCatr.Name;
					BtrxSecondLevelCatr.Name = name;
					BtrxSecondLevelCatr.NameRUS = rname;
					rname = "";
				end;
				recordstore(BtrxSecondLevelCatr,true);
			end;
			BtrxFirstLevelCatr.Code = code;
			if(readfirstmain(BtrxFirstLevelCatr,1,true))then begin
				if(nonblank(BtrxFirstLevelCatr.Name))then begin
					rname = BtrxFirstLevelCatr.Name;
					BtrxFirstLevelCatr.Name = name;
					BtrxFirstLevelCatr.NameRUS = rname;
					rname = "";
				end;
				recordstore(BtrxFirstLevelCatr,true);
			end;
			BtrxInternalCatr.Code = code;
			if(readfirstmain(BtrxInternalCatr,1,true))then begin
				if(nonblank(BtrxInternalCatr.Name))then begin
					rname = BtrxInternalCatr.Name;
					BtrxInternalCatr.Name = name;
					BtrxInternalCatr.NameRUS = rname;
					rname = "";
				end;
				recordstore(BtrxInternalCatr,true);
			end;
			BTRxOdourr.Code = code;
			if(readfirstmain(BTRxOdourr,1,true))then begin
				if(nonblank(BTRxOdourr.Name))then begin
					rname = BTRxOdourr.Name;
					BTRxOdourr.Name = name;
					BTRxOdourr.NameRUS = rname;
					rname = "";
				end;
				recordstore(BTRxOdourr,true);
			end;
		end;
		rname = "";
		if (NextImportLine(true)) then begin end;
	end;
return;
end;






global 	//Edit***************************Sasha2,11:45 04.07.2017 {
updating procedure BMIn(record RcVc RepSpec)
begin
	record BPIBrandVc BBr;
	integer i;
	string 200 name,mng,pchs;
	i = 0;
	while (TestEOF()==false) begin
		name = ImportField;
		mng = ImportField;
		pchs = ImportField;
		i = i+1;
		BBr.Name = name;
		if(ReadFirstKey("Name",BBr,1,true)) then begin
			BBr.BrndMngr = mng;
			BBr.Puchaser = pchs;
			RecordStore(BBr,true);
		end;	
		if (NextImportLine(true)) then begin end;
	end;
	
return;
end;

global updating procedure ImportGroupsNewIn()
begin
	boolean floine,snrfnd;
	integer i,cnt;
	array string 100 group,subgrp;
	string 255 tmp;
	record NewClassSetVc NCSr;
	row NewClassSetVc NCSrw;
	record BPIBrandVc BPIBrandr;
	record BPICollectionVc BPICollectionr;
	record BPIGroupVc BPIGroupr;
	record BPISubGroupVc BPISubGroupr;
	record BPICategoryVc BPICategoryr;
	record BPIMaterialVc BPIMaterialr;
	record BPIColorVc BPIColorr;
	record BPIShapeVc BPIShaper;
	record BPISizeVc BPISizer;
	record BPIUseVc BPIUser;
	record BPISexVc BPISexr;
	record BPIPlatingVc BPIPlatingr;
	record BPIClarityVc BPIClarityr;
	record BPIWeightVc BPIWeightr;
	record BPICutVc BPICutr;
	record BPIStoneVc BPIStoner;
	record BPIStrapVc BPIStrapr;
	record BPIOdourVc BPIOdourr;
	vector string 100 vgroup,vsubgroup,vCategory,vMaterial,vColor,vShape,vSize,vUse,vSex,vPlating,vClarity,vWeight,vCut,vStone,vStrap,vOdour;
	integer catcnt,j;
	vector string 100 vcat;
	
	while(loopmain(BPICategoryr,1,true))begin
		vCategory[BPICategoryr.Name] = BPICategoryr.Code;
	end;
	
	while(loopmain(BPIMaterialr,1,true))begin
		vMaterial[BPIMaterialr.Name] = BPIMaterialr.Code;
	end;
	
	while(loopmain(BPIColorr,1,true))begin
		vColor[BPIColorr.Name] = BPIColorr.Code;
	end;
	
	while(loopmain(BPISizer,1,true))begin
		vSize[BPISizer.Name] = BPISizer.Code;
	end;
	
	while(loopmain(BPIShaper,1,true))begin
		vShape[BPIShaper.Name] = BPIShaper.Code;
	end;
	
	while(loopmain(BPIUser,1,true))begin
		vUse[BPIUser.Name] = BPIUser.Code;
	end;
	
	while(loopmain(BPISexr,1,true))begin
		vSex[BPISexr.Name] = BPISexr.Code;
	end;
	
	while(loopmain(BPIPlatingr,1,true))begin
		vPlating[BPIPlatingr.Name] = BPIPlatingr.Code;
	end;
	
	while(loopmain(BPIClarityr,1,true))begin
		vClarity[BPIClarityr.Name] = BPIClarityr.Code;
	end;
	
	while(loopmain(BPIWeightr,1,true))begin
		vWeight[BPIWeightr.Name] = BPIWeightr.Code;
	end;
	
	while(loopmain(BPICutr,1,true))begin
		vCut[BPICutr.Name] = BPICutr.Code;
	end;
	
	while(loopmain(BPIStoner,1,true))begin
		vStone[BPIStoner.Name] = BPIStoner.Code;
	end;
	
	while(loopmain(BPIStrapr,1,true))begin
		vStrap[BPIStrapr.Name] = BPIStrapr.Code;
	end;
	
	while(loopmain(BPIOdourr,1,true))begin
		vOdour[BPIOdourr.Name] = BPIOdourr.Code;
	end;
	
	
	
	while(loopmain(BPIGroupr,1,true))begin
		vgroup[BPIGroupr.Name] = BPIGroupr.Code;
	end;
	while(loopmain(BPISubGroupr,1,true))begin
		vsubgroup[BPISubGroupr.Name] = BPISubGroupr.Code;
	end;
	
	
	while(loopmain(NCSr,1,true))begin
		recorddelete(NCSr);
		stepback(NCSr);
	end;
	
	floine = false;
	while (TestEOF()==false) begin
		if(snrfnd)then begin
			logtext(0,"Import Categ===========");
			for(i=0;i<cnt;i=i+1)begin
				tmp = "";
				tmp = ImportField;
				vcat[catcnt & "_" & i] = tmp;
			end;
			catcnt = catcnt + 1;
		end;
		if(floine and snrfnd==false)then begin
			logtext(0,"Import SubGroups===========" & cnt);
			for(i=0;i<cnt;i=i+1)begin
				tmp = ImportField;
				subgrp[i] = tmp;
				snrfnd = true;
			end;
		end;
		
		if(floine==false)then begin
			logtext(0,"Import Groups===========");
			tmp = ImportField;
			while(nonblank(tmp))begin
				group[cnt] = tmp;
				cnt=cnt+1;
				tmp = ImportField;
			end;
			floine = true;
		end;
				
		if (NextImportLine(true)) then begin end;
	end;
	
	if(snrfnd)then begin
		for(i=1;i<cnt;i=i+1)begin
			recordnew(NCSr);
				NCSr.Group = vgroup[group[i]];
				if(blank(NCSr.Group))then begin
					NCSr.Group = group[i];
				end;
				NCSr.Type = vsubgroup[subgrp[i]];
				if(blank(NCSr.Type))then begin
					NCSr.Group = subgrp[i];
				end;
				NCSr.GroupName = group[i];
				NCSr.TypeName = subgrp[i];

				for(j=0;j<catcnt;j=j+1)begin
					if(nonblank(vcat[j & "_" & i]))then begin
						NCSrw.CType = vcat[j & "_" & 0];
						NCSrw.CCode = vcat[j & "_" & i];
						NCSrw.CTypeName = vcat[j & "_" & 0];
						NCSrw.CCodeName = vcat[j & "_" & i];
						switch(vcat[j & "_" & 0]) begin
							case "Category": NCSrw.CType = "CATEGORY";
							NCSrw.CCode = vCategory[vcat[j & "_" & i]];
							case "Clarity": NCSrw.CType = "CLARITY";
							NCSrw.CCode = vClarity[vcat[j & "_" & i]];
							case "Color": NCSrw.CType = "COLOR";
							NCSrw.CCode = vColor[vcat[j & "_" & i]];
							case "Cut": NCSrw.CType = "CUT";
							NCSrw.CCode = vCut[vcat[j & "_" & i]];
							case "Material": NCSrw.CType = "MATERIAL";
							NCSrw.CCode = vMaterial[vcat[j & "_" & i]];
							case "Odour": NCSrw.CType = "ODOUR";
							NCSrw.CCode = vOdour[vcat[j & "_" & i]];
							case "Plating": NCSrw.CType = "PLATING";
							NCSrw.CCode = vPlating[vcat[j & "_" & i]];
							case "Sex": NCSrw.CType = "SEX";
							NCSrw.CCode = vSex[vcat[j & "_" & i]];
							case "Shape": NCSrw.CType = "SHAPE";
							NCSrw.CCode = vShape[vcat[j & "_" & i]];
							case "Size": NCSrw.CType = "SIZE";
							NCSrw.CCode = vSize[vcat[j & "_" & i]];
							case "Stone": NCSrw.CType = "STONE";
							NCSrw.CCode = vStone[vcat[j & "_" & i]];
							case "Strap": NCSrw.CType = "STRAP";
							NCSrw.CCode = vStrap[vcat[j & "_" & i]];
							case "Use": NCSrw.CType = "USE";
							NCSrw.CCode = vUse[vcat[j & "_" & i]];
							case "Weight": NCSrw.CType = "WEIGHT";
							NCSrw.CCode = vWeight[vcat[j & "_" & i]];
						end;
						
						matrowput(NCSr,matrowcnt(NCSr),NCSrw);
					end;
				end;
				
				// logtext(0,"recordstore(NCSr,true);");
			recordstore(NCSr,true);
		end;
	end;

return;
end;

global updating procedure ImportABCXMLIn()
begin
	area axml;
	xml xdata;
	string 255 xkey,crncy,tstr,OwnID,BankID,ABC,XYZ,CurCode,CdtDbtInd,bookdate,impfilename;
	record INVc INr;
	longint cntchld,i,dcf;
	date ndat;
	area afile;
	
	logtext(0,"ImportABCXMLIn " & GetImportFileName);
	cntchld = 0;
	xdata = ParseXMLFile(GetImportFileName);
	impfilename = "Categorization Data for Hansa.xml";
	addfiletoarea(GetImportFileName,afile,0);
	if(DirExists("CategorizationDataforHansa")==false)then begin
		CreateFolder("CategorizationDataforHansa");
	end;
	impfilename = impfilename & currentdate & "-" & currenttime;
	writeareatofile(afile,"CategorizationDataforHansa/" & impfilename,0);
	cntchld = XmlCountChildren(xdata,"dataroot");
	for(i=0;i<cntchld;i=i+1) begin
		CurCode = XmlGet(xdata,"dataroot/Categorization_x0020_Data_x0020_for_x0020_Hansa[" & i & "]/Item_x0020_ID");
		INr.Code=CUrCode;
		if(ReadFirstMain(INr,1,true)) then begin
			ABC = XmlGet(xdata,"dataroot/Categorization_x0020_Data_x0020_for_x0020_Hansa[" & i & "]/ABC_x002C__x0020_E");
			XYZ = XmlGet(xdata,"dataroot/Categorization_x0020_Data_x0020_for_x0020_Hansa[" & i & "]/XYZ_x002C__x0020_S");
			INr.ItemCat = ABC;
			INr.SubItemCat = XYZ;
			RecordStore(INr,true);
		end;
	end;	
	
	while (TestEOF==false) begin
    tstr = ImportField;
    if (NextImportLine(true)) then begin
    end;
  end;
return;
end;

global webpublic updating procedure WebIDEAFixCost()
begin
	record INVc INr;
	
	setcompany(28,false);
	
	INr.Code = "";
	while(loopmain(INr,1,true))begin
		if(INr.LastPurchCurncyCode=="EUR")then begin
			if(INr.LastPurchPrice2>INr.InPrice)then begin
				// logtext(0,INr.Code & "___" & INr.InPrice & "->" & round(INr.LastPurchPrice2 * 1.954,SetRoundModeD(2)));
				INr.InPrice = round(INr.LastPurchPrice2 * 1.954,SetRoundModeD(2));
				
				recordstore(INr,true);
			end;
		end;
	end;

return;
end;





global webpublic updating procedure WebCWH5SGFill()
begin
	record BPIBrandVc BRNDr;
	
	setcompany(18,false);
	
	BRNDr.Code = "";
	while(loopmain(BRNDr,1,true))begin
		if(BRNDr.CWHCode=="CWH5")then begin
			if(BRNDr.CWHCode=="CWH5" and BRNDr.StockGroup!="Eleqant R MMC")then begin logtext (0,"Brand: " & BRNDr.Code & " Old SG: " & BRNDr.StockGroup); end;
			BRNDr.StockGroup = "Eleqant R MMC";
			recordstore(BRNDr,true);
		end;
	end;

return;
end;






global webpublic updating procedure WebIDEAChechIHPU()
begin
	record INVc INr;
	record PUVc PUr;
	row PUVc PUrw;
	record ItemHistVc IHr;
	integer i,mtrw;
	
	
	setcompany(28,false);
	
	PUr.SerNr = -1;
	while(loopmain(PUr,1,true))begin
		mtrw = matrowcnt(PUr);
		For(i=0;i<mtrw;i=i+1) begin
	  	matrowget(PUr,i,PUrw);
	  	IHr.FileName = "PUVc";
	  	IHr.TransNr = PUr.SerNr;
	  	IHr.Row = i;
	  	if(readfirstkey("FNTransNr",IHr,3,true))then begin
	  		if(IHr.TotCostPrice!=PUrw.Sum)then begin
	  			logtext(0,PUrw.ArtCode & "  " & PUrw.Sum & " -> " & IHr.TotCostPrice);
	  		end;
	  	end;
		end; 
	end;
	
return;
end;

global webpublic updating procedure WebIDEACheckCost()
begin
	record INVc INr;
	
	setcompany(28,false);
	
	INr.Code = "";
	while(loopmain(INr,1,true))begin
		if(INr.LastPurchPrice2==0 and INr.InPrice>0)then begin
			logtext(0,INr.Code & "___" & INr.InPrice & "->" & round(INr.LastPurchPrice2,SetRoundModeD(2)));
		end;
	end;

return;
end;

global webpublic updating procedure WebIDEACheckCostPU()
begin
	record INVc INr;
	record PUVc PUr;
	row PUVc PUrw;
	integer mtrw,i;
	boolean changed;
	
	setcompany(28,false);
	
	PUr.SerNr = 0;
	while(loopmain(PUr,1,true))begin
		changed = false;
		mtrw = matrowcnt(PUr);
		for(i=0;i<mtrw;i=i+1)begin
			matrowget(PUr,i,PUrw);
			if(true)then begin
				INr.Code = PUrw.ArtCode;
				if(readfirstmain(INr,1,true))then begin
					if(PUrw.UPrice!=INr.LastPurchPrice2 or PUrw.CostPrice!=INr.InPrice)then begin
						//logtext(0,PUrw.ArtCode & "  " & PUrw.UPrice & " " & PUrw.CostPrice);
						//logtext(0,INr.Code & "___" & INr.InPrice & "->" & INr.LastPurchPrice2);
					
						PUrw.UPrice = INr.LastPurchPrice2;
						if(PUrw.UPrice==blankval)then begin
							PUrw.UPrice = 0;
						end;
						PUrw.CostPrice = INr.InPrice;
						if(PUrw.CostPrice==blankval)then begin
							PUrw.CostPrice = 0;
						end;
						PUrw.Sum = INr.InPrice * PUrw.Quant;
						matrowput(PUr,i,PUrw);
						changed = true;
						// logtext(0,INr.Code & "___" & INr.InPrice & "->" & round(INr.LastPurchPrice2,SetRoundModeD(2)));
					end;
				//if(INr.LastPurchPrice2==0 and INr.InPrice>0)then begin
					//logtext(0,INr.Code & "___" & INr.InPrice & "->" & round(INr.LastPurchPrice2,SetRoundModeD(2)));
				end;	
				//end;
			end;
		end;
		if(changed)then begin
			//PUSumUp(PUr);
			recordstore(PUr,true);
		end;
	end;

return;
end;

global
updating procedure ImportFixCreativeCostIn()//   Edit-------------------------------------------Dima    23.12.2014  
begin
	record INVc INr;
	string 255 artcode,eurcost,azncost,creativeartcode;
	val eurvalcost,aznvalcost;
	
	while (TestEOF()==false) begin	
		artcode = importfield;
		eurcost = importfield;
		
		if(nonblank(artcode) and nonblank(eurcost))then begin
			INr.Code = artcode;
			if(readfirstmain(INr,1,true))then begin
				INr.LastPurchPrice2 = stringtoval(eurcost,m45val);
				recordstore(INr,True);
			end;
		end;
		
		if (NextImportLine(true)) then begin end;
	end;
return;
end;


global
updating procedure PUImportIn()//   Edit-------------------------------------------Dima    23.12.2014  
begin
  record PUVc PUr,PU2r;
  row PUVc PUrw;
	record PosVc Posr;
  record LocationVc Locr;
  string 50 location,curLoc, artcode, quant,binNr,sum1,sum2,sum;
  Integer pucnt;
  record INVc INr;
	integer coefx;
	vector string 50 serialNr;
	record SysFormatBlock SysFormatRec;
  
  BlockLoad(SysFormatRec);
	
	pucnt =0;
	logtext(0,"PUImportIn start");
	while (TestEOF()==false) begin	
		PUr.CurncyCode = "EUR";
		artcode = ImportField;
		location = ImportField;
	
		if ((location == curLoc) and (pucnt < 999) and nonblank(artcode)) then begin	//?????????? ??????? ???????
			binNr = ImportField;
			quant = ImportField;

			PUr.FrRate = 1;
			PUr.ToRateB1 = 1.954;
			INr.Code = artcode;
			Posr.Code = binNr;
			if(blank(serialNr[artcode])) then begin
				Purw.SerialNr = "1";
				serialNr[artcode] = "1";
			end else begin 
				serialNr[artcode] = ValToString((StringToVal(serialNr[artcode],M4UVal)+1), M4UVal,SysFormatRec.thousSep,SysFormatRec.decimalPt,0);
				Purw.SerialNr = ValToString((StringToVal(serialNr[artcode],M4UVal)), M4UVal,SysFormatRec.thousSep,SysFormatRec.decimalPt,0);
			end;
			if(!ReadFirstMain(Posr,1,true)) then begin
				RecordNew(Posr);
				Posr.Code = binNr;
				Posr.Location = location;
				RecordStore(Posr,true);
				logtext(0,"new polochka " & Locr.Name);
			end;
			If(readfirstmain(INr,1,true))then begin
				coefx = INr.Conversion1;
				if(coefx<1)then begin
					coefx = 1;
				end;
				PUrw.ArtCode = artcode;
				//PUrw.UPrice = StringToVal(price,M45Val);
				PUrw.Quant = StringToVal(quant,M4UVal)*coefx;
				PUrw.UPrice = INr.LastPurchPrice2;
				if(PUrw.UPrice==blankval)then begin PUrw.UPrice = 0; end;
				PUrw.CostPrice = INr.InPrice;
				if(PUrw.CostPrice==blankval)then begin PUrw.CostPrice = 0; end;
				Purw.Sum = INr.InPrice * PUrw.Quant ;
		
				MatRowPut(PUr,pucnt,PUrw);
				PUVc_FillRow(PUr,pucnt);
				pucnt= pucnt + 1;	
			end else begin
				INr.Code = artcode;
				if(readfirstMain(INr,1,true))then begin
					PUrw.ArtCode = INr.Code;
					//PUrw.UPrice = StringToVal(price,M45Val);
					PUrw.Quant = StringToVal(quant,M4UVal);
					PUrw.UPrice = INr.LastPurchPrice2;
					if(PUrw.UPrice==blankval)then begin PUrw.UPrice = 0; end;
					PUrw.CostPrice = INr.InPrice;
					if(PUrw.CostPrice==blankval)then begin PUrw.CostPrice = 0; end;
					Purw.Sum = INr.InPrice * PUrw.Quant ;
					PUrw.ToPosCode = binNr;
					MatRowPut(PUr,pucnt,PUrw);
					PUVc_FillRow(PUr,pucnt);
					pucnt= pucnt + 1;	
				end;
			end;
		end else begin			//???????? ????? PU ??????
			if (NonBlank(curLoc)) then begin			
				PUSumUp(PUr);
				RecordInsert(PUr,true);
			end;

			Locr.Code = location;

			if (nonblank(location) and ReadFirstMain(Locr,1,true) and nonblank(artcode)) then begin			
				// logtext(0,location);
				RecordNew(PUr);				
  			PUr.SerNr = NextSerNr("PUVc",PUr.TransDate,-1,false,"");  		
				pucnt = 0;
				binNr	=	ImportField;
				quant = ImportField;
      		
				PUr.Location = location;
				PUr.FrRate = 1;
				PUr.ToRateB1 = 1.954;
				Posr.Code = binNr;
			if(blank(serialNr[artcode])) then begin
						Purw.SerialNr = "1";
						serialNr[artcode] = "1";
					end else begin 
						serialNr[artcode] = ValToString((StringToVal(serialNr[artcode],M4UVal)+1), M4UVal,SysFormatRec.thousSep,SysFormatRec.decimalPt,0);
						Purw.SerialNr = ValToString((StringToVal(serialNr[artcode],M4UVal)), M4UVal,SysFormatRec.thousSep,SysFormatRec.decimalPt,0);
					end;
				if(!ReadFirstMain(Posr,1,true)) then begin
					RecordNew(Posr);
					Posr.Code = binNr;
					Posr.Location = location;
					RecordStore(Posr,true);
					logtext(0,"new polochka " & Locr.Name);
				end;
				INr.Code = artcode;
				If(readfirstmain(INr,1,true))then begin
					coefx = INr.Conversion1;
					if(coefx<1)then begin
						coefx = 1;
					end;
					PUrw.ArtCode = artcode;
					//PUrw.UPrice = StringToVal(price,M45Val);
					PUrw.Quant = StringToVal(quant,M4UVal)*coefx;
					PUrw.UPrice = INr.LastPurchPrice2;
					if(PUrw.UPrice==blankval)then begin PUrw.UPrice = 0; end;
					PUrw.CostPrice = INr.InPrice;
					if(PUrw.CostPrice==blankval)then begin PUrw.CostPrice = 0; end;
					Purw.Sum = INr.InPrice * PUrw.Quant ;
					PUrw.ToPosCode = binNr;
					MatRowPut(PUr,pucnt,PUrw);
					PUVc_FillRow(PUr,pucnt);
					pucnt= pucnt + 1;	
				end else begin
					INr.Code = artcode;
					if(readfirstMain(INr,1,true))then begin
						PUrw.ArtCode = INr.Code;
						//PUrw.UPrice = StringToVal(price,M45Val);
						PUrw.Quant = StringToVal(quant,M4UVal);
						PUrw.UPrice = INr.LastPurchPrice2;
						if(PUrw.UPrice==blankval)then begin PUrw.UPrice = 0; end;
						PUrw.CostPrice = INr.InPrice;
						if(PUrw.CostPrice==blankval)then begin PUrw.CostPrice = 0; end;
						Purw.Sum = INr.InPrice * PUrw.Quant ;
						MatRowPut(PUr,pucnt,PUrw);
						PUVc_FillRow(PUr,pucnt);
						pucnt= pucnt + 1;	
					end;
				end;
								     		
				curLoc = location;
			end;			
				
		end;
		
		if (NextImportLine(true)) then begin end;
	end;

	if (pucnt>0) then begin	//?????????? ????????? ??????
 			PUSumUp(PUr);
			RecordInsert(PUr,true);	
	end;
logtext(0,"PUImportIn end");
return;
end;

global
updating procedure PUImportIn2()//   Edit-------------------------------------------Dima    23.12.2014  
begin
  record PUVc PUr,PU2r;
  row PUVc PUrw;
	record PosVc Posr;
  record LocationVc Locr;
  string 50 location,curLoc, artcode, quant,binNr,sum1,sum2,sum;
  Integer pucnt;
  record INVc INr;
	integer coefx;
	vector string 50 serialNr;
	record SysFormatBlock SysFormatRec;
  
  BlockLoad(SysFormatRec);
	
	pucnt =0;
	logtext(0,"PUImportIn2 start");
	while (TestEOF()==false) begin	
		PUr.CurncyCode = "EUR";
		artcode = ImportField;
		location = ImportField;
	
		if ((location == curLoc) and (pucnt < 999) and nonblank(artcode)) then begin	//?????????? ??????? ???????
			binNr = ImportField;
			quant = ImportField;
			sum1 = ImportField;
			if(blank(sum1))then begin sum1 = "0"; end;
			sum2 = ImportField;
			if(blank(sum2))then begin sum2 = "0"; end;
			PUr.FrRate = 1;
			PUr.ToRateB1 = 1.954;
			INr.Code = artcode;
			Posr.Code = binNr;
			if(blank(serialNr[artcode])) then begin
						Purw.SerialNr = "1";
						serialNr[artcode] = "1";
					end else begin 
						serialNr[artcode] = ValToString((StringToVal(serialNr[artcode],M4UVal)+1), M4UVal,SysFormatRec.thousSep,SysFormatRec.decimalPt,0);
						Purw.SerialNr = ValToString((StringToVal(serialNr[artcode],M4UVal)), M4UVal,SysFormatRec.thousSep,SysFormatRec.decimalPt,0);
					end;
			if(!ReadFirstMain(Posr,1,true)) then begin
					RecordNew(Posr);
					Posr.Code = binNr;
					Posr.Location = location;
					RecordStore(Posr,true);
					logtext(0,"new polochka " & Locr.Name);
			end;
			If(readfirstmain(INr,1,true))then begin
				coefx = INr.Conversion1;
				if(coefx<1)then begin
					coefx = 1;
				end;
				PUrw.ArtCode = artcode;
				//PUrw.UPrice = StringToVal(price,M45Val);
				PUrw.Quant = StringToVal(quant,M4UVal)*coefx;
				PUrw.UPrice = StringToVal(sum1,M4UVal);
				PUrw.CostPrice = StringToVal(sum2,M4UVal);
				PUrw.Sum = PUrw.CostPrice * PUrw.Quant;
				PUrw.ToPosCode = binNr;
				MatRowPut(PUr,pucnt,PUrw);
				PUVc_FillRow(PUr,pucnt);
				/*PUrw.UPrice = StringToVal(sum1,M4UVal);
						PUrw.CostPrice = StringToVal(sum2,M4UVal);
						PUrw.Sum = PUrw.CostPrice * PUrw.Quant;
						PUrw.UnitCode = INr.Unittext;
						MatRowPut(PUr,pucnt,PUrw);*/
				pucnt= pucnt + 1;	
			end else begin
				logtext(0,"ItemNotFound " & artcode);
			end;
		end else begin			//???????? ????? PU ??????
			if (NonBlank(curLoc)) then begin			
				PUSumUp(PUr);
				RecordInsert(PUr,true);
			end;

			Locr.Code = location;

			if (nonblank(location) and ReadFirstMain(Locr,1,true) and nonblank(artcode)) then begin			
				// logtext(0,location);
				RecordNew(PUr);				
  			PUr.SerNr = NextSerNr("PUVc",PUr.TransDate,-1,false,"");  		
				pucnt = 0;
				binNr	=	ImportField;
				quant = ImportField;
      	sum1 = ImportField;
				sum2 = ImportField;	
				PUr.Location = location;
				PUr.FrRate = 1;
				PUr.ToRateB1 = 1.954;
				Posr.Code = binNr;
				if(blank(serialNr[artcode])) then begin
						Purw.SerialNr = "1";
						serialNr[artcode] = "1";
					end else begin 
						serialNr[artcode] = ValToString((StringToVal(serialNr[artcode],M4UVal)+1), M4UVal,SysFormatRec.thousSep,SysFormatRec.decimalPt,0);
						Purw.SerialNr = ValToString((StringToVal(serialNr[artcode],M4UVal)), M4UVal,SysFormatRec.thousSep,SysFormatRec.decimalPt,0);
					end;
				if(!ReadFirstMain(Posr,1,true)) then begin
					RecordNew(Posr);
					Posr.Code = binNr;
					Posr.Location = location;
					RecordStore(Posr,true);
					logtext(0,"new polochka " & Locr.Name);
				end;
				INr.Code = artcode;
				If(readfirstmain(INr,1,true))then begin
					coefx = INr.Conversion1;
					if(coefx<1)then begin
						coefx = 1;
					end;
					PUrw.ArtCode = artcode;
					//PUrw.UPrice = StringToVal(price,M45Val);
					PUrw.Quant = StringToVal(quant,M4UVal)*coefx;
					PUrw.UPrice = StringToVal(sum1,M4UVal);
					PUrw.CostPrice = StringToVal(sum2,M4UVal);
					PUrw.Sum = PUrw.CostPrice * PUrw.Quant;
					PUrw.ToPosCode = binNr;
					MatRowPut(PUr,pucnt,PUrw);
					PUVc_FillRow(PUr,pucnt);
					/*PUrw.UPrice = StringToVal(sum1,M4UVal);
						PUrw.CostPrice = StringToVal(sum2,M4UVal);
						PUrw.Sum = PUrw.CostPrice * PUrw.Quant;
						PUrw.UnitCode = INr.Unittext;
						MatRowPut(PUr,pucnt,PUrw);*/
					pucnt= pucnt + 1;	
				end else begin
					logtext(0,"ItemNotFound " & artcode);
				end;
								     		
				curLoc = location;
			end;			
				
		end;
		
		if (NextImportLine(true)) then begin end;
	end;

	if (pucnt>0) then begin	//?????????? ????????? ??????
 			PUSumUp(PUr);
			RecordInsert(PUr,true);	
	end;
logtext(0,"PUImportIn2 end");
return;
end;

global updating procedure OutOfOrderIn()
begin
record INVc INr;
integer i,curcomp,cnt;
string 100 item,brand;
record BPIBrandVc BPIBrandr;
boolean error;

	curcomp = currentcompany;
	logtext(0,"OutOfOrderIn start");
	LogText(3, "Check OutOfOrder - bulk update by codes and brand names");
	
	error = false;

	while (TestEOF()==false) begin
		cnt = cnt + 1;
		item = importfield;
		brand = importfield;
		BPIBrandr.Name = brand;
		if(readfirstkey("Name",BPIBrandr,1,true))then begin
			brand = BPIBrandr.Code;
		end;
		for(i=1;i<34; i=i+1) begin
			if(!CompanyIsJWLikeCompany(i) or i==3) then begin
				SetCompany(i,false);
				INr.Code = item;
				if(readfirstmain(INr,1,true)) begin
					if(INr.Code==item and INr.BPIBrand==brand and INr.OutOfOrder==0) then begin
						INr.OutOfOrder = 1;
						logtext(0,cnt & ". Updated: " & INr.Code & " " & INr.BPIBrand & " Company code: " & i);
						RecordStore(INr,true);
					end else begin
						error = true;
						LogText(3, cnt & ". Didn't update: " & item & " " & brand & " Company code: " & i & " ---------- Reason: incorrect brand name! ");
					end;
				end;
			end;
		end;
		
		if (NextImportLine(true)) then begin end;
	end;
	SetCompany(curcomp,false);
	
	if(error) then begin
		MessageBox(0, "Imported successfully, but in some rows error occured! Did not import! Please contact administrator - hansa.log");
	end else begin
		MessageBox(0, "Imported successfully!");
	end;
	
logtext(0,"OutOfOrderIn end");
return;
end;	


global updating procedure CheckOffOutOfOrderIn()
begin
record INVc INr;
integer i,curcomp,cnt;
string 100 item,brand;
record BPIBrandVc BPIBrandr;
boolean error;

	curcomp = currentcompany;
	logtext(0,"CheckOffOutOfOrderIn start");
	LogText(3, "Uncheck OutOfOrder - bulk update by codes and brand names");

	
	error = false;

	while (TestEOF()==false) begin
		cnt = cnt + 1;
		item = importfield;
		brand = importfield;
		BPIBrandr.Name = brand;
		if(readfirstkey("Name",BPIBrandr,1,true))then begin
			brand = BPIBrandr.Code;
		end;
		for(i=1;i<34; i=i+1) begin
			if(!CompanyIsJWLikeCompany(i) or i==3) then begin
				SetCompany(i,false);
				INr.Code = item;
				if(readfirstmain(INr,1,true)) begin
					if(INr.Code==item and INr.BPIBrand==brand and INr.OutOfOrder!=0) then begin
						INr.OutOfOrder = 0;
						logtext(0,cnt & ". Updated: " & INr.Code & " " & INr.BPIBrand & " Company code: " & i);
						RecordStore(INr,true);
					end else begin
						error = true;
						LogText(3, cnt & ". Didn't update: " & item & " " & brand & " Company code: " & i & " ---------- Reason: incorrect brand name! ");
					end;
				end;
			end;
		end;
		
		if (NextImportLine(true)) then begin end;
	end;
	SetCompany(curcomp,false);
	
	if(error) then begin
		error = true;
		MessageBox(0, "Imported successfully, but in some rows error occured! Did not import! Please contact administrator - hansa.log");
	end else begin
		MessageBox(0, "Imported successfully!");
	end;
	
logtext(0,"CheckOffOutOfOrderIn end");
return;
end;	

global updating procedure ImportProductName()
begin
record BtrxProductNameVc BtrxProductNamer;
integer i,curcomp,cnt;
string 150 code,name;

	logtext(0,"ImportProductName start");

	while (TestEOF()==false) begin
		cnt = cnt + 1;
		code = importfield;
		name = importfield;
		
		
		if(nonblank(code) and nonblank(name)) then begin 
			BtrxProductNamer.Code=code;
			BtrxProductNamer.Name=name;
			RecordStore(BtrxProductNamer,true);
			// logtext(0, code&" - "&name);
		end;
		
		if (NextImportLine(true)) then begin end;
	end;
	
	if(cnt>0) then begin
		MessageBox(0, "Imported successfully! You sould find detailed information in hansa.log. Please contact Administrator.");
	end;
	
logtext(0,"ImportProductName end");
return;
end;

global updating procedure ImportAllMaterials()
begin

return;
end;


global updating procedure ImportSize()
begin
record BtrxSizeVc BtrxSizer;
integer i,curcomp,cnt;
string 150 code,name;

	logtext(0,"ImportSize start");

	while (TestEOF()==false) begin
		cnt = cnt + 1;
		code = importfield;
		name = importfield;
		
		
		if(nonblank(code) and nonblank(name)) then begin 
			BtrxSizer.Code=code;
			BtrxSizer.Name=name;
			RecordStore(BtrxSizer,true);
			// logtext(0, code&" - "&name);
		end;
		
		if (NextImportLine(true)) then begin end;
	end;
	
	if(cnt>0) then begin
		MessageBox(0, "Imported successfully! You sould find detailed information in hansa.log. Please contact Administrator.");
	end;
	
logtext(0,"ImportSize end");
return;
end;


global updating procedure ImportYearLifeIn()
begin
record INVc INr;
integer i,curcomp,cnt,cntLife,cntHigh;
string 200 item,high,year;
boolean status;

	cntLife = 0;
	cntHigh = 0;

	curcomp = currentcompany;
	
	logtext(0,"ImportYearLifeIn start");
	
	status = false;

	while (TestEOF()==false) begin
		cnt = cnt + 1;
		item = importfield;
		year = importfield;
		high = importfield;
		
		for(i=1;i<34; i=i+1) begin
			SetCompany(i,false);
			if(item!="" and nonblank(item)) then begin
				INr.Code = item;
				if(readfirstmain(INr,1,true)) begin
					logtext(0, item&" tapildi!");
					
					INr.High=year;
					INr.Life2=high;
					
					if(nonblank(year)) then begin 
						cntLife = cntLife + 1;
						logtext(0, "High daxil oldu!");
					end;
					
					if(nonblank(high)) then begin 
						cntHigh = cntHigh + 1;
						logtext(0, "Life daxil oldu!");
					end;
					
					logtext(0,cnt & ". Updated -  Code: " & INr.Code & "   High: " & INr.High & "   Life: " & INr.Life2 & " Company code: " & i);
					RecordStore(INr,true);
				end;
			end;
		end;
		
		if (NextImportLine(true)) then begin end;
	end;
	SetCompany(curcomp,false);
	
	if(cnt>0) then begin
		MessageBox(0, "Imported successfully! You sould find detailed information in hansa.log. "&cntLife&" - year updated. "&cntHigh&" - high updated!" );
	end else begin
		MessageBox(0, "Data did not find!");
	end;
	
logtext(0,"ImportYearLifeIn end");
return;
end;


global updating procedure ChangeBPIGroupIn()
begin
record INVc INr;
integer i,curcomp,cnt;
string 100 item,brand,oldgroup,newgroup,newkey,oldkey;
record BPIBrandVc BPIBrandr;
record BPIGroupVc BPIGroupr;


	curcomp = currentcompany;
	logtext(0,"ChangeBPIGroupIn start");

	while (TestEOF()==false) begin
		cnt = cnt + 1;
		item = importfield;
		brand = importfield;
		oldgroup = importfield;
		newgroup = importfield;
		for(i=1;i<30; i=i+1) begin
			if(!CompanyIsJWLikeCompany(i) or i==3) then begin
				SetCompany(i,false);
				INr.Code = item;
				if(readfirstmain(INr,1,true)) begin
					BPIBrandr.Name = brand;
					if((readfirstkey("Name",BPIBrandr,1,true) and INr.BPIBrand==BPIBrandr.Code) or brand=="*")then begin
						BPIGroupr.Name = oldgroup;
						oldkey = "Name";
						if(left(oldgroup,5)=="GROUP")then begin
								BPIGroupr.Code = oldgroup;
								oldkey = "Code";
							end;
						if(readfirstkey(oldkey,BPIGroupr,1,true) and INr.BPIGroup==BPIGroupr.Code)then begin
							BPIGroupr.Name = newgroup;
							newkey = "Name";
							if(left(newgroup,5)=="GROUP")then begin
								BPIGroupr.Code = newgroup;
								newkey = "Code";
							end;
							if(readfirstkey(newkey,BPIGroupr,1,true))then begin
								// logtext(0,INr.DispGroups & " <- " & INr.BPIGroup);
								// logtext(0,setinset2(INr.BPIGroup,INr.DispGroups));
								if(setinset(INr.BPIGroup,INr.DispGroups))then begin
									logtext(0,"Try to change subgroup");
									// logtext(0,INr.DispGroups & " -> " & StrReplace(INr.DispGroups,INr.BPIGroup,BPIGroupr.Code));
									INr.DispGroups = StrReplace(INr.DispGroups,INr.BPIGroup,BPIGroupr.Code);
									
								end;
								INr.BPIGroup = BPIGroupr.Code;
								recordstore(INr,true);
							end;
						end;
					end;
				end;
			end;
		end;
		if (NextImportLine(true)) then begin end;
	end;
	SetCompany(curcomp,false);
	
logtext(0,"ChangeBPIGroupIn end");
return;
end;


global updating procedure PriceFillIn()
begin
string 100 Code;
record GlobalItemVc GIr,LogGIr;
integer cnt;

logtext(0,"PriceFillIn start");

	while (TestEOF()==false) begin
		cnt = cnt + 1;
		Code = importfield;
		GIr.Code = Code;
		if(readfirstmain(GIr,1,true)) then begin
			logtext(0,"PriceFillIn Code:" & GIr.Code & " Global item price = " & blankval);
			recordcopy(LogGIr,GIr);
			GIr.Price = blankval;
			GIWasUpdated(GIr,LogGIr," GIWasUpdatedlog 106");
			RecordStore(GIr,true);
		end;
		if (NextImportLine(true)) then begin end;
	end;
logtext(0,"PriceFillIn end");
return;
end;

global updating procedure BrandFillCWHIn()
begin
string 100 CWHCode,brand,StockGroup;
record BPIBrandVc Brandr;
integer cnt;

logtext(0,"BrandFillCWHIn start");

	while (TestEOF()==false) begin
		cnt = cnt + 1;
		brand = importfield;
		CWHCode = importfield;
		StockGroup = importfield;
		Brandr.Name = brand;
		if(readfirstkey("Name",Brandr,1,true)) then begin
			if(blank(Brandr.CWHCode))then begin
				//Brandr.CWHCode = CWHCode;
			end;
			Brandr.StockGroup = StockGroup;
			RecordStore(Brandr,true);
		end;
		if (NextImportLine(true)) then begin end;
	end;
logtext(0,"BrandFillCWHIn end");
return;
end;

global updating procedure ChangeAllBrandBPIBrandIn()
begin
record INVc INr,oldINr;
integer i,curcomp,cnt,j,k;
record GlobalItemVc GIr;
string 100 item,oldBrand,newBrand,code,glCode;
record BPIBrandVc BPIBrandr;
record BPIBrandVc BPIBrand1r;
array string 100 abrand,anewbrand;


	curcomp = currentcompany;
	logtext(0,"ChangeAllBrandBPIBrandIn start");

	while (TestEOF()==false) begin
		cnt = cnt + 1;
		code = importfield;
		oldBrand = importfield;
		newBrand = importfield;
		BPIBrandr.Code = oldBrand;
		if(readfirstkey("Code",BPIBrandr,1,true))then begin
			if(uppercase(oldBrand)==uppercase(BPIBrandr.Code))then begin		
				BPIBrand1r.Code = newBrand;
				if(readfirstkey("Code",BPIBrand1r,1,true))then begin
						
						
					for(i=1;i<34; i=i+1) begin
						if(!CompanyIsJWLikeCompany(i) or i==3) then begin
							SetCompany(i,false);
							INr.Code = code;
							if(readfirstMain(INr,1,true))then begin
								if(nonblank(INr.BPIBrand))then begin
									RecordCopy(oldINr,INr);
									if(INr.BPIBrand==BPIBrandr.Code)then begin;
										if(setinset(INr.BPIBrand,INr.DispGroups))then begin										
											INr.DispGroups = StrReplace(INr.DispGroups,INr.BPIBrand,BPIBrand1r.Code);
										end;
										glCode = INr.GlobalArtCode;
										INr.GlobalArtCode = "";
										INr.BPIBrand = BPIBrand1r.Code;
										GIr.Code = glCode;
										if(ReadFirstMain(GIr,1,true)) then begin
											logtext(0,"del" & GIr.Code);
											RecordDelete(GIr);
										end;
										CreateNewGlobalItem(INr);
										if(recordStore(INr,true)) then begin  end;
									end; 
								end;
							end;
						end;
					end;
				end;
			end;
		end;
		if (NextImportLine(true)) then begin end;
	end;
	SetCompany(curcomp,false);
	
logtext(0,"ChangeAllBrandBPIBrandIn end");
return;
end;

global updating procedure ChangeAllBrandBPIGroupIn()
begin
record INVc INr;
integer i,curcomp,cnt,j,k;
string 100 item,brand,oldgroup,newgroup;
record BPIBrandVc BPIBrandr;
record BPIGroupVc BPIGroupr;
array string 100 abrand,aoldgroup,anewgroup;


	curcomp = currentcompany;
	logtext(0,"ChangeAllBrandBPIGroupIn start");

	while (TestEOF()==false) begin
		cnt = cnt + 1;
		brand = importfield;
		oldgroup = importfield;
		newgroup = importfield;
		// logtext(0,brand & " " & oldgroup & " " & newgroup);
		BPIBrandr.Name = brand;
		if(readfirstkey("Name",BPIBrandr,1,false))then begin
			// logtext(0,BPIBrandr.Name & " " & oldgroup & " " & newgroup);
			if(uppercase(brand)==uppercase(BPIBrandr.Name))then begin
				abrand[abrand.length] = BPIBrandr.Code;
				BPIGroupr.Name = oldgroup;
				if(readfirstkey("Name",BPIGroupr,1,false))then begin
					aoldgroup[aoldgroup.length] = BPIGroupr.Code;
					BPIGroupr.Name = newgroup;
					if(readfirstkey("Name",BPIGroupr,1,false))then begin
						anewgroup[anewgroup.length] = BPIGroupr.Code;
					
						// logtext(0,abrand[abrand.length-1] & " " & aoldgroup[aoldgroup.length-1] & " -> " & anewgroup[anewgroup.length-1]);
						
						
						for(i=1;i<30; i=i+1) begin
						if(!CompanyIsJWLikeCompany(i) or i==3) then begin
							SetCompany(i,false);
							resetloop(INr);
							INr.Code = "";
							while(loopmain(INr,1,true)) begin
								if(nonblank(INr.BPIGroup) and nonblank(INr.BPIBrand))then begin
									For(j=0;j<abrand.length;j=j+1) begin
										if(INr.BPIBrand==abrand[j])then begin
											if(INr.BPIGroup==aoldgroup[j])then begin
												// logtext(0,INr.Code & " " & aoldgroup[j] & " -> " & anewgroup[j]);
												if(setinset(INr.BPIGroup,INr.DispGroups))then begin
													// logtext(0,INr.Code & "  " & INr.DispGroups & " -> " & StrReplace(INr.DispGroups,INr.BPIGroup,anewgroup[j]));
													INr.DispGroups = StrReplace(INr.DispGroups,INr.BPIGroup,BPIGroupr.Code);
												end;
												INr.BPIGroup = anewgroup[j];
												recordstore(INr,true);
											end;
										end;
									end; 
								end;
							end;
						end;
					end;
						
					end;
				end;
			end;
		end;
		/*
		for(i=1;i<30; i=i+1) begin
			if(!CompanyIsJWLikeCompany(i) or i==3) then begin
				SetCompany(i,false);
				INr.Code = item;
				if(readfirstmain(INr,1,true)) begin
					BPIBrandr.Name = brand;
					if(readfirstkey("Name",BPIBrandr,1,true) and INr.BPIBrand==BPIBrandr.Code)then begin
						BPIGroupr.Name = oldgroup;
						if(readfirstkey("Name",BPIGroupr,1,true) and INr.BPIGroup==BPIGroupr.Code)then begin
							BPIGroupr.Name = newgroup;
							if(readfirstkey("Name",BPIGroupr,1,true))then begin
								logtext(0,INr.DispGroups & " <- " & INr.BPIGroup);
								logtext(0,setinset2(INr.BPIGroup,INr.DispGroups));
								if(setinset(INr.BPIGroup,INr.DispGroups))then begin
									logtext(0,"Try to change subgroup");
									logtext(0,INr.DispGroups & " -> " & StrReplace(INr.DispGroups,INr.BPIGroup,BPIGroupr.Code));
									INr.DispGroups = StrReplace(INr.DispGroups,INr.BPIGroup,BPIGroupr.Code);
									
								end;
								INr.BPIGroup = BPIGroupr.Code;
								recordstore(INr,true);
							end;
						end;
					end;
				end;
			end;
		end;*/
		if (NextImportLine(true)) then begin end;
	end;
	SetCompany(curcomp,false);
	
logtext(0,"ChangeAllBrandBPIGroupIn end");
return;
end;






global updating procedure Rebuild3catTreeGIMn()
begin
	record GlobalItemVc GIr,LogGIr;
	record BtrxThirdLevelCatVc BtrxThirdLevelCatr;
	boolean TrHs, catrtreef;
	string 255 Name3catrus,Name3cataz,Name3,OldCode;


	GIr.Code = "";
	while (loopmain(GIr,1,true)) begin
		BtrxThirdLevelCatr.Code = GIr.BTRxThirdLevCat;
		if(ReadFirstMain(BtrxThirdLevelCatr,1,true))then begin
			Name3 = BtrxThirdLevelCatr.Name;
			OldCode = BtrxThirdLevelCatr.Code;
			BtrxThirdLevelCatr.Name = Name3;
			if(ReadFirstkey("Name",BtrxThirdLevelCatr,1,true))then begin
				recordcopy(LogGIr,GIr);
				GIr.BTRxThirdLevCat = BtrxThirdLevelCatr.Code;
				GIWasUpdated(GIr,LogGIr," GIWasUpdatedlog 107");
				recordStore(GIr,true);
				if(BtrxThirdLevelCatr.Code != OldCode)then begin
					BtrxThirdLevelCatr.Code = OldCode;
					if(ReadFirstMain(BtrxThirdLevelCatr,1,true))then begin
						recordDelete(BtrxThirdLevelCatr);
					end;
				end;
			end;
		end;
	end;
return;
end;

global updating procedure Rebuild3catTreeMn()
begin
	record GlobalItemVc GIr,LogGIr;
	record BtrxThirdLevelCatVc BtrxThirdLevelCatr;
	record BtrxSecondLevelCatVc BtrxSecondLevelCatr;
	boolean TrHs, catrtreef, createdf;
	string 255 Name3catrus,Name3cataz,Name3,OldCode;
	
	
	GIr.Code = "";
	while (loopmain(GIr,1,true)) begin
		if(nonblank(GIr.BTRxThirdLevCat) and nonblank(GIr.BTRxSecondLevCat))then begin
			BtrxSecondLevelCatr.Code = GIr.BTRxSecondLevCat;
			if(ReadFirstMain(BtrxSecondLevelCatr,1,true))then begin
				BtrxThirdLevelCatr.Code = GIr.BTRxThirdLevCat;
				catrtreef = false;
				TrHs = true;
				Name3catrus = "";
				Name3cataz = "";
				Name3 = "";
				createdf = false;
				while (loopmain(BtrxThirdLevelCatr,1,TrHs)) begin
					if(BtrxThirdLevelCatr.Code!=GIr.BTRxThirdLevCat)then begin TrHs = false; end;
					if(BtrxThirdLevelCatr.Code==GIr.BTRxThirdLevCat)then begin 
						Name3catrus = BtrxThirdLevelCatr.NameRUS;
						Name3cataz = BtrxThirdLevelCatr.NameAZ;
						Name3 = BtrxThirdLevelCatr.Name;
						createdf = true;
					end;
					if(GIr.BTRxSecondLevCat==BtrxThirdLevelCatr.RelatedTo and TrHs)then begin
						catrtreef = true;
						logtext (0,GIr.Code & " Good");
						TrHs = false;
					end;
				end;
				resetloop(BtrxThirdLevelCatr);
				if(!catrtreef and createdf)then begin
					BtrxThirdLevelCatr.Code = "THLVL9999";
					TrHs = true;
					while (LoopBackKey("Code",BtrxThirdLevelCatr,1,TrHs)) begin
						OldCode = BtrxThirdLevelCatr.Code;
						TrHs = false;
					end;
					ResetLoop(BtrxThirdLevelCatr);
					recordnew(BtrxThirdLevelCatr);
					if(blank(OldCode))then begin OldCode = "THLVL0000"; end;
					NextM4SerialNumber(OldCode,BtrxThirdLevelCatr.Code);
					BtrxThirdLevelCatr.RelatedTo = GIr.BTRxSecondLevCat;
					BtrxThirdLevelCatr.Name = Name3;
					BtrxThirdLevelCatr.NameRUS = Name3catrus;
					BtrxThirdLevelCatr.NameAZ = Name3cataz;
					recordstore(BtrxThirdLevelCatr,true);
					recordcopy(LogGIr,GIr);
					GIr.BTRxThirdLevCat = BtrxThirdLevelCatr.Code;
					GIWasUpdated(GIr,LogGIr," GIWasUpdatedlog 108");
					recordStore(GIr,true);
					OldCode = "";
				end;
			end;
		end;
	end;


return;
end;


updating function boolean SetItemBitrixClass(var record GlobalItemVc GIr,array string headers,array string params, var array string ErrAr, var integer ErrCnt,var array string ErrAr2,var vector string classCode)
begin
	record BTRxBrandVc BTRxBrandr;
	record BTRxMaterialVc BTRxMaterialr;
	record BTRxColourVc BTRxColorr;
	record BTRxSizeVc BTRxSizer;
	record BTRxSexVc BTRxSexr;
	record BTRxPlatingVc BTRxPlatingr;
	record BTRxStoneVc BTRxStoner;
	record BTRxStrapVc BTRxStrapr;
	record BTRxOdourVc BTRxOdourr;
	record BtrxInternalCatVc BtrxInternalCatr;
	record BtrxFirstLevelCatVc BtrxFirstLevelCatr;
	record BtrxSecondLevelCatVc BtrxSecondLevelCatr, BSLLastCoder;
	record BtrxThirdLevelCatVc BtrxThirdLevelCatr, BTLLastCoder;
	record BtrxCertificateVc BtrxCertificater;
	record BtrxWatchMechanVc BtrxWatchMechanr;
	record BtrxPowerReserveVc BtrxPowerReserver;
	record BtrxWatchGradeVc BtrxWatchGrader;
	record BtrxPhoneModelVc BtrxPhoneModelr;
	record BtrxFillingVc BtrxFillingr;
	record BtrxTypeVc BtrxTyper;
	record BtrxWaterResistantVc BtrxWatResr;
	record BtrxStrapMatVc BtrxStrapMatr;
	record BtrxBracelMatVc BtrxBracelMatr;
	record BtrxCollectionVc BtrxCollectionr;
	record BtrxComplicationsVc BtrxComplicationsr;
	record BtrxMicrowaveProtectVc BtrxMicrowaveProtectr;
	record BtrxStoveCompatVc BtrxStoveCompatr;
	record BtrxAllMaterialsVc BtrxAllMaterialsr;
	record BtrxPrecMetalContVc BtrxPrecMetalContr;
	record BtrxCaseDiamVc BtrxCaseDiamr;
	
	integer i, pos;
	string 100 param, OldCode, newCode;
	boolean res, TrHs, testf, THRDf, catrtreef, createdf;
	string 255 catName, catNameRUS, catNameAZ, parametr, paramsStr, Name3catrus, Name3cataz, tree3Code;
	
	SetCompany(1,false);
	
	newCode = "";
	GIr.BTRxGiftClass = "";
	res = true;
	for(i=0;i<headers.length;i=i+1)begin
		param = headers[i];
		params[i] = trim(params[i]);
		switch(param)begin
			case"Brand": 			if(blank(params[i]))then begin
													GIr.BPIBrand = "";
												end else begin
													BTRxBrandr.Name = params[i];
													if(readfirstkey("Name",BTRxBrandr,1,true))then begin
														GIr.BPIBrand = BTRxBrandr.Code;
													end else begin
														BTRxBrandr.Code = params[i];
														if(readfirstmain(BTRxBrandr,1,true))then begin
															GIr.BPIBrand = BTRxBrandr.Code;
														end else begin
															GIr.BPIBrand = "";
															ErrAr[ErrCnt] = param & ": " & params[i];
															ErrCnt = ErrCnt + 1;
															 // BTRxBrandr.Code = "BRND9999";
															 // TrHs = true;
															 // while (LoopBackKey("Code",BTRxBrandr,1,TrHs)) begin
																 // OldCode = BTRxBrandr.Code;
																 // TrHs = false;
															 // end;
															 // ResetLoop(BTRxBrandr);
															 // recordnew(BTRxBrandr);
															 // if(blank(OldCode))then begin OldCode = "BRND0000"; end;
															 // NextCode(OldCode,BTRxBrandr.Code);
															 // BTRxBrandr.Name = params[i];
															 // recordinsert(BTRxBrandr,true);
															 // recordupdate(BTRxBrandr,BTRxBrandr,true);
															 // GIr.BPIBrand = BTRxBrandr.Code;
															 // res = true;
															 // OldCode = "";
														end;
													end;
												end;
			case"IntCat": 		if(blank(params[i]))then begin
													GIr.BTRxInterCatClass = "";
												end else begin
													BtrxInternalCatr.Name = trim(params[i]);
													if(readfirstkey("Name",BtrxInternalCatr,1,true))then begin
														GIr.BTRxInterCatClass = BtrxInternalCatr.Code;
													end else begin
														BtrxInternalCatr.Code = params[i];
														if(readfirstmain(BtrxInternalCatr,1,true))then begin
															GIr.BTRxInterCatClass = BtrxInternalCatr.Code;
														end else begin
															// GIr.BTRxInterCatClass = "";
															// ErrAr[ErrCnt] = param & ": " & params[i];
															// ErrAr2[ErrCnt] = param & chr(09) & params[i];
															// ErrCnt = ErrCnt + 1;
															BtrxInternalCatr.Code = "INCAT9999";
															TrHs = true;
															while (LoopBackKey("Code",BtrxInternalCatr,1,TrHs)) begin
																OldCode = BtrxInternalCatr.Code;
																TrHs = false;
															end;
															ResetLoop(BtrxInternalCatr);
															recordnew(BtrxInternalCatr);
															if(blank(OldCode))then begin OldCode = "INCAT0000"; end;
															NextCode(OldCode,BtrxInternalCatr.Code);
															BtrxInternalCatr.Name = params[i];
															recordinsert(BtrxInternalCatr,true);
															recordupdate(BtrxInternalCatr,BtrxInternalCatr,true);
															GIr.BTRxInterCatClass = BtrxInternalCatr.Code;
															res = true;
															OldCode = "";
														end;
													end;
												end;
			case"Type": 			if(blank(params[i]))then begin
													GIr.BTRxType = "";
												end else begin
													BtrxTyper.Name = trim(params[i]);
													if(readfirstkey("Name",BtrxTyper,1,true))then begin
														GIr.BTRxType = BtrxTyper.Code;
													end else begin
														BtrxTyper.Code = params[i];
														if(readfirstmain(BtrxTyper,1,true))then begin
															GIr.BTRxType = BtrxTyper.Code;
														end else begin
															// GIr.BTRxType = "";
															// ErrAr[ErrCnt] = param & ": " & params[i];
															// ErrAr2[ErrCnt] = param & chr(09) & params[i];
															// ErrCnt = ErrCnt + 1;
															BtrxTyper.Code = "BTYPE9999";
															TrHs = true;
															while (LoopBackKey("Code",BtrxTyper,1,TrHs)) begin
																OldCode = BtrxTyper.Code;
																TrHs = false;
															end;
															ResetLoop(BtrxTyper);
															recordnew(BtrxTyper);
															if(blank(OldCode))then begin OldCode = "BTYPE0000"; end;
															NextCode(OldCode,BtrxTyper.Code);
															BtrxTyper.Name = params[i];
															recordinsert(BtrxTyper,true);
															recordupdate(BtrxTyper,BtrxTyper,true);
															GIr.BTRxType = BtrxTyper.Code;
															res = true;
															OldCode = "";
														end;
													end;					
												end;
			case"Cat1":				if(blank(params[i]))then begin
													GIr.BTRxFirstLevCat = "";
												end else begin
													pos = 0;
													BtrxFirstLevelCatr.Name = "";
													paramsStr = "";
													parametr = trim(params[i]);
													// ExtractObjWithSeparator("_",parametr,true,pos,paramsStr);
													// while (nonblank(paramsStr)) begin
														// if(nonblank(BtrxFirstLevelCatr.Name))then begin
															// BtrxFirstLevelCatr.Name = BtrxFirstLevelCatr.Name & " ";
														// end;
														// BtrxFirstLevelCatr.Name = BtrxFirstLevelCatr.Name & paramsStr;
														// ExtractObjWithSeparator("_",parametr,true,pos,paramsStr);
													// end;
													BtrxFirstLevelCatr.Name = parametr;
													if(readfirstkey("Name",BtrxFirstLevelCatr,1,true))then begin
														GIr.BTRxFirstLevCat = BtrxFirstLevelCatr.Code;
													end else begin
														BtrxFirstLevelCatr.Code = params[i];
														if(readfirstmain(BtrxFirstLevelCatr,1,true))then begin
															GIr.BTRxFirstLevCat = BtrxFirstLevelCatr.Code;
														end else begin
															// GIr.BTRxFirstLevCat = "";
															// ErrAr[ErrCnt] = param & ": " & params[i];
															// ErrAr2[ErrCnt] = param & chr(09) & params[i];
															// ErrCnt = ErrCnt + 1;
															// logtext(0,"yes");
															BtrxFirstLevelCatr.Code = "FILVL9999";
															TrHs = true;
															while (LoopBackKey("Code",BtrxFirstLevelCatr,1,TrHs)) begin
																OldCode = BtrxFirstLevelCatr.Code;
																TrHs = false;
															end;
															ResetLoop(BtrxFirstLevelCatr);
															recordnew(BtrxFirstLevelCatr);
															if(blank(OldCode))then begin OldCode = "FILVL0000"; end;
															NextCode(OldCode,BtrxFirstLevelCatr.Code);
															BtrxFirstLevelCatr.Name = params[i];
															recordinsert(BtrxFirstLevelCatr,true);
															recordupdate(BtrxFirstLevelCatr,BtrxFirstLevelCatr,true);
															GIr.BTRxFirstLevCat = BtrxFirstLevelCatr.Code;
															res = true;
															OldCode = "";
														end;
													end;
												end;
			case"Cat2":				if(blank(params[i]))then begin
													GIr.BTRxSecondLevCat = "";
												end else begin
													pos = 0;
													BtrxSecondLevelCatr.Name = "";
													paramsStr = "";
													parametr = trim(params[i]);
													// ExtractObjWithSeparator("_",parametr,true,pos,paramsStr);
													// while (nonblank(paramsStr)) begin
														// if(nonblank(BtrxSecondLevelCatr.Name))then begin
															// BtrxSecondLevelCatr.Name = BtrxSecondLevelCatr.Name & " ";
														// end;
														// BtrxSecondLevelCatr.Name = BtrxSecondLevelCatr.Name & paramsStr;
														// ExtractObjWithSeparator("_",parametr,true,pos,paramsStr);
													// end;
													BtrxSecondLevelCatr.Name = parametr;
													if(readfirstkey("Name",BtrxSecondLevelCatr,1,true))then begin
														GIr.BTRxSecondLevCat = BtrxSecondLevelCatr.Code;
													end else begin
														BtrxSecondLevelCatr.Code = params[i];
														if(readfirstmain(BtrxSecondLevelCatr,1,true))then begin
															GIr.BTRxSecondLevCat = BtrxSecondLevelCatr.Code;
														end else begin
															GIr.BTRxSecondLevCat = "";
															ErrAr[ErrCnt] = param & ": " & params[i];
															ErrAr2[ErrCnt] = param & chr(09) & params[i];
															ErrCnt = ErrCnt + 1;
														end;
													end;
												end;
			case"Cat3":				if(blank(params[i]))then begin
													GIr.BTRxThirdLevCat = GIr.BTRxGiftClass;
												end else begin
													TrHs = true;
													resetloop(BtrxThirdLevelCatr);
													BtrxThirdLevelCatr.Name = trim(params[i]);
													while(loopkey("Name",BtrxThirdLevelCatr,1,TrHs))begin
														if(BtrxThirdLevelCatr.Name!=params[i])then begin TrHs = false; end;
														
														if(TrHs)then begin
															if(BtrxThirdLevelCatr.PathScndCode==GIr.BTRxSecondLevCat)then begin
																if(nonblank(GIr.BTRxGiftClass))then begin
																	GIr.BTRxThirdLevCat = BtrxThirdLevelCatr.Code & "," & GIr.BTRxGiftClass;
																end else begin
																	GIr.BTRxThirdLevCat = BtrxThirdLevelCatr.Code;
																end;
															end;
														end;
													end;
													
												end;
												/*if(blank(params[i]))then begin
													GIr.BTRxThirdLevCat = "";
												end else begin
													pos = 0;
													BtrxThirdLevelCatr.Name = "";
													paramsStr = "";
													parametr = params[i];
													ExtractObjWithSeparator("_",parametr,true,pos,paramsStr);
													while (nonblank(paramsStr)) begin
														if(nonblank(BtrxThirdLevelCatr.Name))then begin
															BtrxThirdLevelCatr.Name = BtrxThirdLevelCatr.Name & " ";
														end;
														BtrxThirdLevelCatr.Name = BtrxThirdLevelCatr.Name & paramsStr;
														ExtractObjWithSeparator("_",parametr,true,pos,paramsStr);
													end;
													if(readfirstkey("Name",BtrxThirdLevelCatr,1,true))then begin
														Name3catrus = BtrxThirdLevelCatr.NameRUS;
														Name3cataz = BtrxThirdLevelCatr.NameAZ;
														if(BtrxThirdLevelCatr.RelatedTo==GIr.BTRxSecondLevCat)then begin
															if(nonblank(GIr.BTRxThirdLevCat))then begin
																GIr.BTRxThirdLevCat = "," & GIr.BTRxThirdLevCat;
															end;
															GIr.BTRxThirdLevCat = BtrxThirdLevelCatr.Code & GIr.BTRxThirdLevCat;
															pos = 0;
															BtrxThirdLevelCatr.Name = "";
															paramsStr = "";
															parametr = GIr.BTRxThirdLevCat;
															GIr.BTRxThirdLevCat = "";
															ExtractObjWithSeparator(",",parametr,true,pos,paramsStr);
															THRDf = false;
															while (nonblank(paramsStr)) begin
																BtrxThirdLevelCatr.Name = paramsStr;
																if(ReadFirstMain(BtrxThirdLevelCatr,1,true) and !THRDf)then begin
																	THRDf = true;
																	if(nonblank(GIr.BTRxThirdLevCat))then begin GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ","; end;
																	GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & paramsStr;
																end else begin
																	BtrxThirdLevelCatr.Name = paramsStr;
																	if(!ReadFirstMain(BtrxThirdLevelCatr,1,true)) then begin
																		if(nonblank(GIr.BTRxThirdLevCat))then begin GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ","; end;
																		GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & paramsStr;
																	end;
																end;
																ExtractObjWithSeparator(",",parametr,true,pos,paramsStr);
															end;
														end else begin

														end;
													end else begin
														BtrxThirdLevelCatr.Code = params[i];
														if(readfirstmain(BtrxThirdLevelCatr,1,true))then begin
															GIr.BTRxThirdLevCat = BtrxThirdLevelCatr.Code;
														end else begin
															GIr.BTRxThirdLevCat = "";
															ErrAr[ErrCnt] = param & ": " & params[i];
															ErrAr2[ErrCnt] = param & chr(09) & params[i];
															ErrCnt = ErrCnt + 1;
														end;
													end;
												end;*/
			case"Name":				if(nonblank(params[i]))then begin GIr.Name = params[i]; end;
			case"NameRUS":		if(nonblank(params[i]))then begin GIr.NameRUS = params[i]; end;
			case"NameAZ":			if(nonblank(params[i]))then begin GIr.NameAZ = params[i]; end;
			case"Material":		if(blank(params[i]))then begin
													GIr.BPIMaterial = "";
												end else begin
													BTRxMaterialr.Name = trim(params[i]);
													if(readfirstkey("Name",BTRxMaterialr,1,true))then begin
														GIr.BPIMaterial = BTRxMaterialr.Code;
													end else begin
														BTRxMaterialr.Code = params[i];
														if(readfirstmain(BTRxMaterialr,1,true))then begin
															GIr.BPIMaterial = BTRxMaterialr.Code;
														end else begin
															// GIr.BPIMaterial = "";
															// ErrAr[ErrCnt] = param & ": " & params[i];
															// ErrAr2[ErrCnt] = param & chr(09) & params[i];
															// ErrCnt = ErrCnt + 1;
															BTRxMaterialr.Code = "MATR99999";
															TrHs = true;
															while (LoopBackKey("Code",BTRxMaterialr,1,TrHs)) begin
																OldCode = BTRxMaterialr.Code;
																TrHs = false;
															end;
															ResetLoop(BTRxMaterialr);
															recordnew(BTRxMaterialr);
															if(blank(OldCode))then begin OldCode = "MATR00000"; end;
															NextCode(OldCode,BTRxMaterialr.Code);
															BTRxMaterialr.Name = params[i];
															recordinsert(BTRxMaterialr,true);
															recordupdate(BTRxMaterialr,BTRxMaterialr,true);
															GIr.BPIMaterial = BTRxMaterialr.Code;
															res = true;
															OldCode = "";
														end;
													end;
												end;
			case"Plating":		if(blank(params[i]))then begin
													GIr.BPIPlating = "";
												end else begin
													BTRxPlatingr.Name = trim(params[i]);
													if(readfirstkey("Name",BTRxPlatingr,1,true))then begin
														GIr.BPIPlating = BTRxPlatingr.Code;
													end else begin
														BTRxPlatingr.Code = params[i];
														if(readfirstmain(BTRxPlatingr,1,true))then begin
															GIr.BPIPlating = BTRxPlatingr.Code;
														end else begin
															// GIr.BPIPlating = "";
															// ErrAr[ErrCnt] = param & ": " & params[i];
															// ErrAr2[ErrCnt] = param & chr(09) & params[i];
															// ErrCnt = ErrCnt + 1;
															BTRxPlatingr.Code = "PLAT99999";
															TrHs = true;
															while (LoopBackKey("Code",BTRxPlatingr,1,TrHs)) begin
																OldCode = BTRxPlatingr.Code;
																TrHs = false;
															end;
															ResetLoop(BTRxPlatingr);
															recordnew(BTRxPlatingr);
															if(blank(OldCode))then begin OldCode = "PLAT00000"; end;
															NextCode(OldCode,BTRxPlatingr.Code);
															BTRxPlatingr.Name = params[i];
															recordinsert(BTRxPlatingr,true);
															recordupdate(BTRxPlatingr,BTRxPlatingr,true);
															GIr.BPIPlating = BTRxPlatingr.Code;
															res = true;
															OldCode = "";
														end;
													end;
												end;
			case"Gender":			if(blank(params[i]))then begin
													GIr.BPISex = "";
												end else begin
													BTRxSexr.Name = trim(params[i]);
													if(readfirstkey("Name",BTRxSexr,1,true))then begin
														GIr.BPISex = BTRxSexr.Code;
													end else begin
														BTRxSexr.Code = params[i];
														if(readfirstmain(BTRxSexr,1,true))then begin
															GIr.BPISex = BTRxSexr.Code;
														end else begin
															// GIr.BPISex = "";
															// ErrAr[ErrCnt] = param & ": " & params[i];
															// ErrAr2[ErrCnt] = param & chr(09) & params[i];
															// ErrCnt = ErrCnt + 1;
															BTRxSexr.Code = "SEX99999";
															TrHs = true;
															while (LoopBackKey("Code",BTRxSexr,1,TrHs)) begin
																OldCode = BTRxSexr.Code;
																TrHs = false;
															end;
															ResetLoop(BTRxSexr);
															recordnew(BTRxSexr);
															if(blank(OldCode))then begin OldCode = "SEX00000"; end;
															NextCode(OldCode,BTRxSexr.Code);
															BTRxSexr.Name = params[i];
															recordinsert(BTRxSexr,true);
															recordupdate(BTRxSexr,BTRxSexr,true);
															GIr.BPISex = BTRxSexr.Code;
															res = true;
															OldCode = "";
														end;
													end;
												end;
			case"Size":				if(blank(params[i]))then begin
													GIr.BPISize = "";
												end else begin
													if (GIr.HansaCode == "R17080OX52") then begin  end;
													BTRxSizer.Name = trim(params[i]);
													if(readfirstkey("Name",BTRxSizer,1,true))then begin
														GIr.BPISize = BTRxSizer.Code;
													end else begin
														BTRxSizer.Code = params[i];
														if(readfirstmain(BTRxSizer,1,true))then begin
															GIr.BPISize = BTRxSizer.Code;
														end else begin
															// GIr.BPISize = "";
															// ErrAr[ErrCnt] = param & ": " & params[i];
															// ErrAr2[ErrCnt] = param & chr(09) & params[i];
															// ErrCnt = ErrCnt + 1;
															BTRxSizer.Code = "SZ99999";
															TrHs = true;
															while (LoopBackKey("Code",BTRxSizer,1,TrHs)) begin
																OldCode = BTRxSizer.Code;
																TrHs = false;
															end;
															ResetLoop(BTRxSizer);
															recordnew(BTRxSizer);
															if(blank(OldCode))then begin OldCode = "SZ00000"; end;
															NextCode(OldCode,BTRxSizer.Code);
															BTRxSizer.Name = params[i];
															recordinsert(BTRxSizer,true);
															recordupdate(BTRxSizer,BTRxSizer,true);
															GIr.BPISize = BTRxSizer.Code;
															res = true;
															OldCode = "";
														end;
													end;
												end;
			case"Weight":			GIr.StrWeight = params[i];
			case"Volume":			GIr.StrVolume = params[i];
			case"Diameter":		GIr.StrBTRxDiam = params[i];
			case"Width":			GIr.StrWidth = params[i];
			case"Length":			GIr.StrDepth = params[i];
			case"Height":			GIr.StrHeight = params[i];
			case"SetQty":			GIr.StrBTRxSetQty = params[i];
			case"FinGirth":		GIr.BTRxFingerGirth = params[i];
			case"ProdColor":	if(blank(params[i]))then begin
													GIr.BTRxProdColour = "";
												end else begin
													BTRxColorr.Name = trim(params[i]);
													if(readfirstkey("Name",BTRxColorr,1,true))then begin
														GIr.BTRxProdColour = BTRxColorr.Code;
													end else begin
														BTRxColorr.Code = params[i];
														if(readfirstmain(BTRxColorr,1,true))then begin
															GIr.BTRxProdColour = BTRxColorr.Code;
														end else begin
															// GIr.BTRxProdColour = "";
															// ErrAr[ErrCnt] = param & ": " & params[i];
															// ErrCnt = ErrCnt + 1;
															BTRxColorr.Code = "CL99999";
															TrHs = true;
															while (LoopBackKey("Code",BTRxColorr,1,TrHs)) begin
																OldCode = BTRxColorr.Code;
																TrHs = false;
															end;
															ResetLoop(BTRxColorr);
															recordnew(BTRxColorr);
															if(blank(OldCode))then begin OldCode = "CL00000"; end;
															NextCode(OldCode,BTRxColorr.Code);
															BTRxColorr.Name = params[i];
															recordinsert(BTRxColorr,true);
															recordupdate(BTRxColorr,BTRxColorr,true);
															GIr.BTRxProdColour = BTRxColorr.Code;
															res = true;
															OldCode = "";
														end;
													end;
												end;
			case"Cert":				GIr.Cert = params[i];
			case"Warranty":		GIr.BtrxWarranty = params[i];
			case"ScratchRes":	GIr.BtrxScratchRes = params[i];
			case"isLimit":		if(params[i]=="1")then begin GIr.BTRxLimitedGood = 1; end;
			case"Mech":				if(blank(params[i]))then begin
													GIr.BTRxWatchMechanism = "";
												end else begin
													BtrxWatchMechanr.Name = trim(params[i]);
													if(readfirstkey("Name",BtrxWatchMechanr,1,true))then begin
														GIr.BTRxWatchMechanism = BtrxWatchMechanr.Code;
													end else begin
														BtrxWatchMechanr.Code = params[i];
														if(readfirstmain(BtrxWatchMechanr,1,true))then begin
															GIr.BTRxWatchMechanism = BtrxWatchMechanr.Code;
														end else begin
															// GIr.BTRxWatchMechanism = "";
															// ErrAr[ErrCnt] = param & ": " & params[i];
															// ErrAr2[ErrCnt] = param & chr(09) & params[i];
															// ErrCnt = ErrCnt + 1;
															BtrxWatchMechanr.Code = "WTMEC9999";
															TrHs = true;
															while (LoopBackKey("Code",BtrxWatchMechanr,1,TrHs)) begin
																OldCode = BtrxWatchMechanr.Code;
																TrHs = false;
															end;
															ResetLoop(BtrxWatchMechanr);
															recordnew(BtrxWatchMechanr);
															if(blank(OldCode))then begin OldCode = "WTMEC0000"; end;
															NextCode(OldCode,BtrxWatchMechanr.Code);
															BtrxWatchMechanr.Name = params[i];
															recordinsert(BtrxWatchMechanr,true);
															recordupdate(BtrxWatchMechanr,BtrxWatchMechanr,true);
															GIr.BTRxWatchMechanism = BtrxWatchMechanr.Code;
															res = true;
															OldCode = "";
														end;
													end;
												end;
			case"LifeTime":		if(blank(params[i]))then begin
													GIr.BTRxPowerReserve = "";
												end else begin
													BtrxPowerReserver.Name = trim(params[i]);
													if(readfirstkey("Name",BtrxPowerReserver,1,true))then begin
														GIr.BTRxPowerReserve = BtrxPowerReserver.Code;
													end else begin
														BtrxPowerReserver.Code = params[i];
														if(readfirstmain(BtrxPowerReserver,1,true))then begin
															GIr.BTRxPowerReserve = BtrxPowerReserver.Code;
														end else begin
															// GIr.BTRxPowerReserve = "";
															// ErrAr[ErrCnt] = param & ": " & params[i];
															// ErrAr2[ErrCnt] = param & chr(09) & params[i];
															// ErrCnt = ErrCnt + 1;
															BtrxPowerReserver.Code = "PWRES9999";
															TrHs = true;
															while (LoopBackKey("Code",BtrxPowerReserver,1,TrHs)) begin
																OldCode = BtrxPowerReserver.Code;
																TrHs = false;
															end;
															ResetLoop(BtrxPowerReserver);
															recordnew(BtrxPowerReserver);
															if(blank(OldCode))then begin OldCode = "PWRES0000"; end;
															NextCode(OldCode,BtrxPowerReserver.Code);
															BtrxPowerReserver.Name = params[i];
															recordinsert(BtrxPowerReserver,true);
															recordupdate(BtrxPowerReserver,BtrxPowerReserver,true);
															GIr.BTRxPowerReserve = BtrxPowerReserver.Code;
															res = true;
															OldCode = "";
														end;
													end;
												end;
			case"Strap":			if(blank(params[i]))then begin
													GIr.BPIStrap = "";
												end else begin
													BTRxStrapr.Name = trim(params[i]);
													if(readfirstkey("Name",BTRxStrapr,1,true))then begin
														GIr.BPIStrap = BTRxStrapr.Code;
													end else begin
														BTRxStrapr.Code = params[i];
														if(readfirstmain(BTRxStrapr,1,true))then begin
															GIr.BPIStrap = BTRxStrapr.Code;
														end else begin
															// GIr.BPIStrap = "";
															// ErrAr[ErrCnt] = param & ": " & params[i];
															// ErrAr2[ErrCnt] = param & chr(09) & params[i];
															// ErrCnt = ErrCnt + 1;
															BTRxStrapr.Code = "STRP99999";
															TrHs = true;
															while (LoopBackKey("Code",BTRxStrapr,1,TrHs)) begin
																OldCode = BTRxStrapr.Code;
																TrHs = false;
															end;
															ResetLoop(BTRxStrapr);
															recordnew(BTRxStrapr);
															if(blank(OldCode))then begin OldCode = "STRP00000"; end;
															NextCode(OldCode,BTRxStrapr.Code);
															BTRxStrapr.Name = params[i];
															recordinsert(BTRxStrapr,true);
															recordupdate(BTRxStrapr,BTRxStrapr,true);
															GIr.BPIStrap = BTRxStrapr.Code;
															res = true;
															OldCode = "";
														end;
													end;
												end;
			case"StClolor":		if(blank(params[i]))then begin
													GIr.BTRxStrapColour = "";
												end else begin
													BTRxColorr.Name = trim(params[i]);
													if(readfirstkey("Name",BTRxColorr,1,true))then begin
														GIr.BTRxStrapColour = BTRxColorr.Code;
													end else begin
														BTRxColorr.Code = params[i];
														if(readfirstmain(BTRxColorr,1,true))then begin
															GIr.BTRxStrapColour = BTRxColorr.Code;
														end else begin
															// GIr.BTRxStrapColour = "";
															// ErrAr[ErrCnt] = param & ": " & params[i];
															// ErrAr2[ErrCnt] = param & chr(09) & params[i];
															// ErrCnt = ErrCnt + 1;
															BTRxColorr.Code = "CL99999";
															TrHs = true;
															while (LoopBackKey("Code",BTRxColorr,1,TrHs)) begin
																OldCode = BTRxColorr.Code;
																TrHs = false;
															end;
															ResetLoop(BTRxColorr);
															recordnew(BTRxColorr);
															if(blank(OldCode))then begin OldCode = "CL00000"; end;
															NextCode(OldCode,BTRxColorr.Code);
															BTRxColorr.Name = params[i];
															recordinsert(BTRxColorr,true);
															recordupdate(BTRxColorr,BTRxColorr,true);
															GIr.BTRxStrapColour = BTRxColorr.Code;
															res = true;
															OldCode = "";
														end;
													end;
												end;
			case"Com1":				if(blank(params[i]))then begin
													GIr.BTRxWatchGradeA = "";
												end else begin
													BtrxWatchGrader.Name = trim(params[i]);
													if(readfirstkey("Name",BtrxWatchGrader,1,true))then begin
														GIr.BTRxWatchGradeA = BtrxWatchGrader.Code;
													end else begin
														BtrxWatchGrader.Code = params[i];
														if(readfirstmain(BtrxWatchGrader,1,true))then begin
															GIr.BTRxWatchGradeA = BtrxWatchGrader.Code;
														end else begin
															// GIr.BTRxWatchGradeA = "";
															// ErrAr[ErrCnt] = param & ": " & params[i];
															// ErrAr2[ErrCnt] = param & chr(09) & params[i];
															// ErrCnt = ErrCnt + 1;
															BtrxWatchGrader.Code = "WTGRD9999";
															TrHs = true;
															while (LoopBackKey("Code",BtrxWatchGrader,1,TrHs)) begin
																OldCode = BtrxWatchGrader.Code;
																TrHs = false;
															end;
															ResetLoop(BtrxWatchGrader);
															recordnew(BtrxWatchGrader);
															if(blank(OldCode))then begin OldCode = "WTGRD0000"; end;
															NextCode(OldCode,BtrxWatchGrader.Code);
															BtrxWatchGrader.Name = params[i];
															recordinsert(BtrxWatchGrader,true);
															recordupdate(BtrxWatchGrader,BtrxWatchGrader,true);
															GIr.BTRxWatchGradeA = BtrxWatchGrader.Code;
															res = true;
															OldCode = "";
														end;
													end;
												end;
			case"Com2":				if(blank(params[i]))then begin
													GIr.BTRxWatchGradeB = "";
												end else begin
													BtrxWatchGrader.Name = trim(params[i]);
													if(readfirstkey("Name",BtrxWatchGrader,1,true))then begin
														GIr.BTRxWatchGradeB = BtrxWatchGrader.Code;
													end else begin
														BtrxWatchGrader.Code = params[i];
														if(readfirstmain(BtrxWatchGrader,1,true))then begin
															GIr.BTRxWatchGradeB = BtrxWatchGrader.Code;
														end else begin
															// GIr.BTRxWatchGradeB = "";
															// ErrAr[ErrCnt] = param & ": " & params[i];
															// ErrAr2[ErrCnt] = param & chr(09) & params[i];
															// ErrCnt = ErrCnt + 1;
															BtrxWatchGrader.Code = "WTGRD9999";
															TrHs = true;
															while (LoopBackKey("Code",BtrxWatchGrader,1,TrHs)) begin
																OldCode = BtrxWatchGrader.Code;
																TrHs = false;
															end;
															ResetLoop(BtrxWatchGrader);
															recordnew(BtrxWatchGrader);
															if(blank(OldCode))then begin OldCode = "WTGRD0000"; end;
															NextCode(OldCode,BtrxWatchGrader.Code);
															BtrxWatchGrader.Name = params[i];
															recordinsert(BtrxWatchGrader,true);
															recordupdate(BtrxWatchGrader,BtrxWatchGrader,true);
															GIr.BTRxWatchGradeB = BtrxWatchGrader.Code;
															res = true;
															OldCode = "";
														end;
													end;
												end;
			case"Com3":				if(blank(params[i]))then begin
													GIr.BTRxWatchGradeC = "";
												end else begin
													BtrxWatchGrader.Name = trim(params[i]);
													if(readfirstkey("Name",BtrxWatchGrader,1,true))then begin
														GIr.BTRxWatchGradeC = BtrxWatchGrader.Code;
													end else begin
														BtrxWatchGrader.Code = params[i];
														if(readfirstmain(BtrxWatchGrader,1,true))then begin
															GIr.BTRxWatchGradeC = BtrxWatchGrader.Code;
														end else begin
															// GIr.BTRxWatchGradeC = "";
															// ErrAr[ErrCnt] = param & ": " & params[i];
															// ErrAr2[ErrCnt] = param & chr(09) & params[i];
															// ErrCnt = ErrCnt + 1;
															BtrxWatchGrader.Code = "WTGRD9999";
															TrHs = true;
															while (LoopBackKey("Code",BtrxWatchGrader,1,TrHs)) begin
																OldCode = BtrxWatchGrader.Code;
																TrHs = false;
															end;
															ResetLoop(BtrxWatchGrader);
															recordnew(BtrxWatchGrader);
															if(blank(OldCode))then begin OldCode = "WTGRD0000"; end;
															NextCode(OldCode,BtrxWatchGrader.Code);
															BtrxWatchGrader.Name = params[i];
															recordinsert(BtrxWatchGrader,true);
															recordupdate(BtrxWatchGrader,BtrxWatchGrader,true);
															GIr.BTRxWatchGradeC = BtrxWatchGrader.Code;
															res = true;
															OldCode = "";
														end;
													end;
												end;
			case"Stone1":			if(blank(params[i]))then begin
													GIr.BTRxStoneA = "";
												end else begin
													BTRxStoner.Name = trim(params[i]);
													if(readfirstkey("Name",BTRxStoner,1,true))then begin
														GIr.BTRxStoneA = BTRxStoner.Code;
													end else begin
														BTRxStoner.Code = params[i];
														if(readfirstmain(BTRxStoner,1,true))then begin
															GIr.BTRxStoneA = BTRxStoner.Code;
														end else begin
															// GIr.BTRxStoneA = "";
															// ErrAr[ErrCnt] = param & ": " & params[i];
															// ErrAr2[ErrCnt] = param & chr(09) & params[i];
															// ErrCnt = ErrCnt + 1;
															BTRxStoner.Code = "STN99999";
															TrHs = true;
															while (LoopBackKey("Code",BTRxStoner,1,TrHs)) begin
																OldCode = BTRxStoner.Code;
																TrHs = false;
															end;
															ResetLoop(BTRxStoner);
															recordnew(BTRxStoner);
															if(blank(OldCode))then begin OldCode = "STN00000"; end;
															NextCode(OldCode,BTRxStoner.Code);
															BTRxStoner.Name = params[i];
															recordinsert(BTRxStoner,true);
															recordupdate(BTRxStoner,BTRxStoner,true);
															GIr.BTRxStoneA = BTRxStoner.Code;
															res = true;
															OldCode = "";
														end;
													end;
												end;
			case"Carat1":			GIr.BTRxStoneScattA = stringtoval(params[i],m4val);
			case"Stone2":			if(blank(params[i]))then begin
													GIr.BTRxStoneB = "";
												end else begin
													BTRxStoner.Name = trim(params[i]);
													if(readfirstkey("Name",BTRxStoner,1,true))then begin
														GIr.BTRxStoneB = BTRxStoner.Code;
													end else begin
														BTRxStoner.Code = params[i];
														if(readfirstmain(BTRxStoner,1,true))then begin
															GIr.BTRxStoneB = BTRxStoner.Code;
														end else begin
															// GIr.BTRxStoneB = "";
															// ErrAr[ErrCnt] = param & ": " & params[i];
															// ErrAr2[ErrCnt] = param & chr(09) & params[i];
															// ErrCnt = ErrCnt + 1;
															BTRxStoner.Code = "STN99999";
															TrHs = true;
															while (LoopBackKey("Code",BTRxStoner,1,TrHs)) begin
																OldCode = BTRxStoner.Code;
																TrHs = false;
															end;
															ResetLoop(BTRxStoner);
															recordnew(BTRxStoner);
															if(blank(OldCode))then begin OldCode = "STN00000"; end;
															NextCode(OldCode,BTRxStoner.Code);
															BTRxStoner.Name = params[i];
															recordinsert(BTRxStoner,true);
															recordupdate(BTRxStoner,BTRxStoner,true);
															GIr.BTRxStoneB = BTRxStoner.Code;
															res = true;
															OldCode = "";
														end;
													end;
												end;
			case"Carat2":			GIr.BTRxStoneScattB = stringtoval(params[i],m4val);
			case"Stone3":			if(blank(params[i]))then begin
													GIr.BTRxStoneC = "";
												end else begin
													BTRxStoner.Name = trim(params[i]);
													if(readfirstkey("Name",BTRxStoner,1,true))then begin
														GIr.BTRxStoneC = BTRxStoner.Code;
													end else begin
														BTRxStoner.Code = params[i];
														if(readfirstmain(BTRxStoner,1,true))then begin
															GIr.BTRxStoneC = BTRxStoner.Code;
														end else begin
															// GIr.BTRxStoneC = "";
															// ErrAr[ErrCnt] = param & ": " & params[i];
															// ErrAr2[ErrCnt] = param & chr(09) & params[i];
															// ErrCnt = ErrCnt + 1;
															BTRxStoner.Code = "STN99999";
															TrHs = true;
															while (LoopBackKey("Code",BTRxStoner,1,TrHs)) begin
																OldCode = BTRxStoner.Code;
																TrHs = false;
															end;
															ResetLoop(BTRxStoner);
															recordnew(BTRxStoner);
															if(blank(OldCode))then begin OldCode = "STN00000"; end;
															NextCode(OldCode,BTRxStoner.Code);
															BTRxStoner.Name = params[i];
															recordinsert(BTRxStoner,true);
															recordupdate(BTRxStoner,BTRxStoner,true);
															GIr.BTRxStoneC = BTRxStoner.Code;
															res = true;
															OldCode = "";
														end;
													end;
												end;
			case"Carat3":			GIr.BTRxStoneScattC = stringtoval(params[i],m4val);
			case"AllCarat":		GIr.BTRxPlacerScatt = stringtoval(params[i],m4val);
											
			case"Color":			if(blank(params[i]))then begin
													GIr.BPIColor = "";
												end else begin
													BTRxColorr.Name = trim(params[i]);
													if(readfirstkey("Name",BTRxColorr,1,true))then begin
														GIr.BPIColor = BTRxColorr.Code;
													end else begin
														BTRxColorr.Code = params[i];
														if(readfirstmain(BTRxColorr,1,true))then begin
															GIr.BPIColor = BTRxColorr.Code;
														end else begin
															// GIr.BPIColor = "";
															// ErrAr[ErrCnt] = param & ": " & params[i];
															// ErrAr2[ErrCnt] = param & chr(09) & params[i];
															// ErrCnt = ErrCnt + 1;
															BTRxColorr.Code = "CL99999";
															TrHs = true;
															while (LoopBackKey("Code",BTRxColorr,1,TrHs)) begin
																OldCode = BTRxColorr.Code;
																TrHs = false;
															end;
															ResetLoop(BTRxColorr);
															recordnew(BTRxColorr);
															if(blank(OldCode))then begin OldCode = "CL00000"; end;
															NextCode(OldCode,BTRxColorr.Code);
															BTRxColorr.Name = params[i];
															recordinsert(BTRxColorr,true);
															recordupdate(BTRxColorr,BTRxColorr,true);
															GIr.BPIColor = BTRxColorr.Code;
															res = true;
															OldCode = "";
														end;
													end;
												end;
			case"Odour":			if(blank(params[i]))then begin
													GIr.BPIOdour = "";
												end else begin
													BTRxOdourr.Name = trim(params[i]);
													if(readfirstkey("Name",BTRxOdourr,1,true))then begin
														GIr.BPIOdour = BTRxOdourr.Code;
													end else begin
														BTRxOdourr.Code = params[i];
														if(readfirstmain(BTRxOdourr,1,true))then begin
															GIr.BPIOdour = BTRxOdourr.Code;
														end else begin
															// GIr.BPIOdour = "";
															// ErrAr[ErrCnt] = param & ": " & params[i];
															// ErrAr2[ErrCnt] = param & chr(09) & params[i];
															// ErrCnt = ErrCnt + 1;
															BTRxOdourr.Code = "ODR99999";
															TrHs = true;
															while (LoopBackKey("Code",BTRxOdourr,1,TrHs)) begin
																OldCode = BTRxOdourr.Code;
																TrHs = false;
															end;
															ResetLoop(BTRxOdourr);
															recordnew(BTRxOdourr);
															if(blank(OldCode))then begin OldCode = "ODR00000"; end;
															NextCode(OldCode,BTRxOdourr.Code);
															BTRxOdourr.Name = params[i];
															recordinsert(BTRxOdourr,true);
															recordupdate(BTRxOdourr,BTRxOdourr,true);
															GIr.BPIOdour = BTRxOdourr.Code;
															res = true;
															OldCode = "";
														end;
													end;
												end;
			case"Phone":			if(blank(params[i]))then begin
													GIr.BTRxPhoneModel = "";
												end else begin
													BtrxPhoneModelr.Name = params[i];
													if(readfirstkey("Name",BtrxPhoneModelr,1,true))then begin
														GIr.BTRxPhoneModel = BtrxPhoneModelr.Code;
													end else begin
														BtrxPhoneModelr.Code = trim(params[i]);
														if(readfirstmain(BtrxPhoneModelr,1,true))then begin
															GIr.BTRxPhoneModel = BtrxPhoneModelr.Code;
														end else begin
															// GIr.BTRxPhoneModel = "";
															// ErrAr[ErrCnt] = param & ": " & params[i];
															// ErrAr2[ErrCnt] = param & chr(09) & params[i];
															// ErrCnt = ErrCnt + 1;
															BtrxPhoneModelr.Code = "PHMOD9999";
															TrHs = true;
															while (LoopBackKey("Code",BtrxPhoneModelr,1,TrHs)) begin
																OldCode = BtrxPhoneModelr.Code;
																TrHs = false;
															end;
															ResetLoop(BtrxPhoneModelr);
															recordnew(BtrxPhoneModelr);
															if(blank(OldCode))then begin OldCode = "PHMOD0000"; end;
															NextCode(OldCode,BtrxPhoneModelr.Code);
															BtrxPhoneModelr.Name = params[i];
															recordinsert(BtrxPhoneModelr,true);
															recordupdate(BtrxPhoneModelr,BtrxPhoneModelr,true);
															GIr.BTRxPhoneModel = BtrxPhoneModelr.Code;
															res = true;
															OldCode = "";
														end;
													end;
												end;
			case"ChaninMat":	if(blank(params[i]))then begin
													GIr.BTRxChainMaterial = "";
												end else begin
													BTRxMaterialr.Name = trim(params[i]);
													if(readfirstkey("Name",BTRxMaterialr,1,true))then begin
														GIr.BTRxChainMaterial = BTRxMaterialr.Code;
													end else begin
														BTRxMaterialr.Code = params[i];
														if(readfirstmain(BTRxMaterialr,1,true))then begin
															GIr.BTRxChainMaterial = BTRxMaterialr.Code;
														end else begin
															// GIr.BTRxChainMaterial = "";
															// ErrAr[ErrCnt] = param & ": " & params[i];
															// ErrAr2[ErrCnt] = param & chr(09) & params[i];
															// ErrCnt = ErrCnt + 1;
															BTRxMaterialr.Code = "MATR99999";
															TrHs = true;
															while (LoopBackKey("Code",BTRxMaterialr,1,TrHs)) begin
																OldCode = BTRxMaterialr.Code;
																TrHs = false;
															end;
															ResetLoop(BTRxMaterialr);
															recordnew(BTRxMaterialr);
															if(blank(OldCode))then begin OldCode = "MATR00000"; end;
															NextCode(OldCode,BTRxMaterialr.Code);
															BTRxMaterialr.Name = params[i];
															recordinsert(BTRxMaterialr,true);
															recordupdate(BTRxMaterialr,BTRxMaterialr,true);
															GIr.BTRxChainMaterial = BTRxMaterialr.Code;
															res = true;
															OldCode = "";
														end;
													end;
												end;
			case"Fill":				if(blank(params[i]))then begin
													GIr.BTRxFilling = "";
												end else begin
													BtrxFillingr.Name = trim(params[i]);
													if(readfirstkey("Name",BtrxFillingr,1,true))then begin
														GIr.BTRxFilling = BtrxFillingr.Code;
													end else begin
														BtrxFillingr.Code = params[i];
														if(readfirstmain(BtrxFillingr,1,true))then begin
															GIr.BTRxFilling = BtrxFillingr.Code;
														end else begin
															// GIr.BTRxFilling = "";
															// ErrAr[ErrCnt] = param & ": " & params[i];
															// ErrAr2[ErrCnt] = param & chr(09) & params[i];
															// ErrCnt = ErrCnt + 1;
															BtrxFillingr.Code = "FILLN9999";
															TrHs = true;
															while (LoopBackKey("Code",BtrxFillingr,1,TrHs)) begin
																OldCode = BtrxFillingr.Code;
																TrHs = false;
															end;
															ResetLoop(BtrxFillingr);
															recordnew(BtrxFillingr);
															if(blank(OldCode))then begin OldCode = "FILLN0000"; end;
															NextCode(OldCode,BtrxFillingr.Code);
															BtrxFillingr.Name = params[i];
															recordinsert(BtrxFillingr,true);
															recordupdate(BtrxFillingr,BtrxFillingr,true);
															GIr.BTRxFilling = BtrxFillingr.Code;
															res = true;
															OldCode = "";
														end;
													end;
												end;
			case"WaterRes":		if(blank(params[i]))then begin
													GIr.BTRxWatterRes = "";
												end else begin
													BtrxWatResr.Name = trim(params[i]);
													if(readfirstkey("Name",BtrxWatResr,1,true))then begin
														GIr.BTRxWatterRes = BtrxWatResr.Code;
													end else begin
														BtrxWatResr.Code = params[i];
														if(readfirstmain(BtrxWatResr,1,true))then begin
															GIr.BTRxWatterRes = BtrxWatResr.Code;
														end else begin
															// GIr.BTRxWatterRes = "";
															// ErrAr[ErrCnt] = param & ": " & params[i];
															// ErrAr2[ErrCnt] = param & chr(09) & params[i];
															// ErrCnt = ErrCnt + 1;
															BtrxWatResr.Code = "WTRS9999";
															TrHs = true;
															while (LoopBackKey("Code",BtrxWatResr,1,TrHs)) begin
																OldCode = BtrxWatResr.Code;
																TrHs = false;
															end;
															ResetLoop(BtrxWatResr);
															recordnew(BtrxWatResr);
															if(blank(OldCode))then begin OldCode = "WTRS0000"; end;
															NextCode(OldCode,BtrxWatResr.Code);
															BtrxWatResr.Name = params[i];
															recordinsert(BtrxWatResr,true);
															recordupdate(BtrxWatResr,BtrxWatResr,true);
															GIr.BTRxWatterRes = BtrxWatResr.Code;
															res = true;
															OldCode = "";
														end;
													end;
												end;
			case"StrapMat":		if(blank(params[i]))then begin
													GIr.BTRxStrapMat = "";
												end else begin
													BTRxMaterialr.Name = trim(params[i]);
													if(readfirstkey("Name",BTRxMaterialr,1,true))then begin
														GIr.BTRxStrapMat = BTRxMaterialr.Code;
													end else begin
														BTRxMaterialr.Code = params[i];
														if(readfirstmain(BTRxMaterialr,1,true))then begin
															GIr.BTRxStrapMat = BTRxMaterialr.Code;
														end else begin
															// GIr.BTRxStrapMat = "";
															// ErrAr[ErrCnt] = param & ": " & params[i];
															// ErrAr2[ErrCnt] = param & chr(09) & params[i];
															// ErrCnt = ErrCnt + 1;
															BTRxMaterialr.Code = "MATR99999";
															TrHs = true;
															while (LoopBackKey("Code",BTRxMaterialr,1,TrHs)) begin
																OldCode = BTRxMaterialr.Code;
																TrHs = false;
															end;
															ResetLoop(BTRxMaterialr);
															recordnew(BTRxMaterialr);
															if(blank(OldCode))then begin OldCode = "MATR00000"; end;
															NextCode(OldCode,BTRxMaterialr.Code);
															BTRxMaterialr.Name = params[i];
															recordinsert(BTRxMaterialr,true);
															recordupdate(BTRxMaterialr,BTRxMaterialr,true);
															GIr.BTRxStrapMat = BTRxMaterialr.Code;
															res = true;
															OldCode = "";
														end;
													end;
												end;
			case"BracelMat":		if(blank(params[i]))then begin
													GIr.BTRxBracelMat = "";
												end else begin
													BTRxMaterialr.Name = trim(params[i]);
													if(readfirstkey("Name",BTRxMaterialr,1,true))then begin
														GIr.BTRxBracelMat = BTRxMaterialr.Code;
													end else begin
														BTRxMaterialr.Code = params[i];
														if(readfirstmain(BTRxMaterialr,1,true))then begin
															GIr.BTRxBracelMat = BTRxMaterialr.Code;
														end else begin
															// GIr.BTRxBracelMat = "";
															// ErrAr[ErrCnt] = param & ": " & params[i];
															// ErrAr2[ErrCnt] = param & chr(09) & params[i];
															// ErrCnt = ErrCnt + 1;
															BTRxMaterialr.Code = "MATR99999";
															TrHs = true;
															while (LoopBackKey("Code",BTRxMaterialr,1,TrHs)) begin
																OldCode = BTRxMaterialr.Code;
																TrHs = false;
															end;
															ResetLoop(BTRxMaterialr);
															recordnew(BTRxMaterialr);
															if(blank(OldCode))then begin OldCode = "MATR00000"; end;
															NextCode(OldCode,BTRxMaterialr.Code);
															BTRxMaterialr.Name = params[i];
															recordinsert(BTRxMaterialr,true);
															recordupdate(BTRxMaterialr,BTRxMaterialr,true);
															GIr.BTRxBracelMat = BTRxMaterialr.Code;
															res = true;
															OldCode = "";
														end;
													end;
												end;
				case"Collection":		if(blank(params[i]))then begin
															GIr.BtrxCollection = "";
														end else begin
															BtrxCollectionr.Name = trim(params[i]);
															if(readfirstkey("Name",BtrxCollectionr,1,true))then begin
																GIr.BtrxCollection = BtrxCollectionr.Code;
															end else begin
																BtrxCollectionr.Code = params[i];
																if(readfirstmain(BtrxCollectionr,1,true))then begin
																	GIr.BtrxCollection = BtrxCollectionr.Code;
																end else begin
																	// GIr.BTRxBracelMat = "";
																	// ErrAr[ErrCnt] = param & ": " & params[i];
																	// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																	// ErrCnt = ErrCnt + 1;
																	BtrxCollectionr.Code = "COLL9999";
																	TrHs = true;
																	while (LoopBackKey("Code",BtrxCollectionr,1,TrHs)) begin
																		OldCode = BtrxCollectionr.Code;
																		TrHs = false;
																	end;
																	ResetLoop(BtrxCollectionr);
																	recordnew(BtrxCollectionr);
																	if(blank(OldCode))then begin OldCode = "COLL0000"; end;
																	NextCode(OldCode,BtrxCollectionr.Code);
																	BtrxCollectionr.Name = params[i];
																	recordinsert(BtrxCollectionr,true);
																	recordupdate(BtrxCollectionr,BtrxCollectionr,true);
																	GIr.BtrxCollection = BtrxCollectionr.Code;
																	res = true;
																	OldCode = "";
																end;
															end;
														end;
				case"ClockFaceColour":	if(blank(params[i]))then begin
																	GIr.BtrxClockFaceColour = "";
																end else begin
																	BTRxColorr.Name = trim(params[i]);
																	if(readfirstkey("Name",BTRxColorr,1,true))then begin
																		GIr.BtrxClockFaceColour = BTRxColorr.Code;
																	end else begin
																		BTRxColorr.Code = params[i];
																		if(readfirstmain(BTRxColorr,1,true))then begin
																			GIr.BtrxClockFaceColour = BTRxColorr.Code;
																		end else begin
																			// GIr.BTRxBracelMat = "";
																			// ErrAr[ErrCnt] = param & ": " & params[i];
																			// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																			// ErrCnt = ErrCnt + 1;
																			BTRxColorr.Code = "CL99999";
																			TrHs = true;
																			while (LoopBackKey("Code",BTRxColorr,1,TrHs)) begin
																				OldCode = BTRxColorr.Code;
																				TrHs = false;
																			end;
																			ResetLoop(BTRxColorr);
																			recordnew(BTRxColorr);
																			if(blank(OldCode))then begin OldCode = "CL00000"; end;
																			NextCode(OldCode,BTRxColorr.Code);
																			BTRxColorr.Name = params[i];
																			recordinsert(BTRxColorr,true);
																			recordupdate(BTRxColorr,BTRxColorr,true);
																			GIr.BtrxClockFaceColour = BTRxColorr.Code;
																			res = true;
																			OldCode = "";
																		end;
																	end;
																end;
																
				case"Complications":	if(blank(params[i]))then begin
																	GIr.BtrxComplications = "";
																end else begin
																	BtrxComplicationsr.Name = trim(params[i]);
																	if(readfirstkey("Name",BtrxComplicationsr,1,true))then begin
																		GIr.BtrxComplications = BtrxComplicationsr.Code;
																	end else begin
																		BtrxComplicationsr.Code = params[i];
																		if(readfirstmain(BtrxComplicationsr,1,true))then begin
																			GIr.BtrxComplications = BtrxComplicationsr.Code;
																		end else begin
																			// GIr.BTRxBracelMat = "";
																			// ErrAr[ErrCnt] = param & ": " & params[i];
																			// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																			// ErrCnt = ErrCnt + 1;
																			BtrxComplicationsr.Code = "CMP99999";
																			TrHs = true;
																			while (LoopBackKey("Code",BtrxComplicationsr,1,TrHs)) begin
																				OldCode = BtrxComplicationsr.Code;
																				TrHs = false;
																			end;
																			ResetLoop(BtrxComplicationsr);
																			recordnew(BtrxComplicationsr);
																			if(blank(OldCode))then begin OldCode = "CMP00000"; end;
																			NextCode(OldCode,newCode);
																			BtrxComplicationsr.Name = params[i];
																			BtrxComplicationsr.Code = newCode;
																			recordinsert(BtrxComplicationsr,true);
																			recordupdate(BtrxComplicationsr,BtrxComplicationsr,true);
																			GIr.BtrxComplications = BtrxComplicationsr.Code;
																			res = true;
																			OldCode = "";
																		end;
																	end;
																end;
				case"ClockFaceMaterial":	if(blank(params[i]))then begin
																	GIr.BtrxClockFaceMaterial = "";
																end else begin
																	BTRxMaterialr.Name = trim(params[i]);
																	if(readfirstkey("Name",BTRxMaterialr,1,true))then begin
																		GIr.BtrxClockFaceMaterial = BTRxMaterialr.Code;
																	end else begin
																		BTRxMaterialr.Code = params[i];
																		if(readfirstmain(BTRxMaterialr,1,true))then begin
																			GIr.BtrxClockFaceMaterial = BTRxMaterialr.Code;
																		end else begin
																			// GIr.BTRxBracelMat = "";
																			// ErrAr[ErrCnt] = param & ": " & params[i];
																			// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																			// ErrCnt = ErrCnt + 1;
																			BTRxMaterialr.Code = "MATR99999";
																			TrHs = true;
																			while (LoopBackKey("Code",BTRxMaterialr,1,TrHs)) begin
																				OldCode = BTRxMaterialr.Code;
																				TrHs = false;
																			end;
																			ResetLoop(BTRxMaterialr);
																			recordnew(BTRxMaterialr);
																			if(blank(OldCode))then begin OldCode = "MATR00000"; end;
																			NextCode(OldCode,BTRxMaterialr.Code);
																			BTRxMaterialr.Name = params[i];
																			recordinsert(BTRxMaterialr,true);
																			recordupdate(BTRxMaterialr,BTRxMaterialr,true);
																			GIr.BtrxClockFaceMaterial = BTRxMaterialr.Code;
																			res = true;
																			OldCode = "";
																		end;
																	end;
																end;
				case"MicrowaveProtect":	if(blank(params[i]))then begin
																	GIr.BtrxMicrowaveProtect = "";
																end else begin
																	BtrxMicrowaveProtectr.Name = trim(params[i]);
																	if(readfirstkey("Name",BtrxMicrowaveProtectr,1,true))then begin
																		GIr.BtrxMicrowaveProtect = BtrxMicrowaveProtectr.Code;
																	end else begin
																		BtrxMicrowaveProtectr.Code = params[i];
																		if(readfirstmain(BtrxMicrowaveProtectr,1,true))then begin
																			GIr.BtrxMicrowaveProtect = BtrxMicrowaveProtectr.Code;
																		end else begin
																			// GIr.BTRxBracelMat = "";
																			// ErrAr[ErrCnt] = param & ": " & params[i];
																			// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																			// ErrCnt = ErrCnt + 1;
																			BtrxMicrowaveProtectr.Code = "MPR99999";
																			TrHs = true;
																			while (LoopBackKey("Code",BtrxMicrowaveProtectr,1,TrHs)) begin
																				OldCode = BtrxMicrowaveProtectr.Code;
																				TrHs = false;
																			end;
																			ResetLoop(BtrxMicrowaveProtectr);
																			recordnew(BtrxMicrowaveProtectr);
																			if(blank(OldCode))then begin OldCode = "MPR00000"; end;
																			NextCode(OldCode,BtrxMicrowaveProtectr.Code);
																			BtrxMicrowaveProtectr.Name = params[i];
																			recordinsert(BtrxMicrowaveProtectr,true);
																			recordupdate(BtrxMicrowaveProtectr,BtrxMicrowaveProtectr,true);
																			GIr.BtrxMicrowaveProtect = BtrxMicrowaveProtectr.Code;
																			res = true;
																			OldCode = "";
																		end;
																	end;
																end;
				case"StoveCompat":			if(blank(params[i]))then begin
																	GIr.BtrxStoveCompat = "";
																end else begin
																	BtrxStoveCompatr.Name = trim(params[i]);
																	if(readfirstkey("Name",BtrxStoveCompatr,1,true))then begin
																		GIr.BtrxStoveCompat = BtrxStoveCompatr.Code;
																	end else begin
																		BtrxStoveCompatr.Code = params[i];
																		if(readfirstmain(BtrxStoveCompatr,1,true))then begin
																			GIr.BtrxStoveCompat = BtrxStoveCompatr.Code;
																		end else begin
																			// GIr.BTRxBracelMat = "";
																			// ErrAr[ErrCnt] = param & ": " & params[i];
																			// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																			// ErrCnt = ErrCnt + 1;
																			BtrxStoveCompatr.Code = "STC99999";
																			TrHs = true;
																			while (LoopBackKey("Code",BtrxStoveCompatr,1,TrHs)) begin
																				OldCode = BtrxStoveCompatr.Code;
																				TrHs = false;
																			end;
																			ResetLoop(BtrxStoveCompatr);
																			recordnew(BtrxStoveCompatr);
																			if(blank(OldCode))then begin OldCode = "STC00000"; end;
																			NextCode(OldCode,BtrxStoveCompatr.Code);
																			BtrxStoveCompatr.Name = params[i];
																			recordinsert(BtrxStoveCompatr,true);
																			recordupdate(BtrxStoveCompatr,BtrxStoveCompatr,true);
																			GIr.BtrxStoveCompat = BtrxStoveCompatr.Code;
																			res = true;
																			OldCode = "";
																		end;
																	end;
																end;
				case"AllMaterials":			if(blank(params[i]))then begin
																	GIr.BtrxAllMaterials = "";
																end else begin
																	BtrxAllMaterialsr.Name = trim(params[i]);
																	if(readfirstkey("Name",BtrxAllMaterialsr,1,true))then begin
																		GIr.BtrxAllMaterials = BtrxAllMaterialsr.Code;
																	end else begin
																		BtrxAllMaterialsr.Code = params[i];
																		if(readfirstmain(BtrxAllMaterialsr,1,true))then begin
																			GIr.BtrxAllMaterials = BtrxAllMaterialsr.Code;
																		end else begin
																			// GIr.BTRxBracelMat = "";
																			// ErrAr[ErrCnt] = param & ": " & params[i];
																			// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																			// ErrCnt = ErrCnt + 1;
																			BtrxAllMaterialsr.Code = "AM999999";
																			TrHs = true;
																			while (LoopBackKey("Code",BtrxAllMaterialsr,1,TrHs)) begin
																				OldCode = BtrxAllMaterialsr.Code;
																				TrHs = false;
																			end;
																			ResetLoop(BtrxAllMaterialsr);
																			recordnew(BtrxAllMaterialsr);
																			if(blank(OldCode))then begin OldCode = "AM000000"; end;
																			NextCode(OldCode,BtrxAllMaterialsr.Code);
																			BtrxAllMaterialsr.Name = params[i];
																			recordinsert(BtrxAllMaterialsr,true);
																			recordupdate(BtrxAllMaterialsr,BtrxAllMaterialsr,true);
																			GIr.BtrxAllMaterials = BtrxAllMaterialsr.Code;
																			res = true;
																			OldCode = "";
																		end;
																	end;
																end;
				case"MetalCont":			if(blank(params[i]))then begin
																	GIr.BtrxPrecMetalCont = "";
																end else begin
																	BtrxPrecMetalContr.Name = trim(params[i]);
																	if(readfirstkey("Name",BtrxPrecMetalContr,1,true))then begin
																		GIr.BtrxPrecMetalCont = BtrxPrecMetalContr.Code;
																	end else begin
																		BtrxPrecMetalContr.Code = params[i];
																		if(readfirstmain(BtrxPrecMetalContr,1,true))then begin
																			GIr.BtrxPrecMetalCont = BtrxPrecMetalContr.Code;
																		end else begin
																			// GIr.BTRxBracelMat = "";
																			// ErrAr[ErrCnt] = param & ": " & params[i];
																			// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																			// ErrCnt = ErrCnt + 1;
																			BtrxPrecMetalContr.Code = "PMC99999";
																			TrHs = true;
																			while (LoopBackKey("Code",BtrxPrecMetalContr,1,TrHs)) begin
																				OldCode = BtrxPrecMetalContr.Code;
																				TrHs = false;
																			end;
																			ResetLoop(BtrxPrecMetalContr);
																			recordnew(BtrxPrecMetalContr);
																			if(blank(OldCode))then begin OldCode = "PMC00000"; end;
																			NextCode(OldCode,BtrxPrecMetalContr.Code);
																			BtrxPrecMetalContr.Name = params[i];
																			recordinsert(BtrxPrecMetalContr,true);
																			recordupdate(BtrxPrecMetalContr,BtrxPrecMetalContr,true);
																			GIr.BtrxPrecMetalCont = BtrxPrecMetalContr.Code;
																			res = true;
																			OldCode = "";
																		end;
																	end;
																end;
				case"CaseDiam":			if(blank(params[i]))then begin
																	GIr.BtrxCaseDiam = "";
																end else begin
																	BtrxCaseDiamr.Name = trim(params[i]);
																	if(readfirstkey("Name",BtrxCaseDiamr,1,true))then begin
																		GIr.BtrxCaseDiam = BtrxCaseDiamr.Code;
																	end else begin
																		BtrxCaseDiamr.Code = params[i];
																		if(readfirstmain(BtrxCaseDiamr,1,true))then begin
																			GIr.BtrxCaseDiam = BtrxCaseDiamr.Code;
																		end else begin
																			// GIr.BTRxBracelMat = "";
																			// ErrAr[ErrCnt] = param & ": " & params[i];
																			// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																			// ErrCnt = ErrCnt + 1;
																			BtrxCaseDiamr.Code = "CD999999";
																			TrHs = true;
																			while (LoopBackKey("Code",BtrxCaseDiamr,1,TrHs)) begin
																				OldCode = BtrxCaseDiamr.Code;
																				TrHs = false;
																			end;
																			ResetLoop(BtrxCaseDiamr);
																			recordnew(BtrxCaseDiamr);
																			if(blank(OldCode))then begin OldCode = "CD000000"; end;
																			NextCode(OldCode,BtrxCaseDiamr.Code);
																			BtrxCaseDiamr.Name = params[i];
																			recordinsert(BtrxCaseDiamr,true);
																			recordupdate(BtrxCaseDiamr,BtrxCaseDiamr,true);
																			GIr.BtrxCaseDiam = BtrxCaseDiamr.Code;
																			res = true;
																			OldCode = "";
																		end;
																	end;
																end;
				case"PF1":		if(nonblank(params[i]))then begin
												if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
													if(nonblank(GIr.BTRxThirdLevCat))then begin
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
													end;
													GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
												end;
												if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
													if(nonblank(GIr.BTRxGiftClass))then begin
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
													end;
													GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
												end;
											end;
				case"PF10":		if(nonblank(params[i]))then begin
												if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
													if(nonblank(GIr.BTRxThirdLevCat))then begin
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
													end;
													GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
												end;
												if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
													if(nonblank(GIr.BTRxGiftClass))then begin
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
													end;
													GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
												end;
											end;
				case"PF11":		if(nonblank(params[i]))then begin
												if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
													if(nonblank(GIr.BTRxThirdLevCat))then begin
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
													end;
													GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
												end;
												if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
													if(nonblank(GIr.BTRxGiftClass))then begin
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
													end;
													GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
												end;
											end;
				case"PF2":		if(nonblank(params[i]))then begin
												if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
													if(nonblank(GIr.BTRxThirdLevCat))then begin
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
													end;
													GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
												end;
												if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
													if(nonblank(GIr.BTRxGiftClass))then begin
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
													end;
													GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
												end;
											end;
				case"PF3":		if(nonblank(params[i]))then begin
												if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
													if(nonblank(GIr.BTRxThirdLevCat))then begin
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
													end;
													GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
												end;
												if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
													if(nonblank(GIr.BTRxGiftClass))then begin
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
													end;
													GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
												end;
											end;
				case"PF4":		if(nonblank(params[i]))then begin
												if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
													if(nonblank(GIr.BTRxThirdLevCat))then begin
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
													end;
													GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
												end;
												if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
													if(nonblank(GIr.BTRxGiftClass))then begin
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
													end;
													GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
												end;
											end;
				case"PF5":		if(nonblank(params[i]))then begin
												if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
													if(nonblank(GIr.BTRxThirdLevCat))then begin
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
													end;
													GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
												end;
												if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
													if(nonblank(GIr.BTRxGiftClass))then begin
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
													end;
													GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
												end;
											end;
				case"PF6":		if(nonblank(params[i]))then begin
												if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
													if(nonblank(GIr.BTRxThirdLevCat))then begin
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
													end;
													GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
												end;
												if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
													if(nonblank(GIr.BTRxGiftClass))then begin
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
													end;
													GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
												end;
											end;
				case"PF7":		if(nonblank(params[i]))then begin
												if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
													if(nonblank(GIr.BTRxThirdLevCat))then begin
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
													end;
													GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
												end;
												if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
													if(nonblank(GIr.BTRxGiftClass))then begin
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
													end;
													GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
												end;
											end;
				case"PF8":		if(nonblank(params[i]))then begin
												if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
													if(nonblank(GIr.BTRxThirdLevCat))then begin
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
													end;
													GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
												end;
												if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
													if(nonblank(GIr.BTRxGiftClass))then begin
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
													end;
													GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
												end;
											end;
				case"PF9":		if(nonblank(params[i]))then begin
												if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
													if(nonblank(GIr.BTRxThirdLevCat))then begin
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
													end;
													GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
												end;
												if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
													if(nonblank(GIr.BTRxGiftClass))then begin
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
													end;
													GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
												end;
											end;
				case"PG1":		if(nonblank(params[i]))then begin
												if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
													if(nonblank(GIr.BTRxThirdLevCat))then begin
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
													end;
													GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
												end;
												if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
													if(nonblank(GIr.BTRxGiftClass))then begin
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
													end;
													GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
												end;
											end;
				case"PG2":		if(nonblank(params[i]))then begin
												if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
													if(nonblank(GIr.BTRxThirdLevCat))then begin
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
													end;
													GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
												end;
												if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
													if(nonblank(GIr.BTRxGiftClass))then begin
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
													end;
													GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
												end;
											end;
				case"PG3":		if(nonblank(params[i]))then begin
												if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
													if(nonblank(GIr.BTRxThirdLevCat))then begin
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
													end;
													GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
												end;
												if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
													if(nonblank(GIr.BTRxGiftClass))then begin
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
													end;
													GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
												end;
											end;
				case"PO1":		if(nonblank(params[i]))then begin
												if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
													if(nonblank(GIr.BTRxThirdLevCat))then begin
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
													end;
													GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
												end;
												if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
													if(nonblank(GIr.BTRxGiftClass))then begin
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
													end;
													GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
												end;
											end;
				case"PO10":		if(nonblank(params[i]))then begin
												if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
													if(nonblank(GIr.BTRxThirdLevCat))then begin
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
													end;
													GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
												end;
												if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
													if(nonblank(GIr.BTRxGiftClass))then begin
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
													end;
													GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
												end;
											end;
				case"PO11":		if(nonblank(params[i]))then begin
												if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
													if(nonblank(GIr.BTRxThirdLevCat))then begin
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
													end;
													GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
												end;
												if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
													if(nonblank(GIr.BTRxGiftClass))then begin
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
													end;
													GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
												end;
											end;
				case"PO12":		if(nonblank(params[i]))then begin
												if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
													if(nonblank(GIr.BTRxThirdLevCat))then begin
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
													end;
													GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
												end;
												if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
													if(nonblank(GIr.BTRxGiftClass))then begin
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
													end;
													GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
												end;
											end;
				case"PO2":		if(nonblank(params[i]))then begin
												if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
													if(nonblank(GIr.BTRxThirdLevCat))then begin
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
													end;
													GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
												end;
												if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
													if(nonblank(GIr.BTRxGiftClass))then begin
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
													end;
													GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
												end;
											end;
				case"PO3":		if(nonblank(params[i]))then begin
												if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
													if(nonblank(GIr.BTRxThirdLevCat))then begin
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
													end;
													GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
												end;
												if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
													if(nonblank(GIr.BTRxGiftClass))then begin
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
													end;
													GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
												end;
											end;
				case"PO4":		if(nonblank(params[i]))then begin
												if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
													if(nonblank(GIr.BTRxThirdLevCat))then begin
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
													end;
													GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
												end;
												if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
													if(nonblank(GIr.BTRxGiftClass))then begin
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
													end;
													GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
												end;
											end;
				case"PO5":		if(nonblank(params[i]))then begin
												if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
													if(nonblank(GIr.BTRxThirdLevCat))then begin
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
													end;
													GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
												end;
												if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
													if(nonblank(GIr.BTRxGiftClass))then begin
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
													end;
													GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
												end;
											end;
				case"PO6":		if(nonblank(params[i]))then begin
												if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
													if(nonblank(GIr.BTRxThirdLevCat))then begin
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
													end;
													GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
												end;
												if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
													if(nonblank(GIr.BTRxGiftClass))then begin
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
													end;
													GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
												end;
											end;
				case"PO7":		if(nonblank(params[i]))then begin
												if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
													if(nonblank(GIr.BTRxThirdLevCat))then begin
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
													end;
													GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
												end;
												if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
													if(nonblank(GIr.BTRxGiftClass))then begin
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
													end;
													GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
												end;
											end;
				case"PO8":		if(nonblank(params[i]))then begin
												if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
													if(nonblank(GIr.BTRxThirdLevCat))then begin
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
													end;
													GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
												end;
												if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
													if(nonblank(GIr.BTRxGiftClass))then begin
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
													end;
													GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
												end;
											end;
				case"PO9":		if(nonblank(params[i]))then begin
												if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
													if(nonblank(GIr.BTRxThirdLevCat))then begin
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
													end;
													GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
												end;
												if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
													if(nonblank(GIr.BTRxGiftClass))then begin
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
													end;
													GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
												end;
											end;
				
				otherwise 
											ErrAr[ErrCnt] = USetStr(36352) & " \"" & param & "\" " & ": " & params[i];
											ErrAr2[ErrCnt] = param & chr(09) & params[i];
											ErrCnt = ErrCnt + 1;
end;
	end;
	SetItemBitrixClass = res;
return;
end;











global
updating procedure SetItemBitrixClassQueued(var record GlobalItemVc GIr,array string headers,array string params, var array string ErrAr, var integer ErrCnt,var array string ErrAr2,var vector string classCode, string finRow)
begin
	record BTRxBrandVc BTRxBrandr;
	record BTRxMaterialVc BTRxMaterialr;
	record BTRxColourVc BTRxColorr;
	record BTRxSizeVc BTRxSizer;
	record BTRxSexVc BTRxSexr;
	record BTRxPlatingVc BTRxPlatingr;
	record BTRxStoneVc BTRxStoner;
	record BTRxStrapVc BTRxStrapr;
	record BTRxOdourVc BTRxOdourr;
	record BtrxInternalCatVc BtrxInternalCatr;
	record BtrxFirstLevelCatVc BtrxFirstLevelCatr;
	record BtrxSecondLevelCatVc BtrxSecondLevelCatr, BSLLastCoder;
	record BtrxThirdLevelCatVc BtrxThirdLevelCatr, BTLLastCoder;
	record BtrxFourthLevelCatVc BtrxFourthLevelCatr, BFLLastCoder;
	record BtrxCertificateVc BtrxCertificater;
	record BtrxWatchMechanVc BtrxWatchMechanr;
	record BtrxPowerReserveVc BtrxPowerReserver;
	record BtrxWatchGradeVc BtrxWatchGrader;
	record BtrxPhoneModelVc BtrxPhoneModelr;
	record BtrxFillingVc BtrxFillingr;
	record BtrxTypeVc BtrxTyper;
	record BtrxWaterResistantVc BtrxWatResr;
	record BtrxStrapMatVc BtrxStrapMatr;
	record BtrxBracelMatVc BtrxBracelMatr;
	record BtrxCollectionVc BtrxCollectionr;
	record BtrxComplicationsVc BtrxComplicationsr;
	record BtrxMicrowaveProtectVc BtrxMicrowaveProtectr;
	record BtrxStoveCompatVc BtrxStoveCompatr;
	record BtrxAllMaterialsVc BtrxAllMaterialsr;
	record BtrxPrecMetalContVc BtrxPrecMetalContr;
	record BtrxCaseDiamVc BtrxCaseDiamr;
	record JSONClassNamesVc JCNr;
	record GlobalItemVc LogGIr;
	
	integer i, pos;
	string 100 param, OldCode, newCode;
	boolean res, TrHs, testf, THRDf, catrtreef, createdf;
	string 255 catName, catNameRUS, catNameAZ, parametr, paramsStr, Name3catrus, Name3cataz, tree3Code;
	
	SetCompany(1,false);
	newCode = "";
	GIr.BTRxGiftClass = "";
	readfirstMain(GIr,1,true);
	res = true;
	logtext(0,"SetItemBitrixClassQueued" & GIr.Code);
	recordcopy(LogGIr,GIr);
	for(i=0;i<headers.length;i=i+1)begin
		param = headers[i];
		params[i] = trim(params[i]);
		if (left(params[i],5)=="JSON_") then begin
			// JCNr.Code = right(params[i],len(params[i])-5);
			// if (!ReadFirstMain(JCNr,1,true)) then begin
				// recordNew(JCNr);
				// JCNr.Code = right(params[i],len(params[i])-5);
			// end;
			// FillClassInM4Text(GIr,JCNr.Code,JCNr.Name,JCNr.NameRUS,JCNr.NameAZ,BAMr.Name,BAMr.NameRUS,BAMr.NameAZ);
		end else begin
			switch(param)begin
				case"Brand": 			if(blank(params[i]))then begin
														GIr.BPIBrand = "";
													end else begin
														BTRxBrandr.Name = params[i];
														if(readfirstkey("Name",BTRxBrandr,1,true))then begin
															GIr.BPIBrand = BTRxBrandr.Code;
														end else begin
															BTRxBrandr.Code = params[i];
															if(readfirstmain(BTRxBrandr,1,true))then begin
																GIr.BPIBrand = BTRxBrandr.Code;
															end else begin
																GIr.BPIBrand = "";
																 // BTRxBrandr.Code = "BRND9999";
																 // TrHs = true;
																 // while (LoopBackKey("Code",BTRxBrandr,1,TrHs)) begin
																	 // OldCode = BTRxBrandr.Code;
																	 // TrHs = false;
																 // end;
																 // ResetLoop(BTRxBrandr);
																 // recordnew(BTRxBrandr);
																 // if(blank(OldCode))then begin OldCode = "BRND0000"; end;
																 // NextCode(OldCode,BTRxBrandr.Code);
																 // BTRxBrandr.Name = params[i];
																 // recordinsert(BTRxBrandr,true);
																 // recordupdate(BTRxBrandr,BTRxBrandr,true);
																 // GIr.BPIBrand = BTRxBrandr.Code;
																 // res = true;
																 // OldCode = "";
															end;
														end;
													end;
				case"IntCat": 		if(blank(params[i]))then begin
														GIr.BTRxInterCatClass = "";
													end else begin
														BtrxInternalCatr.Name = trim(params[i]);
														if(readfirstkey("Name",BtrxInternalCatr,1,true))then begin
															GIr.BTRxInterCatClass = BtrxInternalCatr.Code;
														end else begin
															BtrxInternalCatr.Code = params[i];
															if(readfirstmain(BtrxInternalCatr,1,true))then begin
																GIr.BTRxInterCatClass = BtrxInternalCatr.Code;
															end else begin
																// GIr.BTRxInterCatClass = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																BtrxInternalCatr.Code = "INCAT9999";
																TrHs = true;
																while (LoopBackKey("Code",BtrxInternalCatr,1,TrHs)) begin
																	OldCode = BtrxInternalCatr.Code;
																	TrHs = false;
																end;
																ResetLoop(BtrxInternalCatr);
																recordnew(BtrxInternalCatr);
																if(blank(OldCode))then begin OldCode = "INCAT0000"; end;
																NextCode(OldCode,BtrxInternalCatr.Code);
																BtrxInternalCatr.Name = params[i];
																recordinsert(BtrxInternalCatr,true);
																recordupdate(BtrxInternalCatr,BtrxInternalCatr,true);
																GIr.BTRxInterCatClass = BtrxInternalCatr.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
				case"Type": 			if(blank(params[i]))then begin
														GIr.BTRxType = "";
													end else begin
														BtrxTyper.Name = trim(params[i]);
														if(readfirstkey("Name",BtrxTyper,1,true))then begin
															GIr.BTRxType = BtrxTyper.Code;
														end else begin
															BtrxTyper.Code = params[i];
															if(readfirstmain(BtrxTyper,1,true))then begin
																GIr.BTRxType = BtrxTyper.Code;
															end else begin
																// GIr.BTRxType = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																BtrxTyper.Code = "BTYPE9999";
																TrHs = true;
																while (LoopBackKey("Code",BtrxTyper,1,TrHs)) begin
																	OldCode = BtrxTyper.Code;
																	TrHs = false;
																end;
																ResetLoop(BtrxTyper);
																recordnew(BtrxTyper);
																if(blank(OldCode))then begin OldCode = "BTYPE0000"; end;
																NextCode(OldCode,BtrxTyper.Code);
																BtrxTyper.Name = params[i];
																recordinsert(BtrxTyper,true);
																recordupdate(BtrxTyper,BtrxTyper,true);
																GIr.BTRxType = BtrxTyper.Code;
																res = true;
																OldCode = "";
															end;
														end;					
													end;
				case"Cat1":				if(blank(params[i]))then begin
														GIr.BTRxFirstLevCat = "";
													end else begin
														pos = 0;
														BtrxFirstLevelCatr.Name = "";
														paramsStr = "";
														parametr = trim(params[i]);
														// ExtractObjWithSeparator("_",parametr,true,pos,paramsStr);
														// while (nonblank(paramsStr)) begin
															// if(nonblank(BtrxFirstLevelCatr.Name))then begin
																// BtrxFirstLevelCatr.Name = BtrxFirstLevelCatr.Name & " ";
															// end;
															// BtrxFirstLevelCatr.Name = BtrxFirstLevelCatr.Name & paramsStr;
															// ExtractObjWithSeparator("_",parametr,true,pos,paramsStr);
														// end;
														BtrxFirstLevelCatr.Name = parametr;
														if(readfirstkey("Name",BtrxFirstLevelCatr,1,true))then begin
															GIr.BTRxFirstLevCat = BtrxFirstLevelCatr.Code;
														end else begin
															BtrxFirstLevelCatr.Code = params[i];
															if(readfirstmain(BtrxFirstLevelCatr,1,true))then begin
																GIr.BTRxFirstLevCat = BtrxFirstLevelCatr.Code;
															end else begin
																// GIr.BTRxFirstLevCat = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																// logtext(0,"yes");
																BtrxFirstLevelCatr.Code = "FILVL9999";
																TrHs = true;
																while (LoopBackKey("Code",BtrxFirstLevelCatr,1,TrHs)) begin
																	OldCode = BtrxFirstLevelCatr.Code;
																	TrHs = false;
																end;
																ResetLoop(BtrxFirstLevelCatr);
																recordnew(BtrxFirstLevelCatr);
																if(blank(OldCode))then begin OldCode = "FILVL0000"; end;
																NextCode(OldCode,BtrxFirstLevelCatr.Code);
																BtrxFirstLevelCatr.Name = params[i];
																recordinsert(BtrxFirstLevelCatr,true);
																recordupdate(BtrxFirstLevelCatr,BtrxFirstLevelCatr,true);
																GIr.BTRxFirstLevCat = BtrxFirstLevelCatr.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
				case"Cat2":				if(blank(params[i]))then begin
														GIr.BTRxSecondLevCat = "";
													end else begin
														pos = 0;
														BtrxSecondLevelCatr.Name = "";
														paramsStr = "";
														parametr = trim(params[i]);
														// ExtractObjWithSeparator("_",parametr,true,pos,paramsStr);
														// while (nonblank(paramsStr)) begin
															// if(nonblank(BtrxSecondLevelCatr.Name))then begin
																// BtrxSecondLevelCatr.Name = BtrxSecondLevelCatr.Name & " ";
															// end;
															// BtrxSecondLevelCatr.Name = BtrxSecondLevelCatr.Name & paramsStr;
															// ExtractObjWithSeparator("_",parametr,true,pos,paramsStr);
														// end;
														
														resetloop(BtrxSecondLevelCatr);
														BtrxSecondLevelCatr.Name = trim(params[i]);
														TrHs = true;
														while(loopkey("Name",BtrxSecondLevelCatr,1,TrHs))begin
															if(BtrxSecondLevelCatr.Name!=params[i])then begin TrHs = false; end;
															
															if(TrHs)then begin
																if(BtrxSecondLevelCatr.PathFrstCode==GIr.BTRxFirstLevCat)then begin
																	GIr.BTRxSecondLevCat = BtrxSecondLevelCatr.Code;
																end;
															end;
														end;
														
														// BtrxSecondLevelCatr.Name = parametr;
														// if(readfirstkey("Name",BtrxSecondLevelCatr,1,true))then begin
															// GIr.BTRxSecondLevCat = BtrxSecondLevelCatr.Code;
														// end else begin
															// BtrxSecondLevelCatr.Code = params[i];
															// if(readfirstmain(BtrxSecondLevelCatr,1,true))then begin
																// GIr.BTRxSecondLevCat = BtrxSecondLevelCatr.Code;
															// end else begin
																// GIr.BTRxSecondLevCat = "";
															// end;
														// end;
													end;
				case"Cat3":				if(blank(params[i]))then begin
														GIr.BTRxThirdLevCat = GIr.BTRxGiftClass;
													end else begin
														TrHs = true;
														resetloop(BtrxThirdLevelCatr);
														BtrxThirdLevelCatr.Name = trim(params[i]);
														while(loopkey("Name",BtrxThirdLevelCatr,1,TrHs))begin
															if(BtrxThirdLevelCatr.Name!=params[i])then begin TrHs = false; end;
															
															if(TrHs)then begin
																if(BtrxThirdLevelCatr.PathScndCode==GIr.BTRxSecondLevCat)then begin
																	if(nonblank(GIr.BTRxGiftClass))then begin
																		GIr.BTRxThirdLevCat = BtrxThirdLevelCatr.Code & "," & GIr.BTRxGiftClass;
																	end else begin
																		GIr.BTRxThirdLevCat = BtrxThirdLevelCatr.Code;
																	end;
																end;
															end;
														end;
														
													end;
													/*if(blank(params[i]))then begin
														GIr.BTRxThirdLevCat = "";
													end else begin
														pos = 0;
														BtrxThirdLevelCatr.Name = "";
														paramsStr = "";
														parametr = params[i];
														ExtractObjWithSeparator("_",parametr,true,pos,paramsStr);
														while (nonblank(paramsStr)) begin
															if(nonblank(BtrxThirdLevelCatr.Name))then begin
																BtrxThirdLevelCatr.Name = BtrxThirdLevelCatr.Name & " ";
															end;
															BtrxThirdLevelCatr.Name = BtrxThirdLevelCatr.Name & paramsStr;
															ExtractObjWithSeparator("_",parametr,true,pos,paramsStr);
														end;
														if(readfirstkey("Name",BtrxThirdLevelCatr,1,true))then begin
															Name3catrus = BtrxThirdLevelCatr.NameRUS;
															Name3cataz = BtrxThirdLevelCatr.NameAZ;
															if(BtrxThirdLevelCatr.RelatedTo==GIr.BTRxSecondLevCat)then begin
																if(nonblank(GIr.BTRxThirdLevCat))then begin
																	GIr.BTRxThirdLevCat = "," & GIr.BTRxThirdLevCat;
																end;
																GIr.BTRxThirdLevCat = BtrxThirdLevelCatr.Code & GIr.BTRxThirdLevCat;
																pos = 0;
																BtrxThirdLevelCatr.Name = "";
																paramsStr = "";
																parametr = GIr.BTRxThirdLevCat;
																GIr.BTRxThirdLevCat = "";
																ExtractObjWithSeparator(",",parametr,true,pos,paramsStr);
																THRDf = false;
																while (nonblank(paramsStr)) begin
																	BtrxThirdLevelCatr.Name = paramsStr;
																	if(ReadFirstMain(BtrxThirdLevelCatr,1,true) and !THRDf)then begin
																		THRDf = true;
																		if(nonblank(GIr.BTRxThirdLevCat))then begin GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ","; end;
																		GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & paramsStr;
																	end else begin
																		BtrxThirdLevelCatr.Name = paramsStr;
																		if(!ReadFirstMain(BtrxThirdLevelCatr,1,true)) then begin
																			if(nonblank(GIr.BTRxThirdLevCat))then begin GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ","; end;
																			GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & paramsStr;
																		end;
																	end;
																	ExtractObjWithSeparator(",",parametr,true,pos,paramsStr);
																end;
															end else begin

															end;
														end else begin
															BtrxThirdLevelCatr.Code = params[i];
															if(readfirstmain(BtrxThirdLevelCatr,1,true))then begin
																GIr.BTRxThirdLevCat = BtrxThirdLevelCatr.Code;
															end else begin
																GIr.BTRxThirdLevCat = "";
																ErrAr[ErrCnt] = param & ": " & params[i];
																ErrAr2[ErrCnt] = param & chr(09) & params[i];
																ErrCnt = ErrCnt + 1;
															end;
														end;
													end;*/
				case"Cat4":				if(blank(params[i]))then begin
														GIr.BTRxFourthLevCat = "";
													end else begin
														TrHs = true;
														resetloop(BtrxFourthLevelCatr);
														BtrxFourthLevelCatr.Name = trim(params[i]);
														while(loopkey("Name",BtrxFourthLevelCatr,1,TrHs))begin
															if(BtrxFourthLevelCatr.Name!=params[i])then begin TrHs = false; end;
															if(TrHs)then begin
																if(BtrxFourthLevelCatr.PathThirdCode==GIr.BTRxThirdLevCat)then begin
																		GIr.BTRxFourthLevCat = BtrxFourthLevelCatr.Code;
																end;
															end;
														end;
													end;
													/*if(blank(params[i]))then begin
														GIr.BTRxThirdLevCat = "";
													end else begin
														pos = 0;
														BtrxThirdLevelCatr.Name = "";
														paramsStr = "";
														parametr = params[i];
														ExtractObjWithSeparator("_",parametr,true,pos,paramsStr);
														while (nonblank(paramsStr)) begin
															if(nonblank(BtrxThirdLevelCatr.Name))then begin
																BtrxThirdLevelCatr.Name = BtrxThirdLevelCatr.Name & " ";
															end;
															BtrxThirdLevelCatr.Name = BtrxThirdLevelCatr.Name & paramsStr;
															ExtractObjWithSeparator("_",parametr,true,pos,paramsStr);
														end;
														if(readfirstkey("Name",BtrxThirdLevelCatr,1,true))then begin
															Name3catrus = BtrxThirdLevelCatr.NameRUS;
															Name3cataz = BtrxThirdLevelCatr.NameAZ;
															if(BtrxThirdLevelCatr.RelatedTo==GIr.BTRxSecondLevCat)then begin
																if(nonblank(GIr.BTRxThirdLevCat))then begin
																	GIr.BTRxThirdLevCat = "," & GIr.BTRxThirdLevCat;
																end;
																GIr.BTRxThirdLevCat = BtrxThirdLevelCatr.Code & GIr.BTRxThirdLevCat;
																pos = 0;
																BtrxThirdLevelCatr.Name = "";
																paramsStr = "";
																parametr = GIr.BTRxThirdLevCat;
																GIr.BTRxThirdLevCat = "";
																ExtractObjWithSeparator(",",parametr,true,pos,paramsStr);
																THRDf = false;
																while (nonblank(paramsStr)) begin
																	BtrxThirdLevelCatr.Name = paramsStr;
																	if(ReadFirstMain(BtrxThirdLevelCatr,1,true) and !THRDf)then begin
																		THRDf = true;
																		if(nonblank(GIr.BTRxThirdLevCat))then begin GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ","; end;
																		GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & paramsStr;
																	end else begin
																		BtrxThirdLevelCatr.Name = paramsStr;
																		if(!ReadFirstMain(BtrxThirdLevelCatr,1,true)) then begin
																			if(nonblank(GIr.BTRxThirdLevCat))then begin GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ","; end;
																			GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & paramsStr;
																		end;
																	end;
																	ExtractObjWithSeparator(",",parametr,true,pos,paramsStr);
																end;
															end else begin

															end;
														end else begin
															BtrxThirdLevelCatr.Code = params[i];
															if(readfirstmain(BtrxThirdLevelCatr,1,true))then begin
																GIr.BTRxThirdLevCat = BtrxThirdLevelCatr.Code;
															end else begin
																GIr.BTRxThirdLevCat = "";
																ErrAr[ErrCnt] = param & ": " & params[i];
																ErrAr2[ErrCnt] = param & chr(09) & params[i];
																ErrCnt = ErrCnt + 1;
															end;
														end;
													end;*/
				case"Name":				if(nonblank(params[i]))then begin GIr.Name = params[i]; end;
				case"NameRUS":		if(nonblank(params[i]))then begin GIr.NameRUS = params[i]; end;
				case"NameAZ":			if(nonblank(params[i]))then begin GIr.NameAZ = params[i]; end;
				case"Material":		if(blank(params[i]))then begin
														GIr.BPIMaterial = "";
													end else begin
														BTRxMaterialr.Name = trim(params[i]);
														if(readfirstkey("Name",BTRxMaterialr,1,true))then begin
															GIr.BPIMaterial = BTRxMaterialr.Code;
														end else begin
															BTRxMaterialr.Code = params[i];
															if(readfirstmain(BTRxMaterialr,1,true))then begin
																GIr.BPIMaterial = BTRxMaterialr.Code;
															end else begin
																// GIr.BPIMaterial = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																BTRxMaterialr.Code = "MATR99999";
																TrHs = true;
																while (LoopBackKey("Code",BTRxMaterialr,1,TrHs)) begin
																	OldCode = BTRxMaterialr.Code;
																	TrHs = false;
																end;
																ResetLoop(BTRxMaterialr);
																recordnew(BTRxMaterialr);
																if(blank(OldCode))then begin OldCode = "MATR00000"; end;
																NextCode(OldCode,BTRxMaterialr.Code);
																BTRxMaterialr.Name = params[i];
																recordinsert(BTRxMaterialr,true);
																recordupdate(BTRxMaterialr,BTRxMaterialr,true);
																GIr.BPIMaterial = BTRxMaterialr.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
				case"Plating":		if(blank(params[i]))then begin
														GIr.BPIPlating = "";
													end else begin
														BTRxPlatingr.Name = trim(params[i]);
														if(readfirstkey("Name",BTRxPlatingr,1,true))then begin
															GIr.BPIPlating = BTRxPlatingr.Code;
														end else begin
															BTRxPlatingr.Code = params[i];
															if(readfirstmain(BTRxPlatingr,1,true))then begin
																GIr.BPIPlating = BTRxPlatingr.Code;
															end else begin
																// GIr.BPIPlating = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																BTRxPlatingr.Code = "PLAT99999";
																TrHs = true;
																while (LoopBackKey("Code",BTRxPlatingr,1,TrHs)) begin
																	OldCode = BTRxPlatingr.Code;
																	TrHs = false;
																end;
																ResetLoop(BTRxPlatingr);
																recordnew(BTRxPlatingr);
																if(blank(OldCode))then begin OldCode = "PLAT00000"; end;
																NextCode(OldCode,BTRxPlatingr.Code);
																BTRxPlatingr.Name = params[i];
																recordinsert(BTRxPlatingr,true);
																recordupdate(BTRxPlatingr,BTRxPlatingr,true);
																GIr.BPIPlating = BTRxPlatingr.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
				case"Gender":			if(blank(params[i]))then begin
														GIr.BPISex = "";
													end else begin
														BTRxSexr.Name = trim(params[i]);
														if(readfirstkey("Name",BTRxSexr,1,true))then begin
															GIr.BPISex = BTRxSexr.Code;
														end else begin
															BTRxSexr.Code = params[i];
															if(readfirstmain(BTRxSexr,1,true))then begin
																GIr.BPISex = BTRxSexr.Code;
															end else begin
																// GIr.BPISex = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																BTRxSexr.Code = "SEX99999";
																TrHs = true;
																while (LoopBackKey("Code",BTRxSexr,1,TrHs)) begin
																	OldCode = BTRxSexr.Code;
																	TrHs = false;
																end;
																ResetLoop(BTRxSexr);
																recordnew(BTRxSexr);
																if(blank(OldCode))then begin OldCode = "SEX00000"; end;
																NextCode(OldCode,BTRxSexr.Code);
																BTRxSexr.Name = params[i];
																recordinsert(BTRxSexr,true);
																recordupdate(BTRxSexr,BTRxSexr,true);
																GIr.BPISex = BTRxSexr.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
				case"Size":				if(blank(params[i]))then begin
														GIr.BPISize = "";
													end else begin
														if (GIr.HansaCode == "R17080OX52") then begin end;
														BTRxSizer.Name = trim(params[i]);
														if(readfirstkey("Name",BTRxSizer,1,true))then begin
															GIr.BPISize = BTRxSizer.Code;
														end else begin
															BTRxSizer.Code = params[i];
															if(readfirstmain(BTRxSizer,1,true))then begin
																GIr.BPISize = BTRxSizer.Code;
															end else begin
																// GIr.BPISize = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																BTRxSizer.Code = "SZ99999";
																TrHs = true;
																while (LoopBackKey("Code",BTRxSizer,1,TrHs)) begin
																	OldCode = BTRxSizer.Code;
																	TrHs = false;
																end;
																ResetLoop(BTRxSizer);
																recordnew(BTRxSizer);
																if(blank(OldCode))then begin OldCode = "SZ00000"; end;
																NextCode(OldCode,BTRxSizer.Code);
																BTRxSizer.Name = params[i];
																recordinsert(BTRxSizer,true);
																recordupdate(BTRxSizer,BTRxSizer,true);
																GIr.BPISize = BTRxSizer.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
				case"Weight":			GIr.StrWeight = params[i];
				case"Volume":			GIr.StrVolume = params[i];
				case"Diameter":		GIr.StrBTRxDiam = params[i];
				case"Width":			GIr.StrWidth = params[i];
				case"Length":			GIr.StrDepth = params[i];
				case"Height":			GIr.StrHeight = params[i];
				case"SetQty":			GIr.StrBTRxSetQty = params[i];
				case"FinGirth":		GIr.BTRxFingerGirth = params[i];
				case"ProdColor":	if(blank(params[i]))then begin
														GIr.BTRxProdColour = "";
													end else begin
														BTRxColorr.Name = trim(params[i]);
														if(readfirstkey("Name",BTRxColorr,1,true))then begin
															GIr.BTRxProdColour = BTRxColorr.Code;
														end else begin
															BTRxColorr.Code = params[i];
															if(readfirstmain(BTRxColorr,1,true))then begin
																GIr.BTRxProdColour = BTRxColorr.Code;
															end else begin
																// GIr.BTRxProdColour = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrCnt = ErrCnt + 1;
																BTRxColorr.Code = "CL99999";
																TrHs = true;
																while (LoopBackKey("Code",BTRxColorr,1,TrHs)) begin
																	OldCode = BTRxColorr.Code;
																	TrHs = false;
																end;
																ResetLoop(BTRxColorr);
																recordnew(BTRxColorr);
																if(blank(OldCode))then begin OldCode = "CL00000"; end;
																NextCode(OldCode,BTRxColorr.Code);
																BTRxColorr.Name = params[i];
																recordinsert(BTRxColorr,true);
																recordupdate(BTRxColorr,BTRxColorr,true);
																GIr.BTRxProdColour = BTRxColorr.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
				case"Cert":				GIr.Cert = params[i];
				case"Warranty":		GIr.BtrxWarranty = params[i];
				case"ScratchRes":	GIr.BtrxScratchRes = params[i];
				case"isLimit":		if(params[i]=="1")then begin GIr.BTRxLimitedGood = 1; end;
				case"Mech":				if(blank(params[i]))then begin
														GIr.BTRxWatchMechanism = "";
													end else begin
														BtrxWatchMechanr.Name = trim(params[i]);
														if(readfirstkey("Name",BtrxWatchMechanr,1,true))then begin
															GIr.BTRxWatchMechanism = BtrxWatchMechanr.Code;
														end else begin
															BtrxWatchMechanr.Code = params[i];
															if(readfirstmain(BtrxWatchMechanr,1,true))then begin
																GIr.BTRxWatchMechanism = BtrxWatchMechanr.Code;
															end else begin
																// GIr.BTRxWatchMechanism = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																BtrxWatchMechanr.Code = "WTMEC9999";
																TrHs = true;
																while (LoopBackKey("Code",BtrxWatchMechanr,1,TrHs)) begin
																	OldCode = BtrxWatchMechanr.Code;
																	TrHs = false;
																end;
																ResetLoop(BtrxWatchMechanr);
																recordnew(BtrxWatchMechanr);
																if(blank(OldCode))then begin OldCode = "WTMEC0000"; end;
																NextCode(OldCode,BtrxWatchMechanr.Code);
																BtrxWatchMechanr.Name = params[i];
																recordinsert(BtrxWatchMechanr,true);
																recordupdate(BtrxWatchMechanr,BtrxWatchMechanr,true);
																GIr.BTRxWatchMechanism = BtrxWatchMechanr.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
				case"LifeTime":		if(blank(params[i]))then begin
														GIr.BTRxPowerReserve = "";
													end else begin
														BtrxPowerReserver.Name = trim(params[i]);
														if(readfirstkey("Name",BtrxPowerReserver,1,true))then begin
															GIr.BTRxPowerReserve = BtrxPowerReserver.Code;
														end else begin
															BtrxPowerReserver.Code = params[i];
															if(readfirstmain(BtrxPowerReserver,1,true))then begin
																GIr.BTRxPowerReserve = BtrxPowerReserver.Code;
															end else begin
																// GIr.BTRxPowerReserve = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																BtrxPowerReserver.Code = "PWRES9999";
																TrHs = true;
																while (LoopBackKey("Code",BtrxPowerReserver,1,TrHs)) begin
																	OldCode = BtrxPowerReserver.Code;
																	TrHs = false;
																end;
																ResetLoop(BtrxPowerReserver);
																recordnew(BtrxPowerReserver);
																if(blank(OldCode))then begin OldCode = "PWRES0000"; end;
																NextCode(OldCode,BtrxPowerReserver.Code);
																BtrxPowerReserver.Name = params[i];
																recordinsert(BtrxPowerReserver,true);
																recordupdate(BtrxPowerReserver,BtrxPowerReserver,true);
																GIr.BTRxPowerReserve = BtrxPowerReserver.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
				case"Strap":			if(blank(params[i]))then begin
														GIr.BPIStrap = "";
													end else begin
														BTRxStrapr.Name = trim(params[i]);
														if(readfirstkey("Name",BTRxStrapr,1,true))then begin
															GIr.BPIStrap = BTRxStrapr.Code;
														end else begin
															BTRxStrapr.Code = params[i];
															if(readfirstmain(BTRxStrapr,1,true))then begin
																GIr.BPIStrap = BTRxStrapr.Code;
															end else begin
																// GIr.BPIStrap = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																BTRxStrapr.Code = "STRP99999";
																TrHs = true;
																while (LoopBackKey("Code",BTRxStrapr,1,TrHs)) begin
																	OldCode = BTRxStrapr.Code;
																	TrHs = false;
																end;
																ResetLoop(BTRxStrapr);
																recordnew(BTRxStrapr);
																if(blank(OldCode))then begin OldCode = "STRP00000"; end;
																NextCode(OldCode,BTRxStrapr.Code);
																BTRxStrapr.Name = params[i];
																recordinsert(BTRxStrapr,true);
																recordupdate(BTRxStrapr,BTRxStrapr,true);
																GIr.BPIStrap = BTRxStrapr.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
				case"StClolor":		if(blank(params[i]))then begin
														GIr.BTRxStrapColour = "";
													end else begin
														BTRxColorr.Name = trim(params[i]);
														if(readfirstkey("Name",BTRxColorr,1,true))then begin
															GIr.BTRxStrapColour = BTRxColorr.Code;
														end else begin
															BTRxColorr.Code = params[i];
															if(readfirstmain(BTRxColorr,1,true))then begin
																GIr.BTRxStrapColour = BTRxColorr.Code;
															end else begin
																// GIr.BTRxStrapColour = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																BTRxColorr.Code = "CL99999";
																TrHs = true;
																while (LoopBackKey("Code",BTRxColorr,1,TrHs)) begin
																	OldCode = BTRxColorr.Code;
																	TrHs = false;
																end;
																ResetLoop(BTRxColorr);
																recordnew(BTRxColorr);
																if(blank(OldCode))then begin OldCode = "CL00000"; end;
																NextCode(OldCode,BTRxColorr.Code);
																BTRxColorr.Name = params[i];
																recordinsert(BTRxColorr,true);
																recordupdate(BTRxColorr,BTRxColorr,true);
																GIr.BTRxStrapColour = BTRxColorr.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
				case"Com1":				if(blank(params[i]))then begin
														GIr.BTRxWatchGradeA = "";
													end else begin
														BtrxWatchGrader.Name = trim(params[i]);
														if(readfirstkey("Name",BtrxWatchGrader,1,true))then begin
															GIr.BTRxWatchGradeA = BtrxWatchGrader.Code;
														end else begin
															BtrxWatchGrader.Code = params[i];
															if(readfirstmain(BtrxWatchGrader,1,true))then begin
																GIr.BTRxWatchGradeA = BtrxWatchGrader.Code;
															end else begin
																// GIr.BTRxWatchGradeA = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																BtrxWatchGrader.Code = "WTGRD9999";
																TrHs = true;
																while (LoopBackKey("Code",BtrxWatchGrader,1,TrHs)) begin
																	OldCode = BtrxWatchGrader.Code;
																	TrHs = false;
																end;
																ResetLoop(BtrxWatchGrader);
																recordnew(BtrxWatchGrader);
																if(blank(OldCode))then begin OldCode = "WTGRD0000"; end;
																NextCode(OldCode,BtrxWatchGrader.Code);
																BtrxWatchGrader.Name = params[i];
																recordinsert(BtrxWatchGrader,true);
																recordupdate(BtrxWatchGrader,BtrxWatchGrader,true);
																GIr.BTRxWatchGradeA = BtrxWatchGrader.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
				case"Com2":				if(blank(params[i]))then begin
														GIr.BTRxWatchGradeB = "";
													end else begin
														BtrxWatchGrader.Name = trim(params[i]);
														if(readfirstkey("Name",BtrxWatchGrader,1,true))then begin
															GIr.BTRxWatchGradeB = BtrxWatchGrader.Code;
														end else begin
															BtrxWatchGrader.Code = params[i];
															if(readfirstmain(BtrxWatchGrader,1,true))then begin
																GIr.BTRxWatchGradeB = BtrxWatchGrader.Code;
															end else begin
																// GIr.BTRxWatchGradeB = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																BtrxWatchGrader.Code = "WTGRD9999";
																TrHs = true;
																while (LoopBackKey("Code",BtrxWatchGrader,1,TrHs)) begin
																	OldCode = BtrxWatchGrader.Code;
																	TrHs = false;
																end;
																ResetLoop(BtrxWatchGrader);
																recordnew(BtrxWatchGrader);
																if(blank(OldCode))then begin OldCode = "WTGRD0000"; end;
																NextCode(OldCode,BtrxWatchGrader.Code);
																BtrxWatchGrader.Name = params[i];
																recordinsert(BtrxWatchGrader,true);
																recordupdate(BtrxWatchGrader,BtrxWatchGrader,true);
																GIr.BTRxWatchGradeB = BtrxWatchGrader.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
				case"Com3":				if(blank(params[i]))then begin
														GIr.BTRxWatchGradeC = "";
													end else begin
														BtrxWatchGrader.Name = trim(params[i]);
														if(readfirstkey("Name",BtrxWatchGrader,1,true))then begin
															GIr.BTRxWatchGradeC = BtrxWatchGrader.Code;
														end else begin
															BtrxWatchGrader.Code = params[i];
															if(readfirstmain(BtrxWatchGrader,1,true))then begin
																GIr.BTRxWatchGradeC = BtrxWatchGrader.Code;
															end else begin
																// GIr.BTRxWatchGradeC = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																BtrxWatchGrader.Code = "WTGRD9999";
																TrHs = true;
																while (LoopBackKey("Code",BtrxWatchGrader,1,TrHs)) begin
																	OldCode = BtrxWatchGrader.Code;
																	TrHs = false;
																end;
																ResetLoop(BtrxWatchGrader);
																recordnew(BtrxWatchGrader);
																if(blank(OldCode))then begin OldCode = "WTGRD0000"; end;
																NextCode(OldCode,BtrxWatchGrader.Code);
																BtrxWatchGrader.Name = params[i];
																recordinsert(BtrxWatchGrader,true);
																recordupdate(BtrxWatchGrader,BtrxWatchGrader,true);
																GIr.BTRxWatchGradeC = BtrxWatchGrader.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
				case"Stone1":			if(blank(params[i]))then begin
														GIr.BTRxStoneA = "";
													end else begin
														BTRxStoner.Name = trim(params[i]);
														if(readfirstkey("Name",BTRxStoner,1,true))then begin
															GIr.BTRxStoneA = BTRxStoner.Code;
														end else begin
															BTRxStoner.Code = params[i];
															if(readfirstmain(BTRxStoner,1,true))then begin
																GIr.BTRxStoneA = BTRxStoner.Code;
															end else begin
																// GIr.BTRxStoneA = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																BTRxStoner.Code = "STN99999";
																TrHs = true;
																while (LoopBackKey("Code",BTRxStoner,1,TrHs)) begin
																	OldCode = BTRxStoner.Code;
																	TrHs = false;
																end;
																ResetLoop(BTRxStoner);
																recordnew(BTRxStoner);
																if(blank(OldCode))then begin OldCode = "STN00000"; end;
																NextCode(OldCode,BTRxStoner.Code);
																BTRxStoner.Name = params[i];
																recordinsert(BTRxStoner,true);
																recordupdate(BTRxStoner,BTRxStoner,true);
																GIr.BTRxStoneA = BTRxStoner.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
				case"Carat1":			GIr.BTRxStoneScattA = stringtoval(params[i],m4val);
				case"Stone2":			if(blank(params[i]))then begin
														GIr.BTRxStoneB = "";
													end else begin
														BTRxStoner.Name = trim(params[i]);
														if(readfirstkey("Name",BTRxStoner,1,true))then begin
															GIr.BTRxStoneB = BTRxStoner.Code;
														end else begin
															BTRxStoner.Code = params[i];
															if(readfirstmain(BTRxStoner,1,true))then begin
																GIr.BTRxStoneB = BTRxStoner.Code;
															end else begin
																// GIr.BTRxStoneB = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																BTRxStoner.Code = "STN99999";
																TrHs = true;
																while (LoopBackKey("Code",BTRxStoner,1,TrHs)) begin
																	OldCode = BTRxStoner.Code;
																	TrHs = false;
																end;
																ResetLoop(BTRxStoner);
																recordnew(BTRxStoner);
																if(blank(OldCode))then begin OldCode = "STN00000"; end;
																NextCode(OldCode,BTRxStoner.Code);
																BTRxStoner.Name = params[i];
																recordinsert(BTRxStoner,true);
																recordupdate(BTRxStoner,BTRxStoner,true);
																GIr.BTRxStoneB = BTRxStoner.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
				case"Carat2":			GIr.BTRxStoneScattB = stringtoval(params[i],m4val);
				case"Stone3":			if(blank(params[i]))then begin
														GIr.BTRxStoneC = "";
													end else begin
														BTRxStoner.Name = trim(params[i]);
														if(readfirstkey("Name",BTRxStoner,1,true))then begin
															GIr.BTRxStoneC = BTRxStoner.Code;
														end else begin
															BTRxStoner.Code = params[i];
															if(readfirstmain(BTRxStoner,1,true))then begin
																GIr.BTRxStoneC = BTRxStoner.Code;
															end else begin
																// GIr.BTRxStoneC = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																BTRxStoner.Code = "STN99999";
																TrHs = true;
																while (LoopBackKey("Code",BTRxStoner,1,TrHs)) begin
																	OldCode = BTRxStoner.Code;
																	TrHs = false;
																end;
																ResetLoop(BTRxStoner);
																recordnew(BTRxStoner);
																if(blank(OldCode))then begin OldCode = "STN00000"; end;
																NextCode(OldCode,BTRxStoner.Code);
																BTRxStoner.Name = params[i];
																recordinsert(BTRxStoner,true);
																recordupdate(BTRxStoner,BTRxStoner,true);
																GIr.BTRxStoneC = BTRxStoner.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
				case"Carat3":			GIr.BTRxStoneScattC = stringtoval(params[i],m4val);
				case"AllCarat":		GIr.BTRxPlacerScatt = stringtoval(params[i],m4val);
												
				case"Color":			if(blank(params[i]))then begin
														GIr.BPIColor = "";
													end else begin
														BTRxColorr.Name = trim(params[i]);
														if(readfirstkey("Name",BTRxColorr,1,true))then begin
															GIr.BPIColor = BTRxColorr.Code;
														end else begin
															BTRxColorr.Code = params[i];
															if(readfirstmain(BTRxColorr,1,true))then begin
																GIr.BPIColor = BTRxColorr.Code;
															end else begin
																// GIr.BPIColor = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																BTRxColorr.Code = "CL99999";
																TrHs = true;
																while (LoopBackKey("Code",BTRxColorr,1,TrHs)) begin
																	OldCode = BTRxColorr.Code;
																	TrHs = false;
																end;
																ResetLoop(BTRxColorr);
																recordnew(BTRxColorr);
																if(blank(OldCode))then begin OldCode = "CL00000"; end;
																NextCode(OldCode,BTRxColorr.Code);
																BTRxColorr.Name = params[i];
																recordinsert(BTRxColorr,true);
																recordupdate(BTRxColorr,BTRxColorr,true);
																GIr.BPIColor = BTRxColorr.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
				case"Odour":			if(blank(params[i]))then begin
														GIr.BPIOdour = "";
													end else begin
														BTRxOdourr.Name = trim(params[i]);
														if(readfirstkey("Name",BTRxOdourr,1,true))then begin
															GIr.BPIOdour = BTRxOdourr.Code;
														end else begin
															BTRxOdourr.Code = params[i];
															if(readfirstmain(BTRxOdourr,1,true))then begin
																GIr.BPIOdour = BTRxOdourr.Code;
															end else begin
																// GIr.BPIOdour = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																BTRxOdourr.Code = "ODR99999";
																TrHs = true;
																while (LoopBackKey("Code",BTRxOdourr,1,TrHs)) begin
																	OldCode = BTRxOdourr.Code;
																	TrHs = false;
																end;
																ResetLoop(BTRxOdourr);
																recordnew(BTRxOdourr);
																if(blank(OldCode))then begin OldCode = "ODR00000"; end;
																NextCode(OldCode,BTRxOdourr.Code);
																BTRxOdourr.Name = params[i];
																recordinsert(BTRxOdourr,true);
																recordupdate(BTRxOdourr,BTRxOdourr,true);
																GIr.BPIOdour = BTRxOdourr.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
				case"Phone":			if(blank(params[i]))then begin
														GIr.BTRxPhoneModel = "";
													end else begin
														BtrxPhoneModelr.Name = params[i];
														if(readfirstkey("Name",BtrxPhoneModelr,1,true))then begin
															GIr.BTRxPhoneModel = BtrxPhoneModelr.Code;
														end else begin
															BtrxPhoneModelr.Code = trim(params[i]);
															if(readfirstmain(BtrxPhoneModelr,1,true))then begin
																GIr.BTRxPhoneModel = BtrxPhoneModelr.Code;
															end else begin
																// GIr.BTRxPhoneModel = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																BtrxPhoneModelr.Code = "PHMOD9999";
																TrHs = true;
																while (LoopBackKey("Code",BtrxPhoneModelr,1,TrHs)) begin
																	OldCode = BtrxPhoneModelr.Code;
																	TrHs = false;
																end;
																ResetLoop(BtrxPhoneModelr);
																recordnew(BtrxPhoneModelr);
																if(blank(OldCode))then begin OldCode = "PHMOD0000"; end;
																NextCode(OldCode,BtrxPhoneModelr.Code);
																BtrxPhoneModelr.Name = params[i];
																recordinsert(BtrxPhoneModelr,true);
																recordupdate(BtrxPhoneModelr,BtrxPhoneModelr,true);
																GIr.BTRxPhoneModel = BtrxPhoneModelr.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
				case"ChaninMat":	if(blank(params[i]))then begin
														GIr.BTRxChainMaterial = "";
													end else begin
														BTRxMaterialr.Name = trim(params[i]);
														if(readfirstkey("Name",BTRxMaterialr,1,true))then begin
															GIr.BTRxChainMaterial = BTRxMaterialr.Code;
														end else begin
															BTRxMaterialr.Code = params[i];
															if(readfirstmain(BTRxMaterialr,1,true))then begin
																GIr.BTRxChainMaterial = BTRxMaterialr.Code;
															end else begin
																// GIr.BTRxChainMaterial = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																BTRxMaterialr.Code = "MATR99999";
																TrHs = true;
																while (LoopBackKey("Code",BTRxMaterialr,1,TrHs)) begin
																	OldCode = BTRxMaterialr.Code;
																	TrHs = false;
																end;
																ResetLoop(BTRxMaterialr);
																recordnew(BTRxMaterialr);
																if(blank(OldCode))then begin OldCode = "MATR00000"; end;
																NextCode(OldCode,BTRxMaterialr.Code);
																BTRxMaterialr.Name = params[i];
																recordinsert(BTRxMaterialr,true);
																recordupdate(BTRxMaterialr,BTRxMaterialr,true);
																GIr.BTRxChainMaterial = BTRxMaterialr.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
				case"Fill":				if(blank(params[i]))then begin
														GIr.BTRxFilling = "";
													end else begin
														BtrxFillingr.Name = trim(params[i]);
														if(readfirstkey("Name",BtrxFillingr,1,true))then begin
															GIr.BTRxFilling = BtrxFillingr.Code;
														end else begin
															BtrxFillingr.Code = params[i];
															if(readfirstmain(BtrxFillingr,1,true))then begin
																GIr.BTRxFilling = BtrxFillingr.Code;
															end else begin
																// GIr.BTRxFilling = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																BtrxFillingr.Code = "FILLN9999";
																TrHs = true;
																while (LoopBackKey("Code",BtrxFillingr,1,TrHs)) begin
																	OldCode = BtrxFillingr.Code;
																	TrHs = false;
																end;
																ResetLoop(BtrxFillingr);
																recordnew(BtrxFillingr);
																if(blank(OldCode))then begin OldCode = "FILLN0000"; end;
																NextCode(OldCode,BtrxFillingr.Code);
																BtrxFillingr.Name = params[i];
																recordinsert(BtrxFillingr,true);
																recordupdate(BtrxFillingr,BtrxFillingr,true);
																GIr.BTRxFilling = BtrxFillingr.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
				case"WaterRes":		if(blank(params[i]))then begin
														GIr.BTRxWatterRes = "";
													end else begin
														BtrxWatResr.Name = trim(params[i]);
														if(readfirstkey("Name",BtrxWatResr,1,true))then begin
															GIr.BTRxWatterRes = BtrxWatResr.Code;
														end else begin
															BtrxWatResr.Code = params[i];
															if(readfirstmain(BtrxWatResr,1,true))then begin
																GIr.BTRxWatterRes = BtrxWatResr.Code;
															end else begin
																// GIr.BTRxWatterRes = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																BtrxWatResr.Code = "WTRS9999";
																TrHs = true;
																while (LoopBackKey("Code",BtrxWatResr,1,TrHs)) begin
																	OldCode = BtrxWatResr.Code;
																	TrHs = false;
																end;
																ResetLoop(BtrxWatResr);
																recordnew(BtrxWatResr);
																if(blank(OldCode))then begin OldCode = "WTRS0000"; end;
																NextCode(OldCode,BtrxWatResr.Code);
																BtrxWatResr.Name = params[i];
																recordinsert(BtrxWatResr,true);
																recordupdate(BtrxWatResr,BtrxWatResr,true);
																GIr.BTRxWatterRes = BtrxWatResr.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
				case"StrapMat":		if(blank(params[i]))then begin
														GIr.BTRxStrapMat = "";
													end else begin
														BTRxMaterialr.Name = trim(params[i]);
														if(readfirstkey("Name",BTRxMaterialr,1,true))then begin
															GIr.BTRxStrapMat = BTRxMaterialr.Code;
														end else begin
															BTRxMaterialr.Code = params[i];
															if(readfirstmain(BTRxMaterialr,1,true))then begin
																GIr.BTRxStrapMat = BTRxMaterialr.Code;
															end else begin
																// GIr.BTRxStrapMat = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																BTRxMaterialr.Code = "MATR99999";
																TrHs = true;
																while (LoopBackKey("Code",BTRxMaterialr,1,TrHs)) begin
																	OldCode = BTRxMaterialr.Code;
																	TrHs = false;
																end;
																ResetLoop(BTRxMaterialr);
																recordnew(BTRxMaterialr);
																if(blank(OldCode))then begin OldCode = "MATR00000"; end;
																NextCode(OldCode,BTRxMaterialr.Code);
																BTRxMaterialr.Name = params[i];
																recordinsert(BTRxMaterialr,true);
																recordupdate(BTRxMaterialr,BTRxMaterialr,true);
																GIr.BTRxStrapMat = BTRxMaterialr.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
				case"BracelMat":		if(blank(params[i]))then begin
														GIr.BTRxBracelMat = "";
													end else begin
														BTRxMaterialr.Name = trim(params[i]);
														if(readfirstkey("Name",BTRxMaterialr,1,true))then begin
															GIr.BTRxBracelMat = BTRxMaterialr.Code;
														end else begin
															BTRxMaterialr.Code = params[i];
															if(readfirstmain(BTRxMaterialr,1,true))then begin
																GIr.BTRxBracelMat = BTRxMaterialr.Code;
															end else begin
																// GIr.BTRxBracelMat = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																BTRxMaterialr.Code = "MATR99999";
																TrHs = true;
																while (LoopBackKey("Code",BTRxMaterialr,1,TrHs)) begin
																	OldCode = BTRxMaterialr.Code;
																	TrHs = false;
																end;
																ResetLoop(BTRxMaterialr);
																recordnew(BTRxMaterialr);
																if(blank(OldCode))then begin OldCode = "MATR00000"; end;
																NextCode(OldCode,BTRxMaterialr.Code);
																BTRxMaterialr.Name = params[i];
																recordinsert(BTRxMaterialr,true);
																recordupdate(BTRxMaterialr,BTRxMaterialr,true);
																GIr.BTRxBracelMat = BTRxMaterialr.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
					case"Collection":		if(blank(params[i]))then begin
																GIr.BtrxCollection = "";
															end else begin
																BtrxCollectionr.Name = trim(params[i]);
																if(readfirstkey("Name",BtrxCollectionr,1,true))then begin
																	GIr.BtrxCollection = BtrxCollectionr.Code;
																end else begin
																	BtrxCollectionr.Code = params[i];
																	if(readfirstmain(BtrxCollectionr,1,true))then begin
																		GIr.BtrxCollection = BtrxCollectionr.Code;
																	end else begin
																		// GIr.BTRxBracelMat = "";
																		// ErrAr[ErrCnt] = param & ": " & params[i];
																		// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																		// ErrCnt = ErrCnt + 1;
																		BtrxCollectionr.Code = "COLL9999";
																		TrHs = true;
																		while (LoopBackKey("Code",BtrxCollectionr,1,TrHs)) begin
																			OldCode = BtrxCollectionr.Code;
																			TrHs = false;
																		end;
																		ResetLoop(BtrxCollectionr);
																		recordnew(BtrxCollectionr);
																		if(blank(OldCode))then begin OldCode = "COLL0000"; end;
																		NextCode(OldCode,BtrxCollectionr.Code);
																		BtrxCollectionr.Name = params[i];
																		recordinsert(BtrxCollectionr,true);
																		recordupdate(BtrxCollectionr,BtrxCollectionr,true);
																		GIr.BtrxCollection = BtrxCollectionr.Code;
																		res = true;
																		OldCode = "";
																	end;
																end;
															end;
					case"ClockFaceColour":	if(blank(params[i]))then begin
																		GIr.BtrxClockFaceColour = "";
																	end else begin
																		BTRxColorr.Name = trim(params[i]);
																		if(readfirstkey("Name",BTRxColorr,1,true))then begin
																			GIr.BtrxClockFaceColour = BTRxColorr.Code;
																		end else begin
																			BTRxColorr.Code = params[i];
																			if(readfirstmain(BTRxColorr,1,true))then begin
																				GIr.BtrxClockFaceColour = BTRxColorr.Code;
																			end else begin
																				// GIr.BTRxBracelMat = "";
																				// ErrAr[ErrCnt] = param & ": " & params[i];
																				// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																				// ErrCnt = ErrCnt + 1;
																				BTRxColorr.Code = "CL99999";
																				TrHs = true;
																				while (LoopBackKey("Code",BTRxColorr,1,TrHs)) begin
																					OldCode = BTRxColorr.Code;
																					TrHs = false;
																				end;
																				ResetLoop(BTRxColorr);
																				recordnew(BTRxColorr);
																				if(blank(OldCode))then begin OldCode = "CL00000"; end;
																				NextCode(OldCode,BTRxColorr.Code);
																				BTRxColorr.Name = params[i];
																				recordinsert(BTRxColorr,true);
																				recordupdate(BTRxColorr,BTRxColorr,true);
																				GIr.BtrxClockFaceColour = BTRxColorr.Code;
																				res = true;
																				OldCode = "";
																			end;
																		end;
																	end;
																	
					case"Complications":	if(blank(params[i]))then begin
																		GIr.BtrxComplications = "";
																	end else begin
																		BtrxComplicationsr.Name = trim(params[i]);
																		if(readfirstkey("Name",BtrxComplicationsr,1,true))then begin
																			GIr.BtrxComplications = BtrxComplicationsr.Code;
																		end else begin
																			BtrxComplicationsr.Code = params[i];
																			if(readfirstmain(BtrxComplicationsr,1,true))then begin
																				GIr.BtrxComplications = BtrxComplicationsr.Code;
																			end else begin
																				// GIr.BTRxBracelMat = "";
																				// ErrAr[ErrCnt] = param & ": " & params[i];
																				// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																				// ErrCnt = ErrCnt + 1;
																				BtrxComplicationsr.Code = "CMP99999";
																				TrHs = true;
																				while (LoopBackKey("Code",BtrxComplicationsr,1,TrHs)) begin
																					OldCode = BtrxComplicationsr.Code;
																					TrHs = false;
																				end;
																				ResetLoop(BtrxComplicationsr);
																				recordnew(BtrxComplicationsr);
																				if(blank(OldCode))then begin OldCode = "CMP00000"; end;
																				NextCode(OldCode,newCode);
																				BtrxComplicationsr.Name = params[i];
																				BtrxComplicationsr.Code = newCode;
																				recordinsert(BtrxComplicationsr,true);
																				recordupdate(BtrxComplicationsr,BtrxComplicationsr,true);
																				GIr.BtrxComplications = BtrxComplicationsr.Code;
																				res = true;
																				OldCode = "";
																			end;
																		end;
																	end;
					case"ClockFaceMaterial":	if(blank(params[i]))then begin
																		GIr.BtrxClockFaceMaterial = "";
																	end else begin
																		BTRxMaterialr.Name = trim(params[i]);
																		if(readfirstkey("Name",BTRxMaterialr,1,true))then begin
																			GIr.BtrxClockFaceMaterial = BTRxMaterialr.Code;
																		end else begin
																			BTRxMaterialr.Code = params[i];
																			if(readfirstmain(BTRxMaterialr,1,true))then begin
																				GIr.BtrxClockFaceMaterial = BTRxMaterialr.Code;
																			end else begin
																				// GIr.BTRxBracelMat = "";
																				// ErrAr[ErrCnt] = param & ": " & params[i];
																				// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																				// ErrCnt = ErrCnt + 1;
																				BTRxMaterialr.Code = "MATR99999";
																				TrHs = true;
																				while (LoopBackKey("Code",BTRxMaterialr,1,TrHs)) begin
																					OldCode = BTRxMaterialr.Code;
																					TrHs = false;
																				end;
																				ResetLoop(BTRxMaterialr);
																				recordnew(BTRxMaterialr);
																				if(blank(OldCode))then begin OldCode = "MATR00000"; end;
																				NextCode(OldCode,BTRxMaterialr.Code);
																				BTRxMaterialr.Name = params[i];
																				recordinsert(BTRxMaterialr,true);
																				recordupdate(BTRxMaterialr,BTRxMaterialr,true);
																				GIr.BtrxClockFaceMaterial = BTRxMaterialr.Code;
																				res = true;
																				OldCode = "";
																			end;
																		end;
																	end;
					case"MicrowaveProtect":	if(blank(params[i]))then begin
																		GIr.BtrxMicrowaveProtect = "";
																	end else begin
																		BtrxMicrowaveProtectr.Name = trim(params[i]);
																		if(readfirstkey("Name",BtrxMicrowaveProtectr,1,true))then begin
																			GIr.BtrxMicrowaveProtect = BtrxMicrowaveProtectr.Code;
																		end else begin
																			BtrxMicrowaveProtectr.Code = params[i];
																			if(readfirstmain(BtrxMicrowaveProtectr,1,true))then begin
																				GIr.BtrxMicrowaveProtect = BtrxMicrowaveProtectr.Code;
																			end else begin
																				// GIr.BTRxBracelMat = "";
																				// ErrAr[ErrCnt] = param & ": " & params[i];
																				// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																				// ErrCnt = ErrCnt + 1;
																				BtrxMicrowaveProtectr.Code = "MPR99999";
																				TrHs = true;
																				while (LoopBackKey("Code",BtrxMicrowaveProtectr,1,TrHs)) begin
																					OldCode = BtrxMicrowaveProtectr.Code;
																					TrHs = false;
																				end;
																				ResetLoop(BtrxMicrowaveProtectr);
																				recordnew(BtrxMicrowaveProtectr);
																				if(blank(OldCode))then begin OldCode = "MPR00000"; end;
																				NextCode(OldCode,BtrxMicrowaveProtectr.Code);
																				BtrxMicrowaveProtectr.Name = params[i];
																				recordinsert(BtrxMicrowaveProtectr,true);
																				recordupdate(BtrxMicrowaveProtectr,BtrxMicrowaveProtectr,true);
																				GIr.BtrxMicrowaveProtect = BtrxMicrowaveProtectr.Code;
																				res = true;
																				OldCode = "";
																			end;
																		end;
																	end;
					case"StoveCompat":			if(blank(params[i]))then begin
																		GIr.BtrxStoveCompat = "";
																	end else begin
																		BtrxStoveCompatr.Name = trim(params[i]);
																		if(readfirstkey("Name",BtrxStoveCompatr,1,true))then begin
																			GIr.BtrxStoveCompat = BtrxStoveCompatr.Code;
																		end else begin
																			BtrxStoveCompatr.Code = params[i];
																			if(readfirstmain(BtrxStoveCompatr,1,true))then begin
																				GIr.BtrxStoveCompat = BtrxStoveCompatr.Code;
																			end else begin
																				// GIr.BTRxBracelMat = "";
																				// ErrAr[ErrCnt] = param & ": " & params[i];
																				// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																				// ErrCnt = ErrCnt + 1;
																				BtrxStoveCompatr.Code = "STC99999";
																				TrHs = true;
																				while (LoopBackKey("Code",BtrxStoveCompatr,1,TrHs)) begin
																					OldCode = BtrxStoveCompatr.Code;
																					TrHs = false;
																				end;
																				ResetLoop(BtrxStoveCompatr);
																				recordnew(BtrxStoveCompatr);
																				if(blank(OldCode))then begin OldCode = "STC00000"; end;
																				NextCode(OldCode,BtrxStoveCompatr.Code);
																				BtrxStoveCompatr.Name = params[i];
																				recordinsert(BtrxStoveCompatr,true);
																				recordupdate(BtrxStoveCompatr,BtrxStoveCompatr,true);
																				GIr.BtrxStoveCompat = BtrxStoveCompatr.Code;
																				res = true;
																				OldCode = "";
																			end;
																		end;
																	end;
					case"AllMaterials":			if(blank(params[i]))then begin
																		GIr.BtrxAllMaterials = "";
																	end else begin
																		BtrxAllMaterialsr.Name = trim(params[i]);
																		if(readfirstkey("Name",BtrxAllMaterialsr,1,true))then begin
																			GIr.BtrxAllMaterials = BtrxAllMaterialsr.Code;
																		end else begin
																			BtrxAllMaterialsr.Code = params[i];
																			if(readfirstmain(BtrxAllMaterialsr,1,true))then begin
																				GIr.BtrxAllMaterials = BtrxAllMaterialsr.Code;
																			end else begin
																				// GIr.BTRxBracelMat = "";
																				// ErrAr[ErrCnt] = param & ": " & params[i];
																				// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																				// ErrCnt = ErrCnt + 1;
																				BtrxAllMaterialsr.Code = "AM999999";
																				TrHs = true;
																				while (LoopBackKey("Code",BtrxAllMaterialsr,1,TrHs)) begin
																					OldCode = BtrxAllMaterialsr.Code;
																					TrHs = false;
																				end;
																				ResetLoop(BtrxAllMaterialsr);
																				recordnew(BtrxAllMaterialsr);
																				if(blank(OldCode))then begin OldCode = "AM000000"; end;
																				NextCode(OldCode,BtrxAllMaterialsr.Code);
																				BtrxAllMaterialsr.Name = params[i];
																				recordinsert(BtrxAllMaterialsr,true);
																				recordupdate(BtrxAllMaterialsr,BtrxAllMaterialsr,true);
																				GIr.BtrxAllMaterials = BtrxAllMaterialsr.Code;
																				res = true;
																				OldCode = "";
																			end;
																		end;
																	end;
					case"MetalCont":			if(blank(params[i]))then begin
																		GIr.BtrxPrecMetalCont = "";
																	end else begin
																		BtrxPrecMetalContr.Name = trim(params[i]);
																		if(readfirstkey("Name",BtrxPrecMetalContr,1,true))then begin
																			GIr.BtrxPrecMetalCont = BtrxPrecMetalContr.Code;
																		end else begin
																			BtrxPrecMetalContr.Code = params[i];
																			if(readfirstmain(BtrxPrecMetalContr,1,true))then begin
																				GIr.BtrxPrecMetalCont = BtrxPrecMetalContr.Code;
																			end else begin
																				// GIr.BTRxBracelMat = "";
																				// ErrAr[ErrCnt] = param & ": " & params[i];
																				// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																				// ErrCnt = ErrCnt + 1;
																				BtrxPrecMetalContr.Code = "PMC99999";
																				TrHs = true;
																				while (LoopBackKey("Code",BtrxPrecMetalContr,1,TrHs)) begin
																					OldCode = BtrxPrecMetalContr.Code;
																					TrHs = false;
																				end;
																				ResetLoop(BtrxPrecMetalContr);
																				recordnew(BtrxPrecMetalContr);
																				if(blank(OldCode))then begin OldCode = "PMC00000"; end;
																				NextCode(OldCode,BtrxPrecMetalContr.Code);
																				BtrxPrecMetalContr.Name = params[i];
																				recordinsert(BtrxPrecMetalContr,true);
																				recordupdate(BtrxPrecMetalContr,BtrxPrecMetalContr,true);
																				GIr.BtrxPrecMetalCont = BtrxPrecMetalContr.Code;
																				res = true;
																				OldCode = "";
																			end;
																		end;
																	end;
					case"CaseDiam":			if(blank(params[i]))then begin
																		GIr.BtrxCaseDiam = "";
																	end else begin
																		BtrxCaseDiamr.Name = trim(params[i]);
																		if(readfirstkey("Name",BtrxCaseDiamr,1,true))then begin
																			GIr.BtrxCaseDiam = BtrxCaseDiamr.Code;
																		end else begin
																			BtrxCaseDiamr.Code = params[i];
																			if(readfirstmain(BtrxCaseDiamr,1,true))then begin
																				GIr.BtrxCaseDiam = BtrxCaseDiamr.Code;
																			end else begin
																				// GIr.BTRxBracelMat = "";
																				// ErrAr[ErrCnt] = param & ": " & params[i];
																				// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																				// ErrCnt = ErrCnt + 1;
																				BtrxCaseDiamr.Code = "CD999999";
																				TrHs = true;
																				while (LoopBackKey("Code",BtrxCaseDiamr,1,TrHs)) begin
																					OldCode = BtrxCaseDiamr.Code;
																					TrHs = false;
																				end;
																				ResetLoop(BtrxCaseDiamr);
																				recordnew(BtrxCaseDiamr);
																				if(blank(OldCode))then begin OldCode = "CD000000"; end;
																				NextCode(OldCode,BtrxCaseDiamr.Code);
																				BtrxCaseDiamr.Name = params[i];
																				recordinsert(BtrxCaseDiamr,true);
																				recordupdate(BtrxCaseDiamr,BtrxCaseDiamr,true);
																				GIr.BtrxCaseDiam = BtrxCaseDiamr.Code;
																				res = true;
																				OldCode = "";
																			end;
																		end;
																	end;
					case"PF1":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PF10":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PF11":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PF2":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PF3":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PF4":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PF5":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PF6":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PF7":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PF8":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PF9":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PG1":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PG2":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PG3":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PO1":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PO10":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PO11":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PO12":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PO2":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PO3":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PO4":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PO5":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PO6":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PO7":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PO8":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PO9":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
			end;
		end;
	end;

	GIWasUpdated(GIr,LogGIr," GIWasUpdatedlog 109");
	recordstore(GIr,true);
	if (nonblank(finRow)) then begin
		logtext(0,finRow & " FILENAME!!!");
		MoveFile(finRow,"/mnt/database/Ecommerce/ECommerceIN","/mnt/database/Ecommerce/ECommerceOUT");
		delete_file("/mnt/database/Ecommerce/ECommerceIN/" & finRow);
		runprogram("chmod","-R a+rw /mnt/database/Ecommerce");
	end;
return;
end;




global
updating procedure SetItemBitrixClassVJSONQueued(var record GlobalItemVc GIr,array string headers,array string params, vector string ENGHeder, vector string RUSHeder, vector string AZEHeder, area ImportedFile, longint clarea, string maincode, var array string ErrAr, var integer ErrCnt,var array string ErrAr2,var vector string classCode, string finRow)
begin
	record BTRxBrandVc BTRxBrandr;
	record BTRxMaterialVc BTRxMaterialr;
	record BTRxColourVc BTRxColorr;
	record BTRxSizeVc BTRxSizer;
	record BTRxSexVc BTRxSexr;
	record BTRxPlatingVc BTRxPlatingr;
	record BTRxStoneVc BTRxStoner;
	record BTRxStrapVc BTRxStrapr;
	record BTRxOdourVc BTRxOdourr;
	record BtrxInternalCatVc BtrxInternalCatr;
	record BtrxFirstLevelCatVc BtrxFirstLevelCatr;
	record BtrxSecondLevelCatVc BtrxSecondLevelCatr, BSLLastCoder;
	record BtrxThirdLevelCatVc BtrxThirdLevelCatr, BTLLastCoder;
	record BtrxFourthLevelCatVc BtrxFourthLevelCatr, BFLLastCoder;
	record BtrxCertificateVc BtrxCertificater;
	record BtrxWatchMechanVc BtrxWatchMechanr;
	record BtrxPowerReserveVc BtrxPowerReserver;
	record BtrxWatchGradeVc BtrxWatchGrader;
	record BtrxPhoneModelVc BtrxPhoneModelr;
	record BtrxFillingVc BtrxFillingr;
	record BtrxTypeVc BtrxTyper;
	record BtrxWaterResistantVc BtrxWatResr;
	record BtrxStrapMatVc BtrxStrapMatr;
	record BtrxBracelMatVc BtrxBracelMatr;
	record BtrxCollectionVc BtrxCollectionr;
	record BtrxComplicationsVc BtrxComplicationsr;
	record BtrxMicrowaveProtectVc BtrxMicrowaveProtectr;
	record BtrxStoveCompatVc BtrxStoveCompatr;
	record BtrxAllMaterialsVc BtrxAllMaterialsr;
	record BtrxPrecMetalContVc BtrxPrecMetalContr;
	record BtrxCaseDiamVc BtrxCaseDiamr;
	record JSONClassNamesVc JCNr;
	record GlobalItemVc LogGIr;
	
	integer i, pos;
	string 100 param, OldCode, newCode;
	boolean res, TrHs, testf, THRDf, catrtreef, createdf;
	string 255 catName, catNameRUS, catNameAZ, parametr, paramsStr, Name3catrus, Name3cataz, tree3Code, WEBSSectStr, tmp;
	vector boolean jParamfoundf;
	
	SetCompany(1,false);
	newCode = "";
	GIr.BTRxGiftClass = "";
	readfirstMain(GIr,1,true);
	res = true;
	logtext(0,"SetItemBitrixClassVJSONQueued" & GIr.Code);
	recordcopy(LogGIr,GIr);
	for(i=0;i<headers.length;i=i+1)begin
		param = headers[i];
		params[i] = trim(params[i]);
		if (left(headers[i],5)=="JSON_") then begin
			if (nonblank(params[i]) or nonblank(params[i+1]) or nonblank(params[i+2])/* and !jParamfoundf[trim(right(headers[i],len(headers[i])-5))]*/) then begin
				JCNr.Code = trim(right(headers[i],len(headers[i])-5));
				if (!ReadFirstMain(JCNr,1,true)) then begin
					recordNew(JCNr);
					JCNr.Code = trim(right(headers[i],len(headers[i])-5));
					JCNr.Name = trim(ENGHeder[headers[i]]);
					JCNr.NameRUS = trim(RUSHeder[headers[i]]);
					JCNr.NameAZ = trim(AZEHeder[headers[i]]);
					RecordStore(JCNr,true);
				end else begin
					if (nonblank(ENGHeder[headers[i]]) and trim(ENGHeder[headers[i]])!=JCNr.Name) then begin
						JCNr.Name = trim(ENGHeder[headers[i]]);
						RecordStore(JCNr,true);
					end;
					if (nonblank(RUSHeder[headers[i]]) and trim(RUSHeder[headers[i]])!=JCNr.NameRUS) then begin
						JCNr.NameRUS = trim(RUSHeder[headers[i]]);
						RecordStore(JCNr,true);
					end;
					if (nonblank(AZEHeder[headers[i]]) and trim(AZEHeder[headers[i]])!=JCNr.NameAZ) then begin
						JCNr.NameAZ = trim(AZEHeder[headers[i]]);
						RecordStore(JCNr,true);
					end;
				end;
				FillClassInM4TextWithTP(GIr,JCNr.Code,JCNr.Name,JCNr.NameRUS,JCNr.NameAZ,params[i],params[i+1],params[i+2],ImportedFile, clarea, maincode);
				jParamfoundf[JCNr.Code] = true;
			end;
			i=i+2;
		end else begin
			switch(param)begin
				case"Brand": 			if(blank(params[i]))then begin
														GIr.BPIBrand = "";
													end else begin
														BTRxBrandr.Name = params[i];
														if(readfirstkey("Name",BTRxBrandr,1,true))then begin
															GIr.BPIBrand = BTRxBrandr.Code;
														end else begin
															BTRxBrandr.Code = params[i];
															if(readfirstmain(BTRxBrandr,1,true))then begin
																GIr.BPIBrand = BTRxBrandr.Code;
															end else begin
																GIr.BPIBrand = "";
																 // BTRxBrandr.Code = "BRND9999";
																 // TrHs = true;
																 // while (LoopBackKey("Code",BTRxBrandr,1,TrHs)) begin
																	 // OldCode = BTRxBrandr.Code;
																	 // TrHs = false;
																 // end;
																 // ResetLoop(BTRxBrandr);
																 // recordnew(BTRxBrandr);
																 // if(blank(OldCode))then begin OldCode = "BRND0000"; end;
																 // NextCode(OldCode,BTRxBrandr.Code);
																 // BTRxBrandr.Name = params[i];
																 // recordinsert(BTRxBrandr,true);
																 // recordupdate(BTRxBrandr,BTRxBrandr,true);
																 // GIr.BPIBrand = BTRxBrandr.Code;
																 // res = true;
																 // OldCode = "";
															end;
														end;
													end;
				case"IntCat": 		if(blank(params[i]))then begin
														GIr.BTRxInterCatClass = "";
													end else begin
														BtrxInternalCatr.Name = trim(params[i]);
														if(readfirstkey("Name",BtrxInternalCatr,1,true))then begin
															GIr.BTRxInterCatClass = BtrxInternalCatr.Code;
														end else begin
															BtrxInternalCatr.Code = params[i];
															if(readfirstmain(BtrxInternalCatr,1,true))then begin
																GIr.BTRxInterCatClass = BtrxInternalCatr.Code;
															end else begin
																// GIr.BTRxInterCatClass = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																BtrxInternalCatr.Code = "INCAT9999";
																TrHs = true;
																while (LoopBackKey("Code",BtrxInternalCatr,1,TrHs)) begin
																	OldCode = BtrxInternalCatr.Code;
																	TrHs = false;
																end;
																ResetLoop(BtrxInternalCatr);
																recordnew(BtrxInternalCatr);
																if(blank(OldCode))then begin OldCode = "INCAT0000"; end;
																NextCode(OldCode,BtrxInternalCatr.Code);
																BtrxInternalCatr.Name = params[i];
																recordinsert(BtrxInternalCatr,true);
																recordupdate(BtrxInternalCatr,BtrxInternalCatr,true);
																GIr.BTRxInterCatClass = BtrxInternalCatr.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
				case"Type": 			if(blank(params[i]))then begin
														GIr.BTRxType = "";
													end else begin
														BtrxTyper.Name = trim(params[i]);
														if(readfirstkey("Name",BtrxTyper,1,true))then begin
															GIr.BTRxType = BtrxTyper.Code;
														end else begin
															BtrxTyper.Code = params[i];
															if(readfirstmain(BtrxTyper,1,true))then begin
																GIr.BTRxType = BtrxTyper.Code;
															end else begin
																GIr.BTRxType = "";
																ErrAr[ErrCnt] = param & ": " & params[i];
																ErrAr2[ErrCnt] = param & chr(09) & params[i];
																ErrCnt = ErrCnt + 1;
																// BtrxTyper.Code = "BTYPE9999";
																// TrHs = true;
																// while (LoopBackKey("Code",BtrxTyper,1,TrHs)) begin
																	// OldCode = BtrxTyper.Code;
																	// TrHs = false;
																// end;
																// ResetLoop(BtrxTyper);
																// recordnew(BtrxTyper);
																// if(blank(OldCode))then begin OldCode = "BTYPE0000"; end;
																// NextCode(OldCode,BtrxTyper.Code);
																// BtrxTyper.Name = params[i];
																// recordinsert(BtrxTyper,true);
																// recordupdate(BtrxTyper,BtrxTyper,true);
																// GIr.BTRxType = BtrxTyper.Code;
																// res = true;
																// OldCode = "";
															end;
														end;					
													end;
				case"Cat1":				if(blank(params[i]))then begin
														GIr.BTRxFirstLevCat = "";
													end else begin
														pos = 0;
														BtrxFirstLevelCatr.Name = "";
														paramsStr = "";
														parametr = trim(params[i]);
														// ExtractObjWithSeparator("_",parametr,true,pos,paramsStr);
														// while (nonblank(paramsStr)) begin
															// if(nonblank(BtrxFirstLevelCatr.Name))then begin
																// BtrxFirstLevelCatr.Name = BtrxFirstLevelCatr.Name & " ";
															// end;
															// BtrxFirstLevelCatr.Name = BtrxFirstLevelCatr.Name & paramsStr;
															// ExtractObjWithSeparator("_",parametr,true,pos,paramsStr);
														// end;
														BtrxFirstLevelCatr.Name = parametr;
														if(readfirstkey("Name",BtrxFirstLevelCatr,1,true))then begin
															GIr.BTRxFirstLevCat = BtrxFirstLevelCatr.Code;
														end else begin
															BtrxFirstLevelCatr.Code = params[i];
															if(readfirstmain(BtrxFirstLevelCatr,1,true))then begin
																GIr.BTRxFirstLevCat = BtrxFirstLevelCatr.Code;
															end else begin
																// GIr.BTRxFirstLevCat = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																// logtext(0,"yes");
																BtrxFirstLevelCatr.Code = "FILVL9999";
																TrHs = true;
																while (LoopBackKey("Code",BtrxFirstLevelCatr,1,TrHs)) begin
																	OldCode = BtrxFirstLevelCatr.Code;
																	TrHs = false;
																end;
																ResetLoop(BtrxFirstLevelCatr);
																recordnew(BtrxFirstLevelCatr);
																if(blank(OldCode))then begin OldCode = "FILVL0000"; end;
																NextCode(OldCode,BtrxFirstLevelCatr.Code);
																BtrxFirstLevelCatr.Name = params[i];
																recordinsert(BtrxFirstLevelCatr,true);
																recordupdate(BtrxFirstLevelCatr,BtrxFirstLevelCatr,true);
																GIr.BTRxFirstLevCat = BtrxFirstLevelCatr.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
				case"Cat2":				if(blank(params[i]))then begin
														GIr.BTRxSecondLevCat = "";
													end else begin
														pos = 0;
														BtrxSecondLevelCatr.Name = "";
														paramsStr = "";
														parametr = trim(params[i]);
														// ExtractObjWithSeparator("_",parametr,true,pos,paramsStr);
														// while (nonblank(paramsStr)) begin
															// if(nonblank(BtrxSecondLevelCatr.Name))then begin
																// BtrxSecondLevelCatr.Name = BtrxSecondLevelCatr.Name & " ";
															// end;
															// BtrxSecondLevelCatr.Name = BtrxSecondLevelCatr.Name & paramsStr;
															// ExtractObjWithSeparator("_",parametr,true,pos,paramsStr);
														// end;
														
														resetloop(BtrxSecondLevelCatr);
														BtrxSecondLevelCatr.Name = trim(params[i]);
														TrHs = true;
														while(loopkey("Name",BtrxSecondLevelCatr,1,TrHs))begin
															if(BtrxSecondLevelCatr.Name!=params[i])then begin TrHs = false; end;
															
															if(TrHs)then begin
																if(BtrxSecondLevelCatr.PathFrstCode==GIr.BTRxFirstLevCat)then begin
																	GIr.BTRxSecondLevCat = BtrxSecondLevelCatr.Code;
																end;
															end;
														end;
														
														ResetLoop(BtrxSecondLevelCatr);
														
														// BtrxSecondLevelCatr.Name = parametr;
														// if(readfirstkey("Name",BtrxSecondLevelCatr,1,true))then begin
															// GIr.BTRxSecondLevCat = BtrxSecondLevelCatr.Code;
														// end else begin
															// BtrxSecondLevelCatr.Code = params[i];
															// if(readfirstmain(BtrxSecondLevelCatr,1,true))then begin
																// GIr.BTRxSecondLevCat = BtrxSecondLevelCatr.Code;
															// end else begin
																// GIr.BTRxSecondLevCat = "";
															// end;
														// end;
													end;
				case"WebSSect":			pos = 0;
														WEBSSectStr = "";
														ExtractObj(GIr.BTRxGiftClass,pos,tmp);
														while (nonblank(tmp)) begin
															BtrxSecondLevelCatr.Code = tmp;
															if (!ReadFirstMain(BtrxSecondLevelCatr,1,true)) then begin
																if (nonblank(WEBSSectStr)) then begin WEBSSectStr = WEBSSectStr & ","; end;
																WEBSSectStr = WEBSSectStr & tmp;
															end;
															ExtractObj(GIr.BTRxGiftClass,pos,tmp);
														end;
														GIr.BTRxGiftClass = WEBSSectStr;
														if(nonblank(params[i]))then begin
															BtrxSecondLevelCatr.Name = trim(params[i]);
															TrHs = true;
															res = false;
															while(loopkey("Name",BtrxSecondLevelCatr,1,TrHs))begin
																if(BtrxSecondLevelCatr.Name!=params[i])then begin TrHs = false; end;
																if(TrHs and BtrxSecondLevelCatr.PathFrstCode=="BRANDS")then begin
																	if (nonblank(GIr.BTRxGiftClass)) then begin GIr.BTRxGiftClass = GIr.BTRxGiftClass & ","; end;
																	GIr.BTRxGiftClass = GIr.BTRxGiftClass & BtrxSecondLevelCatr.Code;
																	res = true;
																end;
															end;
															ResetLoop(BtrxSecondLevelCatr);
															if (!res) then begin
																QueuedImportActBrendSectIn(trim(params[i]),GIr);
																res = true;
															end;
														end;
				case"AdditionalCat": 	if(nonblank(params[i]))then begin
																BtrxThirdLevelCatr.Name = trim(params[i]);
																TrHs = true;
																res = false;
																while(loopkey("Name",BtrxThirdLevelCatr,1,TrHs))begin
																	// logtext(0,"1" & "____" & trim(params[i]));
																	if(BtrxThirdLevelCatr.Name!=trim(params[i]))then begin TrHs = false; end;
																	// logtext(0,"5" & "____" & TrHs);
																	if(TrHs and !SetInSet(BtrxThirdLevelCatr.Code,GIr.BTRxGiftClass))then begin
																		// logtext(0,"2" & "____" & trim(params[i]));
																		if (nonblank(GIr.BTRxGiftClass)) then begin GIr.BTRxGiftClass = GIr.BTRxGiftClass & ","; end;
																		GIr.BTRxGiftClass = GIr.BTRxGiftClass & BtrxThirdLevelCatr.Code;
																		res = true;
																		TrHs = false;
																	end;
																end;
																ResetLoop(BtrxThirdLevelCatr);
																if (!res) then begin
																	BtrxFourthLevelCatr.Name = trim(params[i]);
																	TrHs = true;
																	while(loopkey("Name",BtrxFourthLevelCatr,1,TrHs))begin
																		// logtext(0,"3" & "____" & trim(params[i]));
																		if(BtrxFourthLevelCatr.Name!=trim(params[i]))then begin TrHs = false; end;
																		// logtext(0,"6" & "____" & TrHs);
																		if(TrHs and !SetInSet(BtrxFourthLevelCatr.Code,GIr.BTRxGiftClass))then begin
																			// logtext(0,"4" & "____" & trim(params[i]));
																			if (nonblank(GIr.BTRxGiftClass)) then begin GIr.BTRxGiftClass = GIr.BTRxGiftClass & ","; end;
																			GIr.BTRxGiftClass = GIr.BTRxGiftClass & BtrxFourthLevelCatr.Code;
																			res = true;
																			TrHs = false;
																		end;
																	end;
																	ResetLoop(BtrxFourthLevelCatr);
																end;
																// logtext(0,GIr.BTRxGiftClass & "____" & trim(params[i]));
															end;
				// case"WebSSectDelete":	if(nonblank(params[i]))then begin
																// if (params[i]!="ALLSECTDELETE") then begin
																	// BtrxSecondLevelCatr.Name = trim(params[i]);
																	// TrHs = true;
																	// while(loopkey("Name",BtrxSecondLevelCatr,1,TrHs))begin
																		// if(BtrxSecondLevelCatr.Name!=params[i])then begin TrHs = false; end;
																		// if(TrHs and BtrxSecondLevelCatr.PathFrstCode=="BRANDS")then begin
																			// pos = 0;
																			// WEBSSectStr = "";
																			// ExtractObj(GIr.BTRxGiftClass,pos,tmp);
																			// while (nonblank(tmp)) begin
																				// if (BtrxSecondLevelCatr.Code!=tmp) then begin
																					// if (nonblank(WEBSSectStr)) then begin WEBSSectStr = WEBSSectStr & ","; end;
																					// WEBSSectStr = WEBSSectStr & tmp;
																				// end;
																				// ExtractObj(GIr.BTRxGiftClass,pos,tmp);
																			// end;
																			// GIr.BTRxGiftClass = WEBSSectStr;
																		// end;
																	// end;
																// end else begin
																	// pos = 0;
																	// WEBSSectStr = "";
																	// ExtractObj(GIr.BTRxGiftClass,pos,tmp);
																	// while (nonblank(tmp)) begin
																		// BtrxSecondLevelCatr.Code = tmp;
																		// if (!ReadFirstMain(BtrxSecondLevelCatr,1,true)) then begin
																			// if (nonblank(WEBSSectStr)) then begin WEBSSectStr = WEBSSectStr & ","; end;
																			// WEBSSectStr = WEBSSectStr & tmp;
																		// end;
																		// ExtractObj(GIr.BTRxGiftClass,pos,tmp);
																	// end;
																	// GIr.BTRxGiftClass = WEBSSectStr;
																// end;
															// end;
				case"Cat3":				if(blank(params[i]))then begin
														GIr.BTRxThirdLevCat = GIr.BTRxGiftClass;
													end else begin
														TrHs = true;
														resetloop(BtrxThirdLevelCatr);
														BtrxThirdLevelCatr.Name = trim(params[i]);
														while(loopkey("Name",BtrxThirdLevelCatr,1,TrHs))begin
															if(BtrxThirdLevelCatr.Name!=params[i])then begin TrHs = false; end;
															
															if(TrHs)then begin
																if(BtrxThirdLevelCatr.PathScndCode==GIr.BTRxSecondLevCat)then begin
																	// if(nonblank(GIr.BTRxGiftClass))then begin
																		// GIr.BTRxThirdLevCat = BtrxThirdLevelCatr.Code & "," & GIr.BTRxGiftClass;
																	// end else begin
																		GIr.BTRxThirdLevCat = BtrxThirdLevelCatr.Code;
																	// end;
																end;
															end;
														end;
														resetloop(BtrxThirdLevelCatr);
													end;
													/*if(blank(params[i]))then begin
														GIr.BTRxThirdLevCat = "";
													end else begin
														pos = 0;
														BtrxThirdLevelCatr.Name = "";
														paramsStr = "";
														parametr = params[i];
														ExtractObjWithSeparator("_",parametr,true,pos,paramsStr);
														while (nonblank(paramsStr)) begin
															if(nonblank(BtrxThirdLevelCatr.Name))then begin
																BtrxThirdLevelCatr.Name = BtrxThirdLevelCatr.Name & " ";
															end;
															BtrxThirdLevelCatr.Name = BtrxThirdLevelCatr.Name & paramsStr;
															ExtractObjWithSeparator("_",parametr,true,pos,paramsStr);
														end;
														if(readfirstkey("Name",BtrxThirdLevelCatr,1,true))then begin
															Name3catrus = BtrxThirdLevelCatr.NameRUS;
															Name3cataz = BtrxThirdLevelCatr.NameAZ;
															if(BtrxThirdLevelCatr.RelatedTo==GIr.BTRxSecondLevCat)then begin
																if(nonblank(GIr.BTRxThirdLevCat))then begin
																	GIr.BTRxThirdLevCat = "," & GIr.BTRxThirdLevCat;
																end;
																GIr.BTRxThirdLevCat = BtrxThirdLevelCatr.Code & GIr.BTRxThirdLevCat;
																pos = 0;
																BtrxThirdLevelCatr.Name = "";
																paramsStr = "";
																parametr = GIr.BTRxThirdLevCat;
																GIr.BTRxThirdLevCat = "";
																ExtractObjWithSeparator(",",parametr,true,pos,paramsStr);
																THRDf = false;
																while (nonblank(paramsStr)) begin
																	BtrxThirdLevelCatr.Name = paramsStr;
																	if(ReadFirstMain(BtrxThirdLevelCatr,1,true) and !THRDf)then begin
																		THRDf = true;
																		if(nonblank(GIr.BTRxThirdLevCat))then begin GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ","; end;
																		GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & paramsStr;
																	end else begin
																		BtrxThirdLevelCatr.Name = paramsStr;
																		if(!ReadFirstMain(BtrxThirdLevelCatr,1,true)) then begin
																			if(nonblank(GIr.BTRxThirdLevCat))then begin GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ","; end;
																			GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & paramsStr;
																		end;
																	end;
																	ExtractObjWithSeparator(",",parametr,true,pos,paramsStr);
																end;
															end else begin

															end;
														end else begin
															BtrxThirdLevelCatr.Code = params[i];
															if(readfirstmain(BtrxThirdLevelCatr,1,true))then begin
																GIr.BTRxThirdLevCat = BtrxThirdLevelCatr.Code;
															end else begin
																GIr.BTRxThirdLevCat = "";
																ErrAr[ErrCnt] = param & ": " & params[i];
																ErrAr2[ErrCnt] = param & chr(09) & params[i];
																ErrCnt = ErrCnt + 1;
															end;
														end;
													end;*/
				case"Cat4":				if(blank(params[i]))then begin
														GIr.BTRxFourthLevCat = "";
													end else begin
														TrHs = true;
														resetloop(BtrxFourthLevelCatr);
														BtrxFourthLevelCatr.Name = trim(params[i]);
														while(loopkey("Name",BtrxFourthLevelCatr,1,TrHs))begin
															if(BtrxFourthLevelCatr.Name!=params[i])then begin TrHs = false; end;
															if(TrHs)then begin
																if(BtrxFourthLevelCatr.PathThirdCode==GIr.BTRxThirdLevCat)then begin
																		GIr.BTRxFourthLevCat = BtrxFourthLevelCatr.Code;
																end;
															end;
														end;
														resetloop(BtrxFourthLevelCatr);
													end;
													/*if(blank(params[i]))then begin
														GIr.BTRxThirdLevCat = "";
													end else begin
														pos = 0;
														BtrxThirdLevelCatr.Name = "";
														paramsStr = "";
														parametr = params[i];
														ExtractObjWithSeparator("_",parametr,true,pos,paramsStr);
														while (nonblank(paramsStr)) begin
															if(nonblank(BtrxThirdLevelCatr.Name))then begin
																BtrxThirdLevelCatr.Name = BtrxThirdLevelCatr.Name & " ";
															end;
															BtrxThirdLevelCatr.Name = BtrxThirdLevelCatr.Name & paramsStr;
															ExtractObjWithSeparator("_",parametr,true,pos,paramsStr);
														end;
														if(readfirstkey("Name",BtrxThirdLevelCatr,1,true))then begin
															Name3catrus = BtrxThirdLevelCatr.NameRUS;
															Name3cataz = BtrxThirdLevelCatr.NameAZ;
															if(BtrxThirdLevelCatr.RelatedTo==GIr.BTRxSecondLevCat)then begin
																if(nonblank(GIr.BTRxThirdLevCat))then begin
																	GIr.BTRxThirdLevCat = "," & GIr.BTRxThirdLevCat;
																end;
																GIr.BTRxThirdLevCat = BtrxThirdLevelCatr.Code & GIr.BTRxThirdLevCat;
																pos = 0;
																BtrxThirdLevelCatr.Name = "";
																paramsStr = "";
																parametr = GIr.BTRxThirdLevCat;
																GIr.BTRxThirdLevCat = "";
																ExtractObjWithSeparator(",",parametr,true,pos,paramsStr);
																THRDf = false;
																while (nonblank(paramsStr)) begin
																	BtrxThirdLevelCatr.Name = paramsStr;
																	if(ReadFirstMain(BtrxThirdLevelCatr,1,true) and !THRDf)then begin
																		THRDf = true;
																		if(nonblank(GIr.BTRxThirdLevCat))then begin GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ","; end;
																		GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & paramsStr;
																	end else begin
																		BtrxThirdLevelCatr.Name = paramsStr;
																		if(!ReadFirstMain(BtrxThirdLevelCatr,1,true)) then begin
																			if(nonblank(GIr.BTRxThirdLevCat))then begin GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ","; end;
																			GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & paramsStr;
																		end;
																	end;
																	ExtractObjWithSeparator(",",parametr,true,pos,paramsStr);
																end;
															end else begin

															end;
														end else begin
															BtrxThirdLevelCatr.Code = params[i];
															if(readfirstmain(BtrxThirdLevelCatr,1,true))then begin
																GIr.BTRxThirdLevCat = BtrxThirdLevelCatr.Code;
															end else begin
																GIr.BTRxThirdLevCat = "";
																ErrAr[ErrCnt] = param & ": " & params[i];
																ErrAr2[ErrCnt] = param & chr(09) & params[i];
																ErrCnt = ErrCnt + 1;
															end;
														end;
													end;*/
				case"Name":				if(nonblank(params[i]))then begin GIr.Name = params[i]; end;
				case"NameRUS":		if(nonblank(params[i]))then begin GIr.NameRUS = params[i]; end;
				case"NameAZ":			if(nonblank(params[i]))then begin GIr.NameAZ = params[i]; end;
				case"Material":		if(blank(params[i]))then begin
														GIr.BPIMaterial = "";
													end else begin
														BTRxMaterialr.Name = trim(params[i]);
														if(readfirstkey("Name",BTRxMaterialr,1,true))then begin
															GIr.BPIMaterial = BTRxMaterialr.Code;
														end else begin
															BTRxMaterialr.Code = params[i];
															if(readfirstmain(BTRxMaterialr,1,true))then begin
																GIr.BPIMaterial = BTRxMaterialr.Code;
															end else begin
																// GIr.BPIMaterial = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																BTRxMaterialr.Code = "MATR99999";
																TrHs = true;
																while (LoopBackKey("Code",BTRxMaterialr,1,TrHs)) begin
																	OldCode = BTRxMaterialr.Code;
																	TrHs = false;
																end;
																ResetLoop(BTRxMaterialr);
																recordnew(BTRxMaterialr);
																if(blank(OldCode))then begin OldCode = "MATR00000"; end;
																NextCode(OldCode,BTRxMaterialr.Code);
																BTRxMaterialr.Name = params[i];
																recordinsert(BTRxMaterialr,true);
																recordupdate(BTRxMaterialr,BTRxMaterialr,true);
																GIr.BPIMaterial = BTRxMaterialr.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
				case"Plating":		if(blank(params[i]))then begin
														GIr.BPIPlating = "";
													end else begin
														BTRxPlatingr.Name = trim(params[i]);
														if(readfirstkey("Name",BTRxPlatingr,1,true))then begin
															GIr.BPIPlating = BTRxPlatingr.Code;
														end else begin
															BTRxPlatingr.Code = params[i];
															if(readfirstmain(BTRxPlatingr,1,true))then begin
																GIr.BPIPlating = BTRxPlatingr.Code;
															end else begin
																// GIr.BPIPlating = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																BTRxPlatingr.Code = "PLAT99999";
																TrHs = true;
																while (LoopBackKey("Code",BTRxPlatingr,1,TrHs)) begin
																	OldCode = BTRxPlatingr.Code;
																	TrHs = false;
																end;
																ResetLoop(BTRxPlatingr);
																recordnew(BTRxPlatingr);
																if(blank(OldCode))then begin OldCode = "PLAT00000"; end;
																NextCode(OldCode,BTRxPlatingr.Code);
																BTRxPlatingr.Name = params[i];
																recordinsert(BTRxPlatingr,true);
																recordupdate(BTRxPlatingr,BTRxPlatingr,true);
																GIr.BPIPlating = BTRxPlatingr.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
				case"Gender":			if(blank(params[i]))then begin
														GIr.BPISex = "";
													end else begin
														BTRxSexr.Name = trim(params[i]);
														if(readfirstkey("Name",BTRxSexr,1,true))then begin
															GIr.BPISex = BTRxSexr.Code;
														end else begin
															BTRxSexr.Code = params[i];
															if(readfirstmain(BTRxSexr,1,true))then begin
																GIr.BPISex = BTRxSexr.Code;
															end else begin
																// GIr.BPISex = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																BTRxSexr.Code = "SEX99999";
																TrHs = true;
																while (LoopBackKey("Code",BTRxSexr,1,TrHs)) begin
																	OldCode = BTRxSexr.Code;
																	TrHs = false;
																end;
																ResetLoop(BTRxSexr);
																recordnew(BTRxSexr);
																if(blank(OldCode))then begin OldCode = "SEX00000"; end;
																NextCode(OldCode,BTRxSexr.Code);
																BTRxSexr.Name = params[i];
																recordinsert(BTRxSexr,true);
																recordupdate(BTRxSexr,BTRxSexr,true);
																GIr.BPISex = BTRxSexr.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
				case"Size":				if(blank(params[i]))then begin
														GIr.BPISize = "";
													end else begin
														if (GIr.HansaCode == "R17080OX52") then begin  end;
														BTRxSizer.Name = trim(params[i]);
														if(readfirstkey("Name",BTRxSizer,1,true))then begin
															GIr.BPISize = BTRxSizer.Code;
														end else begin
															BTRxSizer.Code = params[i];
															if(readfirstmain(BTRxSizer,1,true))then begin
																GIr.BPISize = BTRxSizer.Code;
															end else begin
																// GIr.BPISize = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																BTRxSizer.Code = "SZ99999";
																TrHs = true;
																while (LoopBackKey("Code",BTRxSizer,1,TrHs)) begin
																	OldCode = BTRxSizer.Code;
																	TrHs = false;
																end;
																ResetLoop(BTRxSizer);
																recordnew(BTRxSizer);
																if(blank(OldCode))then begin OldCode = "SZ00000"; end;
																NextCode(OldCode,BTRxSizer.Code);
																BTRxSizer.Name = params[i];
																recordinsert(BTRxSizer,true);
																recordupdate(BTRxSizer,BTRxSizer,true);
																GIr.BPISize = BTRxSizer.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
				case"Weight":			GIr.StrWeight = params[i];
				case"Volume":			GIr.StrVolume = params[i];
				case"Diameter":		GIr.StrBTRxDiam = params[i];
				case"Width":			GIr.StrWidth = params[i];
				case"Length":			GIr.StrDepth = params[i];
				case"Height":			GIr.StrHeight = params[i];
				case"SetQty":			GIr.StrBTRxSetQty = params[i];
				case"FinGirth":		GIr.BTRxFingerGirth = params[i];
				case"ProdColor":	if(blank(params[i]))then begin
														GIr.BTRxProdColour = "";
													end else begin
														BTRxColorr.Name = trim(params[i]);
														if(readfirstkey("Name",BTRxColorr,1,true))then begin
															GIr.BTRxProdColour = BTRxColorr.Code;
														end else begin
															BTRxColorr.Code = params[i];
															if(readfirstmain(BTRxColorr,1,true))then begin
																GIr.BTRxProdColour = BTRxColorr.Code;
															end else begin
																// GIr.BTRxProdColour = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrCnt = ErrCnt + 1;
																BTRxColorr.Code = "CL99999";
																TrHs = true;
																while (LoopBackKey("Code",BTRxColorr,1,TrHs)) begin
																	OldCode = BTRxColorr.Code;
																	TrHs = false;
																end;
																ResetLoop(BTRxColorr);
																recordnew(BTRxColorr);
																if(blank(OldCode))then begin OldCode = "CL00000"; end;
																NextCode(OldCode,BTRxColorr.Code);
																BTRxColorr.Name = params[i];
																recordinsert(BTRxColorr,true);
																recordupdate(BTRxColorr,BTRxColorr,true);
																GIr.BTRxProdColour = BTRxColorr.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
				case"Cert":				GIr.Cert = params[i];
				case"Warranty":		GIr.BtrxWarranty = params[i];
				case"ScratchRes":	GIr.BtrxScratchRes = params[i];
				case"isLimit":		if(params[i]=="1")then begin GIr.BTRxLimitedGood = 1; end;
				case"Mech":				if(blank(params[i]))then begin
														GIr.BTRxWatchMechanism = "";
													end else begin
														BtrxWatchMechanr.Name = trim(params[i]);
														if(readfirstkey("Name",BtrxWatchMechanr,1,true))then begin
															GIr.BTRxWatchMechanism = BtrxWatchMechanr.Code;
														end else begin
															BtrxWatchMechanr.Code = params[i];
															if(readfirstmain(BtrxWatchMechanr,1,true))then begin
																GIr.BTRxWatchMechanism = BtrxWatchMechanr.Code;
															end else begin
																// GIr.BTRxWatchMechanism = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																BtrxWatchMechanr.Code = "WTMEC9999";
																TrHs = true;
																while (LoopBackKey("Code",BtrxWatchMechanr,1,TrHs)) begin
																	OldCode = BtrxWatchMechanr.Code;
																	TrHs = false;
																end;
																ResetLoop(BtrxWatchMechanr);
																recordnew(BtrxWatchMechanr);
																if(blank(OldCode))then begin OldCode = "WTMEC0000"; end;
																NextCode(OldCode,BtrxWatchMechanr.Code);
																BtrxWatchMechanr.Name = params[i];
																recordinsert(BtrxWatchMechanr,true);
																recordupdate(BtrxWatchMechanr,BtrxWatchMechanr,true);
																GIr.BTRxWatchMechanism = BtrxWatchMechanr.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
				case"LifeTime":		if(blank(params[i]))then begin
														GIr.BTRxPowerReserve = "";
													end else begin
														BtrxPowerReserver.Name = trim(params[i]);
														if(readfirstkey("Name",BtrxPowerReserver,1,true))then begin
															GIr.BTRxPowerReserve = BtrxPowerReserver.Code;
														end else begin
															BtrxPowerReserver.Code = params[i];
															if(readfirstmain(BtrxPowerReserver,1,true))then begin
																GIr.BTRxPowerReserve = BtrxPowerReserver.Code;
															end else begin
																// GIr.BTRxPowerReserve = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																BtrxPowerReserver.Code = "PWRES9999";
																TrHs = true;
																while (LoopBackKey("Code",BtrxPowerReserver,1,TrHs)) begin
																	OldCode = BtrxPowerReserver.Code;
																	TrHs = false;
																end;
																ResetLoop(BtrxPowerReserver);
																recordnew(BtrxPowerReserver);
																if(blank(OldCode))then begin OldCode = "PWRES0000"; end;
																NextCode(OldCode,BtrxPowerReserver.Code);
																BtrxPowerReserver.Name = params[i];
																recordinsert(BtrxPowerReserver,true);
																recordupdate(BtrxPowerReserver,BtrxPowerReserver,true);
																GIr.BTRxPowerReserve = BtrxPowerReserver.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
				case"Strap":			if(blank(params[i]))then begin
														GIr.BPIStrap = "";
													end else begin
														BTRxStrapr.Name = trim(params[i]);
														if(readfirstkey("Name",BTRxStrapr,1,true))then begin
															GIr.BPIStrap = BTRxStrapr.Code;
														end else begin
															BTRxStrapr.Code = params[i];
															if(readfirstmain(BTRxStrapr,1,true))then begin
																GIr.BPIStrap = BTRxStrapr.Code;
															end else begin
																// GIr.BPIStrap = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																BTRxStrapr.Code = "STRP99999";
																TrHs = true;
																while (LoopBackKey("Code",BTRxStrapr,1,TrHs)) begin
																	OldCode = BTRxStrapr.Code;
																	TrHs = false;
																end;
																ResetLoop(BTRxStrapr);
																recordnew(BTRxStrapr);
																if(blank(OldCode))then begin OldCode = "STRP00000"; end;
																NextCode(OldCode,BTRxStrapr.Code);
																BTRxStrapr.Name = params[i];
																recordinsert(BTRxStrapr,true);
																recordupdate(BTRxStrapr,BTRxStrapr,true);
																GIr.BPIStrap = BTRxStrapr.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
				case"StClolor":		if(blank(params[i]))then begin
														GIr.BTRxStrapColour = "";
													end else begin
														BTRxColorr.Name = trim(params[i]);
														if(readfirstkey("Name",BTRxColorr,1,true))then begin
															GIr.BTRxStrapColour = BTRxColorr.Code;
														end else begin
															BTRxColorr.Code = params[i];
															if(readfirstmain(BTRxColorr,1,true))then begin
																GIr.BTRxStrapColour = BTRxColorr.Code;
															end else begin
																// GIr.BTRxStrapColour = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																BTRxColorr.Code = "CL99999";
																TrHs = true;
																while (LoopBackKey("Code",BTRxColorr,1,TrHs)) begin
																	OldCode = BTRxColorr.Code;
																	TrHs = false;
																end;
																ResetLoop(BTRxColorr);
																recordnew(BTRxColorr);
																if(blank(OldCode))then begin OldCode = "CL00000"; end;
																NextCode(OldCode,BTRxColorr.Code);
																BTRxColorr.Name = params[i];
																recordinsert(BTRxColorr,true);
																recordupdate(BTRxColorr,BTRxColorr,true);
																GIr.BTRxStrapColour = BTRxColorr.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
				case"Com1":				if(blank(params[i]))then begin
														GIr.BTRxWatchGradeA = "";
													end else begin
														BtrxWatchGrader.Name = trim(params[i]);
														if(readfirstkey("Name",BtrxWatchGrader,1,true))then begin
															GIr.BTRxWatchGradeA = BtrxWatchGrader.Code;
														end else begin
															BtrxWatchGrader.Code = params[i];
															if(readfirstmain(BtrxWatchGrader,1,true))then begin
																GIr.BTRxWatchGradeA = BtrxWatchGrader.Code;
															end else begin
																// GIr.BTRxWatchGradeA = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																BtrxWatchGrader.Code = "WTGRD9999";
																TrHs = true;
																while (LoopBackKey("Code",BtrxWatchGrader,1,TrHs)) begin
																	OldCode = BtrxWatchGrader.Code;
																	TrHs = false;
																end;
																ResetLoop(BtrxWatchGrader);
																recordnew(BtrxWatchGrader);
																if(blank(OldCode))then begin OldCode = "WTGRD0000"; end;
																NextCode(OldCode,BtrxWatchGrader.Code);
																BtrxWatchGrader.Name = params[i];
																recordinsert(BtrxWatchGrader,true);
																recordupdate(BtrxWatchGrader,BtrxWatchGrader,true);
																GIr.BTRxWatchGradeA = BtrxWatchGrader.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
				case"Com2":				if(blank(params[i]))then begin
														GIr.BTRxWatchGradeB = "";
													end else begin
														BtrxWatchGrader.Name = trim(params[i]);
														if(readfirstkey("Name",BtrxWatchGrader,1,true))then begin
															GIr.BTRxWatchGradeB = BtrxWatchGrader.Code;
														end else begin
															BtrxWatchGrader.Code = params[i];
															if(readfirstmain(BtrxWatchGrader,1,true))then begin
																GIr.BTRxWatchGradeB = BtrxWatchGrader.Code;
															end else begin
																// GIr.BTRxWatchGradeB = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																BtrxWatchGrader.Code = "WTGRD9999";
																TrHs = true;
																while (LoopBackKey("Code",BtrxWatchGrader,1,TrHs)) begin
																	OldCode = BtrxWatchGrader.Code;
																	TrHs = false;
																end;
																ResetLoop(BtrxWatchGrader);
																recordnew(BtrxWatchGrader);
																if(blank(OldCode))then begin OldCode = "WTGRD0000"; end;
																NextCode(OldCode,BtrxWatchGrader.Code);
																BtrxWatchGrader.Name = params[i];
																recordinsert(BtrxWatchGrader,true);
																recordupdate(BtrxWatchGrader,BtrxWatchGrader,true);
																GIr.BTRxWatchGradeB = BtrxWatchGrader.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
				case"Com3":				if(blank(params[i]))then begin
														GIr.BTRxWatchGradeC = "";
													end else begin
														BtrxWatchGrader.Name = trim(params[i]);
														if(readfirstkey("Name",BtrxWatchGrader,1,true))then begin
															GIr.BTRxWatchGradeC = BtrxWatchGrader.Code;
														end else begin
															BtrxWatchGrader.Code = params[i];
															if(readfirstmain(BtrxWatchGrader,1,true))then begin
																GIr.BTRxWatchGradeC = BtrxWatchGrader.Code;
															end else begin
																// GIr.BTRxWatchGradeC = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																BtrxWatchGrader.Code = "WTGRD9999";
																TrHs = true;
																while (LoopBackKey("Code",BtrxWatchGrader,1,TrHs)) begin
																	OldCode = BtrxWatchGrader.Code;
																	TrHs = false;
																end;
																ResetLoop(BtrxWatchGrader);
																recordnew(BtrxWatchGrader);
																if(blank(OldCode))then begin OldCode = "WTGRD0000"; end;
																NextCode(OldCode,BtrxWatchGrader.Code);
																BtrxWatchGrader.Name = params[i];
																recordinsert(BtrxWatchGrader,true);
																recordupdate(BtrxWatchGrader,BtrxWatchGrader,true);
																GIr.BTRxWatchGradeC = BtrxWatchGrader.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
				case"Stone1":			if(blank(params[i]))then begin
														GIr.BTRxStoneA = "";
													end else begin
														BTRxStoner.Name = trim(params[i]);
														if(readfirstkey("Name",BTRxStoner,1,true))then begin
															GIr.BTRxStoneA = BTRxStoner.Code;
														end else begin
															BTRxStoner.Code = params[i];
															if(readfirstmain(BTRxStoner,1,true))then begin
																GIr.BTRxStoneA = BTRxStoner.Code;
															end else begin
																// GIr.BTRxStoneA = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																BTRxStoner.Code = "STN99999";
																TrHs = true;
																while (LoopBackKey("Code",BTRxStoner,1,TrHs)) begin
																	OldCode = BTRxStoner.Code;
																	TrHs = false;
																end;
																ResetLoop(BTRxStoner);
																recordnew(BTRxStoner);
																if(blank(OldCode))then begin OldCode = "STN00000"; end;
																NextCode(OldCode,BTRxStoner.Code);
																BTRxStoner.Name = params[i];
																recordinsert(BTRxStoner,true);
																recordupdate(BTRxStoner,BTRxStoner,true);
																GIr.BTRxStoneA = BTRxStoner.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
				case"Carat1":			GIr.BTRxStoneScattA = stringtoval(params[i],m4val);
				case"Stone2":			if(blank(params[i]))then begin
														GIr.BTRxStoneB = "";
													end else begin
														BTRxStoner.Name = trim(params[i]);
														if(readfirstkey("Name",BTRxStoner,1,true))then begin
															GIr.BTRxStoneB = BTRxStoner.Code;
														end else begin
															BTRxStoner.Code = params[i];
															if(readfirstmain(BTRxStoner,1,true))then begin
																GIr.BTRxStoneB = BTRxStoner.Code;
															end else begin
																// GIr.BTRxStoneB = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																BTRxStoner.Code = "STN99999";
																TrHs = true;
																while (LoopBackKey("Code",BTRxStoner,1,TrHs)) begin
																	OldCode = BTRxStoner.Code;
																	TrHs = false;
																end;
																ResetLoop(BTRxStoner);
																recordnew(BTRxStoner);
																if(blank(OldCode))then begin OldCode = "STN00000"; end;
																NextCode(OldCode,BTRxStoner.Code);
																BTRxStoner.Name = params[i];
																recordinsert(BTRxStoner,true);
																recordupdate(BTRxStoner,BTRxStoner,true);
																GIr.BTRxStoneB = BTRxStoner.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
				case"Carat2":			GIr.BTRxStoneScattB = stringtoval(params[i],m4val);
				case"Stone3":			if(blank(params[i]))then begin
														GIr.BTRxStoneC = "";
													end else begin
														BTRxStoner.Name = trim(params[i]);
														if(readfirstkey("Name",BTRxStoner,1,true))then begin
															GIr.BTRxStoneC = BTRxStoner.Code;
														end else begin
															BTRxStoner.Code = params[i];
															if(readfirstmain(BTRxStoner,1,true))then begin
																GIr.BTRxStoneC = BTRxStoner.Code;
															end else begin
																// GIr.BTRxStoneC = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																BTRxStoner.Code = "STN99999";
																TrHs = true;
																while (LoopBackKey("Code",BTRxStoner,1,TrHs)) begin
																	OldCode = BTRxStoner.Code;
																	TrHs = false;
																end;
																ResetLoop(BTRxStoner);
																recordnew(BTRxStoner);
																if(blank(OldCode))then begin OldCode = "STN00000"; end;
																NextCode(OldCode,BTRxStoner.Code);
																BTRxStoner.Name = params[i];
																recordinsert(BTRxStoner,true);
																recordupdate(BTRxStoner,BTRxStoner,true);
																GIr.BTRxStoneC = BTRxStoner.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
				case"Carat3":			GIr.BTRxStoneScattC = stringtoval(params[i],m4val);
				case"AllCarat":		GIr.BTRxPlacerScatt = stringtoval(params[i],m4val);
												
				case"Color":			if(blank(params[i]))then begin
														GIr.BPIColor = "";
													end else begin
														BTRxColorr.Name = trim(params[i]);
														if(readfirstkey("Name",BTRxColorr,1,true))then begin
															GIr.BPIColor = BTRxColorr.Code;
														end else begin
															BTRxColorr.Code = params[i];
															if(readfirstmain(BTRxColorr,1,true))then begin
																GIr.BPIColor = BTRxColorr.Code;
															end else begin
																// GIr.BPIColor = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																BTRxColorr.Code = "CL99999";
																TrHs = true;
																while (LoopBackKey("Code",BTRxColorr,1,TrHs)) begin
																	OldCode = BTRxColorr.Code;
																	TrHs = false;
																end;
																ResetLoop(BTRxColorr);
																recordnew(BTRxColorr);
																if(blank(OldCode))then begin OldCode = "CL00000"; end;
																NextCode(OldCode,BTRxColorr.Code);
																BTRxColorr.Name = params[i];
																recordinsert(BTRxColorr,true);
																recordupdate(BTRxColorr,BTRxColorr,true);
																GIr.BPIColor = BTRxColorr.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
				case"Odour":			if(blank(params[i]))then begin
														GIr.BPIOdour = "";
													end else begin
														BTRxOdourr.Name = trim(params[i]);
														if(readfirstkey("Name",BTRxOdourr,1,true))then begin
															GIr.BPIOdour = BTRxOdourr.Code;
														end else begin
															BTRxOdourr.Code = params[i];
															if(readfirstmain(BTRxOdourr,1,true))then begin
																GIr.BPIOdour = BTRxOdourr.Code;
															end else begin
																// GIr.BPIOdour = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																BTRxOdourr.Code = "ODR99999";
																TrHs = true;
																while (LoopBackKey("Code",BTRxOdourr,1,TrHs)) begin
																	OldCode = BTRxOdourr.Code;
																	TrHs = false;
																end;
																ResetLoop(BTRxOdourr);
																recordnew(BTRxOdourr);
																if(blank(OldCode))then begin OldCode = "ODR00000"; end;
																NextCode(OldCode,BTRxOdourr.Code);
																BTRxOdourr.Name = params[i];
																recordinsert(BTRxOdourr,true);
																recordupdate(BTRxOdourr,BTRxOdourr,true);
																GIr.BPIOdour = BTRxOdourr.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
				case"Phone":			if(blank(params[i]))then begin
														GIr.BTRxPhoneModel = "";
													end else begin
														BtrxPhoneModelr.Name = params[i];
														if(readfirstkey("Name",BtrxPhoneModelr,1,true))then begin
															GIr.BTRxPhoneModel = BtrxPhoneModelr.Code;
														end else begin
															BtrxPhoneModelr.Code = trim(params[i]);
															if(readfirstmain(BtrxPhoneModelr,1,true))then begin
																GIr.BTRxPhoneModel = BtrxPhoneModelr.Code;
															end else begin
																// GIr.BTRxPhoneModel = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																BtrxPhoneModelr.Code = "PHMOD9999";
																TrHs = true;
																while (LoopBackKey("Code",BtrxPhoneModelr,1,TrHs)) begin
																	OldCode = BtrxPhoneModelr.Code;
																	TrHs = false;
																end;
																ResetLoop(BtrxPhoneModelr);
																recordnew(BtrxPhoneModelr);
																if(blank(OldCode))then begin OldCode = "PHMOD0000"; end;
																NextCode(OldCode,BtrxPhoneModelr.Code);
																BtrxPhoneModelr.Name = params[i];
																recordinsert(BtrxPhoneModelr,true);
																recordupdate(BtrxPhoneModelr,BtrxPhoneModelr,true);
																GIr.BTRxPhoneModel = BtrxPhoneModelr.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
				case"ChaninMat":	if(blank(params[i]))then begin
														GIr.BTRxChainMaterial = "";
													end else begin
														BTRxMaterialr.Name = trim(params[i]);
														if(readfirstkey("Name",BTRxMaterialr,1,true))then begin
															GIr.BTRxChainMaterial = BTRxMaterialr.Code;
														end else begin
															BTRxMaterialr.Code = params[i];
															if(readfirstmain(BTRxMaterialr,1,true))then begin
																GIr.BTRxChainMaterial = BTRxMaterialr.Code;
															end else begin
																// GIr.BTRxChainMaterial = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																BTRxMaterialr.Code = "MATR99999";
																TrHs = true;
																while (LoopBackKey("Code",BTRxMaterialr,1,TrHs)) begin
																	OldCode = BTRxMaterialr.Code;
																	TrHs = false;
																end;
																ResetLoop(BTRxMaterialr);
																recordnew(BTRxMaterialr);
																if(blank(OldCode))then begin OldCode = "MATR00000"; end;
																NextCode(OldCode,BTRxMaterialr.Code);
																BTRxMaterialr.Name = params[i];
																recordinsert(BTRxMaterialr,true);
																recordupdate(BTRxMaterialr,BTRxMaterialr,true);
																GIr.BTRxChainMaterial = BTRxMaterialr.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
				case"Fill":				if(blank(params[i]))then begin
														GIr.BTRxFilling = "";
													end else begin
														BtrxFillingr.Name = trim(params[i]);
														if(readfirstkey("Name",BtrxFillingr,1,true))then begin
															GIr.BTRxFilling = BtrxFillingr.Code;
														end else begin
															BtrxFillingr.Code = params[i];
															if(readfirstmain(BtrxFillingr,1,true))then begin
																GIr.BTRxFilling = BtrxFillingr.Code;
															end else begin
																// GIr.BTRxFilling = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																BtrxFillingr.Code = "FILLN9999";
																TrHs = true;
																while (LoopBackKey("Code",BtrxFillingr,1,TrHs)) begin
																	OldCode = BtrxFillingr.Code;
																	TrHs = false;
																end;
																ResetLoop(BtrxFillingr);
																recordnew(BtrxFillingr);
																if(blank(OldCode))then begin OldCode = "FILLN0000"; end;
																NextCode(OldCode,BtrxFillingr.Code);
																BtrxFillingr.Name = params[i];
																recordinsert(BtrxFillingr,true);
																recordupdate(BtrxFillingr,BtrxFillingr,true);
																GIr.BTRxFilling = BtrxFillingr.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
				case"WaterRes":		if(blank(params[i]))then begin
														GIr.BTRxWatterRes = "";
													end else begin
														BtrxWatResr.Name = trim(params[i]);
														if(readfirstkey("Name",BtrxWatResr,1,true))then begin
															GIr.BTRxWatterRes = BtrxWatResr.Code;
														end else begin
															BtrxWatResr.Code = params[i];
															if(readfirstmain(BtrxWatResr,1,true))then begin
																GIr.BTRxWatterRes = BtrxWatResr.Code;
															end else begin
																// GIr.BTRxWatterRes = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																BtrxWatResr.Code = "WTRS9999";
																TrHs = true;
																while (LoopBackKey("Code",BtrxWatResr,1,TrHs)) begin
																	OldCode = BtrxWatResr.Code;
																	TrHs = false;
																end;
																ResetLoop(BtrxWatResr);
																recordnew(BtrxWatResr);
																if(blank(OldCode))then begin OldCode = "WTRS0000"; end;
																NextCode(OldCode,BtrxWatResr.Code);
																BtrxWatResr.Name = params[i];
																recordinsert(BtrxWatResr,true);
																recordupdate(BtrxWatResr,BtrxWatResr,true);
																GIr.BTRxWatterRes = BtrxWatResr.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
				case"StrapMat":		if(blank(params[i]))then begin
														GIr.BTRxStrapMat = "";
													end else begin
														BTRxMaterialr.Name = trim(params[i]);
														if(readfirstkey("Name",BTRxMaterialr,1,true))then begin
															GIr.BTRxStrapMat = BTRxMaterialr.Code;
														end else begin
															BTRxMaterialr.Code = params[i];
															if(readfirstmain(BTRxMaterialr,1,true))then begin
																GIr.BTRxStrapMat = BTRxMaterialr.Code;
															end else begin
																// GIr.BTRxStrapMat = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																BTRxMaterialr.Code = "MATR99999";
																TrHs = true;
																while (LoopBackKey("Code",BTRxMaterialr,1,TrHs)) begin
																	OldCode = BTRxMaterialr.Code;
																	TrHs = false;
																end;
																ResetLoop(BTRxMaterialr);
																recordnew(BTRxMaterialr);
																if(blank(OldCode))then begin OldCode = "MATR00000"; end;
																NextCode(OldCode,BTRxMaterialr.Code);
																BTRxMaterialr.Name = params[i];
																recordinsert(BTRxMaterialr,true);
																recordupdate(BTRxMaterialr,BTRxMaterialr,true);
																GIr.BTRxStrapMat = BTRxMaterialr.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
				case"BracelMat":		if(blank(params[i]))then begin
														GIr.BTRxBracelMat = "";
													end else begin
														BTRxMaterialr.Name = trim(params[i]);
														if(readfirstkey("Name",BTRxMaterialr,1,true))then begin
															GIr.BTRxBracelMat = BTRxMaterialr.Code;
														end else begin
															BTRxMaterialr.Code = params[i];
															if(readfirstmain(BTRxMaterialr,1,true))then begin
																GIr.BTRxBracelMat = BTRxMaterialr.Code;
															end else begin
																// GIr.BTRxBracelMat = "";
																// ErrAr[ErrCnt] = param & ": " & params[i];
																// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																// ErrCnt = ErrCnt + 1;
																BTRxMaterialr.Code = "MATR99999";
																TrHs = true;
																while (LoopBackKey("Code",BTRxMaterialr,1,TrHs)) begin
																	OldCode = BTRxMaterialr.Code;
																	TrHs = false;
																end;
																ResetLoop(BTRxMaterialr);
																recordnew(BTRxMaterialr);
																if(blank(OldCode))then begin OldCode = "MATR00000"; end;
																NextCode(OldCode,BTRxMaterialr.Code);
																BTRxMaterialr.Name = params[i];
																recordinsert(BTRxMaterialr,true);
																recordupdate(BTRxMaterialr,BTRxMaterialr,true);
																GIr.BTRxBracelMat = BTRxMaterialr.Code;
																res = true;
																OldCode = "";
															end;
														end;
													end;
					case"Collection":		if(blank(params[i]))then begin
																GIr.BtrxCollection = "";
															end else begin
																BtrxCollectionr.Name = trim(params[i]);
																if(readfirstkey("Name",BtrxCollectionr,1,true))then begin
																	GIr.BtrxCollection = BtrxCollectionr.Code;
																end else begin
																	BtrxCollectionr.Code = params[i];
																	if(readfirstmain(BtrxCollectionr,1,true))then begin
																		GIr.BtrxCollection = BtrxCollectionr.Code;
																	end else begin
																		// GIr.BTRxBracelMat = "";
																		// ErrAr[ErrCnt] = param & ": " & params[i];
																		// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																		// ErrCnt = ErrCnt + 1;
																		BtrxCollectionr.Code = "COLL9999";
																		TrHs = true;
																		while (LoopBackKey("Code",BtrxCollectionr,1,TrHs)) begin
																			OldCode = BtrxCollectionr.Code;
																			TrHs = false;
																		end;
																		ResetLoop(BtrxCollectionr);
																		recordnew(BtrxCollectionr);
																		if(blank(OldCode))then begin OldCode = "COLL0000"; end;
																		NextCode(OldCode,BtrxCollectionr.Code);
																		BtrxCollectionr.Name = params[i];
																		recordinsert(BtrxCollectionr,true);
																		recordupdate(BtrxCollectionr,BtrxCollectionr,true);
																		GIr.BtrxCollection = BtrxCollectionr.Code;
																		res = true;
																		OldCode = "";
																	end;
																end;
															end;
					case"ClockFaceColour":	if(blank(params[i]))then begin
																		GIr.BtrxClockFaceColour = "";
																	end else begin
																		BTRxColorr.Name = trim(params[i]);
																		if(readfirstkey("Name",BTRxColorr,1,true))then begin
																			GIr.BtrxClockFaceColour = BTRxColorr.Code;
																		end else begin
																			BTRxColorr.Code = params[i];
																			if(readfirstmain(BTRxColorr,1,true))then begin
																				GIr.BtrxClockFaceColour = BTRxColorr.Code;
																			end else begin
																				// GIr.BTRxBracelMat = "";
																				// ErrAr[ErrCnt] = param & ": " & params[i];
																				// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																				// ErrCnt = ErrCnt + 1;
																				BTRxColorr.Code = "CL99999";
																				TrHs = true;
																				while (LoopBackKey("Code",BTRxColorr,1,TrHs)) begin
																					OldCode = BTRxColorr.Code;
																					TrHs = false;
																				end;
																				ResetLoop(BTRxColorr);
																				recordnew(BTRxColorr);
																				if(blank(OldCode))then begin OldCode = "CL00000"; end;
																				NextCode(OldCode,BTRxColorr.Code);
																				BTRxColorr.Name = params[i];
																				recordinsert(BTRxColorr,true);
																				recordupdate(BTRxColorr,BTRxColorr,true);
																				GIr.BtrxClockFaceColour = BTRxColorr.Code;
																				res = true;
																				OldCode = "";
																			end;
																		end;
																	end;
																	
					case"Complications":	if(blank(params[i]))then begin
																		GIr.BtrxComplications = "";
																	end else begin
																		BtrxComplicationsr.Name = trim(params[i]);
																		if(readfirstkey("Name",BtrxComplicationsr,1,true))then begin
																			GIr.BtrxComplications = BtrxComplicationsr.Code;
																		end else begin
																			BtrxComplicationsr.Code = params[i];
																			if(readfirstmain(BtrxComplicationsr,1,true))then begin
																				GIr.BtrxComplications = BtrxComplicationsr.Code;
																			end else begin
																				// GIr.BTRxBracelMat = "";
																				// ErrAr[ErrCnt] = param & ": " & params[i];
																				// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																				// ErrCnt = ErrCnt + 1;
																				BtrxComplicationsr.Code = "CMP99999";
																				TrHs = true;
																				while (LoopBackKey("Code",BtrxComplicationsr,1,TrHs)) begin
																					OldCode = BtrxComplicationsr.Code;
																					TrHs = false;
																				end;
																				ResetLoop(BtrxComplicationsr);
																				recordnew(BtrxComplicationsr);
																				if(blank(OldCode))then begin OldCode = "CMP00000"; end;
																				NextCode(OldCode,newCode);
																				BtrxComplicationsr.Name = params[i];
																				BtrxComplicationsr.Code = newCode;
																				recordinsert(BtrxComplicationsr,true);
																				recordupdate(BtrxComplicationsr,BtrxComplicationsr,true);
																				GIr.BtrxComplications = BtrxComplicationsr.Code;
																				res = true;
																				OldCode = "";
																			end;
																		end;
																	end;
					case"ClockFaceMaterial":	if(blank(params[i]))then begin
																		GIr.BtrxClockFaceMaterial = "";
																	end else begin
																		BTRxMaterialr.Name = trim(params[i]);
																		if(readfirstkey("Name",BTRxMaterialr,1,true))then begin
																			GIr.BtrxClockFaceMaterial = BTRxMaterialr.Code;
																		end else begin
																			BTRxMaterialr.Code = params[i];
																			if(readfirstmain(BTRxMaterialr,1,true))then begin
																				GIr.BtrxClockFaceMaterial = BTRxMaterialr.Code;
																			end else begin
																				// GIr.BTRxBracelMat = "";
																				// ErrAr[ErrCnt] = param & ": " & params[i];
																				// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																				// ErrCnt = ErrCnt + 1;
																				BTRxMaterialr.Code = "MATR99999";
																				TrHs = true;
																				while (LoopBackKey("Code",BTRxMaterialr,1,TrHs)) begin
																					OldCode = BTRxMaterialr.Code;
																					TrHs = false;
																				end;
																				ResetLoop(BTRxMaterialr);
																				recordnew(BTRxMaterialr);
																				if(blank(OldCode))then begin OldCode = "MATR00000"; end;
																				NextCode(OldCode,BTRxMaterialr.Code);
																				BTRxMaterialr.Name = params[i];
																				recordinsert(BTRxMaterialr,true);
																				recordupdate(BTRxMaterialr,BTRxMaterialr,true);
																				GIr.BtrxClockFaceMaterial = BTRxMaterialr.Code;
																				res = true;
																				OldCode = "";
																			end;
																		end;
																	end;
					case"MicrowaveProtect":	if(blank(params[i]))then begin
																		GIr.BtrxMicrowaveProtect = "";
																	end else begin
																		BtrxMicrowaveProtectr.Name = trim(params[i]);
																		if(readfirstkey("Name",BtrxMicrowaveProtectr,1,true))then begin
																			GIr.BtrxMicrowaveProtect = BtrxMicrowaveProtectr.Code;
																		end else begin
																			BtrxMicrowaveProtectr.Code = params[i];
																			if(readfirstmain(BtrxMicrowaveProtectr,1,true))then begin
																				GIr.BtrxMicrowaveProtect = BtrxMicrowaveProtectr.Code;
																			end else begin
																				// GIr.BTRxBracelMat = "";
																				// ErrAr[ErrCnt] = param & ": " & params[i];
																				// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																				// ErrCnt = ErrCnt + 1;
																				BtrxMicrowaveProtectr.Code = "MPR99999";
																				TrHs = true;
																				while (LoopBackKey("Code",BtrxMicrowaveProtectr,1,TrHs)) begin
																					OldCode = BtrxMicrowaveProtectr.Code;
																					TrHs = false;
																				end;
																				ResetLoop(BtrxMicrowaveProtectr);
																				recordnew(BtrxMicrowaveProtectr);
																				if(blank(OldCode))then begin OldCode = "MPR00000"; end;
																				NextCode(OldCode,BtrxMicrowaveProtectr.Code);
																				BtrxMicrowaveProtectr.Name = params[i];
																				recordinsert(BtrxMicrowaveProtectr,true);
																				recordupdate(BtrxMicrowaveProtectr,BtrxMicrowaveProtectr,true);
																				GIr.BtrxMicrowaveProtect = BtrxMicrowaveProtectr.Code;
																				res = true;
																				OldCode = "";
																			end;
																		end;
																	end;
					case"StoveCompat":			if(blank(params[i]))then begin
																		GIr.BtrxStoveCompat = "";
																	end else begin
																		BtrxStoveCompatr.Name = trim(params[i]);
																		if(readfirstkey("Name",BtrxStoveCompatr,1,true))then begin
																			GIr.BtrxStoveCompat = BtrxStoveCompatr.Code;
																		end else begin
																			BtrxStoveCompatr.Code = params[i];
																			if(readfirstmain(BtrxStoveCompatr,1,true))then begin
																				GIr.BtrxStoveCompat = BtrxStoveCompatr.Code;
																			end else begin
																				// GIr.BTRxBracelMat = "";
																				// ErrAr[ErrCnt] = param & ": " & params[i];
																				// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																				// ErrCnt = ErrCnt + 1;
																				BtrxStoveCompatr.Code = "STC99999";
																				TrHs = true;
																				while (LoopBackKey("Code",BtrxStoveCompatr,1,TrHs)) begin
																					OldCode = BtrxStoveCompatr.Code;
																					TrHs = false;
																				end;
																				ResetLoop(BtrxStoveCompatr);
																				recordnew(BtrxStoveCompatr);
																				if(blank(OldCode))then begin OldCode = "STC00000"; end;
																				NextCode(OldCode,BtrxStoveCompatr.Code);
																				BtrxStoveCompatr.Name = params[i];
																				recordinsert(BtrxStoveCompatr,true);
																				recordupdate(BtrxStoveCompatr,BtrxStoveCompatr,true);
																				GIr.BtrxStoveCompat = BtrxStoveCompatr.Code;
																				res = true;
																				OldCode = "";
																			end;
																		end;
																	end;
					case"AllMaterials":			if(blank(params[i]))then begin
																		GIr.BtrxAllMaterials = "";
																	end else begin
																		BtrxAllMaterialsr.Name = trim(params[i]);
																		if(readfirstkey("Name",BtrxAllMaterialsr,1,true))then begin
																			GIr.BtrxAllMaterials = BtrxAllMaterialsr.Code;
																		end else begin
																			BtrxAllMaterialsr.Code = params[i];
																			if(readfirstmain(BtrxAllMaterialsr,1,true))then begin
																				GIr.BtrxAllMaterials = BtrxAllMaterialsr.Code;
																			end else begin
																				// GIr.BTRxBracelMat = "";
																				// ErrAr[ErrCnt] = param & ": " & params[i];
																				// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																				// ErrCnt = ErrCnt + 1;
																				BtrxAllMaterialsr.Code = "AM999999";
																				TrHs = true;
																				while (LoopBackKey("Code",BtrxAllMaterialsr,1,TrHs)) begin
																					OldCode = BtrxAllMaterialsr.Code;
																					TrHs = false;
																				end;
																				ResetLoop(BtrxAllMaterialsr);
																				recordnew(BtrxAllMaterialsr);
																				if(blank(OldCode))then begin OldCode = "AM000000"; end;
																				NextCode(OldCode,BtrxAllMaterialsr.Code);
																				BtrxAllMaterialsr.Name = params[i];
																				recordinsert(BtrxAllMaterialsr,true);
																				recordupdate(BtrxAllMaterialsr,BtrxAllMaterialsr,true);
																				GIr.BtrxAllMaterials = BtrxAllMaterialsr.Code;
																				res = true;
																				OldCode = "";
																			end;
																		end;
																	end;
					case"MetalCont":			if(blank(params[i]))then begin
																		GIr.BtrxPrecMetalCont = "";
																	end else begin
																		BtrxPrecMetalContr.Name = trim(params[i]);
																		if(readfirstkey("Name",BtrxPrecMetalContr,1,true))then begin
																			GIr.BtrxPrecMetalCont = BtrxPrecMetalContr.Code;
																		end else begin
																			BtrxPrecMetalContr.Code = params[i];
																			if(readfirstmain(BtrxPrecMetalContr,1,true))then begin
																				GIr.BtrxPrecMetalCont = BtrxPrecMetalContr.Code;
																			end else begin
																				// GIr.BTRxBracelMat = "";
																				// ErrAr[ErrCnt] = param & ": " & params[i];
																				// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																				// ErrCnt = ErrCnt + 1;
																				BtrxPrecMetalContr.Code = "PMC99999";
																				TrHs = true;
																				while (LoopBackKey("Code",BtrxPrecMetalContr,1,TrHs)) begin
																					OldCode = BtrxPrecMetalContr.Code;
																					TrHs = false;
																				end;
																				ResetLoop(BtrxPrecMetalContr);
																				recordnew(BtrxPrecMetalContr);
																				if(blank(OldCode))then begin OldCode = "PMC00000"; end;
																				NextCode(OldCode,BtrxPrecMetalContr.Code);
																				BtrxPrecMetalContr.Name = params[i];
																				recordinsert(BtrxPrecMetalContr,true);
																				recordupdate(BtrxPrecMetalContr,BtrxPrecMetalContr,true);
																				GIr.BtrxPrecMetalCont = BtrxPrecMetalContr.Code;
																				res = true;
																				OldCode = "";
																			end;
																		end;
																	end;
					case"CaseDiam":			if(blank(params[i]))then begin
																		GIr.BtrxCaseDiam = "";
																	end else begin
																		BtrxCaseDiamr.Name = trim(params[i]);
																		if(readfirstkey("Name",BtrxCaseDiamr,1,true))then begin
																			GIr.BtrxCaseDiam = BtrxCaseDiamr.Code;
																		end else begin
																			BtrxCaseDiamr.Code = params[i];
																			if(readfirstmain(BtrxCaseDiamr,1,true))then begin
																				GIr.BtrxCaseDiam = BtrxCaseDiamr.Code;
																			end else begin
																				// GIr.BTRxBracelMat = "";
																				// ErrAr[ErrCnt] = param & ": " & params[i];
																				// ErrAr2[ErrCnt] = param & chr(09) & params[i];
																				// ErrCnt = ErrCnt + 1;
																				BtrxCaseDiamr.Code = "CD999999";
																				TrHs = true;
																				while (LoopBackKey("Code",BtrxCaseDiamr,1,TrHs)) begin
																					OldCode = BtrxCaseDiamr.Code;
																					TrHs = false;
																				end;
																				ResetLoop(BtrxCaseDiamr);
																				recordnew(BtrxCaseDiamr);
																				if(blank(OldCode))then begin OldCode = "CD000000"; end;
																				NextCode(OldCode,BtrxCaseDiamr.Code);
																				BtrxCaseDiamr.Name = params[i];
																				recordinsert(BtrxCaseDiamr,true);
																				recordupdate(BtrxCaseDiamr,BtrxCaseDiamr,true);
																				GIr.BtrxCaseDiam = BtrxCaseDiamr.Code;
																				res = true;
																				OldCode = "";
																			end;
																		end;
																	end;
					case"PF1":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PF10":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PF11":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PF2":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PF3":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PF4":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PF5":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PF6":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PF7":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PF8":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PF9":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PG1":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PG2":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PG3":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PO1":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PO10":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PO11":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PO12":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PO2":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PO3":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PO4":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PO5":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PO6":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PO7":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PO8":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
					case"PO9":		if(nonblank(params[i]))then begin
													if(!SetInSet(params[i],GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & params[i];
													end;
													if(!SetInSet(params[i],GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & params[i];
													end;
												end;
			end;
		end;
	end;
	GIWasUpdated(GIr,LogGIr," GIWasUpdatedlog 110");
	recordstore(GIr,true);
	if (nonblank(finRow)) then begin
		logtext(0,finRow & " FILENAME!!!");
		MoveFile(finRow,"/mnt/database/Ecommerce/ECommerceIN","/mnt/database/Ecommerce/ECommerceOUT");
		delete_file("/mnt/database/Ecommerce/ECommerceIN/" & finRow);
		runprogram("chmod","-R a+rw /mnt/database/Ecommerce");
	end;
return;
end;




function boolean CheckItemBitrixClassQueued(record GlobalItemVc GIr,array string headers,array string params, var array string ErrAr, var integer ErrCnt,var array string ErrAr2,var vector string classCode)
begin
	record BTRxBrandVc BTRxBrandr;
	record BTRxMaterialVc BTRxMaterialr;
	record BTRxColourVc BTRxColorr;
	record BTRxSizeVc BTRxSizer;
	record BTRxSexVc BTRxSexr;
	record BTRxPlatingVc BTRxPlatingr;
	record BTRxStoneVc BTRxStoner;
	record BTRxStrapVc BTRxStrapr;
	record BTRxOdourVc BTRxOdourr;
	record BtrxInternalCatVc BtrxInternalCatr;
	record BtrxFirstLevelCatVc BtrxFirstLevelCatr;
	record BtrxSecondLevelCatVc BtrxSecondLevelCatr, BSLLastCoder;
	record BtrxThirdLevelCatVc BtrxThirdLevelCatr, BTLLastCoder;
	record BtrxFourthLevelCatVc BtrxFourthLevelCatr, BFLLastCoder;
	record BtrxCertificateVc BtrxCertificater;
	record BtrxWatchMechanVc BtrxWatchMechanr;
	record BtrxPowerReserveVc BtrxPowerReserver;
	record BtrxWatchGradeVc BtrxWatchGrader;
	record BtrxPhoneModelVc BtrxPhoneModelr;
	record BtrxFillingVc BtrxFillingr;
	record BtrxTypeVc BtrxTyper;
	record BtrxWaterResistantVc BtrxWatResr;
	record BtrxStrapMatVc BtrxStrapMatr;
	record BtrxBracelMatVc BtrxBracelMatr;
	record BtrxCollectionVc BtrxCollectionr;
	record BtrxComplicationsVc BtrxComplicationsr;
	record BtrxMicrowaveProtectVc BtrxMicrowaveProtectr;
	record BtrxStoveCompatVc BtrxStoveCompatr;
	record BtrxAllMaterialsVc BtrxAllMaterialsr;
	record BtrxPrecMetalContVc BtrxPrecMetalContr;
	record BtrxCaseDiamVc BtrxCaseDiamr;
	
	integer i, pos;
	string 100 param, OldCode, newCode;
	boolean res, TrHs, testf, THRDf, catrtreef, createdf;
	string 255 catName, catNameRUS, catNameAZ, parametr, paramsStr, Name3catrus, Name3cataz, tree3Code;
	
	setcompany(1,false);
	
	newCode = "";
	GIr.BTRxGiftClass = "";
	res = true;
	logtext(0,"CheckItemBitrixClassQueued");
	for(i=0;i<headers.length;i=i+1)begin
		param = headers[i];
		if (left(param,5)!="JSON_") then begin
			params[i] = trim(params[i]);
			switch(param)begin
				case"Brand": 			if(nonblank(params[i]))then begin
														BTRxBrandr.Name = params[i];
														if(!readfirstkey("Name",BTRxBrandr,1,true))then begin
															BTRxBrandr.Code = params[i];
															if(!readfirstmain(BTRxBrandr,1,true))then begin
																ErrAr[ErrCnt] = param & ": " & params[i];
																ErrCnt = ErrCnt + 1;
															end;
														end;
													end;
				case"IntCat": 		res = true;
				case"Type": 			res = true;
				case"Cat1":				if(nonblank(params[i]))then begin
														BtrxFirstLevelCatr.Name = params[i];
														if(!readfirstkey("Name",BtrxFirstLevelCatr,1,true))then begin
															BtrxFirstLevelCatr.Code = params[i];
															if(!readfirstmain(BtrxFirstLevelCatr,1,true))then begin
																ErrAr[ErrCnt] = param & ": " & params[i];
																ErrAr2[ErrCnt] = param & chr(09) & params[i];
																ErrCnt = ErrCnt + 1;
															end;
														end;
													end;
				case"Cat2":				if(nonblank(params[i]))then begin
														BtrxSecondLevelCatr.Name = params[i];
														if(!readfirstkey("Name",BtrxSecondLevelCatr,1,true))then begin
															BtrxSecondLevelCatr.Code = params[i];
															if(!readfirstmain(BtrxSecondLevelCatr,1,true))then begin
																ErrAr[ErrCnt] = param & ": " & params[i];
																ErrAr2[ErrCnt] = param & chr(09) & params[i];
																ErrCnt = ErrCnt + 1;
															end;
														end;
													end;
				case"Cat3":				if(nonblank(params[i]))then begin
														BtrxThirdLevelCatr.Name = trim(params[i]);
														if(!readfirstkey("Name",BtrxThirdLevelCatr,1,true))then begin
															BtrxThirdLevelCatr.Code = params[i];
															if(!readfirstmain(BtrxThirdLevelCatr,1,true))then begin
																ErrAr[ErrCnt] = param & ": " & params[i];
																ErrAr2[ErrCnt] = param & chr(09) & params[i];
																ErrCnt = ErrCnt + 1;
															end;
														end;
													end;
				case"Cat4":				if(nonblank(params[i]))then begin
														BtrxFourthLevelCatr.Name = trim(params[i]);
														if(!readfirstkey("Name",BtrxFourthLevelCatr,1,true))then begin
															BtrxFourthLevelCatr.Code = params[i];
															if(!readfirstmain(BtrxFourthLevelCatr,1,true))then begin
																ErrAr[ErrCnt] = param & ": " & params[i];
																ErrAr2[ErrCnt] = param & chr(09) & params[i];
																ErrCnt = ErrCnt + 1;
															end;
														end;
													end;
				case"Name":				res = true;
				case"NameRUS":		res = true;
				case"NameAZ":			res = true;
				case"Material":		res = true;
				case"Plating":		res = true;
				case"Gender":			res = true;
				case"Size":				res = true;
				case"Weight":			res = true;
				case"Volume":			res = true;
				case"Diameter":		res = true;
				case"Width":			res = true;
				case"Length":			res = true;
				case"Height":			res = true;
				case"SetQty":			res = true;
				case"FinGirth":		res = true;
				case"ProdColor":	res = true;
				case"Cert":				res = true;
				case"Warranty":		res = true;
				case"ScratchRes":	res = true;
				case"isLimit":		res = true;
				case"Mech":				res = true;
				case"LifeTime":		res = true;
				case"Strap":			res = true;
				case"StClolor":		res = true;
				case"Com1":				res = true;
				case"Com2":				res = true;
				case"Com3":				res = true;
				case"Stone1":			res = true;
				case"Carat1":			res = true;
				case"Stone2":			res = true;
				case"Carat2":			res = true;
				case"Stone3":			res = true;
				case"Carat3":			res = true;
				case"AllCarat":		res = true;
				case"Color":			res = true;
				case"Odour":			res = true;
				case"Phone":			res = true;
				case"ChaninMat":	res = true;
				case"Fill":				res = true;
				case"WaterRes":		res = true;
				case"StrapMat":		res = true;
				case"BracelMat":	res = true;
				case"Collection":		res = true;
				case"ClockFaceColour":	res = true;
				case"Complications":	res = true;
				case"ClockFaceMaterial":	res = true;
				case"MicrowaveProtect":	res = true;
				case"StoveCompat":			res = true;
				case"AllMaterials":			res = true;
				case"MetalCont":			res = true;
				case"CaseDiam":			res = true;
				case"WebSSect":			res = true;
				case"AdditionalCat":			res = true;
				case"PF1":		res = true;
				case"PF10":		res = true;
				case"PF11":		res = true;
				case"PF2":		res = true;
				case"PF3":		res = true;
				case"PF4":		res = true;
				case"PF5":		res = true;
				case"PF6":		res = true;
				case"PF7":		res = true;
				case"PF8":		res = true;
				case"PF9":		res = true;
				case"PG1":		res = true;
				case"PG2":		res = true;
				case"PG3":		res = true;
				case"PO1":		res = true;
				case"PO10":		res = true;
				case"PO11":		res = true;
				case"PO12":		res = true;
				case"PO2":		res = true;
				case"PO3":		res = true;
				case"PO4":		res = true;
				case"PO5":		res = true;
				case"PO6":		res = true;
				case"PO7":		res = true;
				case"PO8":		res = true;
				case"PO9":		res = true;
				otherwise 
											ErrAr[ErrCnt] = USetStr(36352) & " \"" & param & "\" " & ": " & params[i];
											ErrAr2[ErrCnt] = param & chr(09) & params[i];
											ErrCnt = ErrCnt + 1;
			end;
		end;
	end;
	CheckItemBitrixClassQueued = res;
return;
end;










function boolean CheckClassNOJSONType(string HDR)
begin
	
	boolean res;
	
	
		res = false;
		switch(HDR)begin
			case"Brand": 			res = true;
			case"IntCat": 		res = true;
			case"Type": 			res = true;
			case"Cat1":				res = true;
			case"Cat2":				res = true;
			case"Cat3":				res = true;
			case"Cat4":				res = true;
			case"Name":				res = true;
			case"NameRUS":		res = true;
			case"NameAZ":			res = true;
			case"Material":		res = true;
			case"Plating":		res = true;
			case"Gender":			res = true;
			case"Size":				res = true;
			case"Weight":			res = true;
			case"Volume":			res = true;
			case"Diameter":		res = true;
			case"Width":			res = true;
			case"Length":			res = true;
			case"Height":			res = true;
			case"SetQty":			res = true;
			case"FinGirth":		res = true;
			case"ProdColor":	res = true;
			case"Cert":				res = true;
			case"Warranty":		res = true;
			case"ScratchRes":	res = true;
			case"isLimit":		res = true;
			case"Mech":				res = true;
			case"LifeTime":		res = true;
			case"Strap":			res = true;
			case"StClolor":		res = true;
			case"Com1":				res = true;
			case"Com2":				res = true;
			case"Com3":				res = true;
			case"Stone1":			res = true;
			case"Carat1":			res = true;
			case"Stone2":			res = true;
			case"Carat2":			res = true;
			case"Stone3":			res = true;
			case"Carat3":			res = true;
			case"AllCarat":		res = true;
			case"Color":			res = true;
			case"Odour":			res = true;
			case"Phone":			res = true;
			case"ChaninMat":	res = true;
			case"Fill":				res = true;
			case"WaterRes":		res = true;
			case"StrapMat":		res = true;
			case"BracelMat":	res = true;
			case"Collection":		res = true;
			case"ClockFaceColour":	res = true;
			case"Complications":	res = true;
			case"ClockFaceMaterial":	res = true;
			case"MicrowaveProtect":	res = true;
			case"StoveCompat":			res = true;
			case"AllMaterials":			res = true;
			case"MetalCont":			res = true;
			case"CaseDiam":			res = true;
			case"PF1":		res = true;
			case"PF10":		res = true;
			case"PF11":		res = true;
			case"PF2":		res = true;
			case"PF3":		res = true;
			case"PF4":		res = true;
			case"PF5":		res = true;
			case"PF6":		res = true;
			case"PF7":		res = true;
			case"PF8":		res = true;
			case"PF9":		res = true;
			case"PG1":		res = true;
			case"PG2":		res = true;
			case"PG3":		res = true;
			case"PO1":		res = true;
			case"PO10":		res = true;
			case"PO11":		res = true;
			case"PO12":		res = true;
			case"PO2":		res = true;
			case"PO3":		res = true;
			case"PO4":		res = true;
			case"PO5":		res = true;
			case"PO6":		res = true;
			case"PO7":		res = true;
			case"PO8":		res = true;
			case"PO9":		res = true;
			case"WebSSect":		res = true;
			case"AdditionalCat":		res = true;
			otherwise 
										res = false;
		end;
	CheckClassNOJSONType = res;
return;
end;




















global updating procedure AddClassInRegisters (string param,string name)
begin
	record BTRxBrandVc BTRxBrandr;
	record BTRxMaterialVc BTRxMaterialr;
	record BTRxColourVc BTRxColorr;
	record BTRxSizeVc BTRxSizer;
	record BTRxSexVc BTRxSexr;
	record BTRxPlatingVc BTRxPlatingr;
	record BTRxStoneVc BTRxStoner;
	record BTRxStrapVc BTRxStrapr;
	record BTRxOdourVc BTRxOdourr;
	record BtrxInternalCatVc BtrxInternalCatr;
	record BtrxFirstLevelCatVc BtrxFirstLevelCatr;
	record BtrxSecondLevelCatVc BtrxSecondLevelCatr;
	record BtrxThirdLevelCatVc BtrxThirdLevelCatr;
	record BtrxCertificateVc BtrxCertificater;
	record BtrxWatchMechanVc BtrxWatchMechanr;
	record BtrxPowerReserveVc BtrxPowerReserver;
	record BtrxWatchGradeVc BtrxWatchGrader;
	record BtrxPhoneModelVc BtrxPhoneModelr;
	record BtrxFillingVc BtrxFillingr;
	record BtrxTypeVc BtrxTyper;
	record BtrxWaterResistantVc BtrxWatResr;
	record BtrxComplicationsVc BtrxComplicationsr;
	record BtrxMicrowaveProtectVc BtrxMicrowaveProtectr;
	record BtrxStoveCompatVc BtrxStoveCompatr;

	if(nonblank(param))then begin
		switch(param)begin
			case"IntCat": 		BtrxInternalCatr.Name = name;
												if(!readfirstkey("Name",BtrxInternalCatr,1,true))then begin
													recordnew(BtrxInternalCatr);
													BtrxInternalCatr.Name = name;
													recordinsert(BtrxInternalCatr,true);
													recordupdate(BtrxInternalCatr,BtrxInternalCatr,true);
												end;
			case"Type": 			BtrxTyper.Name = name;
												if(!readfirstkey("Name",BtrxTyper,1,true))then begin
													recordnew(BtrxTyper);
													BtrxTyper.Name = name;
													recordinsert(BtrxTyper,true);
													recordupdate(BtrxTyper,BtrxTyper,true);
												end;									
			case"Cat1":				BtrxFirstLevelCatr.Name = name;
												if(!readfirstkey("Name",BtrxFirstLevelCatr,1,true))then begin
													recordnew(BtrxFirstLevelCatr);
													BtrxFirstLevelCatr.Name = name;
													recordinsert(BtrxFirstLevelCatr,true);
													recordupdate(BtrxFirstLevelCatr,BtrxFirstLevelCatr,true);
												end;
			case"Cat2":				BtrxSecondLevelCatr.Name = name;
												if(!readfirstkey("Name",BtrxSecondLevelCatr,1,true))then begin
													recordnew(BtrxSecondLevelCatr);
													BtrxSecondLevelCatr.Name = name;
													recordinsert(BtrxSecondLevelCatr,true);
													recordupdate(BtrxSecondLevelCatr,BtrxSecondLevelCatr,true);
												end;
			case"Cat3":				BtrxThirdLevelCatr.Name = name;
												if(!readfirstkey("Name",BtrxThirdLevelCatr,1,true))then begin
													recordnew(BtrxThirdLevelCatr);
													BtrxThirdLevelCatr.Name = name;
													recordinsert(BtrxThirdLevelCatr,true);
													recordupdate(BtrxThirdLevelCatr,BtrxThirdLevelCatr,true);
												end;
			case"Material":		BtrxMaterialr.Name = name;
												if(!readfirstkey("Name",BtrxMaterialr,1,true))then begin
													recordnew(BtrxMaterialr);
													BtrxMaterialr.Name = name;
													recordinsert(BtrxMaterialr,true);
													recordupdate(BtrxMaterialr,BtrxMaterialr,true);
												end;
			case"Plating":		BtrxPlatingr.Name = name;
												if(!readfirstkey("Name",BtrxPlatingr,1,true))then begin
													recordnew(BtrxPlatingr);
													BtrxPlatingr.Name = name;
													recordinsert(BtrxPlatingr,true);
													recordupdate(BtrxPlatingr,BtrxPlatingr,true);
												end;
			case"Gender":			BtrxSexr.Name = name;
												if(!readfirstkey("Name",BtrxSexr,1,true))then begin
													recordnew(BtrxSexr);
													BtrxSexr.Name = name;
													recordinsert(BtrxSexr,true);
													recordupdate(BtrxSexr,BtrxSexr,true);
												end;
			case"Size":				BtrxSizer.Name = name;
												if(!readfirstkey("Name",BtrxSizer,1,true))then begin
													recordnew(BtrxSizer);
													BtrxSizer.Name = name;
													recordinsert(BtrxSizer,true);
													recordupdate(BtrxSizer,BtrxSizer,true);
												end;
			case"ProdColor":	BtrxColorr.Name = name;
												if(!readfirstkey("Name",BtrxColorr,1,true))then begin
													recordnew(BtrxColorr);
													BtrxColorr.Name = name;
													recordinsert(BtrxColorr,true);
													recordupdate(BtrxColorr,BtrxColorr,true);
												end;
			case"Mech":				BtrxWatchMechanr.Name = name;
												if(!readfirstkey("Name",BtrxWatchMechanr,1,true))then begin
													recordnew(BtrxWatchMechanr);
													BtrxWatchMechanr.Name = name;
													recordinsert(BtrxWatchMechanr,true);
													recordupdate(BtrxWatchMechanr,BtrxWatchMechanr,true);
												end;
			case"LifeTime":		BtrxPowerReserver.Name = name;
												if(!readfirstkey("Name",BtrxPowerReserver,1,true))then begin
													recordnew(BtrxPowerReserver);
													BtrxPowerReserver.Name = name;
													recordinsert(BtrxPowerReserver,true);
													recordupdate(BtrxPowerReserver,BtrxPowerReserver,true);
												end;
			case"Strap":			BtrxStrapr.Name = name;
												if(!readfirstkey("Name",BtrxStrapr,1,true))then begin
													recordnew(BtrxStrapr);
													BtrxStrapr.Name = name;
													recordinsert(BtrxStrapr,true);
													recordupdate(BtrxStrapr,BtrxStrapr,true);
												end;
			case"StClolor":		BtrxColorr.Name = name;
												if(!readfirstkey("Name",BtrxColorr,1,true))then begin
													recordnew(BtrxColorr);
													BtrxColorr.Name = name;
													recordinsert(BtrxColorr,true);
													recordupdate(BtrxColorr,BtrxColorr,true);
												end;
			case"Com":				BtrxWatchGrader.Name = name;
												if(!readfirstkey("Name",BtrxWatchGrader,1,true))then begin
													recordnew(BtrxWatchGrader);
													BtrxWatchGrader.Name = name;
													recordinsert(BtrxWatchGrader,true);
													recordupdate(BtrxWatchGrader,BtrxWatchGrader,true);
												end;
			case"Stone":			BtrxStoner.Name = name;
												if(!readfirstkey("Name",BtrxStoner,1,true))then begin
													recordnew(BtrxStoner);
													BtrxStoner.Name = name;
													recordinsert(BtrxStoner,true);
													recordupdate(BtrxStoner,BtrxStoner,true);
												end;
			case"Color":			BtrxColorr.Name = name;
												if(!readfirstkey("Name",BtrxColorr,1,true))then begin
													recordnew(BtrxColorr);
													BtrxColorr.Name = name;
													recordinsert(BtrxColorr,true);
													recordupdate(BtrxColorr,BtrxColorr,true);
												end;
			case"Odour":			BtrxOdourr.Name = name;
												if(!readfirstkey("Name",BtrxOdourr,1,true))then begin
													recordnew(BtrxOdourr);
													BtrxOdourr.Name = name;
													recordinsert(BtrxOdourr,true);
													recordupdate(BtrxOdourr,BtrxOdourr,true);
												end;
			case"Phone":			BtrxPhoneModelr.Name = name;
												if(!readfirstkey("Name",BtrxPhoneModelr,1,true))then begin
													recordnew(BtrxPhoneModelr);
													BtrxPhoneModelr.Name = name;
													recordinsert(BtrxPhoneModelr,true);
													recordupdate(BtrxPhoneModelr,BtrxPhoneModelr,true);
												end;
			case"ChaninMat":	BtrxMaterialr.Name = name;
												if(!readfirstkey("Name",BtrxMaterialr,1,true))then begin
													recordnew(BtrxMaterialr);
													BtrxMaterialr.Name = name;
													recordinsert(BtrxMaterialr,true);
													recordupdate(BtrxMaterialr,BtrxMaterialr,true);
												end;
			case"Fill":				BtrxFillingr.Name = name;
												if(!readfirstkey("Name",BtrxFillingr,1,true))then begin
													recordnew(BtrxFillingr);
													BtrxFillingr.Name = name;
													recordinsert(BtrxFillingr,true);
													recordupdate(BtrxFillingr,BtrxFillingr,true);
												end;
			case"WaterRes":		BtrxWatResr.Name = name;
												if(!readfirstkey("Name",BtrxWatResr,1,true))then begin
													recordnew(BtrxWatResr);
													BtrxWatResr.Name = name;
													recordinsert(BtrxWatResr,true);
													recordupdate(BtrxWatResr,BtrxWatResr,true);
												end;
			case"Complications":BtrxComplicationsr.Name = name;
													if(!readfirstkey("Name",BtrxComplicationsr,1,true))then begin
														recordnew(BtrxComplicationsr);
														BtrxComplicationsr.Name = name;
														recordinsert(BtrxComplicationsr,true);
														recordupdate(BtrxComplicationsr,BtrxComplicationsr,true);
													end;
			case"MicrowaveProtect":BtrxMicrowaveProtectr.Name = name;
														if(!readfirstkey("Name",BtrxMicrowaveProtectr,1,true))then begin
															recordnew(BtrxMicrowaveProtectr);
															BtrxMicrowaveProtectr.Name = name;
															recordinsert(BtrxMicrowaveProtectr,true);
															recordupdate(BtrxMicrowaveProtectr,BtrxMicrowaveProtectr,true);
														end;
			case"StoveCompat":	BtrxStoveCompatr.Name = name;
													if(!readfirstkey("Name",BtrxStoveCompatr,1,true))then begin
														recordnew(BtrxStoveCompatr);
														BtrxStoveCompatr.Name = name;
														recordinsert(BtrxStoveCompatr,true);
														recordupdate(BtrxStoveCompatr,BtrxStoveCompatr,true);
													end;
		end;
	end;
return;
end;





global updating procedure ImportAddClassInRegistersIn(record RcVc RepSpec)
begin
record INVc INr,oldINr;
integer i,curcomp,cnt,j,k,CompQty;
record GlobalItemVc GIr;
string 100 artcode,brand,newBrand,code,glCode,tstr;
record BPIBrandVc BPIBrandr;
record BPIBrandVc BPIBrand1r;
array string 100 headers;
string 100 param;
record CompaniesBlock Compb;
row CompaniesBlock Comprw;
		
	BlockLoad(Compb);
	
	logtext(0,"ImportAddClassInRegistersIn start");
	CompQty = matrowcnt(Compb);
	curcomp = currentcompany;	
	
	tstr = importfield;
	if(tstr!=USetStr(36229))then begin
		logtext(0,"ImportAddClassIn codepage error");
		while (TestEOF()==false) begin
			if (NextImportLine(true)) then begin end;
		end;
		goto lImportAddClassInRegistersIn;
	end;
	if (NextImportLine(true)) then begin end;
	while(nonblank(tstr))begin
		tstr = importfield;
		if(nonblank(tstr))then begin
			StripEndingSpaces(tstr);
			headers[headers.length] = tstr;
		end;
	end;
	if (NextImportLine(true)) then begin end;

	while (TestEOF()==false) begin
		for(i=0;i<headers.length;i=i+1)begin
			param = importfield;
			if(nonblank(param))then begin
				AddClassInRegisters(headers[i],param);
			end;
		end;
		if (NextImportLine(true)) then begin end;
	end;
	lImportAddClassInRegistersIn:;
logtext(0,"ImportAddClassInRegistersIn end");
return;
end;






global updating procedure ImportGiftsSearchItemCodesFromBarIn(record RcVc RepSpec)
begin
	record INVc INr,oldINr;
	integer i,curcomp,cnt,j,k,CompQty,ErrCnt1,ErrCnt2,mtrw,INComp;
	record GlobalItemVc GIr,LogGIr;
	string 100 artcode,brand,newBrand,code,glCode,tstr,cntstr;
	record BPIBrandVc BPIBrandr;
	record BPIBrandVc BPIBrand1r;
	area ErrAr1, ErrAr2, reply;
	array string 255 abrand,anewbrand,ErrArr;
	array string 100 headers,params;
	record CompaniesBlock Compb;
	row CompaniesBlock Comprw;
	vector boolean Errf;
	boolean Itemf;
	area ArtArea;

	cnt = 0;
	tstr = importfield;
	while (nonblank(tstr)) begin
		cnt = cnt + 1;
		tstr = importfield;
	end;
	if (NextImportLine(true)) then begin end;
	while (TestEOF()==false) begin
		Itemf = false;
		tstr = importfield;
		INr.Code = tstr;
		if(ReadFirstMain(INr,1,true))then begin
			GIr.Code = INr.GlobalArtCode;
			if(ReadFirstMain(GIr,1,true))then begin
				Itemf = true;
			end;
		end else begin
			INr.BarCode = tstr;
			if(ReadFirstKey("BarCode",INr,1,true))then begin
				GIr.Code = INr.GlobalArtCode;
				if(ReadFirstMain(GIr,1,true))then begin
					Itemf = true;
				end;
			end else begin
				INr.AlternativeCode = tstr;
				if(ReadFirstKey("AlternativeCode",INr,1,true))then begin
					GIr.Code = INr.GlobalArtCode;
					if(ReadFirstMain(GIr,1,true))then begin
						Itemf = true;
					end;
				end;
			end;
		end;
		if(Itemf)then begin
			recordcopy(LogGIr,GIr);
			tstr = importfield;
			for (i=0;i<cnt;i=i+1) begin
				switch(tstr)begin
					case"PF1":		if(nonblank(tstr))then begin
												if(!SetInSet(tstr,GIr.BTRxThirdLevCat))then begin
													if(nonblank(GIr.BTRxThirdLevCat))then begin
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
													end;
													GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & tstr;
												end;
												if(!SetInSet(tstr,GIr.BTRxGiftClass))then begin
													if(nonblank(GIr.BTRxGiftClass))then begin
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
													end;
													GIr.BTRxGiftClass = GIr.BTRxGiftClass & tstr;
												end;
											end;
					case"PF10":		if(nonblank(tstr))then begin
													if(!SetInSet(tstr,GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & tstr;
													end;
													if(!SetInSet(tstr,GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & tstr;
													end;
												end;
					case"PF11":		if(nonblank(tstr))then begin
													if(!SetInSet(tstr,GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & tstr;
													end;
													if(!SetInSet(tstr,GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & tstr;
													end;
												end;
					case"PF2":		if(nonblank(tstr))then begin
													if(!SetInSet(tstr,GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & tstr;
													end;
													if(!SetInSet(tstr,GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & tstr;
													end;
												end;
					case"PF3":		if(nonblank(tstr))then begin
													if(!SetInSet(tstr,GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & tstr;
													end;
													if(!SetInSet(tstr,GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & tstr;
													end;
												end;
					case"PF4":		if(nonblank(tstr))then begin
													if(!SetInSet(tstr,GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & tstr;
													end;
													if(!SetInSet(tstr,GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & tstr;
													end;
												end;
					case"PF5":		if(nonblank(tstr))then begin
													if(!SetInSet(tstr,GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & tstr;
													end;
													if(!SetInSet(tstr,GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & tstr;
													end;
												end;
					case"PF6":		if(nonblank(tstr))then begin
													if(!SetInSet(tstr,GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & tstr;
													end;
													if(!SetInSet(tstr,GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & tstr;
													end;
												end;
					case"PF7":		if(nonblank(tstr))then begin
													if(!SetInSet(tstr,GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & tstr;
													end;
													if(!SetInSet(tstr,GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & tstr;
													end;
												end;
					case"PF8":		if(nonblank(tstr))then begin
													if(!SetInSet(tstr,GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & tstr;
													end;
													if(!SetInSet(tstr,GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & tstr;
													end;
												end;
					case"PF9":		if(nonblank(tstr))then begin
													if(!SetInSet(tstr,GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & tstr;
													end;
													if(!SetInSet(tstr,GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & tstr;
													end;
												end;
					case"PG1":		if(nonblank(tstr))then begin
													if(!SetInSet(tstr,GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & tstr;
													end;
													if(!SetInSet(tstr,GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & tstr;
													end;
												end;
					case"PG2":		if(nonblank(tstr))then begin
													if(!SetInSet(tstr,GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & tstr;
													end;
													if(!SetInSet(tstr,GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & tstr;
													end;
												end;
					case"PG3":		if(nonblank(tstr))then begin
													if(!SetInSet(tstr,GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & tstr;
													end;
													if(!SetInSet(tstr,GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & tstr;
													end;
												end;
					case"PO1":		if(nonblank(tstr))then begin
													if(!SetInSet(tstr,GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & tstr;
													end;
													if(!SetInSet(tstr,GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & tstr;
													end;
												end;
					case"PO10":		if(nonblank(tstr))then begin
													if(!SetInSet(tstr,GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & tstr;
													end;
													if(!SetInSet(tstr,GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & tstr;
													end;
												end;
					case"PO11":		if(nonblank(tstr))then begin
													if(!SetInSet(tstr,GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & tstr;
													end;
													if(!SetInSet(tstr,GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & tstr;
													end;
												end;
					case"PO12":		if(nonblank(tstr))then begin
													if(!SetInSet(tstr,GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & tstr;
													end;
													if(!SetInSet(tstr,GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & tstr;
													end;
												end;
					case"PO2":		if(nonblank(tstr))then begin
													if(!SetInSet(tstr,GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & tstr;
													end;
													if(!SetInSet(tstr,GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & tstr;
													end;
												end;
					case"PO3":		if(nonblank(tstr))then begin
													if(!SetInSet(tstr,GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & tstr;
													end;
													if(!SetInSet(tstr,GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & tstr;
													end;
												end;
					case"PO4":		if(nonblank(tstr))then begin
													if(!SetInSet(tstr,GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & tstr;
													end;
													if(!SetInSet(tstr,GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & tstr;
													end;
												end;
					case"PO5":		if(nonblank(tstr))then begin
													if(!SetInSet(tstr,GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & tstr;
													end;
													if(!SetInSet(tstr,GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & tstr;
													end;
												end;
					case"PO6":		if(nonblank(tstr))then begin
													if(!SetInSet(tstr,GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & tstr;
													end;
													if(!SetInSet(tstr,GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & tstr;
													end;
												end;
					case"PO7":		if(nonblank(tstr))then begin
													if(!SetInSet(tstr,GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & tstr;
													end;
													if(!SetInSet(tstr,GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & tstr;
													end;
												end;
					case"PO8":		if(nonblank(tstr))then begin
													if(!SetInSet(tstr,GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & tstr;
													end;
													if(!SetInSet(tstr,GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & tstr;
													end;
												end;
					case"PO9":		if(nonblank(tstr))then begin
													if(!SetInSet(tstr,GIr.BTRxThirdLevCat))then begin
														if(nonblank(GIr.BTRxThirdLevCat))then begin
															GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & ",";
														end;
														GIr.BTRxThirdLevCat = GIr.BTRxThirdLevCat & tstr;
													end;
													if(!SetInSet(tstr,GIr.BTRxGiftClass))then begin
														if(nonblank(GIr.BTRxGiftClass))then begin
															GIr.BTRxGiftClass = GIr.BTRxGiftClass & ",";
														end;
														GIr.BTRxGiftClass = GIr.BTRxGiftClass & tstr;
													end;
												end;
					
				end;
				tstr = importfield;
			end;
			GIWasUpdated(GIr,LogGIr," GIWasUpdatedlog 111");
			if(Itemf and RecordStore(GIr,true))then begin
			end;
		end;
		if (NextImportLine(true)) then begin end;
	end;



return;
end;



global updating procedure ImportSearchItemCodesFromBarIn(record RcVc RepSpec)
begin
	record INVc INr,oldINr;
	integer i,curcomp,cnt,j,k,CompQty,ErrCnt1,ErrCnt2,mtrw,INComp;
	record GlobalItemVc GIr;
	string 100 artcode,brand,newBrand,code,glCode,tstr,cntstr;
	record BPIBrandVc BPIBrandr;
	record BPIBrandVc BPIBrand1r;
	area ErrAr1, ErrAr2, reply;
	array string 255 abrand,anewbrand,ErrArr;
	array string 100 headers,params;
	record CompaniesBlock Compb;
	row CompaniesBlock Comprw;
	vector boolean Errf;
	boolean Itemf;
	area ArtArea;
	
	curcomp = CurrentCompany;
	logtext(0,"ImportSearchItemCodesFromBarIn start");
	AddTextToArea	("Code type" & chr(09) & "Source" & chr(09) & "Item Code" & chr(09) & "Company" & chr(13),ArtArea);
	while (TestEOF()==false) begin
		Itemf = false;
		tstr = importfield;
		if(nonblank(tstr))then begin
			BlockLoad(Compb);
			mtrw = matrowcnt(Compb);
			for (i=0;i<mtrw;i=i+1) begin
				matrowget(Compb,i,Comprw);
				if(Comprw.ActiveStatus==0 and (!CompanyIsJWLikeCompany(i+1) or i+1==3) and i+1!=10 and i+1!=32 and i+1!=29 and i+1!=18)then begin
					SetCompany(i+1,false);
					INr.Code = tstr;
					if(ReadFirstMain(INr,1,true))then begin
						AddTextToArea	("ItemCode: " & chr(09) & tstr & chr(09) & INr.Code & chr(09) & Comprw.ShortName & chr(13),ArtArea);
						// logtext(0,"ItemCode: " & INr.Code);
						Itemf = true;
					end else begin
						INr.BarCode = tstr;
						if(ReadFirstKey("BarCode",INr,1,true))then begin
							AddTextToArea	("BarCode: " & chr(09) & tstr & chr(09) & INr.Code & chr(09) & Comprw.ShortName & chr(13),ArtArea);
							// logtext(0,"ItemCode: " & INr.Code);
							Itemf = true;
						end else begin
							INr.AlternativeCode = tstr;
							if(ReadFirstKey("AlternativeCode",INr,1,true))then begin
								AddTextToArea	("AlternativeCode: " & chr(09) & tstr & chr(09) & INr.Code & chr(09) & Comprw.ShortName & chr(13),ArtArea);
								// logtext(0,"ItemCode: " & INr.Code);
								Itemf = true;
							end;
						end;
					end;
				end;
			end;
			if(!Itemf)then begin
				AddTextToArea	("This code: " & chr(09) & tstr & chr(09) & "Not found!" & chr(13),ArtArea);
			end;
		end;
		ResetCompany(curcomp);
		if (NextImportLine(true)) then begin end;
	end;

	WriteAreaToFile	(ArtArea,"BTRxErrMail.txt",0);
	logtext(0,"ImportSearchItemCodesFromBarIn finish");
	return;
end;


global updating procedure FindItemParamForCRMIn(record RcVc RepSpec)
begin
	record INVc INr,oldINr;
	integer i,curcomp,cnt,j,k,CompQty,ErrCnt1,ErrCnt2,mtrw,INComp;
	record GlobalItemVc GIr;
	string 100 type,item;
	area ErrAr1, ErrAr2, reply;
	vector string 255 agroup,asubgroup,acollection,acateg;
	record CompaniesBlock Compb;
	row CompaniesBlock Comprw;
	vector boolean Errf;
	boolean Itemf;
	area ArtArea;
	boolean TrHs;
	record BPIGroupVc BPIGroupr; 
	record BPISubGroupVc BPISubGroupr;
	record BPICollectionVc BPICollectionr;
	record BPICategoryVc BPICategoryr;
		
	while(loopmain(BPIGroupr,1,true))begin
		agroup[BPIGroupr.Code] = BPIGroupr.Name;
	end;
	while(loopmain(BPISubGroupr,1,true))begin
		asubgroup[BPISubGroupr.Code] = BPISubGroupr.Name;
	end;
	while(loopmain(BPICollectionr,1,true))begin
		acollection[BPICollectionr.Code] = BPICollectionr.Name;
	end;
	while(loopmain(BPICategoryr,1,true))begin
		acateg[BPICategoryr.Code] = BPICategoryr.Name;
	end;
	
	curcomp = CurrentCompany;
	logtext(0,"start FindItemParamForCRMIn");
	AddTextToArea	("ItemCode" & chr(09) & "Group" & chr(09) & chr(09) & "SubGroup" & chr(09) & chr(09) & "Collection" & chr(09) & chr(09) & "Category" & chr(13),ArtArea);
	while (TestEOF()==false) begin
		type = importfield;
		item = importfield;
		
		TrHs = true;
		resetloop(GIr);
		GIr.HansaCode = item;
		while(loopkey("HansaCode",GIr,1,TrHs))begin
			if(GIr.HansaCode!=item)then begin TrHs = false; end;
			
			if(TrHs and GIr.BPISubGroup==type)then begin
					AddTextToArea	(GIr.HansaCode & chr(09) & GIr.BPIGroup & chr(09) & agroup[GIr.BPIGroup] & chr(09) & GIr.BPISubGroup & chr(09) & asubgroup[GIr.BPISubGroup] & chr(09) & GIr.BPICollection & chr(09) & acollection[GIr.BPICollection] & chr(09) & GIr.BPICategory & chr(09) & acateg[GIr.BPICategory] & chr(13),ArtArea);
			end;
		end;
		
		if (NextImportLine(true)) then begin end;
	end;
	createfile("CRMItemsParams.txt");
	WriteAreaToFile	(ArtArea,"CRMItemsParams.txt",0);
	logtext(0,"finish FindItemParamForCRMIn");
	return;
end;






global updating procedure ImportAddMainItemIn(record RcVc RepSpec)
begin
record INVc INr,oldINr;
integer i,curcomp,cnt,j,k,CompQty,ErrCnt1,ErrCnt2,mtrw,INComp,pos;
record GlobalItemVc GIr, MainGIr;
string 100 artcode,brand,newBrand,code,glCode,tstr,cntstr,OldCode,lev3cat, LevCode;
record BPIBrandVc BPIBrandr;
record BPIBrandVc BPIBrand1r;
area ErrAr1, ErrAr2, reply;
array string 255 abrand,anewbrand,ErrArr;
array string 100 headers,params;
record CompaniesBlock Compb;
row CompaniesBlock Comprw;
vector boolean Errf;
boolean INrf, TrHs2;
record BtrxThirdLevelCatVc BtrxThirdLevelCatr, BTLLastCoder;

	messagebox(0,"Procedure disabled!");
	i = 0;
	k = 0;
	logtext(0,"ImportAddMainItemIn start");
	while (TestEOF()==false) begin
		/*brand = ImportField;
		artcode = ImportField;
		if(nonblank(brand) and nonblank(artcode))then begin
			BPIBrandr.Name = brand;
			if(readfirstkey("Name",BPIBrandr,1,true))then begin
				artcode = BPIBrandr.Code & "_" & artcode;
				GIr.Code = artcode;
				if(readfirstmain(GIr,1,true))then begin
					glCode = ImportField;
					MainGIr.Code = glCode;
					if(ReadFirstMain(MainGIr,1,true))then begin
						GIr.MainCode = MainGIr.Code;
						GIr.MainItemFlag = 1;
						GIr.IsVariant = 1;
						if(RecordStore(GIr,true))then begin
							logtext(0,GIr.Code & "  Updated MainCode");
						end;
					end else begin
						MainGIr.Code = glCode;
						MainGIr.Brand = brand;
						MainGIr.NameRUS = ImportField;
						MainGIr.Name = ImportField;
						MainGIr.BTRxFirstLevCat = GIr.BTRxFirstLevCat;
						MainGIr.BTRxSecondLevCat = GIr.BTRxSecondLevCat;
						MainGIr.MainItemFlag = 0;
						MainGIr.IsVariant = 1;
						MainGIr.BPIBrand = GIr.BPIBrand;
						MainGIr.AlternativeCode = glCode;
						MainGIr.HansaCode = glCode;
						lev3cat = GIr.BTRxThirdLevCat;
						pos = 0;
						ExtractObjWithSeparator(",",lev3cat,true,pos,LevCode);
						while (nonblank(LevCode) and left(LevCode,5)=="THLVL") begin
							BtrxThirdLevelCatr.Code = LevCode;
							if(ReadFirstmain(BtrxThirdLevelCatr,1,true))then begin
								MainGIr.BTRxThirdLevCat = BtrxThirdLevelCatr.Code;
							end;
							ExtractObjWithSeparator(",",lev3cat,true,pos,LevCode);
						end;
						if(RecordStore(MainGIr,true))then begin
							logtext(0,MainGIr.Code & "  Created MainItem");
							GIr.MainCode = MainGIr.Code;
							GIr.MainItemFlag = 1;
							GIr.IsVariant = 1;
							if(RecordStore(GIr,true))then begin
								logtext(0,GIr.Code & "  Updated MainCode");
							end;
						end;
					end;
				end;
			end;
		end;*/
		if (NextImportLine(true)) then begin end;
	end;
	
return;
end;










//  Import("?????? ?????????? ??????? ??? Bitrix",ImportIClass,ImportAddClassIn,modBtrx);
// 36229 = ???????? ?????????
global updating procedure ImportAddClassIn(record RcVc RepSpec)
begin
record INVc INr,oldINr;
integer i,curcomp,cnt,j,k,CompQty,ErrCnt1,ErrCnt2,mtrw,INComp,StatAllRows,StatOkRows,StatFailItemRows,StatFailClassRows,ErrClasscnt,ErrCnt3;
record GlobalItemVc GIr,LogGIr;
string 100 artcode,brand,newBrand,code,glCode,tstr,cntstr,origartcode;
record BPIBrandVc BPIBrandr;
record BPIBrandVc BPIBrand1r;
area ErrAr1, ErrAr2, reply;
array string 255 abrand,anewbrand,ErrArr,ErrAr3;
array string 100 headers,params;
record CompaniesBlock Compb;
row CompaniesBlock Comprw;
vector boolean Errf, Classf;
array string 255 Class;
boolean INrf;
vector string 255 classCode;

		
	BlockLoad(Compb);
	
	logtext(0,"ImportAddClassIn start");
	CompQty = matrowcnt(Compb);
	curcomp = currentcompany;	
	//SetImportCodePage("CP1251");
	SetCompany(1,false);
	tstr = importfield;
	tstr = right(tstr,(len(tstr)-1));
	// logtext(0,USetStr(36229));
	if(tstr!=USetStr(36229))then begin
		logtext(0,"ImportAddClassIn codepage error");
		while (TestEOF()==false) begin
			if (NextImportLine(true)) then begin end;
		end;
		goto lImportAddClassIn;
	end;
	if (NextImportLine(true)) then begin end;
	tstr = importfield;
	//tstr = importfield;
	while(nonblank(tstr))begin
		tstr = importfield;
		if(nonblank(tstr))then begin
			StripEndingSpaces(tstr);
			headers[headers.length] = tstr;
		end;
	end;
	if (NextImportLine(true)) then begin end;
	ErrCnt1 = 2;
	AddTextToArea	(USetStr(36266) & chr(09) & USetStr(36267) & chr(09) & USetStr(36268) & chr(09) & USetStr(36269) & chr(13),ErrAr1);
	StatAllRows = 0;
	StatOkRows = 0;
	StatFailItemRows = 0;
	StatFailClassRows = 0;
	ErrClasscnt = 0;
	while (TestEOF()==false) begin
		StatAllRows = StatAllRows + 1;
		for(i=0;i<headers.length;i=i+1)begin
			params[i] = "";
		end;
		cnt = cnt + 1;
		artcode = importfield;
		StripEndingSpaces(artcode);
		origartcode = artcode;
		brand = importfield;
		StripEndingSpaces(brand);
		params[0] = brand;
		for(i=1;i<headers.length;i=i+1)begin
			tstr = importfield;
			params[i] = tstr;
		end;
		BPIBrandr.Name = brand;
		if(readfirstkey("Name",BPIBrandr,1,true))then begin
			mtrw = matrowcnt(Compb);
			INrf = false;
			INComp = 0;
			for (i=0;i<mtrw;i=i+1) begin
				matrowget(Compb,i,Comprw);
				if(Comprw.ActiveStatus==0 and (!CompanyIsJWLikeCompany(i+1) or i+1==3) and i+1!=10 and i+1!=32)then begin
					SetCompany(i+1,false);
					INr.Code = artcode;
					if(ReadFirstMain(INr,1,true))then begin
						if(INr.BPIBrand==BPIBrandr.Code)then begin 
							INComp = i+1;
							INrf = true; 
							i = mtrw;
						end;
					end;
				end;
			end;
			resetcompany(curcomp);
			artcode = BPIBrandr.Code & "_" & artcode;
			GIr.Code = artcode;
			if(readfirstmain(GIr,1,true))then begin
				ErrCnt2 = 0;
				recordcopy(LogGIr,GIr);
				if(SetItemBitrixClass(GIr,headers,params,ErrArr,ErrCnt2,ErrAr3,classCode))then begin
					if(ErrCnt2>0)then begin
						ErrCnt1 = ErrCnt1 + 1;
						AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand & chr(09) & USetStr(36264) & chr(09),ErrAr1);
						for (i=0;i<ErrCnt2;i=i+1) begin
							AddTextToArea	((i+1) & ". " & ErrArr[i] & " - " & USetStr(36238) & chr(09),ErrAr1);
							if(!Classf[ErrArr[i]])then begin
								Classf[ErrArr[i]] = true;
								Class[ErrClasscnt] = ErrAr3[i];
								ErrClasscnt = ErrClasscnt + 1;
							end;
						end;
						AddTextToArea	(chr(13),ErrAr1);
						StatFailClassRows = StatFailClassRows + 1;
					end else begin
						ErrCnt1 = ErrCnt1 + 1;
						AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand &  chr(09) & USetStr(36265) & chr(13),ErrAr1);
						StatOkRows = StatOkRows + 1;
					end;
					GIWasUpdated(GIr,LogGIr," GIWasUpdatedlog 112");
					recordstore(GIr,true);
					GIr.Code = "CP_" & artcode;
					if(readfirstmain(GIr,1,true))then begin
						recordcopy(LogGIr,GIr);
						if(SetItemBitrixClass(GIr,headers,params,ErrArr,ErrCnt2,ErrAr3,classCode))then begin
							if(ErrCnt2>0)then begin
								ErrCnt1 = ErrCnt1 + 1;
								AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand & chr(09) & USetStr(36264) & chr(09),ErrAr1);
								for (i=0;i<ErrCnt2;i=i+1) begin
									AddTextToArea	((i+1) & ". " & ErrArr[i] & " - " & USetStr(36238) & chr(09),ErrAr1);
									if(!Classf[ErrArr[i]])then begin
										Classf[ErrArr[i]] = true;
										Class[ErrClasscnt] = ErrAr3[i];
										ErrClasscnt = ErrClasscnt + 1;
									end;
								end;
								AddTextToArea	(chr(13),ErrAr1);
								StatFailClassRows = StatFailClassRows + 1;
							end else begin
								ErrCnt1 = ErrCnt1 + 1;
								AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand &  chr(09) & USetStr(36265) & chr(13),ErrAr1);
								StatOkRows = StatOkRows + 1;
							end;
							GIWasUpdated(GIr,LogGIr," GIWasUpdatedlog 113");
							recordstore(GIr,true);
						end;
					end;
				end;
			end else begin
				if(!INrf)then begin
					ErrCnt1 = ErrCnt1 + 1;
					AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand & chr(09) & USetStr(36237) & chr(13),ErrAr1);
					StatFailItemRows = StatFailItemRows + 1;
				end else begin
					SetCompany(INComp,false);
					CreateNewGlobalItem(INr);
					ResetCompany(curcomp);
					GIr.Code = BPIBrandr.Code & "_" & artcode;
					if(readfirstmain(GIr,1,true))then begin
						recordcopy(LogGIr,GIr);
						ErrCnt2 = 0;
						if(SetItemBitrixClass(GIr,headers,params,ErrArr,ErrCnt2,ErrAr3,classCode))then begin
							if(ErrCnt2>0)then begin
								ErrCnt1 = ErrCnt1 + 1;
								AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand & chr(09) & USetStr(36264) & chr(09),ErrAr1);
								for (i=0;i<ErrCnt2;i=i+1) begin
									AddTextToArea	((i+1) & ". " & ErrArr[i] & " - " & USetStr(36238) & chr(09),ErrAr1);
									if(!Classf[ErrArr[i]])then begin
										Classf[ErrArr[i]] = true;
										Class[ErrClasscnt] = ErrAr3[i];
										ErrClasscnt = ErrClasscnt + 1;
									end;
								end;
								AddTextToArea	(chr(13),ErrAr1);
								StatFailClassRows = StatFailClassRows + 1;
							end else begin
								ErrCnt1 = ErrCnt1 + 1;
								AddTextToArea	(ErrCnt1 & chr(09) & chr(09)  & origartcode  & chr(09) & brand &  chr(09) & USetStr(36265) & chr(13),ErrAr1);
								StatOkRows = StatOkRows + 1;
							end;
							GIWasUpdated(GIr,LogGIr," GIWasUpdatedlog 114");
							recordstore(GIr,true);
							GIr.Code = "CP_" & BPIBrandr.Code & "_" & artcode;
								if(readfirstmain(GIr,1,true))then begin
									recordcopy(LogGIr,GIr);
									ErrCnt2 = 0;
									if(SetItemBitrixClass(GIr,headers,params,ErrArr,ErrCnt2,ErrAr3,classCode))then begin
										if(ErrCnt2>0)then begin
											ErrCnt1 = ErrCnt1 + 1;
											AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand & USetStr(36264) & chr(09),ErrAr1);
											for (i=0;i<ErrCnt2;i=i+1) begin
												AddTextToArea	((i+1) & ". " & ErrArr[i] & " - " & USetStr(36238) & chr(09),ErrAr1);
												if(!Classf[ErrArr[i]])then begin
													Classf[ErrArr[i]] = true;
													Class[ErrClasscnt] = ErrAr3[i];
													ErrClasscnt = ErrClasscnt + 1;
												end;
											end;
											AddTextToArea	(chr(13),ErrAr1);
											StatFailClassRows = StatFailClassRows + 1;
										end else begin
											ErrCnt1 = ErrCnt1 + 1;
											AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand & chr(09) & USetStr(36265) & chr(13),ErrAr1);
											StatOkRows = StatOkRows + 1;
										end;
										GIWasUpdated(GIr,LogGIr," GIWasUpdatedlog 115");
										recordstore(GIr,true);
									end;
								end;
						end;
					end;
				end;
			end;
		end else begin
			BPIBrandr.Code = brand;
			if(readfirstkey("Code",BPIBrandr,1,true))then begin
				mtrw = matrowcnt(Compb);
				INrf = false;
				INComp = 0;
				for (i=0;i<mtrw;i=i+1) begin
					matrowget(Compb,i,Comprw);
					if(Comprw.ActiveStatus==0 and (!CompanyIsJWLikeCompany(i+1) or i+1==3) and i+1!=10 and i+1!=32)then begin
						SetCompany(i+1,false);
						INr.Code = artcode;
						if(ReadFirstMain(INr,1,true))then begin
							if(INr.BPIBrand==brand)then begin 
								INComp = i+1;
								INrf = true; 
								i = mtrw;
							end;
						end;
					end;
				end;
				resetcompany(curcomp);
				artcode = BPIBrandr.Code & "_" & artcode;
				GIr.Code = artcode;
				if(readfirstmain(GIr,1,true))then begin
					recordcopy(LogGIr,GIr);
					ErrCnt2 = 0;
					if(SetItemBitrixClass(GIr,headers,params,ErrArr,ErrCnt2,ErrAr3,classCode))then begin
						if(ErrCnt2>0)then begin
							ErrCnt1 = ErrCnt1 + 1;
							AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand & USetStr(36264) & chr(09),ErrAr1);
							for (i=0;i<ErrCnt2;i=i+1) begin
								AddTextToArea	((i+1) & ". " & ErrArr[i] & " - " & USetStr(36238) & chr(09),ErrAr1);
								if(!Classf[ErrArr[i]])then begin
									Classf[ErrArr[i]] = true;
									Class[ErrClasscnt] = ErrAr3[i];
									ErrClasscnt = ErrClasscnt + 1;
								end;
							end;
							AddTextToArea	(chr(13),ErrAr1);
							StatFailClassRows = StatFailClassRows + 1;
						end else begin
							ErrCnt1 = ErrCnt1 + 1;
							AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand &  chr(09) & USetStr(36265) & chr(13),ErrAr1);
							StatOkRows = StatOkRows + 1;
						end;
						GIWasUpdated(GIr,LogGIr," GIWasUpdatedlog 116");
						recordstore(GIr,true);
						GIr.Code = "CP_" & artcode;
						if(readfirstmain(GIr,1,true))then begin
							recordcopy(LogGIr,GIr);
							if(SetItemBitrixClass(GIr,headers,params,ErrArr,ErrCnt2,ErrAr3,classCode))then begin
								if(ErrCnt2>0)then begin
									ErrCnt1 = ErrCnt1 + 1;
									AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand & chr(09) & USetStr(36264) & chr(09),ErrAr1);
									for (i=0;i<ErrCnt2;i=i+1) begin
										AddTextToArea	((i+1) & ". " & ErrArr[i] & " - " & USetStr(36238) & chr(09),ErrAr1);
										if(!Classf[ErrArr[i]])then begin
											Classf[ErrArr[i]] = true;
											Class[ErrClasscnt] = ErrAr3[i];
											ErrClasscnt = ErrClasscnt + 1;
										end;
									end;
									AddTextToArea	(chr(13),ErrAr1);
									StatFailClassRows = StatFailClassRows + 1;
								end else begin
									ErrCnt1 = ErrCnt1 + 1;
									AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand &  chr(09) & USetStr(36265) & chr(13),ErrAr1);
									StatOkRows = StatOkRows + 1;
								end;
								GIWasUpdated(GIr,LogGIr," GIWasUpdatedlog 111");
								recordstore(GIr,true);
							end;
						end;
					end;
				end else begin
					if(!INrf)then begin
						ErrCnt1 = ErrCnt1 + 1;
						AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & chr(09) & chr(09) & brand & chr(09) & USetStr(36237) & chr(13),ErrAr1);
						StatFailItemRows = StatFailItemRows + 1;
					end else begin
						SetCompany(INComp,false);
						CreateNewGlobalItem(INr);
						ResetCompany(curcomp);
						GIr.Code = BPIBrandr.Code & "_" & artcode;
						if(readfirstmain(GIr,1,true))then begin
							ErrCnt2 = 0;
							recordcopy(LogGIr,GIr);
							if(SetItemBitrixClass(GIr,headers,params,ErrArr,ErrCnt2,ErrAr3,classCode))then begin
								if(ErrCnt2>0)then begin
									ErrCnt1 = ErrCnt1 + 1;
									AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand & USetStr(36264) & chr(09),ErrAr1);
									for (i=0;i<ErrCnt2;i=i+1) begin
										AddTextToArea	((i+1) & ". " & ErrArr[i] & " - " & USetStr(36238) & chr(09),ErrAr1);
										if(!Classf[ErrArr[i]])then begin
											Classf[ErrArr[i]] = true;
											Class[ErrClasscnt] = ErrAr3[i];
											ErrClasscnt = ErrClasscnt + 1;
										end;
									end;
									AddTextToArea	(chr(13),ErrAr1);
									StatFailClassRows = StatFailClassRows + 1;
								end else begin
									ErrCnt1 = ErrCnt1 + 1;
									AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand & chr(09) & USetStr(36265) & chr(13),ErrAr1);
									StatOkRows = StatOkRows + 1;
								end;
								GIWasUpdated(GIr,LogGIr," GIWasUpdatedlog 118");
								recordstore(GIr,true);
								GIr.Code = "CP_" & BPIBrandr.Code & "_" & artcode;
								if(readfirstmain(GIr,1,true))then begin
									ErrCnt2 = 0;
									recordcopy(LogGIr,GIr);
									if(SetItemBitrixClass(GIr,headers,params,ErrArr,ErrCnt2,ErrAr3,classCode))then begin
										if(ErrCnt2>0)then begin
											ErrCnt1 = ErrCnt1 + 1;
											AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand & USetStr(36264) & chr(09),ErrAr1);
											for (i=0;i<ErrCnt2;i=i+1) begin
												AddTextToArea	((i+1) & ". " & ErrArr[i] & " - " & USetStr(36238) & chr(09),ErrAr1);
												if(!Classf[ErrArr[i]])then begin
													Classf[ErrArr[i]] = true;
													Class[ErrClasscnt] = ErrAr3[i];
													ErrClasscnt = ErrClasscnt + 1;
												end;
											end;
											AddTextToArea	(chr(13),ErrAr1);
											StatFailClassRows = StatFailClassRows + 1;
										end else begin
											ErrCnt1 = ErrCnt1 + 1;
											AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand & chr(09) & USetStr(36265) & chr(13),ErrAr1);
											StatOkRows = StatOkRows + 1;
										end;
										GIWasUpdated(GIr,LogGIr," GIWasUpdatedlog 119");
										recordstore(GIr,true);
									end;
								end;
							end;
						end;
					end;
				end;
			end;
		end;
		if (NextImportLine(true)) then begin end;
	end;
	// j = 0;
	// for (i=0;i<ErrCnt2;i=i+1) begin
		// if(!Errf[ErrArr[i]])then begin
			// j = j + 1;
			// Errf[ErrArr[i]] = true;
			// AddTextToArea	(j & ". " & USetStr(36238) & ": " & ErrArr[i] & ";" & chr(13),ErrAr1);
		// end;
	// end;
	AddTextToArea	(USetStr(36272) & chr(09) & chr(09) & chr(09) & StatAllRows & chr(13),ErrAr2);
	AddTextToArea	(USetStr(36273) & chr(09) & chr(09) & chr(09) & StatOkRows & chr(13),ErrAr2);
	AddTextToArea	(USetStr(36274) & chr(09) & chr(09) & chr(09) & StatFailItemRows & chr(13),ErrAr2);
	AddTextToArea	(USetStr(36275) & chr(09) & chr(09) & chr(09) & StatFailClassRows & chr(13),ErrAr2);
	AddTextToArea	(USetStr(36276) & chr(09) & chr(09) & chr(09) & ErrClasscnt & chr(13),ErrAr2);
	AddTextToArea	(chr(09) &  chr(09) &  chr(09) & USetStr(36277) & chr(09) & USetStr(36278) & chr(09) & USetStr(36279) & chr(13),ErrAr2);
	for (i=0;i<ErrClasscnt;i=i+1) begin
		AddTextToArea	( chr(09) &  chr(09) &  chr(09) & (i+1) & chr(09) & Class[i] & chr(13),ErrAr2);
	end;
	
	AddTextToArea	(chr(13),ErrAr2);

	
	AddAreaAfterArea(ErrAr2,ErrAr1);
	WriteAreaToFile	(ErrAr1,"BTRxErrMail.txt",0);
	resetcompany(curcomp);
	lImportAddClassIn:;
logtext(0,"ImportAddClassIn end");
return;
end;



global updating procedure ImportAddClassFromFolderIn()
begin
record INVc INr,oldINr;
integer i,flushcnt,curcomp,cnt,j,k,CompQty,ErrCnt1,ErrCnt2,mtrw,INComp,StatAllRows,StatOkRows,StatFailItemRows,StatFailClassRows,ErrClasscnt,ErrCnt3;
record GlobalItemVc GIr,LogGIr;
string 100 artcode,brand,newBrand,code,glCode,tstr,cntstr,origartcode;
record BPIBrandVc BPIBrandr;
record BPIBrandVc BPIBrand1r;
area ErrAr1, ErrAr2, reply;
array string 255 abrand,anewbrand,ErrArr,ErrAr3;
array string 100 headers,params;
record CompaniesBlock Compb;
row CompaniesBlock Comprw;
vector boolean Errf, Classf;
array string 255 Class;
boolean INrf;
vector string 255 classCode;
string 255 filename;
		
	BlockLoad(Compb);
	
	CompQty = matrowcnt(Compb);
	curcomp = currentcompany;	
	// SetImportCodePage("CP1251");
	SetCompany(1,false);
	for (i=0;i<CountFilesInDir("/mnt/database/Ecommerce/ECommerceIN");i=i+1) begin
		if (right(GetFileNameInDir("/mnt/database/Ecommerce/ECommerceIN",i),4) == ".txt") then begin 
			filename = GetFileNameInDir("/mnt/database/Ecommerce/ECommerceIN",i);
			i = CountFilesInDir("/mnt/database/Ecommerce/ECommerceIN"); 
		end;
	end;
	if(nonblank(filename) and fileexists("/mnt/database/Ecommerce/ECommerceIN/" & filename))then begin
		if (fileexists("/mnt/database/Ecommerce/ECommerceERRORS/" & filename)) then begin
			delete_file("/mnt/database/Ecommerce/ECommerceERRORS/" & filename);
		end;
		if (fileexists("/mnt/database/Ecommerce/ECommerceOUT/" & filename)) then begin
			delete_file("/mnt/database/Ecommerce/ECommerceOUT/" & filename);
		end;
		logtext(0,"start ImportAddClassFromFolderIn");
		SetImportCodePage("UTF-8");
		openfile("/mnt/database/Ecommerce/ECommerceIN/" & filename);
		tstr = importfield;
		tstr = right(tstr,(len(tstr)-1));
		ErrCnt1 = 2;
		// logtext(0,USetStr(36229));
		if(tstr!=USetStr(36229))then begin
			logtext(0,"ImportAddClassIn codepage error");
			ErrCnt1 = ErrCnt1 + 1;
			AddTextToArea	(USetStr(36351) & chr(09),ErrAr1);
			while (TestEOF()==false) begin
				if (NextImportLine(true)) then begin end;
			end;
			goto lImportAddClassFromFolderIn;
		end;
		if (NextImportLine(true)) then begin end;
		tstr = importfield;
		//tstr = importfield;
		while(nonblank(tstr))begin
			tstr = importfield;
			if(nonblank(tstr))then begin
				StripEndingSpaces(tstr);
				headers[headers.length] = tstr;
			end;
		end;
		if (NextImportLine(true)) then begin end;
		AddTextToArea	(USetStr(36266) & chr(09) & USetStr(36267) & chr(09) & USetStr(36268) & chr(09) & USetStr(36269) & chr(13),ErrAr1);
		StatAllRows = 0;
		StatOkRows = 0;
		StatFailItemRows = 0;
		StatFailClassRows = 0;
		ErrClasscnt = 0;
		while (TestEOF()==false) begin
			StatAllRows = StatAllRows + 1;
			for(i=0;i<headers.length;i=i+1)begin
				params[i] = "";
			end;
			cnt = cnt + 1;
			artcode = importfield;
			StripEndingSpaces(artcode);
			origartcode = artcode;
			brand = importfield;
			StripEndingSpaces(brand);
			params[0] = brand;
			for(i=1;i<headers.length;i=i+1)begin
				tstr = importfield;
				params[i] = tstr;
			end;
			BPIBrandr.Name = brand;
			if(readfirstkey("Name",BPIBrandr,1,true))then begin
				mtrw = matrowcnt(Compb);
				INrf = false;
				INComp = 0;
				for (i=0;i<mtrw;i=i+1) begin
					matrowget(Compb,i,Comprw);
					if(Comprw.ActiveStatus==0 and (!CompanyIsJWLikeCompany(i+1) or i+1==3) and i+1!=10 and i+1!=32)then begin
						SetCompany(i+1,false);
						INr.Code = artcode;
						if(ReadFirstMain(INr,1,true))then begin
							if(INr.BPIBrand==BPIBrandr.Code)then begin 
								INComp = i+1;
								INrf = true; 
								i = mtrw;
							end;
						end;
					end;
				end;
				resetcompany(curcomp);
				artcode = BPIBrandr.Code & "_" & artcode;
				GIr.Code = artcode;
				if(readfirstmain(GIr,1,true))then begin
					ErrCnt2 = 0;
					recordcopy(LogGIr,GIr);
					if(SetItemBitrixClass(GIr,headers,params,ErrArr,ErrCnt2,ErrAr3,classCode))then begin
						if(ErrCnt2>0)then begin
							ErrCnt1 = ErrCnt1 + 1;
							AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand & chr(09) & USetStr(36264) & chr(09),ErrAr1);
							for (i=0;i<ErrCnt2;i=i+1) begin
								AddTextToArea	((i+1) & ". " & ErrArr[i] & " - " & USetStr(36238) & chr(09),ErrAr1);
								if(!Classf[ErrArr[i]])then begin
									Classf[ErrArr[i]] = true;
									Class[ErrClasscnt] = ErrAr3[i];
									ErrClasscnt = ErrClasscnt + 1;
								end;
							end;
							AddTextToArea	(chr(13),ErrAr1);
							StatFailClassRows = StatFailClassRows + 1;
						end else begin
							// ErrCnt1 = ErrCnt1 + 1;
							// AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand &  chr(09) & USetStr(36265) & chr(13),ErrAr1);
							StatOkRows = StatOkRows + 1;
						end;
						GIWasUpdated(GIr,LogGIr," GIWasUpdatedlog 120");
						recordstore(GIr,true);
						// GIr.Code = "CP_" & artcode;
						// if(readfirstmain(GIr,1,true))then begin
							// if(SetItemBitrixClass(GIr,headers,params,ErrArr,ErrCnt2,ErrAr3,classCode))then begin
								// if(ErrCnt2>0)then begin
									// ErrCnt1 = ErrCnt1 + 1;
									// AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand & chr(09) & USetStr(36264) & chr(09),ErrAr1);
									// for (i=0;i<ErrCnt2;i=i+1) begin
										// AddTextToArea	((i+1) & ". " & ErrArr[i] & " - " & USetStr(36238) & chr(09),ErrAr1);
										// if(!Classf[ErrArr[i]])then begin
											// Classf[ErrArr[i]] = true;
											// Class[ErrClasscnt] = ErrAr3[i];
											// ErrClasscnt = ErrClasscnt + 1;
										// end;
									// end;
									// AddTextToArea	(chr(13),ErrAr1);
									// StatFailClassRows = StatFailClassRows + 1;
								// end else begin
									// // ErrCnt1 = ErrCnt1 + 1;
									// // AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand &  chr(09) & USetStr(36265) & chr(13),ErrAr1);
									// StatOkRows = StatOkRows + 1;
								// end;
								// recordstore(GIr,true);
							// end;
						// end;
					end;
				end else begin
					if(!INrf)then begin
						ErrCnt1 = ErrCnt1 + 1;
						AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand & chr(09) & USetStr(36237) & chr(13),ErrAr1);
						StatFailItemRows = StatFailItemRows + 1;
					end else begin
						SetCompany(INComp,false);
						CreateNewGlobalItem(INr);
						ResetCompany(curcomp);
						GIr.Code = BPIBrandr.Code & "_" & artcode;
						if(readfirstmain(GIr,1,true))then begin
							ErrCnt2 = 0;
							recordcopy(LogGIr,GIr);
							if(SetItemBitrixClass(GIr,headers,params,ErrArr,ErrCnt2,ErrAr3,classCode))then begin
								if(ErrCnt2>0)then begin
									ErrCnt1 = ErrCnt1 + 1;
									AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand & chr(09) & USetStr(36264) & chr(09),ErrAr1);
									for (i=0;i<ErrCnt2;i=i+1) begin
										AddTextToArea	((i+1) & ". " & ErrArr[i] & " - " & USetStr(36238) & chr(09),ErrAr1);
										if(!Classf[ErrArr[i]])then begin
											Classf[ErrArr[i]] = true;
											Class[ErrClasscnt] = ErrAr3[i];
											ErrClasscnt = ErrClasscnt + 1;
										end;
									end;
									AddTextToArea	(chr(13),ErrAr1);
									StatFailClassRows = StatFailClassRows + 1;
								end else begin
									// ErrCnt1 = ErrCnt1 + 1;
									// AddTextToArea	(ErrCnt1 & chr(09) & chr(09)  & origartcode  & chr(09) & brand &  chr(09) & USetStr(36265) & chr(13),ErrAr1);
									StatOkRows = StatOkRows + 1;
								end;
								GIWasUpdated(GIr,LogGIr," GIWasUpdatedlog 121");
								recordstore(GIr,true);
								// GIr.Code = "CP_" & BPIBrandr.Code & "_" & artcode;
								// if(readfirstmain(GIr,1,true))then begin
									// ErrCnt2 = 0;
									// if(SetItemBitrixClass(GIr,headers,params,ErrArr,ErrCnt2,ErrAr3,classCode))then begin
										// if(ErrCnt2>0)then begin
											// ErrCnt1 = ErrCnt1 + 1;
											// AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand & USetStr(36264) & chr(09),ErrAr1);
											// for (i=0;i<ErrCnt2;i=i+1) begin
												// AddTextToArea	((i+1) & ". " & ErrArr[i] & " - " & USetStr(36238) & chr(09),ErrAr1);
												// if(!Classf[ErrArr[i]])then begin
													// Classf[ErrArr[i]] = true;
													// Class[ErrClasscnt] = ErrAr3[i];
													// ErrClasscnt = ErrClasscnt + 1;
												// end;
											// end;
											// AddTextToArea	(chr(13),ErrAr1);
											// StatFailClassRows = StatFailClassRows + 1;
										// end else begin
											// // ErrCnt1 = ErrCnt1 + 1;
											// // AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand & chr(09) & USetStr(36265) & chr(13),ErrAr1);
											// StatOkRows = StatOkRows + 1;
										// end;
										// recordstore(GIr,true);
									// end;
								// end;
							end;
						end else begin
							ErrCnt1 = ErrCnt1 + 1;
							AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand & chr(09) & USetStr(36237) & chr(13),ErrAr1);
							StatFailItemRows = StatFailItemRows + 1;
						end;
					end;
				end;
			end else begin
				BPIBrandr.Code = brand;
				if(readfirstkey("Code",BPIBrandr,1,true))then begin
					mtrw = matrowcnt(Compb);
					INrf = false;
					INComp = 0;
					for (i=0;i<mtrw;i=i+1) begin
						matrowget(Compb,i,Comprw);
						if(Comprw.ActiveStatus==0 and (!CompanyIsJWLikeCompany(i+1) or i+1==3) and i+1!=10 and i+1!=32)then begin
							SetCompany(i+1,false);
							INr.Code = artcode;
							if(ReadFirstMain(INr,1,true))then begin
								if(INr.BPIBrand==brand)then begin 
									INComp = i+1;
									INrf = true; 
									i = mtrw;
								end;
							end;
						end;
					end;
					resetcompany(curcomp);
					artcode = BPIBrandr.Code & "_" & artcode;
					GIr.Code = artcode;
					if(readfirstmain(GIr,1,true))then begin
						ErrCnt2 = 0;
						recordcopy(LogGIr,GIr);
						if(SetItemBitrixClass(GIr,headers,params,ErrArr,ErrCnt2,ErrAr3,classCode))then begin
							if(ErrCnt2>0)then begin
								ErrCnt1 = ErrCnt1 + 1;
								AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand & USetStr(36264) & chr(09),ErrAr1);
								for (i=0;i<ErrCnt2;i=i+1) begin
									AddTextToArea	((i+1) & ". " & ErrArr[i] & " - " & USetStr(36238) & chr(09),ErrAr1);
									if(!Classf[ErrArr[i]])then begin
										Classf[ErrArr[i]] = true;
										Class[ErrClasscnt] = ErrAr3[i];
										ErrClasscnt = ErrClasscnt + 1;
									end;
								end;
								AddTextToArea	(chr(13),ErrAr1);
								StatFailClassRows = StatFailClassRows + 1;
							end else begin
								// ErrCnt1 = ErrCnt1 + 1;
								// AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand &  chr(09) & USetStr(36265) & chr(13),ErrAr1);
								StatOkRows = StatOkRows + 1;
							end;
							GIWasUpdated(GIr,LogGIr," GIWasUpdatedlog 122");
							recordstore(GIr,true);
							// GIr.Code = "CP_" & artcode;
							// if(readfirstmain(GIr,1,true))then begin
								// if(SetItemBitrixClass(GIr,headers,params,ErrArr,ErrCnt2,ErrAr3,classCode))then begin
									// if(ErrCnt2>0)then begin
										// ErrCnt1 = ErrCnt1 + 1;
										// AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand & chr(09) & USetStr(36264) & chr(09),ErrAr1);
										// for (i=0;i<ErrCnt2;i=i+1) begin
											// AddTextToArea	((i+1) & ". " & ErrArr[i] & " - " & USetStr(36238) & chr(09),ErrAr1);
											// if(!Classf[ErrArr[i]])then begin
												// Classf[ErrArr[i]] = true;
												// Class[ErrClasscnt] = ErrAr3[i];
												// ErrClasscnt = ErrClasscnt + 1;
											// end;
										// end;
										// AddTextToArea	(chr(13),ErrAr1);
										// StatFailClassRows = StatFailClassRows + 1;
									// end else begin
										// // ErrCnt1 = ErrCnt1 + 1;
										// // AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand &  chr(09) & USetStr(36265) & chr(13),ErrAr1);
										// StatOkRows = StatOkRows + 1;
									// end;
									// recordstore(GIr,true);
								// end;
							// end;
						end;
					end else begin
						if(!INrf)then begin
							ErrCnt1 = ErrCnt1 + 1;
							AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & chr(09) & chr(09) & brand & chr(09) & USetStr(36237) & chr(13),ErrAr1);
							StatFailItemRows = StatFailItemRows + 1;
						end else begin
							SetCompany(INComp,false);
							CreateNewGlobalItem(INr);
							ResetCompany(curcomp);
							GIr.Code = BPIBrandr.Code & "_" & artcode;
							if(readfirstmain(GIr,1,true))then begin
								ErrCnt2 = 0;
								recordcopy(LogGIr,GIr);
								if(SetItemBitrixClass(GIr,headers,params,ErrArr,ErrCnt2,ErrAr3,classCode))then begin
									if(ErrCnt2>0)then begin
										ErrCnt1 = ErrCnt1 + 1;
										AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand & USetStr(36264) & chr(09),ErrAr1);
										for (i=0;i<ErrCnt2;i=i+1) begin
											AddTextToArea	((i+1) & ". " & ErrArr[i] & " - " & USetStr(36238) & chr(09),ErrAr1);
											if(!Classf[ErrArr[i]])then begin
												Classf[ErrArr[i]] = true;
												Class[ErrClasscnt] = ErrAr3[i];
												ErrClasscnt = ErrClasscnt + 1;
											end;
										end;
										AddTextToArea	(chr(13),ErrAr1);
										StatFailClassRows = StatFailClassRows + 1;
									end else begin
										// ErrCnt1 = ErrCnt1 + 1;
										// AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand & chr(09) & USetStr(36265) & chr(13),ErrAr1);
										StatOkRows = StatOkRows + 1;
									end;
									GIWasUpdated(GIr,LogGIr," GIWasUpdatedlog 123");
									recordstore(GIr,true);
									// GIr.Code = "CP_" & BPIBrandr.Code & "_" & artcode;
									// if(readfirstmain(GIr,1,true))then begin
										// ErrCnt2 = 0;
										// if(SetItemBitrixClass(GIr,headers,params,ErrArr,ErrCnt2,ErrAr3,classCode))then begin
											// if(ErrCnt2>0)then begin
												// ErrCnt1 = ErrCnt1 + 1;
												// AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand & USetStr(36264) & chr(09),ErrAr1);
												// for (i=0;i<ErrCnt2;i=i+1) begin
													// AddTextToArea	((i+1) & ". " & ErrArr[i] & " - " & USetStr(36238) & chr(09),ErrAr1);
													// if(!Classf[ErrArr[i]])then begin
														// Classf[ErrArr[i]] = true;
														// Class[ErrClasscnt] = ErrAr3[i];
														// ErrClasscnt = ErrClasscnt + 1;
													// end;
												// end;
												// AddTextToArea	(chr(13),ErrAr1);
												// StatFailClassRows = StatFailClassRows + 1;
											// end else begin
												// // ErrCnt1 = ErrCnt1 + 1;
												// // AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand & chr(09) & USetStr(36265) & chr(13),ErrAr1);
												// StatOkRows = StatOkRows + 1;
											// end;
											// recordstore(GIr,true);
										// end;
									// end;
								end;
							end else begin
								ErrCnt1 = ErrCnt1 + 1;
								AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand & chr(09) & USetStr(36237) & chr(13),ErrAr1);
								StatFailItemRows = StatFailItemRows + 1;
							end;
						end;
					end;
				end else begin
					ErrCnt1 = ErrCnt1 + 1;
					AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand & chr(09) & USetStr(36264) & chr(09),ErrAr1);
					AddTextToArea	(USetStr(36353) & chr(09) & "\"" & brand & "\"" & chr(09) & USetStr(36237) & chr(13),ErrAr1);
					StatFailItemRows = StatFailItemRows + 1;
				end;
			end;
			CheckFlush(flushcnt,100);
			if (NextImportLine(true)) then begin end;
		end;
		// j = 0;
		// for (i=0;i<ErrCnt2;i=i+1) begin
			// if(!Errf[ErrArr[i]])then begin
				// j = j + 1;
				// Errf[ErrArr[i]] = true;
				// AddTextToArea	(j & ". " & USetStr(36238) & ": " & ErrArr[i] & ";" & chr(13),ErrAr1);
			// end;
		// end;
		AddTextToArea	(USetStr(36272) & chr(09) & chr(09) & chr(09) & StatAllRows & chr(13),ErrAr2);
		AddTextToArea	(USetStr(36273) & chr(09) & chr(09) & chr(09) & StatOkRows & chr(13),ErrAr2);
		AddTextToArea	(USetStr(36274) & chr(09) & chr(09) & chr(09) & StatFailItemRows & chr(13),ErrAr2);
		AddTextToArea	(USetStr(36275) & chr(09) & chr(09) & chr(09) & StatFailClassRows & chr(13),ErrAr2);
		AddTextToArea	(USetStr(36276) & chr(09) & chr(09) & chr(09) & ErrClasscnt & chr(13),ErrAr2);
		AddTextToArea	(chr(09) &  chr(09) &  chr(09) & USetStr(36277) & chr(09) & USetStr(36278) & chr(09) & USetStr(36279) & chr(13),ErrAr2);
		for (i=0;i<ErrClasscnt;i=i+1) begin
			AddTextToArea	( chr(09) &  chr(09) &  chr(09) & (i+1) & chr(09) & Class[i] & chr(13),ErrAr2);
		end;
		
		AddTextToArea	(chr(13),ErrAr2);

		
		AddAreaAfterArea(ErrAr2,ErrAr1);
		if (ErrCnt1 > 2) then begin
			WriteAreaToFile	(ErrAr1,"/mnt/database/Ecommerce/ECommerceERRORS/" & filename,0);
		end;
		lImportAddClassFromFolderIn:;
		CloseFile;
		MoveFile(filename,"/mnt/database/Ecommerce/ECommerceIN","/mnt/database/Ecommerce/ECommerceOUT");
		delete_file("/mnt/database/Ecommerce/ECommerceIN/" & filename);
		logtext(0,"end ImportAddClassFromFolderIn");
	end;
	runprogram("chmod","-R a+rw /mnt/database/Ecommerce");
	resetcompany(curcomp);
return;
end;















global procedure ImportAddClassFromFolderQueuedIn()  // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 15:34 07.05.2020
begin
record INVc INr,oldINr;
integer i,flushcnt,curcomp,cnt,j,k,CompQty,ErrCnt1,ErrCnt2,mtrw,INComp,StatAllRows,StatOkRows,StatFailItemRows,StatFailClassRows,ErrClasscnt,ErrCnt3,slipcont;
record GlobalItemVc GIr, ExtPrGIr;
string 100 artcode,brand,newBrand,code,glCode,tstr,cntstr,origartcode;
record BPIBrandVc BPIBrandr;
record BPIBrandVc BPIBrand1r;
area ErrAr1, ErrAr2, reply;
array string 255 abrand,anewbrand,ErrArr,ErrAr3;
array string 100 headers,params;
record CompaniesBlock Compb;
row CompaniesBlock Comprw;
vector boolean Errf, Classf;
array string 255 Class;
boolean INrf, ExtPrItemf;
vector string 255 classCode;
string 255 filename, FinRow;
LongInt rcnt, r, okend ;
vector string 255 vparams, vartcode, vbrand, vorigartcode;
		
	BlockLoad(Compb);
	
	CompQty = matrowcnt(Compb);
	curcomp = currentcompany;	
	// SetImportCodePage("CP1251");
	SetCompany(1,false);
	okend = 0;
	for (i=0;i<CountFilesInDir("/mnt/database/Ecommerce/ECommerceIN");i=i+1) begin
		if (right(GetFileNameInDir("/mnt/database/Ecommerce/ECommerceIN",i),4) == ".txt") then begin 
			filename = GetFileNameInDir("/mnt/database/Ecommerce/ECommerceIN",i);
			i = CountFilesInDir("/mnt/database/Ecommerce/ECommerceIN"); 
		end;
	end;
	if(nonblank(filename) and fileexists("/mnt/database/Ecommerce/ECommerceIN/" & filename))then begin
		if (fileexists("/mnt/database/Ecommerce/ECommerceERRORS/" & filename)) then begin
			delete_file("/mnt/database/Ecommerce/ECommerceERRORS/" & filename);
		end;
		if (fileexists("/mnt/database/Ecommerce/ECommerceOUT/" & filename)) then begin
			delete_file("/mnt/database/Ecommerce/ECommerceOUT/" & filename);
		end;
		logtext(0,"start ImportAddClassFromFolderIn");
		SetImportCodePage("UTF-8");
		openfile("/mnt/database/Ecommerce/ECommerceIN/" & filename);
	// _______________________________________________________________________
	// for (i=0;i<CountFilesInDir("ECommerceIN");i=i+1) begin
		// if (right(GetFileNameInDir("ECommerceIN",i),4) == ".txt") then begin 
			// filename = GetFileNameInDir("ECommerceIN",i);
			// i = CountFilesInDir("ECommerceIN"); 
		// end;
	// end;
	// if(nonblank(filename) and fileexists("ECommerceIN/" & filename))then begin
		// if (fileexists("ECommerceERRORS/" & filename)) then begin
			// delete_file("ECommerceERRORS/" & filename);
		// end;
		// if (fileexists("ECommerceOUT/" & filename)) then begin
			// delete_file("ECommerceOUT/" & filename);
		// end;
		// logtext(0,"start ImportAddClassFromFolderQueueIn");
		// SetImportCodePage("UTF-8");
		// openfile("ECommerceIN/" & filename);
		// _______________________________________________________________________
		tstr = importfield;
		tstr = right(tstr,(len(tstr)-1));
		ErrCnt1 = 2;
		// logtext(0,USetStr(36229));
		if(tstr!=USetStr(36229))then begin
			logtext(0,"ImportAddClassIn codepage error");
			ErrCnt1 = ErrCnt1 + 1;
			AddTextToArea	(USetStr(36351) & chr(09),ErrAr1);
			while (TestEOF()==false) begin
				if (NextImportLine(true)) then begin end;
			end;
			goto lImportAddClassFromFolderIn;
		end;
		if (NextImportLine(true)) then begin end;
		tstr = importfield;
		//tstr = importfield;
		while(nonblank(tstr))begin
			tstr = importfield;
			if(nonblank(tstr))then begin
				StripEndingSpaces(tstr);
				headers[headers.length] = tstr;
			end;
		end;
		if (NextImportLine(true)) then begin end;
		AddTextToArea	(USetStr(36266) & chr(09) & USetStr(36267) & chr(09) & USetStr(36268) & chr(09) & USetStr(36269) & chr(13),ErrAr1);
		StatAllRows = 0;
		StatOkRows = 0;
		StatFailItemRows = 0;
		StatFailClassRows = 0;
		ErrClasscnt = 0;
		r = 0;
		while (TestEOF()==false) begin
			StatAllRows = StatAllRows + 1;
			for(i=0;i<headers.length;i=i+1)begin
				params[i] = "";
			end;
			cnt = cnt + 1;
			artcode = importfield;
			StripEndingSpaces(artcode);
			vartcode[r] = artcode;
			origartcode = artcode;
			vorigartcode[r] = origartcode;
			brand = importfield;
			StripEndingSpaces(brand);
			vbrand[r] = brand;
			params[0] = brand;
			vparams[r & "_0"] = params[0];
			for(i=1;i<headers.length;i=i+1)begin
				tstr = importfield;
				params[i] = tstr;
				vparams[r & "_" & i] = params[i];
			end;
			ExtPrItemf = false;
			ExtPrGIr.Code = artcode;
			if (ReadFirstMain(ExtPrGIr,1,true)) then begin
				//if (ExtPrGIr.ExtProwItRegulations>0) then begin
					ExtPrItemf = true;
				//end;
			end;
			if (!ExtPrItemf) then begin
				BPIBrandr.Name = brand;
				if(readfirstkey("Name",BPIBrandr,1,true))then begin
					mtrw = matrowcnt(Compb);
					INrf = false;
					INComp = 0;
					for (i=0;i<mtrw;i=i+1) begin
						matrowget(Compb,i,Comprw);
						if(Comprw.ActiveStatus==0 and (!CompanyIsJWLikeCompany(i+1) or i+1==3) and i+1!=10 and i+1!=32)then begin
							SetCompany(i+1,false);
							INr.Code = artcode;
							if(ReadFirstMain(INr,1,true))then begin
								if(INr.BPIBrand==BPIBrandr.Code)then begin 
									INComp = i+1;
									INrf = true; 
									i = mtrw;
								end;
							end;
						end;
					end;
					resetcompany(curcomp);
					artcode = BPIBrandr.Code & "_" & artcode;
					GIr.Code = artcode;
					if(readfirstmain(GIr,1,true))then begin
						ErrCnt2 = 0;
						if(CheckItemBitrixClassQueued(GIr,headers,params,ErrArr,ErrCnt2,ErrAr3,classCode))then begin
							if(ErrCnt2>0)then begin
								ErrCnt1 = ErrCnt1 + 1;
								AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand & chr(09) & USetStr(36264) & chr(09),ErrAr1);
								for (i=0;i<ErrCnt2;i=i+1) begin
									AddTextToArea	((i+1) & ". " & ErrArr[i] & " - " & USetStr(36238) & chr(09),ErrAr1);
									if(!Classf[ErrArr[i]])then begin
										Classf[ErrArr[i]] = true;
										Class[ErrClasscnt] = ErrAr3[i];
										ErrClasscnt = ErrClasscnt + 1;
									end;
								end;
								AddTextToArea	(chr(13),ErrAr1);
								StatFailClassRows = StatFailClassRows + 1;
							end else begin
								// ErrCnt1 = ErrCnt1 + 1;
								// AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand &  chr(09) & USetStr(36265) & chr(13),ErrAr1);
								StatOkRows = StatOkRows + 1;
								okend = r;
							end;
						end;
					end else begin
						if(!INrf)then begin
							ErrCnt1 = ErrCnt1 + 1;
							AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand & chr(09) & USetStr(36237) & chr(13),ErrAr1);
							StatFailItemRows = StatFailItemRows + 1;
						end else begin
							SetCompany(INComp,false);
							queued.CreateNewGlobalItem(INr);
							ResetCompany(curcomp);
							if(CheckItemBitrixClassQueued(GIr,headers,params,ErrArr,ErrCnt2,ErrAr3,classCode))then begin
								if(ErrCnt2>0)then begin
									ErrCnt1 = ErrCnt1 + 1;
									AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand & chr(09) & USetStr(36264) & chr(09),ErrAr1);
									for (i=0;i<ErrCnt2;i=i+1) begin
										AddTextToArea	((i+1) & ". " & ErrArr[i] & " - " & USetStr(36238) & chr(09),ErrAr1);
										if(!Classf[ErrArr[i]])then begin
											Classf[ErrArr[i]] = true;
											Class[ErrClasscnt] = ErrAr3[i];
											ErrClasscnt = ErrClasscnt + 1;
										end;
									end;
									AddTextToArea	(chr(13),ErrAr1);
									StatFailClassRows = StatFailClassRows + 1;
								end else begin
									// ErrCnt1 = ErrCnt1 + 1;
									// AddTextToArea	(ErrCnt1 & chr(09) & chr(09)  & origartcode  & chr(09) & brand &  chr(09) & USetStr(36265) & chr(13),ErrAr1);
									StatOkRows = StatOkRows + 1;
									okend = r;
								end;
							end;
						end;
					end;
				end else begin
					BPIBrandr.Code = brand;
					if(readfirstkey("Code",BPIBrandr,1,true))then begin
						mtrw = matrowcnt(Compb);
						INrf = false;
						INComp = 0;
						for (i=0;i<mtrw;i=i+1) begin
							matrowget(Compb,i,Comprw);
							if(Comprw.ActiveStatus==0 and (!CompanyIsJWLikeCompany(i+1) or i+1==3) and i+1!=10 and i+1!=32)then begin
								SetCompany(i+1,false);
								INr.Code = artcode;
								if(ReadFirstMain(INr,1,true))then begin
									if(INr.BPIBrand==brand)then begin 
										INComp = i+1;
										INrf = true; 
										i = mtrw;
									end;
								end;
							end;
						end;
						resetcompany(curcomp);
						artcode = BPIBrandr.Code & "_" & artcode;
						GIr.Code = artcode;
						if(readfirstmain(GIr,1,true))then begin
							ErrCnt2 = 0;
							if(CheckItemBitrixClassQueued(GIr,headers,params,ErrArr,ErrCnt2,ErrAr3,classCode))then begin
								if(ErrCnt2>0)then begin
									ErrCnt1 = ErrCnt1 + 1;
									AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand & USetStr(36264) & chr(09),ErrAr1);
									for (i=0;i<ErrCnt2;i=i+1) begin
										AddTextToArea	((i+1) & ". " & ErrArr[i] & " - " & USetStr(36238) & chr(09),ErrAr1);
										if(!Classf[ErrArr[i]])then begin
											Classf[ErrArr[i]] = true;
											Class[ErrClasscnt] = ErrAr3[i];
											ErrClasscnt = ErrClasscnt + 1;
										end;
									end;
									AddTextToArea	(chr(13),ErrAr1);
									StatFailClassRows = StatFailClassRows + 1;
								end else begin
									// ErrCnt1 = ErrCnt1 + 1;
									// AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand &  chr(09) & USetStr(36265) & chr(13),ErrAr1);
									StatOkRows = StatOkRows + 1;
									okend = r;
								end;
							end;
						end else begin
							if(!INrf)then begin
								ErrCnt1 = ErrCnt1 + 1;
								AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & chr(09) & chr(09) & brand & chr(09) & USetStr(36237) & chr(13),ErrAr1);
								StatFailItemRows = StatFailItemRows + 1;
							end else begin
								SetCompany(INComp,false);
								//CreateNewGlobalItem(INr);
								ResetCompany(curcomp);
								GIr.Code = BPIBrandr.Code & "_" & artcode;
								if(CheckItemBitrixClassQueued(GIr,headers,params,ErrArr,ErrCnt2,ErrAr3,classCode))then begin
									if(ErrCnt2>0)then begin
										ErrCnt1 = ErrCnt1 + 1;
										AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand & USetStr(36264) & chr(09),ErrAr1);
										for (i=0;i<ErrCnt2;i=i+1) begin
											AddTextToArea	((i+1) & ". " & ErrArr[i] & " - " & USetStr(36238) & chr(09),ErrAr1);
											if(!Classf[ErrArr[i]])then begin
												Classf[ErrArr[i]] = true;
												Class[ErrClasscnt] = ErrAr3[i];
												ErrClasscnt = ErrClasscnt + 1;
											end;
										end;
										AddTextToArea	(chr(13),ErrAr1);
										StatFailClassRows = StatFailClassRows + 1;
									end else begin
										// ErrCnt1 = ErrCnt1 + 1;
										// AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand & chr(09) & USetStr(36265) & chr(13),ErrAr1);
										StatOkRows = StatOkRows + 1;
										okend = r;
									end;
								end;
							end;
						end;
					end else begin
						ErrCnt1 = ErrCnt1 + 1;
						AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand & chr(09) & USetStr(36264) & chr(09),ErrAr1);
						AddTextToArea	(USetStr(36353) & chr(09) & "\"" & brand & "\"" & chr(09) & USetStr(36237) & chr(13),ErrAr1);
						StatFailItemRows = StatFailItemRows + 1;
					end;
				end;
			end else begin
				GIr.Code = artcode;
				if(readfirstmain(GIr,1,true))then begin
					ErrCnt2 = 0;
					if(CheckItemBitrixClassQueued(GIr,headers,params,ErrArr,ErrCnt2,ErrAr3,classCode))then begin
						if(ErrCnt2>0)then begin
							ErrCnt1 = ErrCnt1 + 1;
							AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand & chr(09) & USetStr(36264) & chr(09),ErrAr1);
							for (i=0;i<ErrCnt2;i=i+1) begin
								AddTextToArea	((i+1) & ". " & ErrArr[i] & " - " & USetStr(36238) & chr(09),ErrAr1);
								if(!Classf[ErrArr[i]])then begin
									Classf[ErrArr[i]] = true;
									Class[ErrClasscnt] = ErrAr3[i];
									ErrClasscnt = ErrClasscnt + 1;
								end;
							end;
							AddTextToArea	(chr(13),ErrAr1);
							StatFailClassRows = StatFailClassRows + 1;
						end else begin
							// ErrCnt1 = ErrCnt1 + 1;
							// AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand &  chr(09) & USetStr(36265) & chr(13),ErrAr1);
							StatOkRows = StatOkRows + 1;
							okend = r;
						end;
					end;
				end else begin
					ErrCnt1 = ErrCnt1 + 1;
					AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand & chr(09) & USetStr(36237) & chr(13),ErrAr1);
					StatFailItemRows = StatFailItemRows + 1;
				end;
			end;
			// CheckFlush(flushcnt,100);
			if (NextImportLine(true)) then begin end;
			r = r + 1;
		end;
		AddTextToArea	(USetStr(36272) & chr(09) & chr(09) & chr(09) & StatAllRows & chr(13),ErrAr2);
		AddTextToArea	(USetStr(36273) & chr(09) & chr(09) & chr(09) & StatOkRows & chr(13),ErrAr2);
		AddTextToArea	(USetStr(36274) & chr(09) & chr(09) & chr(09) & StatFailItemRows & chr(13),ErrAr2);
		AddTextToArea	(USetStr(36275) & chr(09) & chr(09) & chr(09) & StatFailClassRows & chr(13),ErrAr2);
		AddTextToArea	(USetStr(36276) & chr(09) & chr(09) & chr(09) & ErrClasscnt & chr(13),ErrAr2);
		AddTextToArea	(chr(09) &  chr(09) &  chr(09) & USetStr(36277) & chr(09) & USetStr(36278) & chr(09) & USetStr(36279) & chr(13),ErrAr2);
		for (i=0;i<ErrClasscnt;i=i+1) begin
			AddTextToArea	( chr(09) &  chr(09) &  chr(09) & (i+1) & chr(09) & Class[i] & chr(13),ErrAr2);
		end;
		
		AddTextToArea	(chr(13),ErrAr2);



		AddAreaAfterArea(ErrAr2,ErrAr1);
		if (ErrCnt1 > 2) then begin
			WriteAreaToFile	(ErrAr1,"/mnt/database/Ecommerce/ECommerceERRORS/" & filename,0);
		end;
		lImportAddClassFromFolderIn:;
		CloseFile;
		if (okend == 0) then begin
			MoveFile(filename,"/mnt/database/Ecommerce/ECommerceIN","/mnt/database/Ecommerce/ECommerceOUT");
			delete_file("/mnt/database/Ecommerce/ECommerceIN/" & filename);
		end;
	end;
	runprogram("chmod","-R a+rw /mnt/database/Ecommerce");
	
	// //_______________________________________________________________
		// AddAreaAfterArea(ErrAr2,ErrAr1);
		// if (ErrCnt1 > 2) then begin
			// WriteAreaToFile	(ErrAr1,"ECommerceERRORS/" & filename,0);
		// end;
		// lImportAddClassFromFolderIn:;
		// CloseFile;
		// MoveFile(filename,"ECommerceIN","ECommerceOUT");
		// delete_file("ECommerceIN/" & filename);
	// end;
	// //_______________________________________________________________

	StatAllRows = 0;
	StatOkRows = 0;
	StatFailItemRows = 0;
	StatFailClassRows = 0;
	ErrClasscnt = 0;
	rcnt = r;
	for (r=0;r<rcnt;r=r+1) begin
		FinRow = "";
		if (r == okend) then begin
			FinRow = filename;
		end;
		StatAllRows = StatAllRows + 1;
		for(i=0;i<headers.length;i=i+1)begin
			params[i] = "";
		end;
		cnt = cnt + 1;
		artcode = vartcode[r];
		origartcode = vorigartcode[r];
		brand = vbrand[r];
		params[0] = vparams[r & "_0"];
		for(i=1;i<headers.length;i=i+1)begin
			tstr = vparams[r & "_" & i];
			params[i] = tstr;
		end;
		ExtPrItemf = false;
		ExtPrGIr.Code = artcode;
		if (ReadFirstMain(ExtPrGIr,1,true)) then begin
			// if (ExtPrGIr.ExtProwItRegulations>0) then begin
				ExtPrItemf = true;
			// end;
		end;
		if (!ExtPrItemf) then begin
			BPIBrandr.Name = brand;
			if(readfirstkey("Name",BPIBrandr,1,true))then begin
				artcode = BPIBrandr.Code & "_" & artcode;
				GIr.Code = artcode;
				if(readfirstmain(GIr,1,true))then begin
					queued.SetItemBitrixClassQueued(GIr,headers,params,ErrArr,ErrCnt2,ErrAr3,classCode,FinRow);
					slipcont = slipcont + 1;
					if(slipcont>10)then begin
						millisleep(20);
						slipcont = 0;
					end;
				end;
			end else begin
				BPIBrandr.Code = brand;
				if(readfirstkey("Code",BPIBrandr,1,true))then begin
					artcode = BPIBrandr.Code & "_" & artcode;
					GIr.Code = artcode;
					if(readfirstmain(GIr,1,true))then begin
						queued.SetItemBitrixClassQueued(GIr,headers,params,ErrArr,ErrCnt2,ErrAr3,classCode,FinRow);
						slipcont = slipcont + 1;					
						if(slipcont>10)then begin
							millisleep(30);
							slipcont = 0;
						end;
					end;
				end;
			end;
		end else begin
			GIr.Code = artcode;
			if(readfirstmain(GIr,1,true))then begin
				queued.SetItemBitrixClassQueued(GIr,headers,params,ErrArr,ErrCnt2,ErrAr3,classCode,FinRow);
				slipcont = slipcont + 1;					
				if(slipcont>10)then begin
					millisleep(30);
					slipcont = 0;
				end;
			end;
		end;
		if(fileexists("stop"))then begin
  		r = rcnt;
  	end;
	end;
	logtext(0,"end ImportAddClassFromFolderQueueIn");
	resetcompany(curcomp);
return;
end;

 // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 15:35 08.05.2020


















global procedure ImportAddChiccoItemsFromFolderQueuedIn()  // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 15:34 07.05.2020
begin
record INVc INr,oldINr;
integer i,flushcnt,curcomp,cnt,j,k,CompQty,ErrCnt1,ErrCnt2,mtrw,INComp,StatAllRows,StatOkRows,StatFailItemRows,StatFailClassRows,ErrClasscnt,ErrCnt3,slipcont;
record GlobalItemVc GIr, ExtPrGIr;
string 100 artcode,brand,newBrand,code,glCode,tstr,bltstr,cntstr,origartcode;
record BPIBrandVc BPIBrandr;
record BPIBrandVc BPIBrand1r;
area ErrAr1, ErrAr2, reply;
array string 255 abrand,anewbrand,ErrArr,ErrAr3;
array string 100 headers,params;
record CompaniesBlock Compb;
row CompaniesBlock Comprw;
vector boolean Errf, Classf;
array string 255 ItemCode,ItemName,ItemBrand,ItemPrice;
boolean INrf, ExtPrItemf, namef;
vector string 255 classCode;
string 255 filename, FinRow;
LongInt rcnt, r, okend ;
vector string 255 vparams, vartcode, vbrand, vorigartcode,vJSONParENG,vJSONParRUS,vJSONParAZE;
record JSONClassNamesVc JCNr;
vector boolean vJSONClassf;
vector boolean CodeInstf;
boolean TrHs
		
	BlockLoad(Compb);
	
	CompQty = matrowcnt(Compb);
	curcomp = currentcompany;	
	// SetImportCodePage("CP1251");
	SetCompany(1,false);
	okend = 0;
	for (i=0;i<CountFilesInDir("/mnt/database/Ecommerce/ChiccoIN");i=i+1) begin
		if (right(GetFileNameInDir("/mnt/database/Ecommerce/ChiccoIN",i),4) == ".txt") then begin 
			filename = GetFileNameInDir("/mnt/database/Ecommerce/ChiccoIN",i);
			i = CountFilesInDir("/mnt/database/Ecommerce/ChiccoIN"); 
		end;
	end;
	if(nonblank(filename) and fileexists("/mnt/database/Ecommerce/ChiccoIN/" & filename))then begin
		if (fileexists("/mnt/database/Ecommerce/ChiccoOUT/" & filename)) then begin
			delete_file("/mnt/database/Ecommerce/ChiccoOUT/" & filename);
		end;
		logtext(0,"start ImportAddChiccoItemsFromFolderQueuedIn");
		SetImportCodePage("UTF-8");
		openfile("/mnt/database/Ecommerce/ChiccoIN/" & filename);
	// _______________________________________________________________________
	// for (i=0;i<CountFilesInDir("ChiccoIN");i=i+1) begin
		// if (right(GetFileNameInDir("ChiccoIN",i),4) == ".txt") then begin 
			// filename = GetFileNameInDir("ChiccoIN",i);
			// i = CountFilesInDir("ChiccoIN"); 
		// end;
	// end;
	// if(nonblank(filename) and fileexists("ChiccoIN/" & filename))then begin
		// if (fileexists("ChiccoOUT/" & filename)) then begin
			// delete_file("ChiccoOUT/" & filename);
		// end;
		// logtext(0,"start ImportAddChiccoItemsFromFolderQueuedIn");
		// SetImportCodePage("UTF-8");
		// openfile("ChiccoIN/" & filename);
		// _______________________________________________________________________
		tstr = importfield;
		tstr = right(tstr,(len(tstr)-1));
		// logtext(0,USetStr(36229));
		if(tstr!=USetStr(36229))then begin
			logtext(0,"ImportAddClassIn codepage error");
			AddTextToArea	(USetStr(36351) & chr(09),ErrAr1);
			while (TestEOF()==false) begin
				if (NextImportLine(true)) then begin end;
			end;
		end;
		if (NextImportLine(true)) then begin end;
		tstr = ImportField;
		tstr = ImportField;
		if (tstr=="name") then begin
			namef = true;
			// logtext(0,namef & " NAMEFLAG");
		end;
		// logtext(0,namef & " NAMEFLAG");
		if (NextImportLine(true)) then begin end;
		i=0;
		while (TestEOF()==false) begin
			tstr = trim(ImportField);
			ItemCode[i] = tstr;
			if (namef) then begin
				tstr = trim(ImportField);
				ItemName[i] = tstr;
			end;
			tstr = trim(ImportField);
			ItemBrand[i] = tstr;
			tstr = trim(ImportField);
			// ItemPrice[i] = tstr;
			for (j=0;j<len(tstr);j=j+1) begin
				if(Mid(tstr,j,1)==",") then begin
					ItemPrice[i] = ItemPrice[i] & ".";
				end else begin
					ItemPrice[i] = ItemPrice[i] & Mid(tstr,j,1);
				end;
			end;
			if (NextImportLine(true)) then begin end;
			i=i+1;
		end;
		cnt = i;
		CloseFile;
		MoveFile(filename,"/mnt/database/Ecommerce/ChiccoIN","/mnt/database/Ecommerce/ChiccoOUT");
		delete_file("/mnt/database/Ecommerce/ChiccoIN/" & filename);
		runprogram("chmod","-R a+rw /mnt/database/Ecommerce");
		// _________________________________________________________________
		// MoveFile(filename,"ChiccoIN","ChiccoOUT");
		// delete_file("ChiccoIN/" & filename);
		// runprogram("chmod","-R a+rw Ecommerce");
		
		for (i=0;i<cnt;i=i+1) begin
			if(nonblank(ItemCode[i])) then begin 
				queued.CreateChiccoGlobalItem(ItemCode[i],ItemBrand[i],ItemPrice[i],ItemName[i],namef);
				MilliSleep(50);
				CodeInstf["CHIC" & ItemCode[i]] = true;
			end;
		end;
		GIr.Code = "CHIC";
		TrHs = true;
		while (loopMain(GIr,1,TrHs)) begin
			if (left(GIr.Code,4)!="CHIC") then begin TrHs = false; end;
			if (TrHs and !CodeInstf[GIr.Code]) then begin
				queued.Instock0(GIr.Code);
				MilliSleep(50);
			end;
		end;
	end;
	return;
end;













global procedure ImportAddExtVendItemsFromFolderQueuedIn()  // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 13:50 13.10.2020
begin
record INVc INr,oldINr;
integer i,flushcnt,curcomp,cnt,j,k,CompQty,ErrCnt1,ErrCnt2,mtrw,INComp,StatAllRows,StatOkRows,StatFailItemRows,StatFailClassRows,ErrClasscnt,ErrCnt3,slipcont;
record GlobalItemVc GIr, ExtPrGIr;
string 100 artcode,brand,newBrand,code,glCode,tstr,bltstr,cntstr,origartcode;
record BPIBrandVc BPIBrandr;
record BPIBrandVc BPIBrand1r;
area ErrAr1, ErrAr2, reply;
array string 255 abrand,anewbrand,ErrArr,ErrAr3;
array string 100 headers,params;
record CompaniesBlock Compb;
row CompaniesBlock Comprw;
vector boolean Errf, Classf;
array string 255 ItemCode,ItemName,ItemBrand,ItemPrice,DealerPrice,Rebate,DealerInStock;
boolean INrf, ExtPrItemf, namef, dpf, rbf, isf;
vector string 255 classCode;
string 255 filename, FinRow, PrefCode;
LongInt rcnt, r, okend ;
vector string 255 vparams, vartcode, vbrand, vorigartcode,vJSONParENG,vJSONParRUS,vJSONParAZE;
record JSONClassNamesVc JCNr;
vector boolean vJSONClassf;
vector boolean CodeInstf;
boolean TrHs;
record ExpProvItemRegVc EPIRr;
		
	BlockLoad(Compb);
	
	CompQty = matrowcnt(Compb);
	curcomp = currentcompany;	
	// SetImportCodePage("CP1251");
	SetCompany(1,false);
	okend = 0;
	for (i=0;i<CountFilesInDir("/mnt/database/Ecommerce/ExtItemIN");i=i+1) begin
		if (right(GetFileNameInDir("/mnt/database/Ecommerce/ExtItemIN",i),4) == ".txt") then begin 
			filename = GetFileNameInDir("/mnt/database/Ecommerce/ExtItemIN",i);
			i = CountFilesInDir("/mnt/database/Ecommerce/ExtItemIN"); 
		end;
	end;
	if(nonblank(filename) and fileexists("/mnt/database/Ecommerce/ExtItemIN/" & filename))then begin
		if (fileexists("/mnt/database/Ecommerce/ExtItemOUT/" & filename)) then begin
			delete_file("/mnt/database/Ecommerce/ExtItemOUT/" & filename);
		end;
		logtext(0,"start ImportAddExtVendItemsFromFolderQueuedIn");
		SetImportCodePage("UTF-8");
		openfile("/mnt/database/Ecommerce/ExtItemIN/" & filename);
		// _______________________________________________________________________
		// FOR TEST SERVER ONLY
	// for (i=0;i<CountFilesInDir("ECommerceIN");i=i+1) begin	
		// if (right(GetFileNameInDir("ECommerceIN",i),4) == ".txt") then begin 
			// filename = GetFileNameInDir("ECommerceIN",i);
			// i = CountFilesInDir("ECommerceIN"); 
		// end;
	// end;
	// if(nonblank(filename) and fileexists("ECommerceIN/" & filename))then begin
		// if (fileexists("ECommerceOUT/" & filename)) then begin
			// delete_file("ECommerceOUT/" & filename);
		// end;
		// logtext(0,"start ImportAddExtVendItemsFromFolderQueuedIn");
		// SetImportCodePage("UTF-8");
		// openfile("ECommerceIN/" & filename);
		// _______________________________________________________________________
	// for (i=0;i<CountFilesInDir("ExtItemIN");i=i+1) begin
		// if (right(GetFileNameInDir("ExtItemIN",i),4) == ".txt") then begin 
			// filename = GetFileNameInDir("ExtItemIN",i);
			// i = CountFilesInDir("ExtItemIN"); 
		// end;
	// end;
	// if(nonblank(filename) and fileexists("ExtItemIN/" & filename))then begin
		// if (fileexists("ExtItemOUT/" & filename)) then begin
			// delete_file("ExtItemOUT/" & filename);
		// end;
		// logtext(0,"start ImportAddExtVendItemsFromFolderQueuedIn");
		// SetImportCodePage("UTF-8");
		// openfile("ExtItemIN/" & filename);
		
		
		
		tstr = importfield;
		tstr = right(tstr,(len(tstr)-1));
		// logtext(0,USetStr(36229));
		if(tstr!=USetStr(36229))then begin
			logtext(0,"ImportAddClassIn codepage error");
			AddTextToArea	(USetStr(36351) & chr(09),ErrAr1);
			while (TestEOF()==false) begin
				if (NextImportLine(true)) then begin end;
			end;
		end;
		if (NextImportLine(true)) then begin end;
		tstr = importfield; 
		if(tstr!=USetStr(36385))then begin
			// logtext(0,tstr & " PrefCode");
			SetCompany(29,false);
			EPIRr.PrefCode = tstr;
			if (readfirstKey("PrefCode",EPIRr,1,true)) then begin
				PrefCode = EPIRr.PrefCode;
				// logtext(0,namef & " PrefCode");
			end;
			ResetCompany(1);
			if (NextImportLine(true)) then begin end;
			tstr = ImportField;
			tstr = ImportField;
			if (tstr=="name") then begin
				namef = true;
			end;
			tstr = ImportField;
			tstr = ImportField;
			
			while(nonblank(tstr))begin
				tstr = ImportField;
				if(nonblank(tstr))then begin
					StripEndingSpaces(tstr);
					headers[headers.length] = tstr;
					if (tstr=="dealer_pr") then begin
						dpf = true;
					end;
					if (tstr=="rebate") then begin
						rbf = true;
					end;
					if (tstr=="inStock") then begin
						isf = true;
					end;
				end;
			end;
			
			if (NextImportLine(true)) then begin end;
			i=0;
			while (TestEOF()==false) begin
				tstr = trim(ImportField);
				ItemCode[i] = tstr;
				if (namef) then begin
					tstr = trim(ImportField);
					ItemName[i] = tstr;
				end;
				tstr = trim(ImportField);
				ItemBrand[i] = tstr;
				tstr = trim(ImportField);
				for (j=0;j<len(tstr);j=j+1) begin
					if(Mid(tstr,j,1)==",") then begin
						ItemPrice[i] = ItemPrice[i] & ".";
					end else begin
						ItemPrice[i] = ItemPrice[i] & Mid(tstr,j,1);
					end;
				end;
				
				
				for (k=0;k<headers.length;k=k+1) begin
					if (headers[k]=="dealer_pr") then begin
						tstr = trim(ImportField);
						for (j=0;j<len(tstr);j=j+1) begin
							if(Mid(tstr,j,1)==",") then begin
								DealerPrice[i] = DealerPrice[i] & ".";
							end else begin
								DealerPrice[i] = DealerPrice[i] & Mid(tstr,j,1);
							end;
						end;
					end;
					if (headers[k]=="rebate") then begin
						tstr = trim(ImportField);
						for (j=0;j<len(tstr);j=j+1) begin
							if(Mid(tstr,j,1)==",") then begin
								Rebate[i] = Rebate[i] & ".";
							end else begin
								Rebate[i] = Rebate[i] & Mid(tstr,j,1);
							end;
						end;
					end;
					if (headers[k]=="inStock") then begin
						tstr = trim(ImportField);
						for (j=0;j<len(tstr);j=j+1) begin
							if(Mid(tstr,j,1)==",") then begin
								DealerInStock[i] = DealerInStock[i] & ".";
							end else begin
								DealerInStock[i] = DealerInStock[i] & Mid(tstr,j,1);
							end;
						end;
					end;
				end;
				
				
				
				if (NextImportLine(true)) then begin end;
				i=i+1;
			end;
			cnt = i;
			CloseFile;
			MoveFile(filename,"/mnt/database/Ecommerce/ExtItemIN","/mnt/database/Ecommerce/ExtItemOUT");
			delete_file("/mnt/database/Ecommerce/ExtItemIN/" & filename);
			runprogram("chmod","-R a+rw Ecommerce");
			if (nonblank(PrefCode)) then begin
				for (i=0;i<cnt;i=i+1) begin
					if(nonblank(ItemCode[i])) then begin 
						queued.CreateExtProvGlobalItem(PrefCode & ItemCode[i],ItemBrand[i],ItemPrice[i],ItemName[i], namef, DealerPrice[i], dpf, Rebate[i], rbf, DealerInStock[i], isf, EPIRr.SerNr);
						MilliSleep(50);
						CodeInstf[PrefCode & ItemCode[i]] = true;
					end;
				end;
				GIr.Code = PrefCode;
				TrHs = true;
				while (loopMain(GIr,1,TrHs)) begin
					if (left(GIr.Code,len(PrefCode))!=PrefCode) then begin TrHs = false; end;
					if (TrHs and !CodeInstf[GIr.Code]) then begin
						queued.Instock0(GIr.Code);
						MilliSleep(50);
					end;
				end;
			end;
		end else begin
			while (TestEOF()==false) begin
				if (NextImportLine(true)) then begin end;
			end;
		end;
	end;
	return;
end;








global procedure ImportRefCodesByClassQueuedIn()  // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 13:50 13.10.2020
begin
	record INVc INr,oldINr;
	integer i,flushcnt,curcomp,cnt,j,k,CompQty,ErrCnt1,ErrCnt2,mtrw,INComp,StatAllRows,StatOkRows,StatFailItemRows,StatFailClassRows,ErrClasscnt,ErrCnt3,slipcont;
	record GlobalItemVc GIr, ExtPrGIr;
	string 100 artcode,brand,newBrand,code,glCode,tstr,bltstr,cntstr,origartcode;
	record BPIBrandVc BPIBrandr;
	record BPIBrandVc BPIBrand1r;
	area ErrAr1, ErrAr2, reply;
	array string 255 abrand,anewbrand,ErrArr,ErrAr3;
	array string 100 headers,params;
	record CompaniesBlock Compb;
	row CompaniesBlock Comprw;
	vector boolean Errf, Classf;
	array string 255 ItemCode,ItemName,ItemBrand,ItemPrice,DealerPrice,RefCode;
	boolean INrf, ExtPrItemf, namef, dpf;
	vector string 255 classCode;
	string 255 filename, FinRow, PrefCode;
	LongInt rcnt, r, okend ;
	vector string 255 vparams, vartcode, vbrand, vorigartcode,vJSONParENG,vJSONParRUS,vJSONParAZE;
	record JSONClassNamesVc JCNr;
	vector boolean vJSONClassf;
	vector boolean CodeInstf;
	boolean TrHs;
	record ExpProvItemRegVc EPIRr;
		
	BlockLoad(Compb);
	
	CompQty = matrowcnt(Compb);
	curcomp = currentcompany;	
	// SetImportCodePage("CP1251");
	SetCompany(1,false);
	okend = 0;
	for (i=0;i<CountFilesInDir("/mnt/database/Ecommerce/ExtItemIN");i=i+1) begin
		if (right(GetFileNameInDir("/mnt/database/Ecommerce/ExtItemIN",i),4) == ".txt") then begin 
			filename = GetFileNameInDir("/mnt/database/Ecommerce/ExtItemIN",i);
			i = CountFilesInDir("/mnt/database/Ecommerce/ExtItemIN"); 
		end;
	end;
	if(nonblank(filename) and fileexists("/mnt/database/Ecommerce/ExtItemIN/" & filename))then begin
		if (fileexists("/mnt/database/Ecommerce/ExtItemOUT/" & filename)) then begin
			delete_file("/mnt/database/Ecommerce/ExtItemOUT/" & filename);
		end;
		logtext(0,"start ImportRefCodesByClassQueuedIn");
		SetImportCodePage("UTF-8");
		openfile("/mnt/database/Ecommerce/ExtItemIN/" & filename);
		// _______________________________________________________________________
		// for (i=0;i<CountFilesInDir("ExtItemIN");i=i+1) begin
			// if (right(GetFileNameInDir("ExtItemIN",i),4) == ".txt") then begin 
				// filename = GetFileNameInDir("ExtItemIN",i);
				// i = CountFilesInDir("ExtItemIN"); 
			// end;
		// end;
		// if(nonblank(filename) and fileexists("ExtItemIN/" & filename))then begin
			// if (fileexists("ExtItemOUT/" & filename)) then begin
				// delete_file("ExtItemOUT/" & filename);
			// end;
			// logtext(0,"start ImportRefCodesByClassQueuedIn");
			// SetImportCodePage("UTF-8");
			// openfile("ExtItemIN/" & filename);
		// _______________________________________________________________________
		
		
		
		tstr = importfield;
		tstr = right(tstr,(len(tstr)-1));
		if(tstr!=USetStr(36229))then begin
			logtext(0,"Import references in global Items by class CODEPAGE Error");
			AddTextToArea	(USetStr(36351) & chr(09),ErrAr1);
			while (TestEOF()==false) begin
				if (NextImportLine(true)) then begin end;
			end;
		end;
		if (NextImportLine(true)) then begin end;
		tstr = ImportField;
		if(tstr!=USetStr(36387))then begin
			logtext(0,"ImportRefCodesByClassQueuedIn CODEWORD Error");
			while (TestEOF()==false) begin
				if (NextImportLine(true)) then begin end;
			end;
			CloseFile;
		end else begin
			if (NextImportLine(true)) then begin end;
			tstr = ImportField;
			tstr = ImportField;
			if (NextImportLine(true)) then begin end;
			i=0;
			while (TestEOF()==false) begin
				tstr = trim(ImportField);
				ItemCode[i] = tstr;
				tstr = trim(ImportField);
				RefCode[i] =  tstr;
				if (NextImportLine(true)) then begin end;
				i=i+1;
			end;
			cnt = i;
			CloseFile;
			MoveFile(filename,"/mnt/database/Ecommerce/ExtItemIN","/mnt/database/Ecommerce/ExtItemOUT");
			delete_file("/mnt/database/Ecommerce/ExtItemIN/" & filename);
			runprogram("chmod","-R a+rw Ecommerce");
			for (i=0;i<cnt;i=i+1) begin
				if (nonblank(ItemCode[i])) then begin
					queued.SetReffItem(ItemCode[i],RefCode[i]);
					MilliSleep(50);
				end;
			end;
		end;
	end;
	return;
end;










global procedure ImportGlobalSetsQueuedIn()  // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 13:50 13.10.2020
begin
	record INVc INr,oldINr;
	integer i,flushcnt,curcomp,cnt,j,k,CompQty,ErrCnt1,ErrCnt2,mtrw,INComp,StatAllRows,StatOkRows,StatFailItemRows,StatFailClassRows,ErrClasscnt,ErrCnt3,slipcont;
	record GlobalItemVc GIr, ExtPrGIr;
	string 100 artcode,brand,newBrand,code,glCode,tstr,bltstr,cntstr,origartcode;
	record BPIBrandVc BPIBrandr;
	record BPIBrandVc BPIBrand1r;
	area ErrAr1, ErrAr2, reply;
	array string 255 abrand,anewbrand,ErrArr,ErrAr3;
	array string 100 headers,params;
	record CompaniesBlock Compb;
	row CompaniesBlock Comprw;
	vector boolean Errf, Classf;
	array string 255 SetItemCode,ItemName,ItemBrand,ItemPrice,DealerPrice,ItemCode,SetName;
	array val SetItenQty;
	boolean INrf, ExtPrItemf, namef, dpf;
	string 255 filename, FinRow, PrefCode;
	LongInt rcnt, r, okend ;
	vector string 255 vparams, vartcode, vbrand, vorigartcode,vJSONParENG,vJSONParRUS,vJSONParAZE;
	record JSONClassNamesVc JCNr;
	boolean TrHs;
	record GlobalItSetVc GISr;
		
	BlockLoad(Compb);
	
	CompQty = matrowcnt(Compb);
	curcomp = currentcompany;	
	// SetImportCodePage("CP1251");
	SetCompany(1,false);
	okend = 0;
	for (i=0;i<CountFilesInDir("/mnt/database/Ecommerce/ExtItemIN");i=i+1) begin
		if (right(GetFileNameInDir("/mnt/database/Ecommerce/ExtItemIN",i),4) == ".txt") then begin 
			filename = GetFileNameInDir("/mnt/database/Ecommerce/ExtItemIN",i);
			i = CountFilesInDir("/mnt/database/Ecommerce/ExtItemIN"); 
		end;
	end;
	if(nonblank(filename) and fileexists("/mnt/database/Ecommerce/ExtItemIN/" & filename))then begin
		if (fileexists("/mnt/database/Ecommerce/ExtItemOUT/" & filename)) then begin
			delete_file("/mnt/database/Ecommerce/ExtItemOUT/" & filename);
		end;
		logtext(0,"start ImportGlobalSetsQueuedIn");
		SetImportCodePage("UTF-8");
		openfile("/mnt/database/Ecommerce/ExtItemIN/" & filename);
		// _______________________________________________________________________
		// for (i=0;i<CountFilesInDir("ExtItemIN");i=i+1) begin
			// if (right(GetFileNameInDir("ExtItemIN",i),4) == ".txt") then begin 
				// filename = GetFileNameInDir("ExtItemIN",i);
				// i = CountFilesInDir("ExtItemIN"); 
			// end;
		// end;
		// if(nonblank(filename) and fileexists("ExtItemIN/" & filename))then begin
			// if (fileexists("ExtItemOUT/" & filename)) then begin
				// delete_file("ExtItemOUT/" & filename);
			// end;
			// logtext(0,"start ImportGlobalSetsQueuedIn");
			// SetImportCodePage("UTF-8");
			// openfile("ExtItemIN/" & filename);
		// _______________________________________________________________________
		
		
		
		tstr = importfield;
		tstr = right(tstr,(len(tstr)-1));
		if(tstr!=USetStr(36229))then begin
			logtext(0,"Import global sets CODEPAGE Error");
			AddTextToArea	(USetStr(36351) & chr(09),ErrAr1);
			while (TestEOF()==false) begin
				if (NextImportLine(true)) then begin end;
			end;
		end;
		if (NextImportLine(true)) then begin end;
		tstr = ImportField;
		if(tstr!=USetStr(36388))then begin
			logtext(0,"ImportGlobalSetsQueuedIn CODEWORD Error");
			while (TestEOF()==false) begin
				if (NextImportLine(true)) then begin end;
			end;
			CloseFile;
		end else begin
			if (NextImportLine(true)) then begin end;
			tstr = ImportField;
			tstr = ImportField;
			tstr = ImportField;
			if (NextImportLine(true)) then begin end;
			i=0;
			while (TestEOF()==false) begin
				tstr = trim(ImportField);
				SetItemCode[i] = tstr;
				tstr = trim(ImportField);
				ItemCode[i] =  tstr;
				tstr = trim(ImportField);
				SetItenQty[i] =  StringToVal(tstr,M4Val);
				tstr = trim(ImportField);
				SetName[i] =  tstr;
				if (NextImportLine(true)) then begin end;
				i=i+1;
			end;
			cnt = i;
			CloseFile;
			MoveFile(filename,"/mnt/database/Ecommerce/ExtItemIN","/mnt/database/Ecommerce/ExtItemOUT");
			delete_file("/mnt/database/Ecommerce/ExtItemIN/" & filename);
			runprogram("chmod","-R a+rw Ecommerce");
			for (i=0;i<cnt;i=i+1) begin
				if (nonblank(ItemCode[i])) then begin
					queued.CreateGlobalSet(SetItemCode[i],ItemCode[i],SetItenQty[i],SetName[i]);
					MilliSleep(50);
				end;
			end;
		end;
	end;
	return;
end;









global procedure ImportAddTPExtVendItemsFromFolderQueuedIn()  // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 13:50 13.10.2020
begin
record INVc INr,oldINr;
integer i,flushcnt,curcomp,cnt,j,k,CompQty,ErrCnt1,ErrCnt2,mtrw,INComp,StatAllRows,StatOkRows,StatFailItemRows,StatFailClassRows,ErrClasscnt,ErrCnt3,slipcont;
record GlobalItemVc GIr, ExtPrGIr;
string 100 artcode,brand,newBrand,code,glCode,tstr,bltstr,cntstr,origartcode;
record BPIBrandVc BPIBrandr;
record BPIBrandVc BPIBrand1r;
area ErrAr1, ErrAr2, reply;
array string 255 abrand,anewbrand,ErrArr,ErrAr3;
array string 100 headers,params;
record CompaniesBlock Compb;
row CompaniesBlock Comprw;
vector boolean Errf, Classf;
array string 255 ItemCode,ItemName,ItemBrand,ItemPrice,DealerPrice,TPCode;
boolean INrf, ExtPrItemf, namef, dpf;
vector string 255 classCode;
string 255 filename, FinRow, PrefCode;
LongInt rcnt, r, okend ;
vector string 255 vparams, vartcode, vbrand, vorigartcode,vJSONParENG,vJSONParRUS,vJSONParAZE;
record JSONClassNamesVc JCNr;
vector boolean vJSONClassf;
vector boolean CodeInstf;
boolean TrHs;
record ExpProvItemRegVc EPIRr;
		
	BlockLoad(Compb);
	
	CompQty = matrowcnt(Compb);
	curcomp = currentcompany;	
	// SetImportCodePage("CP1251");
	SetCompany(1,false);
	okend = 0;
	for (i=0;i<CountFilesInDir("/mnt/database/Ecommerce/ExtItemIN");i=i+1) begin
		if (right(GetFileNameInDir("/mnt/database/Ecommerce/ExtItemIN",i),4) == ".txt") then begin 
			filename = GetFileNameInDir("/mnt/database/Ecommerce/ExtItemIN",i);
			i = CountFilesInDir("/mnt/database/Ecommerce/ExtItemIN"); 
		end;
	end;
	if(nonblank(filename) and fileexists("/mnt/database/Ecommerce/ExtItemIN/" & filename))then begin
		if (fileexists("/mnt/database/Ecommerce/ExtItemOUT/" & filename)) then begin
			delete_file("/mnt/database/Ecommerce/ExtItemOUT/" & filename);
		end;
		logtext(0,"start ImportAddTPExtVendItemsFromFolderQueuedIn");
		SetImportCodePage("UTF-8");
		openfile("/mnt/database/Ecommerce/ExtItemIN/" & filename);
		// _______________________________________________________________________
		// for (i=0;i<CountFilesInDir("ExtItemIN");i=i+1) begin
			// if (right(GetFileNameInDir("ExtItemIN",i),4) == ".txt") then begin 
				// filename = GetFileNameInDir("ExtItemIN",i);
				// i = CountFilesInDir("ExtItemIN"); 
			// end;
		// end;
		// if(nonblank(filename) and fileexists("ExtItemIN/" & filename))then begin
			// if (fileexists("ExtItemOUT/" & filename)) then begin
				// delete_file("ExtItemOUT/" & filename);
			// end;
			// logtext(0,"start ImportAddTPExtVendItemsFromFolderQueuedIn");
			// SetImportCodePage("UTF-8");
			// openfile("ExtItemIN/" & filename);
		// _______________________________________________________________________
		
		
		
		
		tstr = importfield;
		tstr = right(tstr,(len(tstr)-1));
		// logtext(0,USetStr(36229));
		if(tstr!=USetStr(36229))then begin
			logtext(0,"ImportAddClassIn codepage error");
			AddTextToArea	(USetStr(36351) & chr(09),ErrAr1);
			while (TestEOF()==false) begin
				if (NextImportLine(true)) then begin end;
			end;
			CloseFile;
		end;
		
		if (NextImportLine(true)) then begin end;
		tstr = ImportField;
		if(tstr!=USetStr(36385))then begin
			logtext(0,"ImportAddClassIn TP error");
			while (TestEOF()==false) begin
				if (NextImportLine(true)) then begin end;
			end;
			CloseFile;
		end else begin
			namef = false;
			if (NextImportLine(true)) then begin end;
			tstr = ImportField;
			tstr = ImportField;
			if (tstr=="Name") then begin
				namef = true;
			end;
			tstr = ImportField;
			while(nonblank(tstr))begin
				tstr = importfield;
				if(nonblank(tstr))then begin
					StripEndingSpaces(tstr);
					headers[headers.length] = tstr;
				end;
			end;
			
			
			if (NextImportLine(true)) then begin end;
			i=0;
			while (TestEOF()==false) begin
				tstr = trim(ImportField);
				ItemCode[i] = tstr;
				if (namef) then begin
					tstr = trim(ImportField);
					ItemName[i] = tstr;
				end;
				tstr = trim(ImportField);
				TPCode[i] =  tstr;
				for(j=0;j<headers.length;j=j+1)begin
					tstr = importfield;
					vparams[TPCode[i] & "_" & headers[j]] = tstr;
				end;
				if (NextImportLine(true)) then begin end;
				i=i+1;
			end;
			cnt = i;
			CloseFile;
			MoveFile(filename,"/mnt/database/Ecommerce/ExtItemIN","/mnt/database/Ecommerce/ExtItemOUT");
			delete_file("/mnt/database/Ecommerce/ExtItemIN/" & filename);
			runprogram("chmod","-R a+rw Ecommerce");
			for (i=0;i<cnt;i=i+1) begin
				if(nonblank(ItemCode[i])) then begin 
					queued.CreateTPGlobalItem(ItemCode[i],TPCode[i],ItemName[i],headers,vparams);
					MilliSleep(50);
				end;
			end;
		end;
	end;
	return;
end;










global function boolean ImportAddClassWithJSONFromFolderQueuedComIn()  // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 15:34 07.05.2020
begin
record INVc INr,oldINr;
integer i,flushcnt,curcomp,cnt,j,k,CompQty,ErrCnt1,ErrCnt2,mtrw,INComp,StatAllRows,StatOkRows,StatFailItemRows,StatFailClassRows,ErrClasscnt,ErrCnt3,slipcont;
record GlobalItemVc GIr, ExtPrGIr;
string 100 artcode,brand,newBrand,code,glCode,tstr,bltstr,cntstr,origartcode;
record BPIBrandVc BPIBrandr;
record BPIBrandVc BPIBrand1r;
area ErrAr1, ErrAr2, reply, HDAr, fileArea;
array string 255 abrand,anewbrand,ErrArr,ErrAr3;
array string 100 headers,params;
record CompaniesBlock Compb;
row CompaniesBlock Comprw;
vector boolean Errf, Classf, vTPMainCodef;
array string 255 Class;
boolean INrf, ExtPrItemf, JSONf, TrHs;
vector string 255 classCode;
string 255 filename, FinRow, MainItemCode, mothfilename, filename1, header1,header2,header3;
LongInt rcnt, r, okend ;
vector string 255 vparams, vartcode, vbrand, vorigartcode,vJSONParENG,vJSONParRUS,vJSONParAZE, vTPCodes;
record JSONClassNamesVc JCNr;
vector boolean vJSONClassf, vOldArtCode;
area ImportedFile, headerf;
vector longint vTPCNt;
		
	BlockLoad(Compb);
	
	CompQty = matrowcnt(Compb);
	curcomp = currentcompany;	
	// SetImportCodePage("CP1251");
	SetCompany(1,false);
	JSONf = false;
	
	okend = 0;
	for (i=0;i<CountFilesInDir("/mnt/database/Ecommerce/ECommerceIN");i=i+1) begin
		if (right(GetFileNameInDir("/mnt/database/Ecommerce/ECommerceIN",i),4) == ".txt") then begin 
			filename = GetFileNameInDir("/mnt/database/Ecommerce/ECommerceIN",i);
			i = CountFilesInDir("/mnt/database/Ecommerce/ECommerceIN"); 
		end;
	end;
	if(nonblank(filename) and fileexists("/mnt/database/Ecommerce/ECommerceIN/" & filename))then begin
		if (fileexists("/mnt/database/Ecommerce/ECommerceERRORS/" & filename)) then begin
			delete_file("/mnt/database/Ecommerce/ECommerceERRORS/" & filename);
		end;
		if (fileexists("/mnt/database/Ecommerce/ECommerceOUT/" & filename)) then begin
			delete_file("/mnt/database/Ecommerce/ECommerceOUT/" & filename);
		end;
		logtext(0,"start ImportAddClassFromFolderIn");
		SetImportCodePage("UTF-8");
		AddFileToArea("/mnt/database/Ecommerce/ECommerceIN/" & filename,ImportedFile,false);
		openfile("/mnt/database/Ecommerce/ECommerceIN/" & filename);
	// _______________________________________________________________________
	// for (i=0;i<CountFilesInDir("ECommerceIN");i=i+1) begin
		// if (right(GetFileNameInDir("ECommerceIN",i),4) == ".txt") then begin 
			// filename = GetFileNameInDir("ECommerceIN",i);
			// i = CountFilesInDir("ECommerceIN"); 
		// end;
	// end;
	// if(nonblank(filename) and fileexists("ECommerceIN/" & filename))then begin
		// if (fileexists("ECommerceERRORS/" & filename)) then begin
			// delete_file("ECommerceERRORS/" & filename);
		// end;
		// if (fileexists("ECommerceOUT/" & filename)) then begin
			// delete_file("ECommerceOUT/" & filename);
		// end;
		// logtext(0,"start ImportAddClassFromFolderQueueIn");
		// SetImportCodePage("UTF-8");
		// openfile("ECommerceIN/" & filename);
		// AddFileToArea(filename,ImportedFile,false);
		// _______________________________________________________________________
		tstr = importfield;
		tstr = right(tstr,(len(tstr)-1));
		ErrCnt1 = 2;
		// logtext(0,USetStr(36229));
		if(tstr!=USetStr(36229))then begin
			logtext(0,"ImportAddClassIn codepage error");
			ErrCnt1 = ErrCnt1 + 1;
			AddTextToArea	(USetStr(36351) & chr(09),ErrAr1);
			while (TestEOF()==false) begin
				if (NextImportLine(true)) then begin end;
			end;
			goto lImportAddClassWithJSONFromFolderQueuedComIn;
		end;
		if (NextImportLine(true)) then begin end;
		tstr = importfield;
		while(nonblank(tstr))begin
			tstr = importfield;
			if(nonblank(tstr))then begin
				StripEndingSpaces(tstr);
				if (!CheckClassNOJSONType(tstr)) then begin
					JSONf = true;
				end;
			end;
		end;
		if (NextImportLine(true)) then begin end;
		while (TestEOF()==false) begin
			if (NextImportLine(true)) then begin end;
		end;
		CloseFile;
		if (JSONf) then begin
			MoveFile(filename,"/mnt/database/Ecommerce/ECommerceIN","ECommerceIN");
			delete_file("/mnt/database/Ecommerce/ECommerceIN/" & filename);
			
			// split divi.txt -l 100
			// RenameFile	(string fileA,string fileB)
			
			runprogram("split","ECommerceIN/" & filename & " -l 100 -d");
			millisleep(500);
			delete_file("ECommerceIN/" & filename);
			mothfilename = filename;
			
			if (fileexists("x00")) then begin
				logtext (0,"fileexists(x00)");
				SetImportCodePage("UTF-8");
				openfile("x00");
				AddFileToArea("x00",headerf,false);
				header1 = GetLineFromArea(headerf,0);
				header2 = GetLineFromArea(headerf,1);
				header3 = GetLineFromArea(headerf,2);
				addtexttoarea(header1,HDAr);
				addtexttoarea(header2,HDAr);
				addtexttoarea(header3,HDAr);
				if (NextImportLine(true)) then begin end;
				while (TestEOF()==false) begin
					if (NextImportLine(true)) then begin end;
				end;
				CloseFile;
				RenameFile ("x00","x00" & "_" & mothfilename);
				MoveFile("x00" & "_" & mothfilename,"","/mnt/database/Ecommerce/TMP");
				delete_file("x00" & "_" & mothfilename);
			end;
			
			i = 1;
			TrHs = true;
			runprogram("chmod","-R a+rw /mnt/database/Ecommerce");
			while (TrHs) begin
				if (fileexists("x0" & i) or fileexists("x" & i)) then begin 
					if (i < 10) then begin 
						filename = "x0" & i;
					end else begin
						filename = "x" & i;
					end;
					logtext (0,"fileexists(filename) " & filename);
					AddAreaAfterArea(HDAr,fileArea);
					AddFileToArea(filename,fileArea,0);
					createfile("/mnt/database/Ecommerce/TMP/" & filename & "_" & mothfilename);
					WriteAreaToFile(fileArea,"/mnt/database/Ecommerce/TMP/" & filename & "_" & mothfilename,0);
					SetAreaZeroSize(fileArea);
					delete_file(filename);
					CloseFile;
				end else begin
					TrHs = false;
				end;
				i = i + 1;
			end;
			runprogram("chmod","-R a+rw /mnt/database/Ecommerce");
		end else begin
			MoveFile(filename,"ECommerceIN/" ,"/mnt/database/Ecommerce/TMP");
			delete_file("ECommerceIN/" & filename);
		end;
	end;
	CloseFile;

	lImportAddClassWithJSONFromFolderQueuedComIn:;
	ImportAddClassWithJSONFromFolderQueuedComIn = JSONf;
return;
end;


















global procedure ImportAddClassWithJSONFromFolderQueuedIn()  // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 15:34 07.05.2020
begin
record INVc INr,oldINr;
integer i,flushcnt,curcomp,cnt,j,k,CompQty,ErrCnt1,ErrCnt2,mtrw,INComp,StatAllRows,StatOkRows,StatFailItemRows,StatFailClassRows,ErrClasscnt,ErrCnt3,slipcont;
record GlobalItemVc GIr, ExtPrGIr;
string 100 artcode,brand,newBrand,code,glCode,tstr,bltstr,cntstr,origartcode;
record BPIBrandVc BPIBrandr;
record BPIBrandVc BPIBrand1r;
area ErrAr1, ErrAr2, reply;
array string 255 abrand,anewbrand,ErrArr,ErrAr3;
array string 100 headers,params;
record CompaniesBlock Compb;
row CompaniesBlock Comprw;
vector boolean Errf, Classf, vTPMainCodef;
array string 255 Class;
boolean INrf, ExtPrItemf, iportf;
vector string 255 classCode;
string 255 filename, FinRow, MainItemCode;
LongInt rcnt, r, okend, clarea;
vector string 255 vparams, vartcode, vbrand, vorigartcode,vJSONParENG,vJSONParRUS,vJSONParAZE, vTPCodes;
record JSONClassNamesVc JCNr;
vector boolean vJSONClassf, vOldArtCode;
area ImportedFile;
vector longint vTPCNt;
		
	BlockLoad(Compb);
	
	CompQty = matrowcnt(Compb);
	curcomp = currentcompany;	
	// SetImportCodePage("CP1251");
	SetCompany(1,false);
	iportf = true;
	if (ImportAddClassWithJSONFromFolderQueuedComIn) then begin iportf = false; end;
	// if (gethour(currenttime)==9 and getminute(currenttime)>=01 and getminute(currenttime)<=25) then begin
		// for (i=0;i<CountFilesInDir("/mnt/database/Ecommerce/ECommerceWJSONIN");i=i+1) begin
			// if (right(GetFileNameInDir("/mnt/database/Ecommerce/ECommerceWJSONIN",i),4) == ".txt") then begin 
				// filename = GetFileNameInDir("/mnt/database/Ecommerce/ECommerceWJSONIN",i);
				// i = CountFilesInDir("/mnt/database/Ecommerce/ECommerceWJSONIN"); 
			// end;
		// end;
		// if (fileexists("/mnt/database/Ecommerce/ECommerceIN/" & filename)) then begin
			// MoveFile(filename,"/mnt/database/Ecommerce/ECommerceWJSONIN","/mnt/database/Ecommerce/ECommerceIN");
			// delete_file("/mnt/database/Ecommerce/ECommerceIN/" & filename);
		// end;
	// end;
	
	
	if (iportf) then begin
		okend = 0;
		
		for (i=0;i<CountFilesInDir("/mnt/database/Ecommerce/TMP");i=i+1) begin
			if (right(GetFileNameInDir("/mnt/database/Ecommerce/TMP",i),4) == ".txt") then begin 
				filename = GetFileNameInDir("/mnt/database/Ecommerce/TMP",i);
				i = CountFilesInDir("/mnt/database/Ecommerce/TMP"); 
			end;
		end;
		if(nonblank(filename) and fileexists("/mnt/database/Ecommerce/TMP/" & filename))then begin
			if (fileexists("/mnt/database/Ecommerce/ECommerceERRORS/" & filename)) then begin
				delete_file("/mnt/database/Ecommerce/ECommerceERRORS/" & filename);
			end;
			if (fileexists("/mnt/database/Ecommerce/ECommerceOUT/" & filename)) then begin
				delete_file("/mnt/database/Ecommerce/ECommerceOUT/" & filename);
			end;
			logtext(0,"start ImportAddClassFromFolderIn");
			SetImportCodePage("UTF-8");
			AddFileToArea("/mnt/database/Ecommerce/TMP/" & filename,ImportedFile,false);
			openfile("/mnt/database/Ecommerce/TMP/" & filename);
		// _______________________________________________________________________
		// for (i=0;i<CountFilesInDir("ECommerceIN");i=i+1) begin
			// if (right(GetFileNameInDir("ECommerceIN",i),4) == ".txt") then begin 
				// filename = GetFileNameInDir("ECommerceIN",i);
				// i = CountFilesInDir("ECommerceIN"); 
			// end;
		// end;
		// if(nonblank(filename) and fileexists("ECommerceIN/" & filename))then begin
			// if (fileexists("ECommerceERRORS/" & filename)) then begin
				// delete_file("ECommerceERRORS/" & filename);
			// end;
			// if (fileexists("ECommerceOUT/" & filename)) then begin
				// delete_file("ECommerceOUT/" & filename);
			// end;
			// logtext(0,"start ImportAddClassFromFolderQueueIn");
			// SetImportCodePage("UTF-8");
			// openfile("ECommerceIN/" & filename);
			// AddFileToArea("ECommerceIN/" & filename,ImportedFile,false);
			// _______________________________________________________________________
			clarea = countlinesinarea(ImportedFile);
			tstr = importfield;
			tstr = right(tstr,(len(tstr)-1));
			ErrCnt1 = 2;
			logtext(0,USetStr(36229));
			logtext(0,tstr);
			if(tstr!=USetStr(36229))then begin
				logtext(0,"ImportAddClassIn codepage error");
				ErrCnt1 = ErrCnt1 + 1;
				AddTextToArea	(USetStr(36351) & chr(09),ErrAr1);
				while (TestEOF()==false) begin
					if (NextImportLine(true)) then begin end;
				end;
				goto lImportAddClassWithJSONFromFolderQueuedIn;
			end;
			if (NextImportLine(true)) then begin end;
			tstr = importfield;
			while(nonblank(tstr))begin
				tstr = importfield;
				if(nonblank(tstr))then begin
					StripEndingSpaces(tstr);
					if (CheckClassNOJSONType(tstr)) then begin
						headers[headers.length] = tstr;
					end else begin
						JCNr.Code = tstr;
						if (ReadFirstMain(JCNr,1,true)) then begin
							vJSONClassf["JSON_" & tstr] = true;
						end;
						bltstr = importfield;
						bltstr = importfield;
						headers[headers.length] = "JSON_" & tstr;
						headers[headers.length] = "JSON_" & tstr;
						headers[headers.length] = "JSON_" & tstr;
					end;
				end;
			end;
			
			if (NextImportLine(true)) then begin end;
			tstr = importfield;
			for(i=0;i<headers.length;i=i+1)begin
				tstr = importfield;
				if(nonblank(tstr))then begin
					StripEndingSpaces(tstr);
					if (left(headers[i],5)=="JSON_") then begin
						vJSONParENG[headers[i]] = tstr;
						tstr = importfield;
						vJSONParRUS[headers[i]] = tstr;
						tstr = importfield;
						vJSONParAZE[headers[i]] = tstr;
					end;
					i=i+2;
				end;
			end;
			
			if (NextImportLine(true)) then begin end;
			AddTextToArea	(USetStr(36266) & chr(09) & USetStr(36267) & chr(09) & USetStr(36268) & chr(09) & USetStr(36269) & chr(13),ErrAr1);
			StatAllRows = 0;
			StatOkRows = 0;
			StatFailItemRows = 0;
			StatFailClassRows = 0;
			ErrClasscnt = 0;
			r = 0;
			while (TestEOF()==false) begin
				StatAllRows = StatAllRows + 1;
				for(i=0;i<headers.length;i=i+1)begin
					params[i] = "";
				end;
				cnt = cnt + 1;
				artcode = importfield;
				StripEndingSpaces(artcode);
				if (vOldArtCode[artcode]) then begin artcode = artcode & "REPEAT"; end;
				vOldArtCode[artcode] = true;
				vartcode[r] = artcode;
				origartcode = artcode;
				vorigartcode[r] = origartcode;
				brand = importfield;
				StripEndingSpaces(brand);
				vbrand[r] = brand;
				params[0] = brand;
				vparams[r & "_0"] = params[0];
				for(i=1;i<headers.length;i=i+1)begin
					tstr = importfield;
					params[i] = tstr;
					vparams[r & "_" & i] = params[i];
				end;
				ExtPrItemf = false;
				ExtPrGIr.Code = artcode;
				if (ReadFirstMain(ExtPrGIr,1,true)) then begin
					//if (ExtPrGIr.ExtProwItRegulations>0) then begin
						ExtPrItemf = true;
					//end;
				end;
				if (!ExtPrItemf) then begin
					BPIBrandr.Name = brand;
					if(readfirstkey("Name",BPIBrandr,1,true))then begin
						mtrw = matrowcnt(Compb);
						INrf = false;
						INComp = 0;
						for (i=0;i<mtrw;i=i+1) begin
							matrowget(Compb,i,Comprw);
							if(Comprw.ActiveStatus==0 and (!CompanyIsJWLikeCompany(i+1) or i+1==3) and i+1!=10 and i+1!=32)then begin
								SetCompany(i+1,false);
								INr.Code = artcode;
								if(ReadFirstMain(INr,1,true))then begin
									if(INr.BPIBrand==BPIBrandr.Code)then begin 
										INComp = i+1;
										INrf = true; 
										i = mtrw;
									end;
								end;
							end;
						end;
						resetcompany(curcomp);
						artcode = BPIBrandr.Code & "_" & artcode;
						GIr.Code = artcode;
						if(readfirstmain(GIr,1,true))then begin
							
							ErrCnt2 = 0;
							if(CheckItemBitrixClassQueued(GIr,headers,params,ErrArr,ErrCnt2,ErrAr3,classCode))then begin
								if(ErrCnt2>0)then begin
									ErrCnt1 = ErrCnt1 + 1;
									AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand & chr(09) & USetStr(36264) & chr(09),ErrAr1);
									for (i=0;i<ErrCnt2;i=i+1) begin
										AddTextToArea	((i+1) & ". " & ErrArr[i] & " - " & USetStr(36238) & chr(09),ErrAr1);
										if(!Classf[ErrArr[i]])then begin
											Classf[ErrArr[i]] = true;
											Class[ErrClasscnt] = ErrAr3[i];
											ErrClasscnt = ErrClasscnt + 1;
										end;
									end;
									AddTextToArea	(chr(13),ErrAr1);
									StatFailClassRows = StatFailClassRows + 1;
								end else begin
									// ErrCnt1 = ErrCnt1 + 1;
									// AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand &  chr(09) & USetStr(36265) & chr(13),ErrAr1);
									StatOkRows = StatOkRows + 1;
									okend = r;
								end;
							end;
						end else begin
							if(!INrf)then begin
								ErrCnt1 = ErrCnt1 + 1;
								AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand & chr(09) & USetStr(36237) & chr(13),ErrAr1);
								StatFailItemRows = StatFailItemRows + 1;
							end else begin
								SetCompany(INComp,false);
								queued.CreateNewGlobalItem(INr);
								ResetCompany(curcomp);
								if(CheckItemBitrixClassQueued(GIr,headers,params,ErrArr,ErrCnt2,ErrAr3,classCode))then begin
									if(ErrCnt2>0)then begin
										ErrCnt1 = ErrCnt1 + 1;
										AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand & chr(09) & USetStr(36264) & chr(09),ErrAr1);
										for (i=0;i<ErrCnt2;i=i+1) begin
											AddTextToArea	((i+1) & ". " & ErrArr[i] & " - " & USetStr(36238) & chr(09),ErrAr1);
											if(!Classf[ErrArr[i]])then begin
												Classf[ErrArr[i]] = true;
												Class[ErrClasscnt] = ErrAr3[i];
												ErrClasscnt = ErrClasscnt + 1;
											end;
										end;
										AddTextToArea	(chr(13),ErrAr1);
										StatFailClassRows = StatFailClassRows + 1;
									end else begin
										// ErrCnt1 = ErrCnt1 + 1;
										// AddTextToArea	(ErrCnt1 & chr(09) & chr(09)  & origartcode  & chr(09) & brand &  chr(09) & USetStr(36265) & chr(13),ErrAr1);
										StatOkRows = StatOkRows + 1;
										okend = r;
									end;
								end;
							end;
						end;
					end else begin
						BPIBrandr.Code = brand;
						if(readfirstkey("Code",BPIBrandr,1,true))then begin
							mtrw = matrowcnt(Compb);
							INrf = false;
							INComp = 0;
							for (i=0;i<mtrw;i=i+1) begin
								matrowget(Compb,i,Comprw);
								if(Comprw.ActiveStatus==0 and (!CompanyIsJWLikeCompany(i+1) or i+1==3) and i+1!=10 and i+1!=32)then begin
									SetCompany(i+1,false);
									INr.Code = artcode;
									if(ReadFirstMain(INr,1,true))then begin
										if(INr.BPIBrand==brand)then begin 
											INComp = i+1;
											INrf = true; 
											i = mtrw;
										end;
									end;
								end;
							end;
							resetcompany(curcomp);
							artcode = BPIBrandr.Code & "_" & artcode;
							GIr.Code = artcode;
							if(readfirstmain(GIr,1,true))then begin
								ErrCnt2 = 0;
								if(CheckItemBitrixClassQueued(GIr,headers,params,ErrArr,ErrCnt2,ErrAr3,classCode))then begin
									if(ErrCnt2>0)then begin
										ErrCnt1 = ErrCnt1 + 1;
										AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand & USetStr(36264) & chr(09),ErrAr1);
										for (i=0;i<ErrCnt2;i=i+1) begin
											AddTextToArea	((i+1) & ". " & ErrArr[i] & " - " & USetStr(36238) & chr(09),ErrAr1);
											if(!Classf[ErrArr[i]])then begin
												Classf[ErrArr[i]] = true;
												Class[ErrClasscnt] = ErrAr3[i];
												ErrClasscnt = ErrClasscnt + 1;
											end;
										end;
										AddTextToArea	(chr(13),ErrAr1);
										StatFailClassRows = StatFailClassRows + 1;
									end else begin
										// ErrCnt1 = ErrCnt1 + 1;
										// AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand &  chr(09) & USetStr(36265) & chr(13),ErrAr1);
										StatOkRows = StatOkRows + 1;
										okend = r;
									end;
								end;
							end else begin
								if(!INrf)then begin
									ErrCnt1 = ErrCnt1 + 1;
									AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & chr(09) & chr(09) & brand & chr(09) & USetStr(36237) & chr(13),ErrAr1);
									StatFailItemRows = StatFailItemRows + 1;
								end else begin
									SetCompany(INComp,false);
									//CreateNewGlobalItem(INr);
									ResetCompany(curcomp);
									GIr.Code = BPIBrandr.Code & "_" & artcode;
									if(CheckItemBitrixClassQueued(GIr,headers,params,ErrArr,ErrCnt2,ErrAr3,classCode))then begin
										if(ErrCnt2>0)then begin
											ErrCnt1 = ErrCnt1 + 1;
											AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand & USetStr(36264) & chr(09),ErrAr1);
											for (i=0;i<ErrCnt2;i=i+1) begin
												AddTextToArea	((i+1) & ". " & ErrArr[i] & " - " & USetStr(36238) & chr(09),ErrAr1);
												if(!Classf[ErrArr[i]])then begin
													Classf[ErrArr[i]] = true;
													Class[ErrClasscnt] = ErrAr3[i];
													ErrClasscnt = ErrClasscnt + 1;
												end;
											end;
											AddTextToArea	(chr(13),ErrAr1);
											StatFailClassRows = StatFailClassRows + 1;
										end else begin
											// ErrCnt1 = ErrCnt1 + 1;
											// AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand & chr(09) & USetStr(36265) & chr(13),ErrAr1);
											StatOkRows = StatOkRows + 1;
											okend = r;
										end;
									end;
								end;
							end;
						end else begin
							ErrCnt1 = ErrCnt1 + 1;
							AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand & chr(09) & USetStr(36264) & chr(09),ErrAr1);
							AddTextToArea	(USetStr(36353) & chr(09) & "\"" & brand & "\"" & chr(09) & USetStr(36237) & chr(13),ErrAr1);
							StatFailItemRows = StatFailItemRows + 1;
						end;
					end;
				end else begin
					GIr.Code = artcode;
					if(readfirstmain(GIr,1,true))then begin
						ErrCnt2 = 0;
						if(CheckItemBitrixClassQueued(GIr,headers,params,ErrArr,ErrCnt2,ErrAr3,classCode))then begin
							if(ErrCnt2>0)then begin
								ErrCnt1 = ErrCnt1 + 1;
								AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand & chr(09) & USetStr(36264) & chr(09),ErrAr1);
								for (i=0;i<ErrCnt2;i=i+1) begin
									AddTextToArea	((i+1) & ". " & ErrArr[i] & " - " & USetStr(36238) & chr(09),ErrAr1);
									if(!Classf[ErrArr[i]])then begin
										Classf[ErrArr[i]] = true;
										Class[ErrClasscnt] = ErrAr3[i];
										ErrClasscnt = ErrClasscnt + 1;
									end;
								end;
								AddTextToArea	(chr(13),ErrAr1);
								StatFailClassRows = StatFailClassRows + 1;
							end else begin
								// ErrCnt1 = ErrCnt1 + 1;
								// AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand &  chr(09) & USetStr(36265) & chr(13),ErrAr1);
								StatOkRows = StatOkRows + 1;
								okend = r;
							end;
						end;
					end else begin
						ErrCnt1 = ErrCnt1 + 1;
						AddTextToArea	(ErrCnt1 & chr(09) & origartcode & chr(09) & brand & chr(09) & USetStr(36237) & chr(13),ErrAr1);
						StatFailItemRows = StatFailItemRows + 1;
					end;
				end;
				r = r + 1;
				// CheckFlush(flushcnt,100);
				if (NextImportLine(true)) then begin end;
			end;
			AddTextToArea	(USetStr(36272) & chr(09) & chr(09) & chr(09) & StatAllRows & chr(13),ErrAr2);
			AddTextToArea	(USetStr(36273) & chr(09) & chr(09) & chr(09) & StatOkRows & chr(13),ErrAr2);
			AddTextToArea	(USetStr(36274) & chr(09) & chr(09) & chr(09) & StatFailItemRows & chr(13),ErrAr2);
			AddTextToArea	(USetStr(36275) & chr(09) & chr(09) & chr(09) & StatFailClassRows & chr(13),ErrAr2);
			AddTextToArea	(USetStr(36276) & chr(09) & chr(09) & chr(09) & ErrClasscnt & chr(13),ErrAr2);
			AddTextToArea	(chr(09) &  chr(09) &  chr(09) & USetStr(36277) & chr(09) & USetStr(36278) & chr(09) & USetStr(36279) & chr(13),ErrAr2);
			for (i=0;i<ErrClasscnt;i=i+1) begin
				AddTextToArea	( chr(09) &  chr(09) &  chr(09) & (i+1) & chr(09) & Class[i] & chr(13),ErrAr2);
			end;
			
			AddTextToArea	(chr(13),ErrAr2);



			AddAreaAfterArea(ErrAr2,ErrAr1);
			if (ErrCnt1 > 2) then begin
				WriteAreaToFile	(ErrAr1,"/mnt/database/Ecommerce/ECommerceERRORS/" & filename,0);
			end;
			lImportAddClassWithJSONFromFolderQueuedIn:;
			CloseFile;
			logtext(0,okend & " !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!");
			if (okend == 0) then begin
				MoveFile(filename,"/mnt/database/Ecommerce/TMP","/mnt/database/Ecommerce/ECommerceOUT");
				delete_file("/mnt/database/Ecommerce/TMP/" & filename);
			end;
		end;
		runprogram("chmod","-R a+rw /mnt/database/Ecommerce");
		
		//_______________________________________________________________
			// AddAreaAfterArea(ErrAr2,ErrAr1);
			// if (ErrCnt1 > 2) then begin
				// WriteAreaToFile	(ErrAr1,"ECommerceERRORS" & filename,0);
			// end;
			// lImportAddClassFromFolderIn:;
			// CloseFile;
			// if (okend == 0) then begin
				// MoveFile(filename,"ECommerceIN","ECommerceOUT");
				// delete_file("ECommerceIN/" & filename);
			// end;
		// end;
		// runprogram("chmod","-R a+rw /usr/local/bin/ECommerceIN");
		// runprogram("chmod","-R a+rw /usr/local/bin/ECommerceERRORS");
		// runprogram("chmod","-R a+rw /usr/local/bin/ECommerceOUT");
		//_______________________________________________________________
		
		
		
		
		
		
		// GIr.Code = "";
		// while (loopMain(GIr,1,true)) begin
			// if (nonblank(GIr.MainCode)) then begin
				// vTPMainCodef[GIr.MainCode] = true;
				// if (vTPCNt[GIr.MainCode]<0) then begin
					// vTPCNt[GIr.MainCode] = 0;
				// end;
				// vTPCodes[GIr.MainCode & "_" & vTPCNt[GIr.MainCode]] = GIr.Code;
				// vTPCNt[GIr.MainCode] = vTPCNt[GIr.MainCode] + 1;
			// end;
		// end;
		// ResetLoop(GIr);
		
		
		
		

		StatAllRows = 0;
		StatOkRows = 0;
		StatFailItemRows = 0;
		StatFailClassRows = 0;
		ErrClasscnt = 0;
		rcnt = r;
		for (r=0;r<rcnt;r=r+1) begin
			FinRow = "";
			if (r == okend) then begin
				FinRow = filename;
			end;
			StatAllRows = StatAllRows + 1;
			for(i=0;i<headers.length;i=i+1)begin
				params[i] = "";
			end;
			cnt = cnt + 1;
			artcode = vartcode[r];
			origartcode = vorigartcode[r];
			brand = vbrand[r];
			params[0] = vparams[r & "_0"];
			for(i=1;i<headers.length;i=i+1)begin
				tstr = vparams[r & "_" & i];
				params[i] = tstr;
			end;
			ExtPrItemf = false;
			ExtPrGIr.Code = artcode;
			if (ReadFirstMain(ExtPrGIr,1,true)) then begin
				// if (ExtPrGIr.ExtProwItRegulations>0) then begin
					ExtPrItemf = true;
				// end;
			end;
			MainItemCode = "";
			if (!ExtPrItemf) then begin
				BPIBrandr.Name = brand;
				if(readfirstkey("Name",BPIBrandr,1,true))then begin
					artcode = BPIBrandr.Code & "_" & artcode;
					GIr.Code = artcode;
					if(readfirstmain(GIr,1,true))then begin
						queued.SetItemBitrixClassVJSONQueued(GIr,headers,params,vJSONParENG,vJSONParRUS,vJSONParAZE,ImportedFile,clarea,MainItemCode,ErrArr,ErrCnt2,ErrAr3,classCode,FinRow);
						slipcont = slipcont + 1;
						if(slipcont>10)then begin
							millisleep(20);
							slipcont = 0;
						end;
						if (vTPMainCodef[GIr.Code]) then begin
							MainItemCode = GIr.Code;
							for (i=0;i<vTPCNt[MainItemCode];i=i+1) begin
								if (nonblank(vTPCodes[MainItemCode & "_" & i])) then begin
									GIr.Code = vTPCodes[MainItemCode & "_" & i];
									if(readfirstmain(GIr,1,true))then begin
										queued.SetItemBitrixClassVJSONQueued(GIr,headers,params,vJSONParENG,vJSONParRUS,vJSONParAZE,ImportedFile,clarea,MainItemCode,ErrArr,ErrCnt2,ErrAr3,classCode,FinRow);
										slipcont = slipcont + 1;
										if(slipcont>10)then begin
											millisleep(20);
											slipcont = 0;
										end;
									end;
								end;
							end;
						end;
					end;
				end else begin
					BPIBrandr.Code = brand;
					if(readfirstkey("Code",BPIBrandr,1,true))then begin
						artcode = BPIBrandr.Code & "_" & artcode;
						GIr.Code = artcode;
						if(readfirstmain(GIr,1,true))then begin
							queued.SetItemBitrixClassVJSONQueued(GIr,headers,params,vJSONParENG,vJSONParRUS,vJSONParAZE,ImportedFile,clarea,MainItemCode,ErrArr,ErrCnt2,ErrAr3,classCode,FinRow);
							slipcont = slipcont + 1;					
							if(slipcont>10)then begin
								millisleep(30);
								slipcont = 0;
							end;
							if (vTPMainCodef[GIr.Code]) then begin
								MainItemCode = GIr.Code;
								for (i=0;i<vTPCNt[MainItemCode];i=i+1) begin
									if (nonblank(vTPCodes[MainItemCode & "_" & i])) then begin
										GIr.Code = vTPCodes[MainItemCode & "_" & i];
										if(readfirstmain(GIr,1,true))then begin
											queued.SetItemBitrixClassVJSONQueued(GIr,headers,params,vJSONParENG,vJSONParRUS,vJSONParAZE,ImportedFile,clarea,MainItemCode,ErrArr,ErrCnt2,ErrAr3,classCode,FinRow);
											slipcont = slipcont + 1;
											if(slipcont>10)then begin
												millisleep(20);
												slipcont = 0;
											end;
										end;
									end;
								end;
							end;
						end;
					end;
				end;
			end else begin
				GIr.Code = artcode;
				if(readfirstmain(GIr,1,true))then begin
					queued.SetItemBitrixClassVJSONQueued(GIr,headers,params,vJSONParENG,vJSONParRUS,vJSONParAZE,ImportedFile,clarea,MainItemCode,ErrArr,ErrCnt2,ErrAr3,classCode,FinRow);
					slipcont = slipcont + 1;					
					if(slipcont>10)then begin
						millisleep(30);
						slipcont = 0;
					end;
					if (vTPMainCodef[GIr.Code]) then begin
						MainItemCode = GIr.Code;
						for (i=0;i<vTPCNt[MainItemCode];i=i+1) begin
							if (nonblank(vTPCodes[MainItemCode & "_" & i])) then begin
								GIr.Code = vTPCodes[MainItemCode & "_" & i];
								if(readfirstmain(GIr,1,true))then begin
									queued.SetItemBitrixClassVJSONQueued(GIr,headers,params,vJSONParENG,vJSONParRUS,vJSONParAZE,ImportedFile,clarea,MainItemCode,ErrArr,ErrCnt2,ErrAr3,classCode,FinRow);
									slipcont = slipcont + 1;
									if(slipcont>10)then begin
										millisleep(20);
										slipcont = 0;
									end;
								end;
							end;
						end;
					end;
				end;
			end;
			if(fileexists("stop"))then begin
				r = rcnt;
			end;
			
		end;
		logtext(0,"end ImportAddClassFromFolderQueueIn");
	end;
	resetcompany(curcomp);
return;
end;





global updating procedure ImportNewINVcRecordsRow (var record NewINvc newINr, LongInt rownr, array string headers, array string params)
begin
	row NewINvc newINrw;
	LongInt i;
	boolean res;
	record BPIBrandVc BBr;
	
	
	for (i=0;i<headers.length;i=i+1) begin
		if (nonblank(params[i])) then begin
			matrowget(newINr,rownr,newINrw);
			switch (headers[i]) begin
				case "Product Name":
					newINrw.ProductNameCode = params[i];
					matrowput(newINr,rownr,newINrw);
					res = NewIN2DClassProductNameCodeEFAfter(-1,rownr,1,newINr); 
					matrowget(newINr,rownr,newINrw);
				case "Subgroup":
					newINrw.SubGroupCl = params[i];
					matrowput(newINr,rownr,newINrw);
					res = NewIN2DClassSubGroupClEFAfter(-1,rownr,1,newINr);
					matrowget(newINr,rownr,newINrw);
			end;
		end;
	end;
	
	for (i=0;i<headers.length;i=i+1) begin
		if (nonblank(params[i])) then begin
			matrowget(newINr,rownr,newINrw);
			switch (headers[i]) begin
				case "Model/Collection":
					newINrw.Collection = params[i];
					logtext (0,params[i] & "     " & rownr);
					matrowput(newINr,rownr,newINrw);
				case "Group":
					newINrw.GroupCl = params[i];
					matrowput(newINr,rownr,newINrw);
				case "Category":
					newINrw.classif31 = params[i];
					matrowput(newINr,rownr,newINrw);
				case "Material":
					newINrw.Material = params[i];
					matrowput(newINr,rownr,newINrw);
				case "All Materials":
					newINrw.AllMaterials = params[i];
					matrowput(newINr,rownr,newINrw);
				case "Color":
					newINrw.Color = params[i];
					matrowput(newINr,rownr,newINrw);
				case "Size":
					newINrw.SizeCl = params[i];
					matrowput(newINr,rownr,newINrw);
				case "Length":
					newINrw.Length2 = params[i];
					matrowput(newINr,rownr,newINrw);
				case "Width":
					newINrw.Width2 = params[i];
					matrowput(newINr,rownr,newINrw);
				case "Height":
					newINrw.Height2 = params[i];
					matrowput(newINr,rownr,newINrw);
				case "Diameter":
					newINrw.Diameter2 = params[i];
					matrowput(newINr,rownr,newINrw);
				case "Volume":
					newINrw.Volume2 = params[i];
					matrowput(newINr,rownr,newINrw);
				case "Item Size":
					newINrw.ItemSize = params[i];
					matrowput(newINr,rownr,newINrw);
				case "Unit of measurement":
					newINrw.UnitOfMeasurement = params[i];
					matrowput(newINr,rownr,newINrw);
				case "Sex":
					newINrw.SexCl = params[i];
					matrowput(newINr,rownr,newINrw);
				case "Filling":
					newINrw.Filling = params[i];
					matrowput(newINr,rownr,newINrw);
				case "Count In Set":
					newINrw.CountInSet = params[i];
					matrowput(newINr,rownr,newINrw);
				case "Care":
					newINrw.Care = params[i];
					matrowput(newINr,rownr,newINrw);
				case "Additional Product Description":
					newINrw.AddProdDesc = params[i];
					matrowput(newINr,rownr,newINrw);
				case "Product Features":
					newINrw.ProdFeat = params[i];
					matrowput(newINr,rownr,newINrw);
				case "Stone":
					newINrw.StoneCl = params[i];
					matrowput(newINr,rownr,newINrw);
				case "Odour":
					newINrw.OdourCl = params[i];
					matrowput(newINr,rownr,newINrw);
				case "Band Material":
					newINrw.StrapMat = params[i];
					matrowput(newINr,rownr,newINrw);
				case "Dial Material":
					newINrw.ClockFaceMaterialCode = params[i];
					matrowput(newINr,rownr,newINrw);
				case "Band Color":
					newINrw.StrapColourCode = params[i];
					matrowput(newINr,rownr,newINrw);
				case "Dial Color":
					newINrw.ClockFaceColourCode = params[i];
					matrowput(newINr,rownr,newINrw);
				case "Strap":
					newINrw.Strap = params[i];
					matrowput(newINr,rownr,newINrw);
				case "Shape":
					newINrw.ShapeCut = params[i];
					matrowput(newINr,rownr,newINrw);
				case "Weight":
					newINrw.WeightCl = params[i];
					matrowput(newINr,rownr,newINrw);
				case "BTRxWeight":
					newINrw.Weight2 = params[i];
					matrowput(newINr,rownr,newINrw);
				case "Use":
					newINrw.UseCl = params[i];
					matrowput(newINr,rownr,newINrw);
				case "Plating":
					newINrw.PlatingCl = params[i];
					matrowput(newINr,rownr,newINrw);
				case "Clarity":
					newINrw.ClaritySC = params[i];
					matrowput(newINr,rownr,newINrw);
				case "Cut":
					newINrw.CutCl = params[i];
					matrowput(newINr,rownr,newINrw);
				case "Carat":
					newINrw.DiamondsCarat = params[i];
					matrowput(newINr,rownr,newINrw);
				case "Carat Central Stone":
					newINrw.CentralCarat = params[i];
					matrowput(newINr,rownr,newINrw);
				case "Complications":
					newINrw.Complications = params[i];
					matrowput(newINr,rownr,newINrw);
				case "Case Diameter":
					newINrw.CaseDiameter = params[i];
					matrowput(newINr,rownr,newINrw);
				case "Watch Mechanism":
					newINrw.WatchMechanism = params[i];
					matrowput(newINr,rownr,newINrw);
				case "Power Reserve":
					newINrw.PowerReserve = params[i];
					matrowput(newINr,rownr,newINrw);
				case "Water Resistant":
					newINrw.WaterResistant = params[i];
					matrowput(newINr,rownr,newINrw);
				case "Limitation":
					newINrw.LimitedGood = params[i];
					matrowput(newINr,rownr,newINrw);
				case "Microwave Safe":
					newINrw.MicrowaveSafe = params[i];
					matrowput(newINr,rownr,newINrw);
				case "Matches Kitchen Stove":
					newINrw.MatchesKitchenStove = params[i];
					matrowput(newINr,rownr,newINrw);
				case "Sctratch Resistant":
					newINrw.Sctrchresistant = params[i];
					matrowput(newINr,rownr,newINrw);
				case "Additional Product Description":
					newINrw.AddProdDesc = params[i];
					matrowput(newINr,rownr,newINrw);
				case "Warranty Information":
					newINrw.Warranty = params[i];
					matrowput(newINr,rownr,newINrw);
				case "Ref.":
					newINrw.VendorCode = params[i];
					matrowput(newINr,rownr,newINrw);
					BBr.Code = newINr.Brand;
					if(ReadFirstMain(BBr,1,true)) then begin
						CheckItemCC(newINr,rownr);
						matrowget(newINr,rownr,newINrw);
					end;
				case "Description":
					newINrw.Name = params[i];
					matrowput(newINr,rownr,newINrw);
			end;
		end;
	end;
	
	RETURN;
end;





global updating procedure ImportNewINVcRecordsMatrix(record RcVc RepSpec)
begin
	record NewINvc NewINr;
	row NewINvc NewINrw;
	string 255 tstr, artcode, brand, currentBrand, filename;
	array string 100 headers,params;
	LongInt i, currentrow;
	record BPIBrandVc BPIBrandr;
	array string 255 aBrands;
	boolean testf, foundf;
	vector LongInt BrandNewINSerNr;
	
	SetCompany(18,false);
	
	// for (i=0;i<CountFilesInDir("BenchmarkIN");i=i+1) begin
		// if (right(GetFileNameInDir("BenchmarkIN",i),4) == ".txt") then begin 
			// filename = GetFileNameInDir("BenchmarkIN",i);
			// i = CountFilesInDir("BenchmarkIN"); 
			// SetImportCodePage("UTF-8");
			// openfile("BenchmarkIN/" & filename);
		// end;
	// end;

	SetImportCodePage("CP1251");
	
	tstr = importfield;
	// tstr = right(tstr,(len(tstr)-1));
	// logtext(0,USetStr(36229));
	if(tstr!=USetStr(36229))then begin
		logtext(0,"ImportAddClassIn codepage error");
		while (TestEOF()==false) begin
			if (NextImportLine(true)) then begin end;
		end;
		goto lImportNewINVcRecordsMatrix;
	end;

	if (NextImportLine(true)) then begin end;
	tstr = importfield;
	while(nonblank(tstr))begin
		if(nonblank(tstr))then begin
			StripEndingSpaces(tstr);
			headers[headers.length] = tstr;
		end;
		tstr = importfield;
	end;
	if (NextImportLine(true)) then begin end;
	while (TestEOF()==false) begin
		cleararray(params);
		artcode = importfield;
		params[0] = artcode;
		brand = importfield;
		params[1] = brand;
		testf = false;
		foundf = false;
		for (i=0;i<aBrands.length;i=i+1) begin
			if (aBrands[i]==brand) then begin
				testf = true;
				if (currentBrand!=brand) then begin
					recordStore(NewINr,true);
					NewINr.SerNr = BrandNewINSerNr[brand];
					if (readfirstmain(NewINr,1,true)) then begin
						foundf = true;
						currentBrand = brand;
					end;
				end else begin
					foundf = true;
				end;
			end;
		end;
		if (!testf) then begin
			aBrands[aBrands.length] = brand;
			BPIBrandr.Name = brand;
			if (ReadFirstKey("Name",BPIBrandr,1,true)) then begin
				RecordNew(NewINr);
				NewINr.SerNr = NextSerNr("NewINvc",CurrentDate,-1,false,"");
				NewINr.Brand = BPIBrandr.Code;
				recordStore(NewINr,true);
				BrandNewINSerNr[brand] = NewINr.SerNr;
				foundf = true;
				currentBrand = brand;
			end;
		end;
		for(i=2;i<headers.length;i=i+1)begin
			tstr = importfield;
			params[i] = tstr;
		end;
		
		
		
		if (foundf) then begin
			currentrow = matrowcnt(NewINr);
			ImportNewINVcRecordsRow(NewINr,currentrow,headers,params);
			matrowget(NewINr,currentrow,NewINrw);
		end;
		
		if (NextImportLine(true)) then begin end;
	end;
	if (RecordStore(NewINr,true)) then begin logtext(0,"End"); end;
	lImportNewINVcRecordsMatrix:;
	CloseFile;
	return;
end;



global webpublic updating procedure WebTestSeqno()
begin
	record GlobalItemVc GIr,OldGIr;
	
	GIr.Code = "ZMAZ93396000";
	if (ReadFirstMain(Gir,1,true)) then begin
		RecordCopy (OldGIr,GIr);
		GIr.HansaName = GIr.HansaName & " ";
		// recordUpdate(OldGIr,Gir,true);
		GIWasUpdated(GIr,OldGIr," GIWasUpdatedlog 124");
		if (recordstore(GIr,true)) then begin
			logtext (0,"Stored");
		end;
	end;
	return;
end;




global updating procedure ImportBTrxClassifSettings(record RcVc RepSpec)
begin
	record BTRxClassSetVc BCSr;
	row BTRxClassSetVc BCSrw;
	string 255 tstr, artcode, brand, prodname, filename;
	array string 100 headers,CTypesNames;
	LongInt i, currentrow;
	record BtrxProductNameVc BtrxProductNamer;
	array string 255 aBrands;
	boolean testf, foundf;
	vector LongInt BrandNewINSerNr;
	record CTypeVc CTr;
	
	SetCompany(18,false);
	
	
	tstr = importfield;
	// tstr = right(tstr,(len(tstr)-1));
	// logtext(0,USetStr(36229));
	if(tstr!=USetStr(36229))then begin
		logtext(0,"ImportAddClassIn codepage error");
		while (TestEOF()==false) begin
			if (NextImportLine(true)) then begin end;
		end;
		goto lImportBTrxClassifSettings;
	end;

	if (NextImportLine(true)) then begin end;
	tstr = importfield;
	while(nonblank(tstr))begin
		tstr = importfield;
		if(nonblank(tstr))then begin
			StripEndingSpaces(tstr);
			headers[headers.length] = tstr;
		end;
	end;
	
	// if (NextImportLine(true)) then begin end;
	// tstr = importfield;
	// for (i=0;i<headers.length;i=i+1) begin
		// tstr = importfield;
		// StripEndingSpaces(tstr);
		// CTypesNames[i] = tstr;
	// end;
	
	if (NextImportLine(true)) then begin end;
	while (TestEOF()==false) begin
		prodname = importfield;
		BCSr.TypeName = prodname;
		BtrxProductNamer.Name = prodname;
		if (readfirstKey("Name",BtrxProductNamer,1,true)) then begin
			BCSr.Type = BtrxProductNamer.Code;
			if (!ReadFirstMain(BCSr,1,true)) then begin
				RecordNew(BCSr);
				BCSr.Type = BtrxProductNamer.Code;
				BCSr.TypeName = BtrxProductNamer.Name;
				if (RecordStore(BCSr,true)) then begin
					for (i=0;i<headers.length;i=I+1) begin
						tstr = "";
						tstr = importfield;
						if (tstr=="1") then begin
							BCSrw.CType = headers[i];
							CTr.Code = BCSrw.CType;
							if(!readfirstmain(CTr,1,true)) then begin
								RecordNew(CTr);
								CTr.Code = BCSrw.CType;
								CTr.Comment = CTypesNames[i];
								if (RecordStore(CTr,true)) then begin
									BCSrw.CTypeName = CTr.Comment;
								end;
							end else begin
								BCSrw.CTypeName = CTr.Comment;
							end;
							matrowput(BCSr,matrowcnt(BCSr),BCSrw);
						end;
					end;
				end;
				if (RecordStore(BCSr,true)) then begin
					logtext(0,BCSr.TypeName & " Created new BTRx class setting!");
				end;
			end;
		end;
		
		if (NextImportLine(true)) then begin end;
	end;
	lImportBTrxClassifSettings:;
	return;
end;













global updating procedure ImportBTrxGroupClassifSettings(record RcVc RepSpec)  // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 10:47 28.10.2020
begin
	record BTRxGroupClassSetVc BGCSr;
	row BTRxGroupClassSetVc BGCSrw;
	string 255 tstr, artcode, brand, prodname, filename, OldCode, newCode;
	array string 100 headers,CTypesNames;
	LongInt i, currentrow;
	record BtrxGroupsVc BtrxGroupr;
	array string 255 aBrands;
	boolean testf, foundf;
	vector LongInt BrandNewINSerNr;
	record CTypeVc CTr;
	record BTRxProductNameVc BTRxPNr;
	record BtrxFillingVc BtrxFillingr;
	record BtrxAllMaterialsVc BtrxAllMaterialsr;
	record BtrxComplicationsVc BtrxComplicationsr;
	record BtrxWatchMechanVc BtrxWatchMechanr;
	record BtrxWaterResistantVc BtrxWatResr;
	record BTRxBrandVc BTRxBrandr;
	record BPIMaterialVc BPIMaterialr;
	record BPIColorVc BPIColorr;
	record BTRxSizeVc BTRxSizer;
	record BTRxSexVc BTRxSexr;
	record BPIPlatingVc BPIPlatingr;
	record BPIStoneVc BPIStoner;
	record BPIStrapVc BPIStrapr;
	record BPIOdourVc BPIOdourr;
	record BtrxInternalCatVc BtrxInternalCatr;
	record BtrxFirstLevelCatVc BtrxFirstLevelCatr;
	record BtrxSecondLevelCatVc BtrxSecondLevelCatr, BSLLastCoder;
	record BtrxThirdLevelCatVc BtrxThirdLevelCatr, BTLLastCoder;
	record BtrxFourthLevelCatVc BtrxFourthLevelCatr, BFLLastCoder;
	record BtrxCertificateVc BtrxCertificater;
	record BtrxPowerReserveVc BtrxPowerReserver;
	record BtrxWatchGradeVc BtrxWatchGrader;
	record BtrxPhoneModelVc BtrxPhoneModelr;
	record BtrxTypeVc BtrxTyper;
	record BtrxStrapMatVc BtrxStrapMatr;
	record BtrxBracelMatVc BtrxBracelMatr;
	record BtrxCollectionVc BtrxCollectionr;
	record BtrxMicrowaveProtectVc BtrxMicrowaveProtectr;
	record BtrxStoveCompatVc BtrxStoveCompatr;
	record BtrxPrecMetalContVc BtrxPrecMetalContr;
	record BtrxCaseDiamVc BtrxCaseDiamr;
	boolean TrHs;
	vector string 255 vTypeNameCode;
	
	SetCompany(18,false);
	
	
	tstr = importfield;
	// tstr = right(tstr,(len(tstr)-1));
	// logtext(0,USetStr(36229));
	if(tstr!=USetStr(36229))then begin
		logtext(0,"ImportAddClassIn codepage error");
		while (TestEOF()==false) begin
			if (NextImportLine(true)) then begin end;
		end;
		goto lImportBTrxClassifSettings;
	end;
	
	if (NextImportLine(true)) then begin end;
	while (TestEOF()==false) begin
		tstr = importfield;
		BtrxGroupr.Name = tstr;
		if (ReadFirstKey("Name",BtrxGroupr,1,true)) then begin
			BGCSr.Type = BtrxGroupr.Code;
			if (!ReadFirstMain(BGCSr,1,true)) then begin
				RecordNew(BGCSr);
				BGCSr.Type = BtrxGroupr.Code;
				BGCSr.TypeName = BtrxGroupr.Name;
			end;
			tstr = importfield;
			CTr.Code = tstr;
			if(readfirstmain(CTr,1,true)) then begin
				BGCSrw.CType = tstr;
				BGCSrw.CTypeName = CTr.Comment;
				tstr = importfield;
				switch (BGCSrw.CType) begin
					case "PROD_N":
						BTRxPNr.Name = tstr;
						if (ReadFirstKey("Name",BTRxPNr,1,true)) then begin
							BGCSrw.CCode = BTRxPNr.Code;
							BGCSrw.CCodeName = BTRxPNr.Name;
						end else begin
			
						end;
					case "ALL_MAT":
						BtrxAllMaterialsr.Name = tstr;
						if (ReadFirstKey("Name",BtrxAllMaterialsr,1,true)) then begin
							BGCSrw.CCode = BtrxAllMaterialsr.Code;
							BGCSrw.CCodeName = BtrxAllMaterialsr.Name;
						end else begin
							if (nonblank(vTypeNameCode[BGCSrw.CType & "_" & tstr])) then begin
								BGCSrw.CCode = vTypeNameCode[BGCSrw.CType & "_" & tstr];
								BGCSrw.CCodeName = tstr;
							end else begin
								BtrxAllMaterialsr.Code = "AM999999";
								TrHs = true;
								while (LoopBackKey("Code",BtrxAllMaterialsr,1,TrHs)) begin
									OldCode = BtrxAllMaterialsr.Code;
									TrHs = false;
								end;
								ResetLoop(BtrxAllMaterialsr);
								recordnew(BtrxAllMaterialsr);
								if(blank(OldCode))then begin OldCode = "AM000000"; end;
								NextCode(OldCode,BtrxAllMaterialsr.Code);
								BtrxAllMaterialsr.Name = tstr;
								BGCSrw.CCode = BtrxAllMaterialsr.Code;
								BGCSrw.CCodeName = BtrxAllMaterialsr.Name;
								recordinsert(BtrxAllMaterialsr,true);
								recordupdate(BtrxAllMaterialsr,BtrxAllMaterialsr,true);
								OldCode = "";
								vTypeNameCode[BGCSrw.CType & "_" & tstr] = BtrxAllMaterialsr.Code;
							end;
						end;
					case "COMPLICAT":
						BtrxComplicationsr.Name = tstr;
						if (ReadFirstKey("Name",BtrxComplicationsr,1,true)) then begin
							BGCSrw.CCode = BtrxComplicationsr.Code;
							BGCSrw.CCodeName = BtrxComplicationsr.Name;
						end else begin
							if (nonblank(vTypeNameCode[BGCSrw.CType & "_" & tstr])) then begin
								BGCSrw.CCode = vTypeNameCode[BGCSrw.CType & "_" & tstr];
								BGCSrw.CCodeName = tstr;
							end else begin
								BtrxComplicationsr.Code = "CMP99999";
								TrHs = true;
								while (LoopBackKey("Code",BtrxComplicationsr,1,TrHs)) begin
									OldCode = BtrxComplicationsr.Code;
									TrHs = false;
								end;
								ResetLoop(BtrxComplicationsr);
								recordnew(BtrxComplicationsr);
								if(blank(OldCode))then begin OldCode = "CMP00000"; end;
								NextCode(OldCode,newCode);
								BtrxComplicationsr.Name = tstr;
								BtrxComplicationsr.Code = newCode;
								BGCSrw.CCode = BtrxComplicationsr.Code;
								BGCSrw.CCodeName = BtrxComplicationsr.Name;
								recordinsert(BtrxComplicationsr,true);
								recordupdate(BtrxComplicationsr,BtrxComplicationsr,true);
								OldCode = "";
								vTypeNameCode[BGCSrw.CType & "_" & tstr] = BtrxComplicationsr.Code;
							end;
						end;
					case "WATCH_MECH":
						BtrxWatchMechanr.Name = tstr;
						if (ReadFirstKey("Name",BtrxWatchMechanr,1,true)) then begin
							BGCSrw.CCode = BtrxWatchMechanr.Code;
							BGCSrw.CCodeName = BtrxWatchMechanr.Name;
						end else begin
							if (nonblank(vTypeNameCode[BGCSrw.CType & "_" & tstr])) then begin
								BGCSrw.CCode = vTypeNameCode[BGCSrw.CType & "_" & tstr];
								BGCSrw.CCodeName = tstr;
							end else begin
								BtrxWatchMechanr.Code = "WTMEC9999";
								TrHs = true;
								while (LoopBackKey("Code",BtrxWatchMechanr,1,TrHs)) begin
									OldCode = BtrxWatchMechanr.Code;
									TrHs = false;
								end;
								ResetLoop(BtrxWatchMechanr);
								recordnew(BtrxWatchMechanr);
								if(blank(OldCode))then begin OldCode = "WTMEC0000"; end;
								NextCode(OldCode,BtrxWatchMechanr.Code);
								BtrxWatchMechanr.Name = tstr;
								BGCSrw.CCode = BtrxWatchMechanr.Code;
								BGCSrw.CCodeName = BtrxWatchMechanr.Name;
								recordinsert(BtrxWatchMechanr,true);
								recordupdate(BtrxWatchMechanr,BtrxWatchMechanr,true);
								OldCode = "";
								vTypeNameCode[BGCSrw.CType & "_" & tstr] = BtrxWatchMechanr.Code;
							end;
						end;
					case "WATER_RES":
						BtrxWatResr.Name = tstr;
						if (ReadFirstKey("Name",BtrxWatResr,1,true)) then begin
							BGCSrw.CCode = BtrxWatResr.Code;
							BGCSrw.CCodeName = BtrxWatResr.Name;
						end else begin
							if (nonblank(vTypeNameCode[BGCSrw.CType & "_" & tstr])) then begin
								BGCSrw.CCode = vTypeNameCode[BGCSrw.CType & "_" & tstr];
								BGCSrw.CCodeName = tstr;
							end else begin
								BtrxWatResr.Code = "WTRS9999";
								TrHs = true;
								while (LoopBackKey("Code",BtrxWatResr,1,TrHs)) begin
									OldCode = BtrxWatResr.Code;
									TrHs = false;
								end;
								ResetLoop(BtrxWatResr);
								recordnew(BtrxWatResr);
								if(blank(OldCode))then begin OldCode = "WTRS0000"; end;
								NextCode(OldCode,BtrxWatResr.Code);
								BtrxWatResr.Name = tstr;
								BGCSrw.CCode = BtrxWatResr.Code;
								BGCSrw.CCodeName = BtrxWatResr.Name;
								recordinsert(BtrxWatResr,true);
								recordupdate(BtrxWatResr,BtrxWatResr,true);
								OldCode = "";
								vTypeNameCode[BGCSrw.CType & "_" & tstr] = BtrxWatResr.Code;
							end;
						end;
					case "MATERIAL":
						BPIMaterialr.Name = tstr;
						if (ReadFirstKey("Name",BPIMaterialr,1,true)) then begin
							BGCSrw.CCode = BPIMaterialr.Code;
							BGCSrw.CCodeName = BPIMaterialr.Name;
						end else begin
							if (nonblank(vTypeNameCode[BGCSrw.CType & "_" & tstr])) then begin
								BGCSrw.CCode = vTypeNameCode[BGCSrw.CType & "_" & tstr];
								BGCSrw.CCodeName = tstr;
							end else begin
								BPIMaterialr.Code = "MATR99999";
								TrHs = true;
								while (LoopBackKey("Code",BPIMaterialr,1,TrHs)) begin
									OldCode = BPIMaterialr.Code;
									TrHs = false;
								end;
								ResetLoop(BPIMaterialr);
								recordnew(BPIMaterialr);
								if(blank(OldCode))then begin OldCode = "MATR00000"; end;
								NextCode(OldCode,BPIMaterialr.Code);
								BPIMaterialr.Name = tstr;
								BGCSrw.CCode = BPIMaterialr.Code;
								BGCSrw.CCodeName = BPIMaterialr.Name;
								recordinsert(BPIMaterialr,true);
								recordupdate(BPIMaterialr,BPIMaterialr,true);
								OldCode = "";
								vTypeNameCode[BGCSrw.CType & "_" & tstr] = BPIMaterialr.Code;
							end;
						end;
					case "BAND_MAT":
						BPIMaterialr.Name = tstr;
						if (ReadFirstKey("Name",BPIMaterialr,1,true)) then begin
							BGCSrw.CCode = BPIMaterialr.Code;
							BGCSrw.CCodeName = BPIMaterialr.Name;
						end else begin
							if (nonblank(vTypeNameCode[BGCSrw.CType & "_" & tstr])) then begin
								BGCSrw.CCode = vTypeNameCode[BGCSrw.CType & "_" & tstr];
								BGCSrw.CCodeName = tstr;
							end else begin
								BPIMaterialr.Code = "MATR99999";
								TrHs = true;
								while (LoopBackKey("Code",BPIMaterialr,1,TrHs)) begin
									OldCode = BPIMaterialr.Code;
									TrHs = false;
								end;
								ResetLoop(BPIMaterialr);
								recordnew(BPIMaterialr);
								if(blank(OldCode))then begin OldCode = "MATR00000"; end;
								NextCode(OldCode,BPIMaterialr.Code);
								BPIMaterialr.Name = tstr;
								BGCSrw.CCode = BPIMaterialr.Code;
								BGCSrw.CCodeName = BPIMaterialr.Name;
								recordinsert(BPIMaterialr,true);
								recordupdate(BPIMaterialr,BPIMaterialr,true);
								OldCode = "";
								vTypeNameCode[BGCSrw.CType & "_" & tstr] = BPIMaterialr.Code;
							end;
						end;
					case "DIAL_MAT":
						BPIMaterialr.Name = tstr;
						if (ReadFirstKey("Name",BPIMaterialr,1,true)) then begin
							BGCSrw.CCode = BPIMaterialr.Code;
							BGCSrw.CCodeName = BPIMaterialr.Name;
						end else begin
							if (nonblank(vTypeNameCode[BGCSrw.CType & "_" & tstr])) then begin
								BGCSrw.CCode = vTypeNameCode[BGCSrw.CType & "_" & tstr];
								BGCSrw.CCodeName = tstr;
							end else begin
								BPIMaterialr.Code = "MATR99999";
								TrHs = true;
								while (LoopBackKey("Code",BPIMaterialr,1,TrHs)) begin
									OldCode = BPIMaterialr.Code;
									TrHs = false;
								end;
								ResetLoop(BPIMaterialr);
								recordnew(BPIMaterialr);
								if(blank(OldCode))then begin OldCode = "MATR00000"; end;
								NextCode(OldCode,BPIMaterialr.Code);
								BPIMaterialr.Name = tstr;
								BGCSrw.CCode = BPIMaterialr.Code;
								BGCSrw.CCodeName = BPIMaterialr.Name;
								recordinsert(BPIMaterialr,true);
								recordupdate(BPIMaterialr,BPIMaterialr,true);
								OldCode = "";
								vTypeNameCode[BGCSrw.CType & "_" & tstr] = BPIMaterialr.Code;
							end;
						end;
					case "COLOR":
						BPIColorr.Name = tstr;
						if (ReadFirstKey("Name",BPIColorr,1,true)) then begin
							BGCSrw.CCode = BPIColorr.Code;
							BGCSrw.CCodeName = BPIColorr.Name;
						end else begin
							if (nonblank(vTypeNameCode[BGCSrw.CType & "_" & tstr])) then begin
								BGCSrw.CCode = vTypeNameCode[BGCSrw.CType & "_" & tstr];
								BGCSrw.CCodeName = tstr;
							end else begin
								BPIColorr.Code = "CL99999";
								TrHs = true;
								while (LoopBackKey("Code",BPIColorr,1,TrHs)) begin
									OldCode = BPIColorr.Code;
									TrHs = false;
								end;
								ResetLoop(BPIColorr);
								recordnew(BPIColorr);
								if(blank(OldCode))then begin OldCode = "CL00000"; end;
								NextCode(OldCode,BPIColorr.Code);
								BPIColorr.Name = tstr;
								BGCSrw.CCode = BPIColorr.Code;
								BGCSrw.CCodeName = BPIColorr.Name;
								recordinsert(BPIColorr,true);
								recordupdate(BPIColorr,BPIColorr,true);
								OldCode = "";
								vTypeNameCode[BGCSrw.CType & "_" & tstr] = BPIColorr.Code;
							end;
						end;
					case "BAND_COL":
						BPIColorr.Name = tstr;
						if (ReadFirstKey("Name",BPIColorr,1,true)) then begin
							BGCSrw.CCode = BPIColorr.Code;
							BGCSrw.CCodeName = BPIColorr.Name;
						end else begin
							if (nonblank(vTypeNameCode[BGCSrw.CType & "_" & tstr])) then begin
								BGCSrw.CCode = vTypeNameCode[BGCSrw.CType & "_" & tstr];
								BGCSrw.CCodeName = tstr;
							end else begin
								BPIColorr.Code = "CL99999";
								TrHs = true;
								while (LoopBackKey("Code",BPIColorr,1,TrHs)) begin
									OldCode = BPIColorr.Code;
									TrHs = false;
								end;
								ResetLoop(BPIColorr);
								recordnew(BPIColorr);
								if(blank(OldCode))then begin OldCode = "CL00000"; end;
								NextCode(OldCode,BPIColorr.Code);
								BPIColorr.Name = tstr;
								BGCSrw.CCode = BPIColorr.Code;
								BGCSrw.CCodeName = BPIColorr.Name;
								recordinsert(BPIColorr,true);
								recordupdate(BPIColorr,BPIColorr,true);
								OldCode = "";
								vTypeNameCode[BGCSrw.CType & "_" & tstr] = BPIColorr.Code;
							end;
						end;
					case "DIAL_COL":
						BPIColorr.Name = tstr;
						if (ReadFirstKey("Name",BPIColorr,1,true)) then begin
							BGCSrw.CCode = BPIColorr.Code;
							BGCSrw.CCodeName = BPIColorr.Name;
						end else begin
							if (nonblank(vTypeNameCode[BGCSrw.CType & "_" & tstr])) then begin
								BGCSrw.CCode = vTypeNameCode[BGCSrw.CType & "_" & tstr];
								BGCSrw.CCodeName = tstr;
							end else begin
								BPIColorr.Code = "CL99999";
								TrHs = true;
								while (LoopBackKey("Code",BPIColorr,1,TrHs)) begin
									OldCode = BPIColorr.Code;
									TrHs = false;
								end;
								ResetLoop(BPIColorr);
								recordnew(BPIColorr);
								if(blank(OldCode))then begin OldCode = "CL00000"; end;
								NextCode(OldCode,BPIColorr.Code);
								BPIColorr.Name = tstr;
								BGCSrw.CCode = BPIColorr.Code;
								BGCSrw.CCodeName = BPIColorr.Name;
								recordinsert(BPIColorr,true);
								recordupdate(BPIColorr,BPIColorr,true);
								OldCode = "";
								vTypeNameCode[BGCSrw.CType & "_" & tstr] = BPIColorr.Code;
							end;
						end;
					case "STRAP":
						BPIStrapr.Name = tstr;
						if (ReadFirstKey("Name",BPIStrapr,1,true)) then begin
							BGCSrw.CCode = BPIStrapr.Code;
							BGCSrw.CCodeName = BPIStrapr.Name;
						end else begin
							if (nonblank(vTypeNameCode[BGCSrw.CType & "_" & tstr])) then begin
								BGCSrw.CCode = vTypeNameCode[BGCSrw.CType & "_" & tstr];
								BGCSrw.CCodeName = tstr;
							end else begin
								BPIStrapr.Code = "STRP99999";
								TrHs = true;
								while (LoopBackKey("Code",BPIStrapr,1,TrHs)) begin
									OldCode = BPIStrapr.Code;
									TrHs = false;
								end;
								ResetLoop(BPIStrapr);
								recordnew(BPIStrapr);
								if(blank(OldCode))then begin OldCode = "STRP00000"; end;
								NextCode(OldCode,BPIStrapr.Code);
								BPIStrapr.Name = tstr;
								BGCSrw.CCode = BPIStrapr.Code;
								BGCSrw.CCodeName = BPIStrapr.Name;
								recordinsert(BPIStrapr,true);
								recordupdate(BPIStrapr,BPIStrapr,true);
								OldCode = "";
								vTypeNameCode[BGCSrw.CType & "_" & tstr] = BPIStrapr.Code;
							end;
						end;
					case "SIZE":
						BTRxSizer.Name = tstr;
						if (ReadFirstKey("Name",BTRxSizer,1,true)) then begin
							BGCSrw.CCode = BTRxSizer.Code;
							BGCSrw.CCodeName = BTRxSizer.Name;
						end else begin
							if (nonblank(vTypeNameCode[BGCSrw.CType & "_" & tstr])) then begin
								BGCSrw.CCode = vTypeNameCode[BGCSrw.CType & "_" & tstr];
								BGCSrw.CCodeName = tstr;
							end else begin
								BTRxSizer.Code = "SZ99999";
								TrHs = true;
								while (LoopBackKey("Code",BTRxSizer,1,TrHs)) begin
									OldCode = BTRxSizer.Code;
									TrHs = false;
								end;
								ResetLoop(BTRxSizer);
								recordnew(BTRxSizer);
								if(blank(OldCode))then begin OldCode = "SZ00000"; end;
								NextCode(OldCode,BTRxSizer.Code);
								BTRxSizer.Name = tstr;
								BGCSrw.CCode = BTRxSizer.Code;
								BGCSrw.CCodeName = BTRxSizer.Name;
								recordinsert(BTRxSizer,true);
								recordupdate(BTRxSizer,BTRxSizer,true);
								OldCode = "";
								vTypeNameCode[BGCSrw.CType & "_" & tstr] = BTRxSizer.Code;
							end;
						end;
					case "ODOUR":
						BPIOdourr.Name = tstr;
						if (ReadFirstKey("Name",BPIOdourr,1,true)) then begin
							BGCSrw.CCode = BPIOdourr.Code;
							BGCSrw.CCodeName = BPIOdourr.Name;
						end else begin
							if (nonblank(vTypeNameCode[BGCSrw.CType & "_" & tstr])) then begin
								BGCSrw.CCode = vTypeNameCode[BGCSrw.CType & "_" & tstr];
								BGCSrw.CCodeName = tstr;
							end else begin
								BPIOdourr.Code = "ODR99999";
								TrHs = true;
								while (LoopBackKey("Code",BPIOdourr,1,TrHs)) begin
									OldCode = BPIOdourr.Code;
									TrHs = false;
								end;
								ResetLoop(BPIOdourr);
								recordnew(BPIOdourr);
								if(blank(OldCode))then begin OldCode = "ODR00000"; end;
								NextCode(OldCode,BPIOdourr.Code);
								BPIOdourr.Name = tstr;
								BGCSrw.CCode = BPIOdourr.Code;
								BGCSrw.CCodeName = BPIOdourr.Name;
								recordinsert(BPIOdourr,true);
								recordupdate(BPIOdourr,BPIOdourr,true);
								OldCode = "";
								vTypeNameCode[BGCSrw.CType & "_" & tstr] = BPIOdourr.Code;
							end;
						end;
					case "SEX":
						BTRxSexr.Name = tstr;
						if (ReadFirstKey("Name",BTRxSexr,1,true)) then begin
							BGCSrw.CCode = BTRxSexr.Code;
							BGCSrw.CCodeName = BTRxSexr.Name;
						end else begin
							
						end;
					case "PLATING":
						BPIPlatingr.Name = tstr;
						if (ReadFirstKey("Name",BPIPlatingr,1,true)) then begin
							BGCSrw.CCode = BPIPlatingr.Code;
							BGCSrw.CCodeName = BPIPlatingr.Name;
						end else begin
							if (nonblank(vTypeNameCode[BGCSrw.CType & "_" & tstr])) then begin
								BGCSrw.CCode = vTypeNameCode[BGCSrw.CType & "_" & tstr];
								BGCSrw.CCodeName = tstr;
							end else begin
								BPIPlatingr.Code = "PLAT99999";
								TrHs = true;
								while (LoopBackKey("Code",BPIPlatingr,1,TrHs)) begin
									OldCode = BPIPlatingr.Code;
									TrHs = false;
								end;
								ResetLoop(BPIPlatingr);
								recordnew(BPIPlatingr);
								if(blank(OldCode))then begin OldCode = "PLAT00000"; end;
								NextCode(OldCode,BPIPlatingr.Code);
								BPIPlatingr.Name = tstr;
								BGCSrw.CCode = BPIPlatingr.Code;
								BGCSrw.CCodeName = BPIPlatingr.Name;
								recordinsert(BPIPlatingr,true);
								recordupdate(BPIPlatingr,BPIPlatingr,true);
								OldCode = "";
								vTypeNameCode[BGCSrw.CType & "_" & tstr] = BPIPlatingr.Code;
							end;
						end;
					case "STONE":
						BPIStoner.Name = tstr;
						if (ReadFirstKey("Name",BPIStoner,1,true)) then begin
							BGCSrw.CCode = BPIStoner.Code;
							BGCSrw.CCodeName = BPIStoner.Name;
						end else begin
							if (nonblank(vTypeNameCode[BGCSrw.CType & "_" & tstr])) then begin
								BGCSrw.CCode = vTypeNameCode[BGCSrw.CType & "_" & tstr];
								BGCSrw.CCodeName = tstr;
							end else begin
								BPIStoner.Code = "STN99999";
								TrHs = true;
								while (LoopBackKey("Code",BPIStoner,1,TrHs)) begin
									OldCode = BPIStoner.Code;
									TrHs = false;
								end;
								ResetLoop(BPIStoner);
								recordnew(BPIStoner);
								if(blank(OldCode))then begin OldCode = "STN00000"; end;
								NextCode(OldCode,BPIStoner.Code);
								BPIStoner.Name = tstr;
								BGCSrw.CCode = BPIStoner.Code;
								BGCSrw.CCodeName = BPIStoner.Name;
								recordinsert(BPIStoner,true);
								recordupdate(BPIStoner,BPIStoner,true);
								OldCode = "";
								vTypeNameCode[BGCSrw.CType & "_" & tstr] = BPIStoner.Code;
							end;
						end;
					case "POWER_RES":
						BtrxPowerReserver.Name = tstr;
						if (ReadFirstKey("Name",BtrxPowerReserver,1,true)) then begin
							BGCSrw.CCode = BtrxPowerReserver.Code;
							BGCSrw.CCodeName = BtrxPowerReserver.Name;
						end else begin
							if (nonblank(vTypeNameCode[BGCSrw.CType & "_" & tstr])) then begin
								BGCSrw.CCode = vTypeNameCode[BGCSrw.CType & "_" & tstr];
								BGCSrw.CCodeName = tstr;
							end else begin
								BtrxPowerReserver.Code = "PWRES9999";
								TrHs = true;
								while (LoopBackKey("Code",BtrxPowerReserver,1,TrHs)) begin
									OldCode = BtrxPowerReserver.Code;
									TrHs = false;
								end;
								ResetLoop(BtrxPowerReserver);
								recordnew(BtrxPowerReserver);
								if(blank(OldCode))then begin OldCode = "PWRES0000"; end;
								NextCode(OldCode,BtrxPowerReserver.Code);
								BtrxPowerReserver.Name = tstr;
								BGCSrw.CCode = BtrxPowerReserver.Code;
								BGCSrw.CCodeName = BtrxPowerReserver.Name;
								recordinsert(BtrxPowerReserver,true);
								recordupdate(BtrxPowerReserver,BtrxPowerReserver,true);
								OldCode = "";
								vTypeNameCode[BGCSrw.CType & "_" & tstr] = BtrxPowerReserver.Code;
							end;
						end;
					case "MICRW_SAFE":
						BtrxMicrowaveProtectr.Name = tstr;
						if (ReadFirstKey("Name",BtrxMicrowaveProtectr,1,true)) then begin
							BGCSrw.CCode = BtrxMicrowaveProtectr.Code;
							BGCSrw.CCodeName = BtrxMicrowaveProtectr.Name;
						end else begin
							if (nonblank(vTypeNameCode[BGCSrw.CType & "_" & tstr])) then begin
								BGCSrw.CCode = vTypeNameCode[BGCSrw.CType & "_" & tstr];
								BGCSrw.CCodeName = tstr;
							end else begin
								BtrxMicrowaveProtectr.Code = "MPR99999";
								TrHs = true;
								while (LoopBackKey("Code",BtrxMicrowaveProtectr,1,TrHs)) begin
									OldCode = BtrxMicrowaveProtectr.Code;
									TrHs = false;
								end;
								ResetLoop(BtrxMicrowaveProtectr);
								recordnew(BtrxMicrowaveProtectr);
								if(blank(OldCode))then begin OldCode = "MPR00000"; end;
								NextCode(OldCode,BtrxMicrowaveProtectr.Code);
								BtrxMicrowaveProtectr.Name = tstr;
								BGCSrw.CCode = BtrxMicrowaveProtectr.Code;
								BGCSrw.CCodeName = BtrxMicrowaveProtectr.Name;
								recordinsert(BtrxMicrowaveProtectr,true);
								recordupdate(BtrxMicrowaveProtectr,BtrxMicrowaveProtectr,true);
								OldCode = "";
								vTypeNameCode[BGCSrw.CType & "_" & tstr] = BtrxMicrowaveProtectr.Code;
							end;
						end;
					case "MATCH_STOV":
						BtrxStoveCompatr.Name = tstr;
						if (ReadFirstKey("Name",BtrxStoveCompatr,1,true)) then begin
							BGCSrw.CCode = BtrxStoveCompatr.Code;
							BGCSrw.CCodeName = BtrxStoveCompatr.Name;
						end else begin
							if (nonblank(vTypeNameCode[BGCSrw.CType & "_" & tstr])) then begin
								BGCSrw.CCode = vTypeNameCode[BGCSrw.CType & "_" & tstr];
								BGCSrw.CCodeName = tstr;
							end else begin
								BtrxStoveCompatr.Code = "STC99999";
								TrHs = true;
								while (LoopBackKey("Code",BtrxStoveCompatr,1,TrHs)) begin
									OldCode = BtrxStoveCompatr.Code;
									TrHs = false;
								end;
								ResetLoop(BtrxStoveCompatr);
								recordnew(BtrxStoveCompatr);
								if(blank(OldCode))then begin OldCode = "STC00000"; end;
								NextCode(OldCode,BtrxStoveCompatr.Code);
								BtrxStoveCompatr.Name = tstr;
								BGCSrw.CCode = BtrxStoveCompatr.Code;
								BGCSrw.CCodeName = BtrxStoveCompatr.Name;
								recordinsert(BtrxStoveCompatr,true);
								recordupdate(BtrxStoveCompatr,BtrxStoveCompatr,true);
								OldCode = "";
								vTypeNameCode[BGCSrw.CType & "_" & tstr] = BtrxStoveCompatr.Code;
							end;
						end;
					case "FILLING":
						BTRxFillingr.Name = tstr;
						if (ReadFirstKey("Name",BTRxFillingr,1,true)) then begin
							BGCSrw.CCode = BTRxFillingr.Code;
							BGCSrw.CCodeName = BTRxFillingr.Name;
						end else begin
							if (nonblank(vTypeNameCode[BGCSrw.CType & "_" & tstr])) then begin
								BGCSrw.CCode = vTypeNameCode[BGCSrw.CType & "_" & tstr];
								BGCSrw.CCodeName = tstr;
							end else begin
								BTRxFillingr.Code = "FILLN9999";
								TrHs = true;
								while (LoopBackKey("Code",BTRxFillingr,1,TrHs)) begin
									OldCode = BTRxFillingr.Code;
									TrHs = false;
								end;
								ResetLoop(BTRxFillingr);
								recordnew(BTRxFillingr);
								if(blank(OldCode))then begin OldCode = "FILLN0000"; end;
								NextCode(OldCode,BTRxFillingr.Code);
								BTRxFillingr.Name = tstr;
								BGCSrw.CCode = BTRxFillingr.Code;
								BGCSrw.CCodeName = BTRxFillingr.Name;
								recordinsert(BTRxFillingr,true);
								recordupdate(BTRxFillingr,BtrxFillingr,true);
								OldCode = "";
								vTypeNameCode[BGCSrw.CType & "_" & tstr] = BTRxFillingr.Code;
							end;
						end;
					case "ADD_PR_DES":
						BGCSrw.CCode = "-";
						BGCSrw.CCodeName = tstr;
					case "IT_SIZE":
						BGCSrw.CCode = "-";
						BGCSrw.CCodeName = tstr;
					case "UN_OF_MEAS":
						BGCSrw.CCode = "-";
						BGCSrw.CCodeName = tstr;
					case "C_IN_SET":
						BGCSrw.CCode = "-";
						BGCSrw.CCodeName = tstr;
					case "CARAT":
						BGCSrw.CCode = "-";
						BGCSrw.CCodeName = tstr;
				end;
				Matrowput(BGCSr,matrowcnt(BGCSr),BGCSrw);
				RecordStore (BGCSr,true);
			end;
		end;
		if (NextImportLine(true)) then begin end;
	end;
	lImportBTrxClassifSettings:;
	return;
end;

















 // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 13:11 20.08.2019
 
 
 
 
 
global updating procedure ImportNewItemWAllClassIn(record RcVc RepSpec)
begin
record INVc INr,oldINr,ConsINr,OldConsINr;
integer i,curcomp,cnt,j,k,CompQty,ErrCnt1,ErrCnt2,mtrw,INComp,StatAllRows,StatOkRows,StatFailItemRows,StatFailClassRows,ErrClasscnt,ErrCnt3,HeadrCnt;
record GlobalItemVc GIr;
string 100 artcode,EANCode,VECode,brand,newBrand,code,glCode,tstr,cntstr,origartcode,OldCode;
record BPIBrandVc BPIBrandr;
record BPIBrandVc BPIBrand1r;
area ErrAr1, ErrAr2, reply;
array string 255 abrand,anewbrand,ErrArr,ErrAr3;
array string 100 headers,params;
record CompaniesBlock Compb;
row CompaniesBlock Comprw;
vector boolean Errf, Classf;
array string 255 Class;
boolean INrf, TrHs, TrHs2;
record ConsItemVc CIr, OldCIr;
		
	BlockLoad(Compb);
	
	logtext(0,"ImportNewItemWAllClassIn start");
	CompQty = matrowcnt(Compb);
	curcomp = currentcompany;	
	SetCompany(1,false);
	tstr = importfield;
	tstr = right(tstr,(len(tstr)-1));
	// logtext(0,USetStr(36229));
	if(tstr!=USetStr(36229))then begin
		logtext(0,"ImportAddClassIn codepage error");
		while (TestEOF()==false) begin
			if (NextImportLine(true)) then begin end;
		end;
		goto lImportNewItemWAllClass;
	end;
	if (NextImportLine(true)) then begin end;
	tstr = importfield;
	tstr = importfield;
	tstr = importfield;
	tstr = importfield;
	HeadrCnt = 0;
	while(nonblank(tstr))begin
		tstr = importfield;
		if(nonblank(tstr))then begin
			StripEndingSpaces(tstr);
			headers[headers.length] = tstr;
		end else begin
			headers[headers.length] = "HField";
			tstr = "HField";
		end;
	end;
	if (NextImportLine(true)) then begin end;
	if (NextImportLine(true)) then begin end;
	while (TestEOF()==false) begin
		SetCompany(18,false);
		artcode = importfield;
		VECode = importfield;
		EANCode = importfield;
		brand = importfield;
		for(i=0;i<headers.length;i=i+1)begin
			params[i] = "";
		end;
		for(i=0;i<headers.length;i=i+1)begin
			tstr = importfield;
			params[i] = tstr;
		end;
		CIr.LocCode = artcode;
		CIr.BrandCode = brand;
		if(!ReadFirstKey("LocCodeBrand",CIr,2,true))then begin
			recordNew(ConsINr);
			OldConsINr.Code = "IN_9999999";
			TrHs2 = true;
			while (LoopBackKey("Code",OldConsINr,1,TrHs2)) begin
				OldCode = OldConsINr.Code;
				TrHs2 = false;
			end;
			ResetLoop(OldConsINr);
			if(blank(OldCode)) then begin oldCode = "IN_0000000"; end;
			NextM4SerialNumber(OldCode,ConsINr.Code);
			ConsINr.BPIBrand = brand;
			if(RecordStore(ConsINr,true))then begin
				recordNew(CIr);
				CIr.Code = ConsINr.Code;
				CIr.LocCode = artcode;
				CIr.BrandCode = brand;
				if(RecordStore(CIr,true)) then begin
					// CheckClassifGLImport(headers,params,ConsINr);
				end;
			end;
		end;
		if (NextImportLine(true)) then begin end;
	end;
	
	
	lImportNewItemWAllClass:;
return;
end;
 
 
 
 
 
 
 // _-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_- Anton Preisinger 13:11 20.08.2019











global function boolean IDOkedSHs(longint ORSer,integer rownr)
begin
record ORVc ORr;
row ORVc ORrw;
Integer wn,i,rwcnt;
val pt;
Boolean deliveredf, TrHs, testf;
record SHVc SHr;
row SHVc SHrw;
record RetVc Retr;
row RetVc Retrw;
integer shwty;

	SHr.OrderNr = ORSer;
	TrHs = true;
	testf = true;
	while (loopkey("OrderKey",SHr,1,TrHs)) begin
		if(SHr.OrderNr!=ORSer) then begin TrHs = false; end;
		if(TrHs and SHr.OKFlag==1)then begin 
			rwcnt = matrowcnt(SHr);
			for(i=0;i<rwcnt;i=i+1)begin
				matrowget(SHr,i,SHrw);
				if(SHrw.OrdRow==rownr)then begin
					shwty = shwty + SHrw.Ship;
				end;
			end;
		end;
	end;
	
	
	Retr.OrdNr = ORSer;
	TrHs = true;
	testf = true;
	while (loopkey("OrdNr",Retr,1,TrHs)) begin
		if(Retr.OrdNr!=ORSer) then begin TrHs = false; end;
		if(TrHs and Retr.OKFlag==1)then begin 
			rwcnt = matrowcnt(Retr);
			for(i=0;i<rwcnt;i=i+1)begin
				matrowget(Retr,i,Retrw);
				if(Retrw.OrdRow==rownr)then begin
					shwty = shwty - Retrw.Quant;
				end;
			end;
		end;
	end;
	
	if(shwty>0)then begin
		testf = false; 
	end;
	
IDOkedSHs = testf;
RETURN;
end;




global updating procedure ReturnOldNamesINIn(record RcVc RepSpec)
begin
record INVc INr,oldINr;
integer i,curcomp,cnt,j,k,CompQty;
record GlobalItemVc GIr;
string 100 artcode,brand,newBrand,code,glCode,tstr;
record BPIBrandVc BPIBrandr;
record BPIBrandVc BPIBrand1r;
array string 100 abrand,anewbrand;
array string 100 headers,params;
record CompaniesBlock Compb;
row CompaniesBlock Comprw;
boolean TrHs1, TrHs, TrHs2;
record RHistVc RHistr;
string 200 rstr;
		
	BlockLoad(Compb);

	while (TestEOF()==false) begin
		artcode = importfield;
		StripEndingSpaces(artcode);
		brand = importfield;
		StripEndingSpaces(brand);
		BPIBrandr.Name = brand;
		TrHs2 = true;
		if(readfirstkey("Name",BPIBrandr,1,true))then begin
			INr.Code = artcode;
			while(LoopMain(INr,1,TrHs2))begin
				if(INr.BPIBrand==BPIBrandr.Code)then begin
					TrHs2 = false;
					resetloop(RHistr);
					TrHs1 = true;
					rstr = BuildRecordIdStr(INr,currentcompany);
	  			RHistr.RecidStr = rstr;
					while(loopbackkey("RecidStr",RHistr,1,TrHs1)) begin		
						if(TrHs1)then begin
							ReadOriginalRecord(RHistr,oldINr);
							if(oldINr.Code!=INr.Code)then begin TrHs1 = false; end;
							if(nonblank(oldINr.Name) and RHistr.TransDate<AddMonth(CurrentDate,-1) and TrHs1)then begin
								INr.Name = oldINr.Name;
								recordstore(INr,true);
								TrHs1 = false;
							end;
						end;
					end;
					ResetLoop(RHistr);
				end else begin
					TrHs2 = false;
				end;
			end;
			ResetLoop(INr);
		end;
		if (NextImportLine(true)) then begin end;
	end;
	
	lImportAddClassIn:;
logtext(0,"ImportNewItemWAllClassIn end");
return;
end;


global updating procedure ImportFixToCoin()
begin
	record INVc INr;
	string 100 code;
	
	while (TestEOF()==false) begin
	code = importfield;
	
	//EditField(h,v+=vs,80,"?????????",Normal,SN,false,0);
	//EditField(h+180,v,80,"????.????.",Normal,MainDisp,false,0); 
	//EditField(h+360,v,80,"??????",Normal,SNOne,false,0); 
	//EditField(h,v+=vs, 140,"?????????",Normal,Reference,false,0); 

	INr.Code = code;
	if(readfirstmain(INr,1,true))then begin
		if(nonblank(INr.MainDisp))then begin
			INr.Reference = INr.MainDisp;
		end;
		if(nonblank(INr.SNOne))then begin
			INr.MainDisp = INr.SNOne;
			INr.MainDisp = StrReplace(INr.MainDisp,"_"," ");
			INr.SNOne = "";
		end;
		recordstore(INr,true);
	end;
	
	if (NextImportLine(true)) then begin end;
	end;
return;
end;



global updating procedure ImportFixGlobalItems3level()
begin
	record GlobalItemVc GIr,LogGIr;
	string 100 code,param;
	vector string 255 gift;
	
	while (TestEOF()==false) begin
		code = importfield;
		param = importfield;
		if(nonblank(param) and nonblank(code))then begin
			if(blank(gift[code]))then begin
				gift[code] = param;
			end else begin
				gift[code] = gift[code] & "," & param;
			end;
		end;
		if (NextImportLine(true)) then begin end;
	end;
	
	
	while(loopmain(GIr,1,true))begin
		if(nonblank(gift[GIr.Code]))then begin
			if(gift[GIr.Code]!=GIr.BTRxThirdLevCat)then begin
				// logtext(0,GIr.Code & "|" & GIr.BTRxThirdLevCat & " -> " & gift[GIr.Code]);
				recordcopy(LogGIr,GIr);
				GIr.BTRxThirdLevCat = gift[GIr.Code];
				GIWasUpdated(GIr,LogGIr," GIWasUpdatedlog 125");
				recordstore(GIr,true);
			end;
		end;
	end;
	
return;
end;

global updating procedure FixCRMSum()
begin
	record GlobalItemVc GIr;
	string 100 code,param;
	vector string 255 gift;
	record IVVc IVr;
	area output;
	
	while (TestEOF()==false) begin
		code = importfield;
		param = importfield;
		
		if(setcompany(stringtoint(code),false))then begin
			IVr.SerNr = stringtolongint(param);
			if(readfirstmain(IVr,1,true))then begin
				if(nonblank(IVr.CRMid))then begin
					addtexttoarea(IVr.CRMid,output);
					addtexttoarea(chr(9),output);
					addtexttoarea(valtostring(IVr.Sum4,M45Val,"",".",0),output);
					addtexttoarea(chr(13) & chr(10),output);
				end else begin
					logtext(0,currentcompany & " " & IVr.SerNr & " " & "NoCRMId");
				end;
			end else begin
				logtext(0,currentcompany & " " & IVr.SerNr & " " & "NoRecord");
			end;
		end;
		
		if (NextImportLine(true)) then begin end;		
	end;
	writeareatofile(output,"WrongSum.txt",1);
	
return;
end;


global updating procedure ClearFIOCUVcIn(record RcVc RepSpec)
begin
record CUVc CUr;
string 20 tstr;
	
	logtext(0,"ClearFIOCUVcIn start");

	while (TestEOF()==false) begin	
	
		tstr = importfield;
		if(nonblank(tstr))then begin
			CUr.Code = tstr;
			logtext(0,"ClearFIOCUVcIn " & CUr.Code);
			if(readfirstmain(CUr,1,true))then begin
				CUr.CRMLName = "";
				CUr.CRMName = "";
				CUr.CRMPatr = "";
				recordstore(CUr,true);
			end;
		end;
	
		if (NextImportLine(true)) then begin end;
	end;

logtext(0,"ClearFIOCUVcIn end");
return;
end;

global updating procedure CRMUpdateFIOCUVcIn(record RcVc RepSpec)
begin
record CUVc CUr;
string 20 tstr;
array string 20 acucodes;
integer i;
	
	logtext(0,"CRMUpdateFIOCUVcIn start");

	while (TestEOF()==false) begin	
	
		tstr = importfield;
		acucodes[acucodes.length] = tstr;
		
	
		if (NextImportLine(true)) then begin end;
	end;
	
	for(i=0;i<acucodes.length;i=i+1)begin
		if(nonblank(acucodes[i]))then begin
			CUr.Code = acucodes[i];
			if(readfirstmain(CUr,1,true))then begin
				logtext(0,"CRMUpdateFIOCUVcIn " & CUr.Code);
				SendAsyncUpdateContactToCRM(CUr);
				millisleep(500);
			end;
		end;
	
	end;
	

logtext(0,"CRMUpdateFIOCUVcIn end");
return;
end;


global webpublic updating procedure WebCRMUpdateFIOCUVcIn()
begin
record CUVc CUr;
string 20 tstr;
array string 20 acucodes;
string 100 filename;
integer i;
	
	logtext(0,"WebCRMUpdateFIOCUVcIn start");
	
	filename = webgetarg("FileName");
	if(nonblank(filename))then begin
		if(fileexists("CRMUpdateContacts/" & filename))then begin
			openfile("CRMUpdateContacts/" & filename);
			while (TestEOF()==false) begin	
	
				tstr = importfield;
				acucodes[acucodes.length] = tstr;
	
				if (NextImportLine(true)) then begin end;
			end;
			CloseFile;
			for(i=0;i<acucodes.length;i=i+1)begin
				if(nonblank(acucodes[i]))then begin
					CUr.Code = acucodes[i];
					if(readfirstmain(CUr,1,true) and blank(CUr.CreateLocation))then begin
						if(blank(CUr.CreateLocation))then begin
							CUr.CreateLocation = "SW1";
							recordstore(CUr,true);
						end;
						logtext(0,"CRMUpdateFIOCUVcIn " & CUr.Code);
						SendAsyncUpdateContactToCRM(CUr);
						millisleep(500);
					end;
				end;
	
			end;
		end;
	end;
	

logtext(0,"WebCRMUpdateFIOCUVcIn end");
return;
end;


global webpublic updating procedure WebCRMCloseCUVcIn()
begin
record CUVc CUr;
string 20 tstr;
array string 20 acucodes;
string 100 filename;
integer i;
boolean testf;
	
	logtext(0,"WebCRMCloseCUVcIn start");
	
	filename = webgetarg("FileName");
	if(nonblank(filename))then begin
		if(fileexists("CRMUpdateContacts/" & filename))then begin
			openfile("CRMUpdateContacts/" & filename);
			while (TestEOF()==false) begin	
	
				tstr = importfield;
				acucodes[acucodes.length] = tstr;
	
				if (NextImportLine(true)) then begin end;
			end;
			CloseFile;
			for(i=0;i<acucodes.length;i=i+1)begin
				if(nonblank(acucodes[i]))then begin
					CUr.Code = acucodes[i];
					if(readfirstmain(CUr,1,true))then begin
						testf = true;
						if(CUr.VEType==1)then begin testf = false; end;
							
						if(testf)then begin
							CUr.blockedFlag = 1;
							if(blank(CUr.CreateLocation))then begin
								CUr.CreateLocation = "SW1";
								recordstore(CUr,true);
							end;
							recordstore(CUr,true);
							logtext(0,"CRMUpdateFIOCUVcIn " & CUr.Code);
							SendAsyncUpdateContactToCRM(CUr);
							millisleep(500);
						end;
					end;
				end;
	
			end;
		end;
	end;
	

logtext(0,"WebCRMCloseCUVcIn end");
return;
end;


updating procedure updateINPP(var record INVc INr, string ppcode)
begin
	record INVc oldINr;
	
	if(blank(ppcode) and nonblank(INr.CPSCode) and stringtoint(INr.CPSCode)>0)then begin
		recordcopy(oldINr,INr);
		INr.CPSCode = "";
		recordupdate(oldINr,INr,true);
	end else begin
		if(INr.CPSCode!=ppcode and stringtoint(ppcode)>0)then begin
			recordcopy(oldINr,INr);
				INr.CPSCode = ppcode;
			recordupdate(oldINr,INr,true);
		end;
	end;

return;
end;

Global updating procedure ImportPPListIn()
begin
	record PLVc PLr;
	Integer i;
	array string 255 sfield;
	string 5 flag,itemcode,ppcode;
	record INVc INr,oldINr;
	record PLDefVc PLDr;
	val price, calcprice, calcrebate;		
	record CurncyCodeVc Curncyr;
	string 50 tstr;
		
		while (TestEOF()==false) begin
			itemcode = ImportField;
			ppcode = ImportField;
      INr.Code = itemcode;
      if(readfirstmain(INr,1,true))then begin
        updateINPP(INr,ppcode);
      end else begin
      	INr.AlternativeCode = itemcode;
      	if(readfirstKey("AlternativeCode",INr,1,true))then begin
					updateINPP(INr,ppcode);
				end else begin
					INr.BarCode = itemcode;
					if(readfirstKey("BarCode",INr,1,true))then begin
						updateINPP(INr,ppcode);
					end;
				end;
      end;
      NextImportLine(true);
		end;

 return;
end;




global updating procedure ImportCLOutAFFObjIn()
begin
	record CLOutVc CLr;
	string 255 CLSerNr, Obj;
		setcompany(18,false);
		while (TestEOF()==false) begin
			CLSerNr = ImportField;
			Obj = ImportField;
      CLr.SerNr = StringToLongInt(CLSerNr);
			if (ReadFirstMain(CLr,1,true)) then begin
				CLr.Addr4 = Obj;
				RecordStore(CLr,true);
			end;
      NextImportLine(true);
		end;

 return;
end;




global updating procedure ImportCLOutAFFObjIn()
begin
	record CLOutVc CLr;
	string 255 CLSerNr, Obj;
		setcompany(18,false);
		while (TestEOF()==false) begin
			CLSerNr = ImportField;
			Obj = ImportField;
      CLr.SerNr = StringToLongInt(CLSerNr);
			if (ReadFirstMain(CLr,1,true)) then begin
				CLr.Addr4 = Obj;
				RecordStore(CLr,true);
			end;
      NextImportLine(true);
		end;

 return;
end;








global updating procedure ImportVIAFFObjIn()
begin
	record VIVc VIr;
	string 255 CLSerNr, Obj;
		setcompany(18,false);
		while (TestEOF()==false) begin
			CLSerNr = ImportField;
			Obj = ImportField;
      VIr.SerNr = StringToLongInt(CLSerNr);
			if (ReadFirstMain(VIr,1,true)) then begin
				if (blank(VIr.VATNr)) then begin
					VIr.VATNr = Obj;
					RecordStore(VIr,true);
				end;
			end;
      NextImportLine(true);
		end;

 return;
end;




//server-onlyexternal procedure HTNr(Integer,Integer,LongInt,LongInt,var string);external procedure ExtractObj(string,var Integer,var string);external procedure LogProcTime(string,longint);procedure PopulateItems(var record IntORVc IntOR2r,string item,string brand,integer qty,integer doc)begin  Integer i,rwcnt,pos;  row IntORVc IntOR2rw;  Boolean foundf;    if (Blank(brand)) then begin    goto LPopulateItems;  end;    foundf = false;  rwcnt = MatRowCnt(IntOR2r);  for (i=0;i<rwcnt;i=i+1) begin  	MatRowGet(IntOR2r,i,IntOR2rw);    if (item==IntOR2rw.ArtCode and brand==IntOR2rw.Spec) then begin      pos = i;      foundf = true;      i = rwcnt;    end;  end;  if (foundf==false) then begin    pos = rwcnt;    IntOR2rw.ArtCode = item;    IntOR2rw.Spec = brand;    IntOR2rw.Quant = 0;    IntOR2rw.Price = 0;  end;  switch (doc) begin    case 0: IntOR2rw.Quant = IntOR2rw.Quant + qty;    case 1: IntOR2rw.Price = IntOR2rw.Price + qty;  end;    MatRowPut(IntOR2r,pos,IntOR2rw);  LPopulateItems:;    return;end;globalprocedure ComparePOwithIntORRn(record RcVc RepSpec)begin  record IntORVc IntORr,IntOR2r;  row IntORVc IntORrw;  record POVc POr;  row POVc POrw;  record DIVc DIr;  record INVc INr;  Boolean TrHs;  val iv;  val TotSum;  Boolean testf;  LongInt afr,ato;  string 255 tstr;  Integer rw;  array val av1;  array val av2;  array val av3;  array string 20 acur;  Integer curcnt,pos,i,rwcnt;  string 30 brandfound,brand;	longint curtick;		curtick = getcurtick();   rw = 1;  //afr = FirstInRange(RepSpec.f1,30);  //ato = LastInRange(RepSpec.f1,30);  TotSum = 0;  StartReportJob(USetStr(31181));    Header(rw,USetStr(13835) & RepSpec.sStartDate & ":" & RepSpec.sEndDate,1);  rw = rw + 1;  /*HTNr(14552,14551,afr,ato,tstr);  if nonblank(tstr) then begin    Header(rw,tstr,1);    rw = rw + 1;  end;    HTDetailLevel(RepSpec.ArtMode,tstr);  Header(rw,tstr,0);  HTEmployees(RepSpec.f2,RepSpec.f2,tstr);  if nonblank(tstr) then begin    Header(rw,tstr,1);    rw = rw + 1;  end;  HTDepartment(RepSpec.f4,tstr);  if (nonblank(tstr)) then begin    Header(rw,tstr,1);    rw = rw + 1;  end;  HTLocations(RepSpec.f3,RepSpec.f3,tstr);  if (nonblank(tstr)) then begin    Header(rw,tstr,1);    rw = rw + 1;  end;*/    EndHeader;    StartFormat(15);    pos = 0;    OutString(pos,0,USetStr(31203),false);    OutString(pos+=80,0,USetStr(31205),false);    OutString(pos+=80,0,USetStr(22414) & " (" & USetStr(10522) & ")",false);    OutString(pos+=100,0,USetStr(8298) & " (" & USetStr(10522) & ")",false);  EndFormat;  Gray_Divider(0,1);    RECORDNEW(IntOR2r);  IntORr.TransDate = RepSpec.sStartDate;  TrHs = true;  while LoopKey("TransDate",IntORr,1,TrHs) begin    testf = true;    if (DateInRange(IntORr.TransDate,RepSpec.sStartDate,RepSpec.sEndDate)==false) then begin testf = false; end;    if (IntORr.TransDate>RepSpec.sEndDate) then begin TrHs = false; testf = false; end;    if (testf) then begin      rwcnt = MatRowCnt(IntORr);      for (i=0;i<rwcnt;i=i+1) begin        MatRowGet(IntORr,i,IntORrw);        INr.Code = IntORrw.ArtCode;        if (NonBlank(IntORrw.ArtCode) and ReadFirstMain(INr,1,true)) then begin          pos = 0;          brand = "";    			ExtractObj(INr.DispGroups,pos,brandfound);    			while(nonblank(brandfound)) begin    				DIr.Code = brandfound;    				ReadFirstMain(DIr,1,true);    				if(DIr.CType=="BRAND")then begin    					brand = DIr.Name;    					pos = 255;    				end;    				ExtractObj(INr.DispGroups,pos,brandfound);    			end;    			PopulateItems(IntOR2r,INr.Code,brand,IntORrw.Quant,0);        end;      end;    end;  end;    POr.TransDate = RepSpec.sStartDate;  TrHs = true;  while LoopKey("TransDate",POr,1,TrHs) begin    testf = true;    if (DateInRange(POr.TransDate,RepSpec.sStartDate,RepSpec.sEndDate)==false) then begin testf = false; end;    if (POr.TransDate>RepSpec.sEndDate) then begin TrHs = false; testf = false; end;    if (testf) then begin      rwcnt = MatRowCnt(POr);      for (i=0;i<rwcnt;i=i+1) begin        MatRowGet(POr,i,POrw);        INr.Code = POrw.ArtCode;        if (NonBlank(POrw.ArtCode) and ReadFirstMain(INr,1,true)) then begin          pos = 0;          brand = "";    			ExtractObj(INr.DispGroups,pos,brandfound);    			while(nonblank(brandfound)) begin    				DIr.Code = brandfound;    				ReadFirstMain(DIr,1,true);    				if(DIr.CType=="BRAND")then begin    					brand = DIr.Name;    					pos = 255;    				end;    				ExtractObj(INr.DispGroups,pos,brandfound);    			end;    			PopulateItems(IntOR2r,INr.Code,brand,POrw.Quant,1);        end;      end;    end;  end;    rwcnt = MatRowCnt(IntOR2r);  if (rwcnt>0) then begin    for (i=0;i<rwcnt;i=i+1) begin      MatRowGet(IntOR2r,i,IntORrw);      StartFormat(15);        pos = 0;        OutString(pos,0,IntORrw.ArtCode,false);        OutString(pos+=80,0,IntORrw.Spec,false);        OutString(pos+=80,0,IntORrw.Quant,false);        OutString(pos+=100,0,IntORrw.Price,false);      EndFormat;    end;  end;	LogProcTime("ComparePOwithIntORRn",getcurtick() - curtick);  EndJob;  return;end;
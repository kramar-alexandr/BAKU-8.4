remote procedure GetFullCurncyRate (var string,Date,var val,var val,var val,var val,var val);
remote procedure CntPOSCurrencies(var Array string,var Array Boolean,var Integer);
remote procedure GetBaseCurncy(Integer,var string);
external procedure ExtractObj(string,var Integer,var string);
external function longint DateDiff(date,date);
remote procedure ItemStockStatExtWebRn(record RcVc,var area,string);
remote procedure ItemStockStatExtWebNewRn(record RcVc,var area,string);
remote procedure SalesReportExtPictRn(record RcVc,var area,string);
external procedure GetUserName(string,var string);
//Edit---------------Vitalii 16:23 21.05.2015
external procedure FindNLAccBal(string,string,string,Integer,Date,Date,Integer,Integer,Boolean,string,Integer,string,string,var val);
external procedure YcToStr(Integer,var string);
external function Boolean CorspTRTest(record TRVc,record AccVc,Integer,var val,var val);
external procedure GetObjs(string,string,var string);
external function boolean CompanyIsJWLikeCompany(Integer);
external procedure SendUpdateLoyaltyCardToCRM(var record LoyaltyCardVc);
external  function string 100 BPICodeToName(string);
remote function string 255 GetCompanyShortCode(string);
external procedure ExtractObjWithSeparator(string,string,Boolean,var Integer,var string);
external procedure CollectNameByCode(var vector string);
remote inner procedure LogProcTime(string,longint);
SetLangMode(LangRussian,"RUS",0); //Edit***************************Sasha2,17:21 11.12.2014

global procedure MiddleInvoiceOrderRn(record RcVc RepSpec)
begin
  record IVVc IVr;
  row IVVc IVrw;
  record ORVc ORr;
  row ORVc ORrw;
  integer i,mtrw;
  boolean TrHs,testf,first;
  string 50 key;
  integer fl;
  record CYBlock CYb;
  val day,total,dayqty,totalqty;
  integer invday,invtotal;
  date curdat;
  val fr,to1,to2,br1,br2,ivfr,ivto;
  string 20 curncy;
  Array string 50 acrncy;// Edit ************************** Tuesday, 19 March 2013 15:48:06
  Array Boolean achangecrncyf;// Edit ************************** Tuesday, 19 March 2013 15:48:52
  Integer acrncnt;// Edit ************************** Tuesday, 19 March 2013 15:48:51
	longint curtick;
	
	curtick = getcurtick();
	CntPOSCurrencies(acrncy,achangecrncyf,acrncnt);// Edit ************************** Wednesday, 19 June 2013 13:59:15
	curncy = acrncy[0];// Edit ************************** Wednesday, 19 June 2013 13:59:14


	blockload(CYb);

	startreportnoheaderjob(USetStr(31167));

	startformat(15);
		outstring(0,0,"",false);
		outstring(100,0,USetStr(31102),false);
		outstring(150,0,RepSpec.sStartDate & ":" & RepSpec.sEndDate,false);
	endformat;
	startformat(15);
	endformat;
	startformat(15);
		outstring(0,0,getyear(RepSpec.sStartDate),false);
		outstring(50,0,"",false);
		outstring(100,0,CYb.BusinessName,false);
		outstring(150,0,RepSpec.f1,false);
		outstring(190,0,USetStr(31218),false);
		if(nonblank(RepSpec.f2))then begin
			outstring(240,0,RepSpec.f2,false);
			outstring(300,0,USetStr(31219),false);
		end;
	endformat;
	black_divider(0,1);
	startformat(15);
	endformat;
	startformat(15);
		outstring(0,0,USetStr(31220),false);
		outstring(50,0,USetStr(31221),false);
		outstring(120,0,USetStr(31222),false);
		outstring(170,0,USetStr(31223),false);
		outstring(240,0,USetStr(31224),false);
	endformat;
	startformat(15);
	endformat;

	key = "OrdDate";
	fl = 1;
	/*
	if(nonblank(RepSpec.f1))then begin
		key = "MachineName";
		IVr.MachineName = RepSpec.f1;
		fl = 2;
	end;
	*/


	ORr.OrdDate = RepSpec.sStartDate;
	TrHs = true;
	curdat = stringtodate("1/1/2000");
	day = 0;
	dayqty = 0;
	total = 0;
	totalqty = 0;
	invday = 0;
	invtotal = 0;
	first = true;
	while(loopkey(key,ORr,fl,TrHs))begin
		if(first)then begin
			curdat = ORr.OrdDate;
			first = false;
		end;
		if(curdat!=ORr.OrdDate and invday>0)then begin
			startformat(15);
				outstring(0,0,curdat,false);
				outstring(50,0,invday,false);
				outstring(120,0,day,false);
				outstring(170,0,day/invday,false);
				outstring(240,0,dayqty,false);
			endformat;
			invday = 0;
			day = 0;
			dayqty = 0;
			curdat = ORr.OrdDate;
		end;
		testf = true;
		if(ORr.OrdDate<RepSpec.sStartDate or ORr.OrdDate>RepSpec.sEndDate)then begin TrHs = false; testf = false; end;
		if(nonblank(RepSpec.f1) and ORr.LocalMachineCode!=RepSpec.f1)then begin testf = false; end;
		if(nonblank(RepSpec.f3) and ORr.Location!=RepSpec.f3)then begin testf = false; end;
		if(nonblank(RepSpec.f2) and RepSpec.f2!=ORr.SalesMan)then begin testf = false; end;
		if(ORr.OKFlag==0)then begin testf = false; end;

		if(testf)then begin
			ivfr = 1; ivto = 1;
			fr = 1; to1 = 1;
			if(ORr.CurncyCode!=curncy)then begin
				ivfr = ORr.FrRate;
				ivto = ORr.ToRateB1;
				if(ivfr==0 or ivto==0)then begin
					ivfr = 1;	ivto = 1;
				end;
				GetFullCurncyRate(curncy,ORr.OrdDate,fr,to1,to2,br1,br2);
				if(fr==0 or to1==0)then begin
					fr = 1;	to1 = 1;
				end;
			end;
			invday = invday + 1;
			invtotal = invtotal + 1;
			day = day + ORr.Sum4/ivfr*ivto*fr/to1;

			mtrw = matrowcnt(ORr);
			For(i=0;i<mtrw;i=i+1) begin
	  		matrowget(ORr,i,ORrw);
	  		//if(IVrw.stp==kInvoiceRowTypeNormal and IVrw.Quant!=0)then begin
	  		if(nonblank(ORrw.ArtCode) and ORrw.Quant!=0 /*and ORrw.Sum!=0*/)then begin
	  			dayqty = dayqty + ORrw.Quant;
	  			totalqty = totalqty + ORrw.Quant;
	  		end;
			end;

			total = total + ORr.Sum4/ivfr*ivto*fr/to1;
		end;
	end;
	if(invday>0)then begin
		startformat(15);
			outstring(0,0,curdat,false);
			outstring(50,0,invday,false);
			outstring(120,0,day,false);
			outstring(170,0,day/invday,false);
			outstring(240,0,dayqty,false);
		endformat;
		invday = 0;
		day = 0;
		dayqty = 0;
		curdat = ORr.OrdDate;
	end;
	gray_divider(0,1);
	startformat(15);
	endformat;
	startformat(15);
		outstring(0,0,USetStr(31211),false);
		outstring(50,0,invtotal,false);
		outstring(120,0,total,false);
		outstring(170,0,total/invtotal,false);
		outstring(240,0,totalqty,false);
	endformat;

	endjob;
	LogProcTime("BayAcivityButiqueRn",getcurtick()-curtick);
return;
end;

global procedure StockMovPricingRn(record RcVc RepSpec)
begin
	record StockMovVc SMr,SM2r;
	row StockMovVc SMrw,SM2rw;
	integer i,mtrw,k,smmtrw;
	record PLDefVc PLDr;
	record PLVc PLr;
	string 20 curcode,curdef,basecur;
	val totqty,totsumb1;
	boolean curfoundf;
	val fr,to1,to2,br1,br2;
	Array string 50 acrncy;
  Array Boolean achangecrncyf;
  Integer acrncnt;
	longint curtick;
	
	curtick = getcurtick();
	totqty = 0;
	recordnew(SM2r);
	startreportnoheaderjob(USetStr(31166));
		startformat(15);
			outstring(0,0,USetStr(31231),false);
			outstring(150,0,USetStr(31204),false);
			outstring(300,0,USetStr(31165) & " RRP",true);
			outstring(320,0,USetStr(31121),false);
			outstring(400,0,USetStr(31122),true);
			outstring(1,0,USetStr(31164) &" RRP",true);
		endformat;
	PLDr.Code = "RRP";
	readfirstmain(PLDr,1,true);
	curcode = PLDr.CurncyCode;
	curdef = curcode;
	SMr.SerNr = RepSpec.long1;
	if(readfirstmain(SMr,1,true))then begin
		mtrw = matrowcnt(SMr);
		if(mtrw>0)then begin
			for(i=0;i<mtrw;i=i+1)begin
				matrowget(SMr,i,SMrw);
				curcode = curdef;
				PLr.ArtCode = SMrw.ArtCode;
				PLr.PLCode = "RRP";
				PLr.SerialNr = SMrw.SerialNr;
				readfirstkey("SerialNr",PLr,3,true);
				if(nonblank(PLr.CurncyCode))then begin
					curcode = PLr.CurncyCode;
				end;
				startformat(15);
					outstring(0,0,SMrw.ArtCode,false);
					outstring(150,0,SMrw.Spec,false);
					outstring(300,0,PLr.ExVatPrice,true);
					outstring(320,0,SMrw.OrdQuant,false);
					outstring(400,0,SMrw.OrdQuant*PLr.ExVatPrice,true);
					outstring(1,0,curcode,true);
				endformat;
				totqty = totqty + SMrw.OrdQuant;
				GetFullCurncyRate(curcode,currentdate,fr,to1,to2,br1,br2);
				if(fr==0 or to1==0)then begin
					fr=1; to1=1;
				end;
				totsumb1 = totsumb1 + SMrw.OrdQuant*PLr.ExVatPrice/fr*to1;
				smmtrw = matrowcnt(SM2r);
				if(smmtrw>0)then begin
					curfoundf = false;
					For(k=0;k<smmtrw;k=k+1) begin
						matrowget(SM2r,k,SM2rw);
	  				if(SM2rw.ArtCode==curcode)then begin
	  					SM2rw.OldPrice = SM2rw.OldPrice + SMrw.OrdQuant*PLr.ExVatPrice;
							SM2rw.NewPrice = SM2rw.NewPrice + SMrw.OrdQuant*PLr.ExVatPrice/fr*to1;
	  					curfoundf = true;
	  					matrowput(SM2r,k,SM2rw);
	  				end;
					end;
					if(curfoundf==false)then begin
	  				SM2rw.ArtCode = curcode;
						SM2rw.OldPrice = SMrw.OrdQuant*PLr.ExVatPrice;
						SM2rw.NewPrice = SMrw.OrdQuant*PLr.ExVatPrice/fr*to1;
						matrowput(SM2r,smmtrw,SM2rw);
					end;

				end else begin
					SM2rw.ArtCode = curcode;
					SM2rw.OldPrice = SMrw.OrdQuant*PLr.ExVatPrice;
					SM2rw.NewPrice = SMrw.OrdQuant*PLr.ExVatPrice/fr*to1;
					matrowput(SM2r,0,SM2rw);
				end;
			end;
		end;
	end;

	if(totqty<>0)then begin
		Black_Divider(320,1);
		startformat(15);
			outstring(300,0,USetStr(31074),true);
			outstring(320,0,totqty,false);
		endformat;
		smmtrw = matrowcnt(SM2r);
		if(smmtrw>0)then begin
			Gray_Divider(0,1);
			startformat(15);
				outstring(400,0,USetStr(31076),true);
				outstring(1,0,USetStr(31164),true);
			endformat;
			For(k=0;k<smmtrw;k=k+1) begin
				matrowget(SM2r,k,SM2rw);
				startformat(15);
					outstring(400,0,SM2rw.OldPrice,true);
					outstring(1,0,SM2rw.ArtCode,true);
				endformat;
			end;

		end;
		GetBaseCurncy(1,basecur);
		startformat(15);
			outstring(1,0,USetStr(31163) & basecur,true);
		endformat;
		startformat(15);
			outstring(1,0,totsumb1,true);
		endformat;

		CntPOSCurrencies(acrncy,achangecrncyf,acrncnt);
		if(acrncnt>1)then begin
			Gray_Divider(300,1);
			startformat(15);
				outstring(1,0,USetStr(31162),true);
			endformat;
			For(i=1;i<acrncnt;i=i+1) begin
				GetFullCurncyRate(acrncy[i],currentdate,fr,to1,to2,br1,br2);
				if(fr==0 or to1==0)then begin
					fr=1; to1=1;
				end;
	  		startformat(15);
					outstring(400,0,totsumb1*fr/to1,true);
					outstring(1,0,acrncy[i],true);
				endformat;
			end;
		end;
	end;

	endjob;
	LogProcTime("BayAcivityButiqueRn",getcurtick()-curtick);
return;
end;


global procedure StockMovSumCostRn(record RcVc RepSpec)
begin
	record StockMovVc SMr,SM2r;
	row StockMovVc SMrw,SM2rw;
	integer i,mtrw,k,smmtrw;
	record PLDefVc PLDr;
	record PLVc PLr;
	string 20 curcode,curdef,basecur;
	val totqty,totsumb1;
	boolean curfoundf;
	val fr,to1,to2,br1,br2;
	Array string 50 acrncy;
  Array Boolean achangecrncyf;
  Integer acrncnt;
	longint curtick;
	
	curtick = getcurtick();
	totqty = 0;
	startreportnoheaderjob(USetStr(31161));
		startformat(15);
			outstring(0,0,USetStr(31231),false);
			outstring(100,0,USetStr(31204),false);
			outstring(300,0,USetStr(31160),true);
			outstring(320,0,USetStr(31121),false);
			outstring(400,0,USetStr(31122),true);
		endformat;
	SMr.SerNr = RepSpec.long1;
	if(readfirstmain(SMr,1,true))then begin
		mtrw = matrowcnt(SMr);
		if(mtrw>0)then begin
			for(i=0;i<mtrw;i=i+1)begin
				matrowget(SMr,i,SMrw);
				startformat(15);
					outstring(0,0,SMrw.ArtCode,false);
					outstring(100,0,SMrw.Spec,false);
					outstring(300,0,SMrw.NewPrice,true);
					outstring(320,0,SMrw.OrdQuant,false);
					outstring(400,0,SMrw.OrdQuant*SMrw.NewPrice,true);
				endformat;
				totqty = totqty + SMrw.OrdQuant;
				totsumb1 = totsumb1 + SMrw.OrdQuant*SMrw.NewPrice;
			end;
		end;
	end;

	if(totqty<>0)then begin
		Black_Divider(320,1);
		startformat(15);
			outstring(300,0,USetStr(31211),true);
			outstring(320,0,totqty,false);
			outstring(400,0,totsumb1,true);
		endformat;
	end;

	endjob;
	LogProcTime("StockMovSumCostRn",getcurtick()-curtick);
return;
end;


function longint FindIHReference(var longint source,string artcode)
begin
	record ItemHistVc IHr;
	boolean testf;
	longint res;
	integer counter;

	res = -1;
	counter = 0;
	testf = true;
	IHr.SerNr = source;
	while(readfirstmain(IHr,1,true) and testf)begin
		if(IHr.FileName=="PUVc")then begin
			res = IHr.SerNr;
			goto LFindIHReference;
			testf = false;
		end else begin
			IHr.SerNr = IHr.Source;
		end;
		if(IHr.ArtCode!=artcode)then begin
			testf = false;
		end;
		if(counter>20)then begin
			testf = false;
		end;
		counter = counter + 1;
	end;

LFindIHReference:;
	FindIHReference = res;
return;
end;

global procedure ConsignationReportRn(record RcVc RepSpec)
begin
	record INConsVc INCr;
	record ItemStatusVc ISr;
	record ItemHistVc IHr,IH2r;
	integer pos;
	string 255 class;
	record DIVc DIr;
	record INVc INr;
	boolean TrHs,testf,TrHs1,testf1;
	val totqty,selqty,retqty,prosroch;
	string 255 brand,type; //Edit***************************Sasha2,15:42 28.01.2016
	longint curtick;


	curtick = getcurtick();
	startreportnoheaderjob(USetStr(31159));

		startformat(15);
			outstring(0,0,USetStr(31231),false);
			outstring(50,0,USetStr(31204),false);
			outstring(200,0,USetStr(31044),false);
			outstring(250,0,USetStr(31105),false);
			outstring(320,0,USetStr(31150),false);
			outstring(1,0,USetStr(31158),true);
		endformat;

		black_divider(0,1);
		if(nonblank(RepSpec.f1))then begin
			INCr.Code = RepSpec.f1;
		end else begin
			INCr.Code = "";
		end;
		TrHs = true;
		While(loopmain(INCr,1,TrHs)) begin
			testf = true;

			if(nonblank(RepSpec.f1) and INCr.Code!=RepSpec.f1)then begin TrHs=false; testf = false; end;

			if(nonblank(RepSpec.f2))then begin
				INr.Code = INCr.Code;
				readfirstmain(INr,1,true);
				pos = 0;
    		brand = "";
    		ExtractObj(INr.DispGroups,pos,class);
    		while (NonBlank(class)) begin
    		  DIr.Code = class;
    		  if (readfirstmain(DIr,1,true)) then begin
    		    if (DIr.CType=="BRAND") then begin
    		      brand = DIr.Name;
    		      pos = len(INr.DispGroups);
    		    end;
    		  end;
    		  ExtractObj(INr.DispGroups,pos,class);
    		end;
    		if(brand!=RepSpec.f2)then begin
					testf = false;
				end;
				
				/*pos = 0;
				ExtractObj(INr.DispGroups,pos,class);
				if(class!=RepSpec.f2)then begin
					testf = false;
				end;*/
			end;
			if(testf)then begin
				ISr.Code = INCr.Code;
				ISr.Location = ";;;";
				if(readfirstmain(ISr,2,true))then begin
					INr.Code = INCr.Code;
					readfirstmain(INr,1,true);
					startformat(15);
						outstring(0,0,INCr.Code,false);
						outstring(50,0,INCr.Name,false);
						
						pos = 0;
						brand = "";
        		type = "";
        		ExtractObj(INr.DispGroups,pos,class);
        		while (NonBlank(class)) begin
        		  DIr.Code = class;
        		  if (readfirstmain(DIr,1,true)) then begin
        		    if (DIr.CType=="BRAND") then begin
        		      brand = DIr.Name;
        		    end;
        		    if (DIr.CType=="TYPE") then begin
        		      type = DIr.Name;
        		    end;
        		  end;
        		  ExtractObj(INr.DispGroups,pos,class);
        		end;
        		outstring(200,0,brand,false);
        		outstring(250,0,type,false);
						
						/*pos = 0;
						ExtractObj(INr.DispGroups,pos,class);
						DIr.Code = class;
						readfirstmain(DIr,1,true);
						outstring(200,0,DIr.Name,false);
						ExtractObj(INr.DispGroups,pos,class);
						DIr.Code = class;
						readfirstmain(DIr,1,true);
						outstring(250,0,DIr.Name,false);*/
						
						outstring(320,0,ISr.Instock,false);
						outstring(1,0,INCr.Days,true);
					endformat;
					Gray_divider(0,1);
					startformat(15);
						outstring(80,0,USetStr(31157) & " Ü",true);
						outstring(100,0,USetStr(31156),false);
						outstring(160,0,USetStr(31121),false);
					endformat;
					IHr.ArtCode = INr.Code;
					IHr.FileName = "PUVc";
					TrHs1 = true;
					totqty = 0;
					prosroch = 0;
					while(loopkey("FNArtCode",IHr,2,TrHs1))begin
						testf1 = true;
						if(IHr.ArtCode!=INr.Code or IHr.FileName!="PUVc")then begin testf1=false; TrHs1 = false; end;
						if(IHr.Invalid>0)then begin testf=false; end;

						if(testf1)then begin
							startformat(15);
								outstring(80,0,IHr.TransNr,true);
								outstring(100,0,IHr.TransDate,false);
								outstring(160,0,IHr.Qty,false);
							endformat;
							totqty = totqty + IHr.Qty;
							selqty = 0;
							retqty = 0;
							IH2r.ArtCode = IHr.ArtCode;
							While(loopkey("ArtCode",IH2r,1,true) and IH2r.ArtCode==IHr.ArtCode) begin
								if(IH2r.Source>0 and FindIHReference(IH2r.Source,IH2r.ArtCode)>0)then begin
									if(IH2r.FileName=="IVVc")then begin
										startformat(15);
											outstring(250,0,USetStr(31155) & " Ü",true);
											outstring(260,0,IH2r.TransNr,false);
											outstring(290,0,IH2r.TransDate,false);
											outstring(330,0,IH2r.Qty,false);
											outstring(350,0,IH2r.Location,false);
										endformat;
										selqty = selqty + IH2r.Qty;
									end;
									if(IH2r.FileName=="SHVc")then begin
										startformat(15);
											outstring(250,0,USetStr(31154) & " Ü",true);
											outstring(260,0,IH2r.TransNr,false);
											outstring(290,0,IH2r.TransDate,false);
											outstring(330,0,IH2r.Qty,false);
											outstring(350,0,IH2r.Location,false);
										endformat;
										selqty = selqty + IH2r.Qty;
									end;
									if(IH2r.FileName=="SDVc")then begin
										startformat(15);
											outstring(250,0,USetStr(31153) & " Ü",true);
											outstring(260,0,IH2r.TransNr,false);
											outstring(290,0,IH2r.TransDate,false);
											outstring(330,0,IH2r.Qty,false);
											outstring(350,0,IH2r.Location,false);
										endformat;
										retqty = retqty + IH2r.Qty;
									end;
									if(IH2r.FileName=="RetVc")then begin
										startformat(15);
											outstring(250,0,USetStr(31111) & " Ü",true);
											outstring(260,0,IH2r.TransNr,false);
											outstring(290,0,IH2r.TransDate,false);
											outstring(330,0,IH2r.Qty,false);
											outstring(350,0,IH2r.Location,false);
										endformat;
										retqty = retqty + IH2r.Qty;
									end;
								end;
							end;
							resetloop(IH2r);
							if(selqty<>0 or retqty<>0)then begin
								gray_divider(250,350);
							end;
							if(selqty<>0)then begin
								startformat(15);
									outstring(250,0,USetStr(31152),true);
									outstring(330,0,-selqty,false);
								endformat;
							end;
							if(retqty<>0)then begin
								startformat(15);
									outstring(250,0,USetStr(31151),true);
									outstring(330,0,-retqty,false);
								endformat;
							end;
							startformat(15);
								outstring(250,0,USetStr(31150),true);
								outstring(330,0,IHr.Qty + selqty + retqty,false);
							endformat;
							if((IHr.Qty + retqty)>0)then begin
								startformat(15);
									outstring(1,0,USetStr(31149),true);
								endformat;
								startformat(15);
									outstring(400,0,USetStr(31121),false);
									outstring(1,0,USetStr(31148),true);
								endformat;
								startformat(15);
									outstring(400,0,IHr.Qty + retqty,false);
									outstring(1,0,datediff(currentdate,IHr.TransDate),true);
								endformat;
								if(datediff(currentdate,IHr.TransDate)>0)then begin
									prosroch = prosroch + IHr.Qty + retqty;
								end;
							end;
						end;
					end;
					resetloop(IHr);
					gray_divider(100,1);
					startformat(15);
						outstring(100,0,USetStr(31211),false);
						outstring(160,0,totqty,false);
						outstring(390,0,USetStr(31147),true);
						outstring(400,0,prosroch,false);
					endformat;
					black_divider(0,1);
				end;
			end;
		end;

	endjob;
	LogProcTime("ConsignationReportRn",getcurtick() - curtick);
return;
end;


global  procedure OstatkiSKartinkamiRn(record RcVc RepSpec)
begin
	record INVc INr;
	string 255 res;
	record Attach2Vc Attachr;
	record RLinkVc RLr;
	string 255 uid;
	longint lenth;
	area attach,attachnew,webpage1;
	string 255 filename,tstr;
	string 20 rowcolor,pricecolor;
	record ItemStatusVc ISr;
	boolean filefind;
	integer wn;
	//record RcVc RepSpec;
	string 255 serverip;
	integer compnr;
	record CompaniesBlock Cb;
	row CompaniesBlock Cbrw;
	integer mtrw,i;
	boolean userlocation;
	record UserVc User;
	integer pos;
	string 50 uloc,location,compfolder;
	record ProgramStatusBlock PSb;
	longint curtick;

	location = RepSpec.f2;
	userlocation = false;
	
	curtick = getcurtick();
	if(userlocation)then begin
		messagebox(0,USetStr(31014));
  end else begin
		if(false)then begin
			Messagebox(0,USetStr(31145));
		end else begin
			closewindow(wn);
			if(right(RepSpec.ObjStr,5)==".html" or right(RepSpec.ObjStr,4)==".htm")then begin
				filename = RepSpec.ObjStr;
			end else begin
				filename = RepSpec.ObjStr & ".html";
			end;
			//createfile(filename);
			//closefile;
			serverip = RepSpec.f6;
			setareazerosize(webpage1);
			ItemStockStatExtWebRn(RepSpec,webpage1,serverip);
			writeareatofile(webpage1,filename,0);

			messagebox(0,USetStr(31146));
			LogProcTime("OstatkiSKartinkamiRn",getcurtick() - curtick);
		end;
	end;
end;

global  procedure OstatkiSKartinkamiNewRn(record RcVc RepSpec)
begin
	record INVc INr;
	string 255 res;
	record Attach2Vc Attachr;
	record RLinkVc RLr;
	string 255 uid;
	longint lenth;
	area attach,attachnew,webpage1;
	string 255 filename,tstr;
	string 20 rowcolor,pricecolor;
	record ItemStatusVc ISr;
	boolean filefind;
	integer wn;
	//record RcVc RepSpec;
	string 255 serverip;
	integer compnr;
	record CompaniesBlock Cb;
	row CompaniesBlock Cbrw;
	integer mtrw,i;
	boolean userlocation;
	record UserVc User;
	integer pos;
	string 50 uloc,location,compfolder;
	record ProgramStatusBlock PSb;
	longint curtick;
	
	curtick = getcurtick();
	location = RepSpec.f2;
	userlocation = false;

	if(userlocation)then begin
		messagebox(0,USetStr(31014));
  end else begin
		if(false)then begin
			Messagebox(0,USetStr(31145));
		end else begin
			closewindow(wn);
			if(right(RepSpec.ObjStr,5)==".html" or right(RepSpec.ObjStr,4)==".htm")then begin
				filename = RepSpec.ObjStr;
			end else begin
				filename = RepSpec.ObjStr & ".html";
			end;
			//createfile(filename);
			//closefile;
			serverip = RepSpec.f6;
			setareazerosize(webpage1);
			ItemStockStatExtWebNewRn(RepSpec,webpage1,serverip);
			writeareatofile(webpage1,filename,0);

			messagebox(0,USetStr(31146));
		end;
	end;
	LogProcTime("OstatkiSKartinkamiNewRn",getcurtick() - curtick);
end;

global  procedure ProdajiSKartinkamiRn(record RcVc RepSpec)
begin
	record INVc INr;
	string 255 res;
	record Attach2Vc Attachr;
	record RLinkVc RLr;
	string 255 uid;
	longint lenth;
	area attach,attachnew,webpage1;
	string 255 filename,tstr;
	string 20 rowcolor,pricecolor;
	record ItemStatusVc ISr;
	boolean filefind;
	integer wn;
	//record RcVc RepSpec;
	string 255 serverip;
	integer compnr;
	record CompaniesBlock Cb;
	row CompaniesBlock Cbrw;
	integer mtrw,i;
	boolean userlocation;
	record UserVc User;
	integer pos;
	string 50 uloc,location,compfolder;
	record ProgramStatusBlock PSb;
	longint alenth;
	string 255 res1;
	longint curtick;
	
	curtick = getcurtick();

	blockload(PSb);
	blockload(Cb);

	/*compnr = currentcompany;
	matrowget(Cb,compnr-1,Cbrw);
	serverip = Cbrw.TCPIP & ":" & PSb.httpPort & "/" & Cbrw.ShortName;*/
	serverip = RepSpec.f6;
	//setcompany(3,false);
	/*wn = curwindow;
	deselectwindow(wn,true);
	selectwindow(wn);
	getwindowrecord(wn,RepSpec);*/

	location = RepSpec.f2;
	userlocation = false;

	//setexportcodepage("CP1251");

	if(userlocation)then begin
		Messagebox(0,USetStr(31014));
  end else begin
		if(false)then begin
			Messagebox(0,USetStr(31145));
		end else begin
			closewindow(wn);
			if(right(RepSpec.ObjStr,5)==".html" or right(RepSpec.ObjStr,4)==".htm")then begin
				filename = RepSpec.ObjStr;
			end else begin
				filename = RepSpec.ObjStr & ".html";
			end;
			//createfile(filename);
			//closefile;

			//setareazerosize(webpage1);
			SalesReportExtPictRn(RepSpec,webpage1,serverip);
			//writeareatofile(webpage1,filename,0);
			//weboutarea(webpage1);
			messagebox(0,USetStr(31146));
		end;
	end;
	LogProcTime("ProdajiSKartinkamiRn",getcurtick() - curtick);
end;

global
function string 60 SalesWithImagesRClassDefaultFileName(record RcVc RepSpec)
begin
	string 60 res,serverip;
	record ProgramStatusBlock PSb;
	longint curtick;
	
	curtick = getcurtick();
  res = "SalesWithImages.html";
  SalesWithImagesRClassDefaultFileName = res;
	LogProcTime("SalesWithImagesRClassDefaultFileName",getcurtick() - curtick);
  return;
end;

global
function Boolean SalesWithImagesRClassOnOpenWindow(integer wn)
begin
	string 60 res,serverip;
	record ProgramStatusBlock PSb;
	integer compnr;
	record CompaniesBlock Cb;
	row CompaniesBlock Cbrw;
	record RcVc RepSpec;
	
	blockload(PSb);
	blockload(Cb);

	getwindowrecord(wn,RepSpec);

	compnr = currentcompany;
	matrowget(Cb,compnr-1,Cbrw);
	serverip = Cbrw.TCPIP & ":" & PSb.httpPort & "/" & Cbrw.ShortName;
  RepSpec.f6 = serverip;
  putwindowrecord(wn,RepSpec);
	
	SalesWithImagesRClassOnOpenWindow = true;
  return;
end;

global
procedure SalesWithImagesRClassReportDefaults(integer wn)
begin
	string 60 res,serverip;
	record ProgramStatusBlock PSb;
	integer compnr;
	record CompaniesBlock Cb;
	row CompaniesBlock Cbrw;
	record RcVc RepSpec;

	blockload(PSb);
	blockload(Cb);

	getwindowrecord(wn,RepSpec);
	reportdefaults(RepSpec,"SalesWithImagesRClass");
	compnr = currentcompany;
	matrowget(Cb,compnr-1,Cbrw);
	serverip = Cbrw.TCPIP & ":" & PSb.httpPort & "/" & Cbrw.ShortName;
  RepSpec.f6 = serverip;

  putwindowrecord(wn,RepSpec);

  return;
end;

global
function string 60 ItemStockStatExtWebRClassDefaultFileName(record RcVc RepSpec)
begin
	string 60 res;

  res = "OstatkiWithImages.html";;
  ItemStockStatExtWebRClassDefaultFileName = res;
  return;
end;


global
function boolean ItemStockStatExtWebRClassOnOpenWindow(integer wn)
begin
	string 60 res,serverip;
	record ProgramStatusBlock PSb;
	integer compnr;
	record CompaniesBlock Cb;
	row CompaniesBlock Cbrw;
	record RcVc RepSpec;

	blockload(PSb);
	blockload(Cb);

	getwindowrecord(wn,RepSpec);

	compnr = currentcompany;
	matrowget(Cb,compnr-1,Cbrw);
	serverip = Cbrw.TCPIP & ":" & PSb.httpPort & "/" & Cbrw.ShortName;
  RepSpec.f6 = serverip;
  putwindowrecord(wn,RepSpec);
	
	ItemStockStatExtWebRClassOnOpenWindow = true;
  return;
end;

global
procedure ItemStockStatExtWebRClassReportDefaults(integer wn)
begin
	string 60 res,serverip;
	record ProgramStatusBlock PSb;
	integer compnr;
	record CompaniesBlock Cb;
	row CompaniesBlock Cbrw;
	record RcVc RepSpec;

	blockload(PSb);
	blockload(Cb);

	getwindowrecord(wn,RepSpec);
	reportdefaults(RepSpec,"ItemStockStatExtWebRClass");
	compnr = currentcompany;
	matrowget(Cb,compnr-1,Cbrw);
	serverip = Cbrw.TCPIP & ":" & PSb.httpPort & "/" & Cbrw.ShortName;
  RepSpec.f6 = serverip;

  putwindowrecord(wn,RepSpec);

  return;
end;



global
procedure ArtRClassReportDefaults(integer wn)
begin
	string 60 res,serverip;
	record ProgramStatusBlock PSb;
	integer compnr;
	record CompaniesBlock Cb;
	row CompaniesBlock Cbrw;
	record RcVc RepSpec;

	blockload(PSb);
	blockload(Cb);

	getwindowrecord(wn,RepSpec);
	reportdefaults(RepSpec,"ArtRClass");
	 DeselectWindow(wn,false);
  RepSpec.flags[3] = 1;
  RepSpec.flags[4] = 1;
  RepSpec.flags[5] = 1;
  RepSpec.flags[6] = 1;
	compnr = currentcompany;
	matrowget(Cb,compnr-1,Cbrw);
	serverip = Cbrw.TCPIP & ":" & PSb.httpPort & "/" & Cbrw.ShortName;
  RepSpec.f6 = serverip;

  putwindowrecord(wn,RepSpec);
	 SelectWindow(wn);
  return;
end;




global procedure TestRn(record RcVc RepSpec)
begin
	record POVc POr;
	row POVc POrw;
	integer i,mtrw;
	record INVc INr;
	longint curtick;

	startreportnoheaderjob("test");
	
	curtick = getcurtick();
	startformat(15);
		outstring(0,0,"PO",false);
		outstring(50,0,"rw",false);
		outstring(100,0,"Art",false);
		outstring(150,0,"Unit1",false);
		outstring(200,0,"Unit2",false);
	endformat;

	POr.SerNr = "";
	while(loopmain(POr,1,true))begin
		mtrw = matrowcnt(POr);
		For(i=0;i<mtrw;i=i+1) begin
			matrowget(POr,i,POrw);
			INr.Code = POrw.ArtCode;
			readfirstmain(INr,1,true);
			If(INr.Unittext!=POrw.UnitCode)then begin
				startformat(15);
					outstring(0,0,POr.SerNr,false);
					outstring(50,0,i+1,false);
					outstring(100,0,POrw.ArtCode,false);
					outstring(150,0,POrw.UnitCode,false);
					outstring(200,0,INr.Unittext,false);
				endformat;
			end;
		end;

	end;
	LogProcTime("TestRn",getcurtick() - curtick);
	endjob;

return;
end;


global
procedure DblSDVcOpen(string dblstr,string l,Integer currepwn)	//Edit----------------------Dima  24.02.2015
begin
  Integer wn;
  record SDVc SDr;

  SDr.SerNr = StringToLongInt(dblstr);

  if (ReadFirstMain(SDr,1,true)) then begin
    wn = OpenWindow("SDDClass",1,0,"","",SDr);
  end;
  return;
end;

global
procedure DblPUVcOpen(string dblstr,string l,Integer currepwn)	//Edit----------------------Dima  25.02.2015
begin
  Integer wn;
  record PUVc PUr;

  PUr.SerNr = StringToLongInt(dblstr);

  if (ReadFirstMain(PUr,1,true)) then begin
    wn = OpenWindow("PUDClass",1,0,"","",PUr);
  end;
  return;
end;

global
procedure DblSHVcOpen(string dblstr,string l,Integer currepwn)	//Edit----------------------Dima  23.03.2015
begin
  Integer wn;
  record SHVc SHr;

  SHr.SerNr = StringToLongInt(dblstr);

  if (ReadFirstMain(SHr,1,true)) then begin
    wn = OpenWindow("SHDClass",1,0,"","",SHr);
  end;
  return;
end;

global
procedure DblStockMovVcOpen(string dblstr,string l,Integer currepwn)	//Edit----------------------Dima  23.03.2015
begin
  Integer wn;
  record StockMovVc SMr;

  SMr.SerNr = StringToLongInt(dblstr);

  if (ReadFirstMain(SMr,1,true)) then begin
    wn = OpenWindow("StockMovDClass",1,0,"","",SMr);
  end;
  return;
end;

global
procedure DblRetVcOpen(string dblstr,string l,Integer currepwn)	//Edit----------------------Dima  23.03.2015
begin
  Integer wn;
  record RetVc Retr;

  Retr.SerNr = StringToLongInt(dblstr);

  if (ReadFirstMain(Retr,1,true)) then begin
    wn = OpenWindow("RetDClass",1,0,"","",Retr);
  end;
  return;
end;

global
procedure DblRetPUVcOpen(string dblstr,string l,Integer currepwn)	//Edit----------------------Dima  23.03.2015
begin
  Integer wn;
  record RetPUVc Retr;

  Retr.SerNr = StringToLongInt(dblstr);

  if (ReadFirstMain(Retr,1,true)) then begin
    wn = OpenWindow("RetPUDClass",1,0,"","",Retr);
  end;
  return;
end;

global
procedure DblIVVcOpen(string dblstr,string l,Integer currepwn)	//Edit----------------------Dima  23.03.2015
begin
  Integer wn;
  record IVVc IVr;

  IVr.SerNr = StringToLongInt(l);

  if (ReadFirstMain(IVr,1,true)) then begin
    wn = OpenWindow("IVDClass",1,0,"","",IVr);
  end;
  return;
end;


procedure ExtractClassificationsFromINVc(string artcode,var string type, var string brand)	//Edit----------------------Dima  23.02.2015
begin
	record INVc INr;
	record DIVc DIr;
	integer pos;
	string 15 classification;

	INr.Code = artcode;
	if (ReadFirstMain(INr,1,true)) then begin

		pos = 0;
  	ExtractObj(INr.DispGroups,pos,classification);
  	while(nonblank(classification)) begin
  		DIr.Code = classification;
			if(ReadFirstMain(DIr,1,true) and (DIr.CType=="BRAND")) then begin
						brand = DIr.Name;
			end else begin
					if(ReadFirstMain(DIr,1,true) and (DIr.CType=="TYPE")) then begin
						type = DIr.Name;
					end;
			end;
  		ExtractObj(INr.DispGroups,pos,classification);
  	end;
	end;

return;
end;

procedure HeaderLocations(string a,  var string res)	//Edit----------------------Dima  23.02.2015
begin
  if (blank(a)) then begin
     res = USetStr(8961);
  end else begin
     res = USetStr(2768);
     res = res &": " & a;
  end;
return;
end;



global
procedure FoundersRn(record RcVc RepSpec)  					//Edit----------------------Dima  23.02.2015
begin
  record SDVc SDr;
  row SDVc SDrw;
  record ObjVc Objr;
  record PLVc PLr;
  integer rw,rwcnt,i,pos;
  string 200 tstr;
  string 30 objct,type,brand,founder;
  boolean testf,TrHs;
  val sum;
	longint curtick;
	
	curtick = getcurtick();

  StartReportJob(USetStr(31322));
  rw=1;
  Header(rw,USetStr(31102) & RepSpec.sStartDate & "-" & RepSpec.sEndDate,1);
  rw = rw + 1;
  HeaderLocations(RepSpec.f1,tstr);
  Header(rw,tstr,1);
  rw = rw + 1;
	EndHeader;

	StartFormat(15);
		OutString(0,0,USetStr(31203),false);		//ArtCode
		OutString(90,0,USetStr(12003),false);		//Type
		OutString(140,0,USetStr(31205),false);	//Brand
		OutString(200,0,USetStr(31169),false);	//Currency
		OutString(240,0,USetStr(12004),false);	//Quantity
		OutString(280,0,USetStr(31122),false);	//Sum
		OutString(320,0,USetStr(35001),false);	//Founder
		OutString(390,0,USetStr(12001),false);	//Date
		OutString(440,0,USetStr(13214),false);	//Document

	EndFormat;

	TrHs = true;
	SDr.TransDate = RepSpec.sStartDate;

	While(LoopKey("TransDate",SDr,1,TrHs))begin
		testf = true;

		if (SDr.TransDate > RepSpec.sEndDate) then begin
			testf = false;
			TrHs = false;
		end;

		if (nonblank(RepSpec.f1) and (RepSpec.f1 != SDr.Location)) then begin
			testf = false;
		end;

		if (testf) then begin
			pos = 0;
  		ExtractObj(SDr.Objects,pos,objct);
  		testf = false;
  		while(nonblank(objct)) begin
  			Objr.Code = objct;
				if(ReadFirstMain(Objr,1,true) and (Objr.OTCode=="FOUND")) then begin
						testf = true;
						founder = Objr.Comment;
						goto LBreakObjSearch4;
				end;
  			ExtractObj(SDr.Objects,pos,objct);
  		end;
			LBreakObjSearch4:;
		end;


		if(testf)  then begin

				rwcnt = MatRowCnt(SDr);

				for(i=0; i<rwcnt; i=i+1) begin
					MatRowGet(SDr,i,SDrw);
					ExtractClassificationsFromINVc(SDrw.ArtCode,type,brand);

					PLr.PLCode = "FOB36";
					PLr.ArtCode = SDrw.ArtCode;
					ReadFirstMain(PLr,2,true);
					sum = PLr.ExVatPrice * SDrw.Qty;

					StartFormat(15);
						OutString(0,0,SDrw.ArtCode,false);
						OutString(90,0,type,false);
						OutString(140,0,brand,false);
						OutString(200,0,PLr.CurncyCode,false);
						OutString(240,0,SDrw.Qty,false);
						OutVal(280,0,sum,M4Val,false);
						OutString(320,0,founder,false);
						OutString(390,0,SDr.TransDate,false);
						OutStringID(440,"DblSDVcOpen",SDr.SerNr,false,SDr.SerNr);

					EndFormat;

				end;
		end;

	end;
	
	LogProcTime("FoundersRn",getcurtick() - curtick);

	EndJob;

return;
end;



global
procedure PUInvoicingRn(record RcVc RepSpec)  					//Edit----------------------------------Dima  24.02.2015
begin
	record PUVc PUr;
	row PUVc PUrw;
	record POVc POr;
	row POVc POrw;
	record VIVc VIr;
	row VIVc VIrw;
  integer rw,rwcnt,i,pos;
  boolean testf,TrHs,testf3,testf4,TrHs3;
  val PUSum,POSum,VISum;
  boolean withoutPO,foundVI;
	longint curtick;
	
	curtick = getcurtick();
	
	withoutPO=!RepSpec.flags[1];

	StartReportJob(USetStr(35003));
  rw=1;
  Header(rw,USetStr(31102) & RepSpec.sStartDate & "-" & RepSpec.sEndDate,1);
  rw = rw + 1;
	EndHeader;

	StartFormat(15);
		OutString(0,0,USetStr(22421),false);		//Vendor
		OutString(90,0,USetStr(22419),false);		//PU Number
		OutString(140,0,USetStr(31156),false);	//Date
		OutString(220,0,USetStr(31122),false);	//Sum
		OutString(300,0,USetStr(35004),false);	//Invoiced
		OutString(400,0,USetStr(2475),false);		//Difference

	EndFormat;


	TrHs = true;
	
	PUr.TransDate = RepSpec.sStartDate;
	While(LoopKey("TransDate",PUr,1,TrHs))begin
		testf = true;

		if (PUr.TransDate > RepSpec.sEndDate) then begin
			testf = false;
			TrHs = false;
		end;

		if (nonblank(RepSpec.f1) and (RepSpec.f1 != PUr.VECode)) then begin
			testf = false;
		end;

		if (nonblank(RepSpec.f2) and (RepSpec.f2 != PUr.Location)) then begin
			testf = false;
		end;


		if (testf) then begin
				PUSum = 0;
				rwcnt = MatRowCnt(PUr);
				for(i=0;i<rwcnt;i=i+1) begin
					MatRowGet(PUr,i,PUrw);
					PUSum = PUSum + PUrw.UPrice * PUrw.Quant;
				end;

					VIr.POSerNr = PUr.PONr;
					VISum = 0;
					TrHs3 = true;

					While(LoopKey("POSerNr",VIr,1,TrHs3)) begin
							testf3 = true;

							if (VIr.TransDate > RepSpec.sEndDate  or VIr.TransDate < RepSpec.sStartDate) then begin
								testf3 = false;
							end;

				 			if (VIr.POSerNr != PUr.PONr  or VIr.POSerNr<0) then begin
								TrHs3 = false;
								testf3 = false;
							end;

							if (testf3) then begin
									foundVI = true;
									rwcnt = MatRowCnt(VIr);
									for(i=0;i<rwcnt;i=i+1) begin
										MatRowGet(VIr,i,VIrw);
											testf4 = true;

											if (VIrw.PUNr > 0  and VIrw.PUNr!=PUr.SerNr)	then begin
													goto LBreakInvLoop1;
											end;

											if (VIrw.stp == kInvoiceRowTypePrepayment) then begin testf4 = false; end;

											if(testf4) then begin
												VISum = VISum + VIrw.Sum;
											end;
									end;
							end;

							LBreakInvLoop1:;
					end;
					ResetLoop(VIr);


					//if exist PU and VI only, without PO record--------------------------------------------------------------
					//and invoices(VI) were not found previously
					
					if (withoutPO and (foundVI==false)) then begin

						VISum = 0;
						TrHs3 = true;
						VIr.TransDate = RepSpec.sStartDate;
						While(LoopKey("TransDate",VIr,1,TrHs3)) begin
								testf3 = true;

								if (VIr.TransDate > RepSpec.sEndDate) then begin
									testf3 = false;
									TrHs3 = false;
								end;

								if (testf3) then begin
									rwcnt = MatRowCnt(VIr);
									for(i=0;i<rwcnt;i=i+1) begin
										MatRowGet(VIr,i,VIrw);
											testf4 = true;

											if ((VIrw.PUNr > 0  and VIrw.PUNr!=PUr.SerNr)  or (VIrw.PUNr < 0))	then begin
													goto LBreakInvLoop2;
											end;

											if (VIrw.stp == kInvoiceRowTypePrepayment) then begin testf4 = false; end;

											if(testf4) then begin
												VISum = VISum + VIrw.Sum;
											end;
									end;
									LBreakInvLoop2:;
								end;

						end;
						ResetLoop(VIr);

					end;
					foundVI = false;

					StartFormat(15);
						OutString(0,0,PUr.VEName,false);
						OutStringID(90,"DblPUVcOpen",PUr.SerNr,false,PUr.SerNr);
						OutString(140,0,PUr.TransDate,false);
						OutVal(220,0,PUSum,M4Val,false);
						OutVal(300,0,VISum,M4Val,false);
						OutVal(400,0,PUSum-VISum,M4Val,false);

					EndFormat;


		end;


	end;


	EndJob;
	LogProcTime("PUInvoicingRn",getcurtick() - curtick);
return;
end;



global
procedure ExportInvoiceToExcelRn(record RcVc RepSpec)  					//Edit----------------------Dima  04.03.2015
begin
  record IVVc IVr;
  row	IVVc IVrw;
  record LocationVc Locr;
  Integer rwcnt,i,wn,curcomp;
  string 255 tstr;
  string 5 cur;
  val noRebSum;
  val fr,to1,to2,br1,br2;
  longint curtick;
	
	curtick = getcurtick();
  curcomp = CurrentCompany;
  noRebSum=0;
  IVr.SerNr = RepSpec.long1;
  if (ReadFirstMain(IVr,1,true)) then begin	 
  
  Locr.Code = IVr.Location;
  ReadFirstMain(Locr,1,true);
   

	StartReportNoHeaderJob("ExportToExcel");
	
		StartFormat(15);
		OutString(0,0,USetStr(31024),false);
		OutString(2,0,IVr.Location,true);
		OutString(3,0,"",false);
		OutString(4,0,"",false);
		OutString(3,0,USetStr(31133),false);
		GetUserName(IVr.SalesMan,tstr);
		OutString(4,0,tstr,false);
		EndFormat;
		OutString(1,0,Locr.Addr0,true);
		EndFormat;
		OutString(1,0,Locr.Phone,true);
		EndFormat;
		OutString(0,0,USetStr(2562),false);
		OutString(1,0,IVr.SerNr,true);
		OutString(1,0,"",false);
		OutString(1,0,"",false);
		OutString(0,0,USetStr(35005),false);
		OutString(1,0,"",false);	
		OutString(1,0,IVr.CustCode,true);
		if(NonBlank(IVr.RebCode)) then begin
			OutString(1,0,"",false);
			OutString(1,0,"",false);
			OutString(1,0,USetStr(31267),false);
			OutString(1,0,IVr.RebCode,true);
		end;
		EndFormat;
		OutString(1,0,USetStr(31262),false);
		OutString(1,0,IVr.InvDate,true);	
		EndFormat;
		
		OutString(1,0,"__________________________________________________________________________________________________________________________________",false);
		EndFormat;
	  OutString(1,0,USetStr(31231),false);
	  OutString(1,0,"",false);
	  OutString(1,0,USetStr(12003),false);
	  OutString(1,0,"",false);
	  OutString(1,0,"",false);
	  OutString(1,0,"",false);
	  OutString(1,0,USetStr(12004),false);
	  OutString(1,0,"",false);
	  OutString(1,0,USetStr(12005),false);
    if curcomp==13 then begin//Edit-------------------Vitalii 11:51 31.05.2016
      OutString(1,0,USetStr(12005) & " " & USetStr(10524) & " USD",false);
    end;
	  OutString(1,0,USetStr(12006),false);
	  OutString(1,0,USetStr(12448),false);
    if curcomp==13 then begin//Edit-------------------Vitalii 11:51 31.05.2016
      OutString(1,0,USetStr(12448) & " " & USetStr(10524) & " USD",false);
    end;
	  EndFormat;
  	rwcnt=MatRowCnt(IVr); 
    if curcomp==13 then begin//Edit-------------------Vitalii 11:51 31.05.2016
      fr=0; to1=0;
      cur = "USD";
      GetFullCurncyRate(cur,currentdate,fr,to1,to2,br1,br2);
      if(fr==0 or to1==0)then begin
        fr=1; to1=1;
      end;
    end;
  	for(i=0;i<rwcnt;i=i+1) begin
			MatRowGet(IVr,i,IVrw);
			if(IVrw.stp==kInvoiceRowTypeNormal) then begin
				OutString(1,0,IVrw.ArtCode,true);
				OutString(1,0,"",false);
				OutString(1,0,IVrw.Spec,true);
				OutString(1,0,"",false);
				OutString(1,0,"",false);
				OutString(1,0,"",false);
				OutString(1,0,IVrw.Quant,true);
				OutString(1,0,"",false);
				OutString(1,0,IVrw.Price,true);
        if curcomp==13 then begin//Edit-------------------Vitalii 11:51 31.05.2016
          OutString(1,0,IVrw.Price*fr/to1,true);
        end;
				OutString(1,0,IVrw.vRebate,true);
				OutString(1,0,IVrw.Sum,true);
        if curcomp==13 then begin//Edit-------------------Vitalii 11:52 31.05.2016
          OutString(1,0,IVrw.Sum*fr/to1,true);
        end;
        EndFormat;
				noRebSum = noRebSum + IVrw.Price*IVrw.Quant;
			end;	
		end;
		OutString(1,0,"__________________________________________________________________________________________________________________________________",false);
		EndFormat;
		StartFormat(15);
    OutString(1,0,"",false);	
		OutString(1,0,USetStr(12867),false);
		OutString(1,0,noRebSum,true);
    OutString(1,0,"",false);
	  
	  if (NonBlank(IVr.RebCode)) then begin
	  	OutString(1,0,USetStr(31267),false);
			OutString(1,0,IVr.RebCode,true);
	  	OutString(1,0,"",false);
	  	OutString(1,0,"",false);
		end else begin
			OutString(1,0,"",false);
			OutString(1,0,"",false);
			OutString(1,0,"",false);
			OutString(1,0,"",false);
		end;
 	  OutString(1,0,USetStr(24193) & ":",false);
		OutString(1,0,IVr.Sum4,true);
    OutString(1,0,IVr.Sum4*fr/to1,true);
	  OutString(1,0,"",false);	
    EndFormat;
    
    if curcomp==13 then begin//Edit-------------------Vitalii 11:52 31.05.2016
      StartFormat(15);
      OutString(1,0,"",false);	
      OutString(1,0,USetStr(12880) & " " & USetStr(10524) & " USD" & ":",false);
      OutString(1,0,noRebSum*fr/to1,true);
      OutString(1,0,"",false);
      
      OutString(1,0,"",false);
      OutString(1,0,"",false);
      OutString(1,0,"",false);
      OutString(1,0,"",false);
      OutString(1,0,USetStr(24193) & " " & USetStr(10524) & " USD" & ":",false);
      OutString(1,0,IVr.Sum4*fr/to1,true);
      OutString(1,0,"",false);
      EndFormat;
    end;
	EndJob;
	end;
	LogProcTime("ExportInvoiceToExcelRn",getcurtick() - curtick);
return;
end;

global procedure CheckItemHistErrorRn()
begin
	record INVc INr;
	record ItemHistVc IHr;
	boolean testf,TrHs;
	record LocationVc Locr;
	val qty;
	
	
	startreportnoheaderjob("check");
		INr.Code = "";
		while(loopmain(INr,1,true))begin
		//if(readfirstmain(INr,1,true))then begin	
			Locr.Code = "";
			while(loopmain(Locr,1,true))begin
				IHr.ArtCode = INr.Code;
				IHr.Location = Locr.Code;
				TrHs = true;
				qty = 0;
				while(loopkey("ArtCodeLoc",IHr,2,TrHs))begin
					if(IHr.ArtCode!=INr.Code or IHr.Location!=Locr.Code)then begin TrHs = false; end;

					if(TrHs and IHr.StockAffectf==1)then begin
						qty = qty + IHr.Qty;
						if(qty<0)then begin
							TrHs = false;
							startformat(15);
								outstring(0,0,IHr.ArtCode,false);
								outstring(0,0,IHr.FileName,false);
								outstring(0,0,IHr.TransNr,false);
								outstring(0,0,IHr.TransDate,false);
								outstring(0,0,IHr.SerNr,false);
							endformat;
						end;
					end;
				end;
				resetloop(IHr);
			end;
			resetloop(Locr);
		end;
	endjob;
	
return;
end;


global procedure SameBarCodesRn()		//Edit----------------------Dima  18.09.2015
begin
record INVc INr;
array string 30 samecodes;
String 30 prevCode;
integer i,k,step;

	StartReportNoHeaderJob("The same barcodes");
	
/*	
	While(LoopKey("BarCode",INr,1,true)) begin
	
					startformat(15);
						outstring(20,0,INr.Code,false);
						outstring(100,0,INr.BarCode,false);
						if (prevCode == INr.BarCode) then begin
								outstring(200,0,"SAME",false);
						end;
					endformat;
					prevCode = INr.BarCode;
	end;
*/	


	prevCode = "";
	step = 50;
	
	ReadFirstKey("BarCode",INr,1,true);
	prevCode = INr.BarCode;
	
	INr.BarCode = "";
	k=0;
	While(LoopKey("BarCode",INr,1,true)) begin
		if (prevCode==INr.BarCode and nonblank(INr.BarCode)) then begin
			samecodes[k] = INr.Code;
			k=k+1;
		end else begin	
			if (k>1) then begin
					startformat(15);
						outstring(20,0,prevCode,false);
					for(i=0;i<k;i=i+1) begin
						outstring(100+step*i,0,samecodes[i],false);
					end;
					endformat;
			end;
			
			samecodes[0] = INr.Code;
			k=1;
			prevCode = INr.BarCode;
		end;		
	end;
	
	EndJob;	
  
end;



function string 200 OutJWAttribute(string attribute)
begin
string 200 str;
	str = attribute;
	if (blank(attribute)) then begin
		str = " ";
	end;
OutJWAttribute = str;
return;
end;

	
global procedure AllJWAttributesRn(record RcVc RepSpec)
begin
	record INVc INr;

	
	StartReportNoHeaderJob("JW Attributes");
	
		startformat(15);
			outstring(0,0,"Item",false);
			outstring(0,0,"Metal",false);
			outstring(0,0,"Weight",false);
			outstring(0,0,"Size",false);
			outstring(0,0,"Length",false);
			outstring(0,0,"Collection",false);
			outstring(0,0,"Stone",false);
			outstring(0,0,"Colour",false);
			outstring(0,0,"Clarity",false);
			outstring(0,0,"Certificate",false);
			outstring(0,0,"Minor Stone",false);
			outstring(0,0,"Watch Brand",false);
			outstring(0,0,"Style",false);
			outstring(0,0,"Watch Metal",false);
			outstring(0,0,"Movement",false);
			outstring(0,0,"Bracelet",false);
			outstring(0,0,"watch colour",false);
			outstring(0,0,"durability",false);
			outstring(0,0,"Other",false);
		endformat;		
	
	
		//INr.Code = "";
	
		while(loopmain(INr,1,true)) begin
		
			
					startformat(15);
						outstring(0,0,OutJWAttribute(INr.Code),false);
						outstring(0,0,OutJWAttribute(INr.Metal),false);
						outstring(0,0,OutJWAttribute(INr.RowWeight),false);
						outstring(0,0,OutJWAttribute(INr.Size),false);
						outstring(0,0,OutJWAttribute(INr.Length),false);
						outstring(0,0,OutJWAttribute(INr.Reference),false);
						outstring(0,0,OutJWAttribute(INr.MajStoneDet),false);
						outstring(0,0,OutJWAttribute(INr.Colour),false);
						outstring(0,0,OutJWAttribute(INr.Clarity),false);
						outstring(0,0,OutJWAttribute(INr.Cert),false);
						outstring(0,0,OutJWAttribute(INr.MinStoneDet),false);
						outstring(0,0,OutJWAttribute(INr.WatchBrand),false);
						outstring(0,0,OutJWAttribute(INr.StyleName),false);
						outstring(0,0,OutJWAttribute(INr.WatchMetal),false);
						outstring(0,0,OutJWAttribute(INr.Movement),false);
						outstring(0,0,OutJWAttribute(INr.BrcStr),false);
						outstring(0,0,OutJWAttribute(INr.Gender),false);
						outstring(0,0,OutJWAttribute(INr.Other),false);
						outstring(0,0,OutJWAttribute(INr.Other2),false);												
												
					endformat;
	
					

		end;		
		
	EndJob;
	
end;





global function string 100 GetBrand(string artcode)		//Edit----------------------Dima  15.03.2016
begin
string 50 brand,classCode;
record INVc INr;
record DIVc DIr;
integer pos;

	brand = "";
	INr.Code = artcode;
	if (ReadFirstMain(INr,1,true)) then begin
		if (nonblank(INr.DispGroups)) then begin
			ExtractObj(INr.DispGroups,pos,classCode);
			while (NonBlank(classCode)) begin
			  DIr.Code = classCode;
			  if (readfirstmain(DIr,1,true)) then begin
			    if (DIr.CType=="Brand") then begin
			      brand = DIr.Name;
			      goto LbreakGetBrand;
			    end;
			  end;
			  ExtractObj(INr.DispGroups,pos,classCode);
			end;   
		end;
	end;
	
LbreakGetBrand:;	
GetBrand = brand;
return;
end;



function boolean  CheckInvoiceIsSpecial1_1(record IVVc IVr,var val subSum, var val loySum)
begin
row IVVc IVrw;
integer i;
boolean res;
	res = false;
	for(i=0;i<MatRowCnt(IVr);i=i+1) begin
		MatRowGet(IVr,i,IVrw);
		if (IVrw.stp==9) then begin			//Special offer 1+1
			res = true;
			i = MatRowCnt(IVr);
			subSum = IVrw.Sum;
			loySum = IVr.Sum4 - subSum;
		end;
	end; 

CheckInvoiceIsSpecial1_1 = res;
return;	 
end;



global procedure SpecialOffer1_1Rn(record RcVc RepSpec)		//Edit----------------------Dima  15.03.2016
begin
record IVVc IVr;
row IVVc IVrw;
integer rw,i;
val subSum,loySum,coef;
string 100 tstr,brand;
boolean TrHs,testf,loyaltyRows;
val totalSum,totalLoySum;
longint curtick;

	curtick = getcurtick();
	StartReportJob(USetStr(35074));	
  rw=1;
  Header(rw,USetStr(31102) & RepSpec.sStartDate & "-" & RepSpec.sEndDate,1);
  rw = rw + 1;
  HeaderLocations(RepSpec.f1,tstr);
  Header(rw,tstr,1);
  rw = rw + 1;  
  if(nonblank(RepSpec.f2)) then begin
  	Header(rw,USetStr(31226) & ": " & RepSpec.f2,1);
  	rw = rw + 1;	
  end;
	EndHeader;

	
	startformat(15);
	OutString(0,0,USetStr(35075),false);	//Inovoice
	OutString(30,0,USetStr(35076),false);	//date
	OutString(70,0,USetStr(35078),false);	//location
	OutString(100,0,USetStr(35077),false);//artcode
	OutString(150,0,USetStr(35084),false);//name
	OutString(260,0,USetStr(35079),false);//brand
	OutString(320,0,USetStr(31160),false);//cost
	OutString(360,0,USetStr(35080),false);//sum
	OutString(390,0,USetStr(35081),false);//loypoints
	OutString(430,0,USetStr(35082),false);//%
	OutString(460,0,USetStr(35083),false);//difference
	endformat;
	Black_Divider(0,1);
	
	TrHs = true;
	IVr.TransDate = RepSpec.sStartDate;
	While(LoopKey("TransDate",IVr,1,TrHs)) begin
		testf = true;
		if (IVr.TransDate > RepSpec.sEndDate) then begin TrHs = false; testf=false; end;
		if (nonblank(RepSpec.f1) and IVr.Location!=RepSpec.f1) then begin testf=false; end;
		if (CheckInvoiceIsSpecial1_1(IVr,subSum,loySum)==false) then begin testf = false; end;
		
		if (testf) then begin
			loyaltyRows = false;
  		for(i=0;i<MatRowCnt(IVr);i=i+1) begin
  			MatRowGet(IVr,i,IVrw);
  			brand = GetBrand(IVrw.ArtCode);
  			if (IVrw.stp==kInvoiceRowTypeNormal and loyaltyRows) then begin
  				if ((nonblank(RepSpec.f2) and RepSpec.f2==brand)  or blank(RepSpec.f2)) then begin
  			
  					coef = subSum/loySum;
  					if (coef>1) then begin coef = 1; end;
  					
  					startformat(15);
						OutString(0,0,IVr.SerNr,false);	
						OutString(30,0,IVr.TransDate,false);	
						OutString(70,0,IVr.Location,false);	
						OutString(100,0,IVrw.ArtCode,false);
						OutString(150,0,IVrw.Spec,false);
						OutString(260,0,GetBrand(IVrw.ArtCode),false);
						OutString(320,0,IVrw.FIFORowVal,false);
						OutString(360,0,IVrw.Sum,false);
						OutString(390,0,IVrw.Sum*coef,false);
						OutString(430,0,coef*100 & "%",false);
						OutString(460,0,IVrw.Sum-IVrw.Sum*coef,false);	
						endformat;
						
						totalSum = totalSum + IVrw.Sum;
						totalLoySum = totalLoySum + IVrw.Sum*coef;
  				end;
  			end;
  			
  			if (IVrw.stp==9) then begin 
  				loyaltyRows = true; 
  			end;	
			end;
		end;
	end;
	
	
	if (totalSum>0) then begin
		Black_Divider(0,1);
		OutString(0,0,"",false);
		OutString(0,0,"",false);
		OutString(0,0,"",false);
		OutString(0,0,"",false);
		OutString(0,0,"",false);
		OutString(280,0,USetStr(31211),false);
		OutString(350,0,totalSum,false);
		OutString(390,0,totalLoySum,false);
		OutString(430,0,"",false);
		OutString(460,0,totalSum-totalLoySum,false);
	end;		
	
	EndJob;
  LogProcTime("SpecialOffer1_1Rn",getcurtick() - curtick);
end;

global procedure GiftCertRn(record RcVc RepSpec)
begin
record GCVc GCr;
record GCSVc GCSr;
record GCRVc GCRr;
record IVVc IVr;
integer i,comp,curcomp;
row IVVc IVrw;
boolean okflag;	
longint curtick;
		
	curtick = getcurtick();
	curcomp=CurrentCompany;
	startreportnoheaderjob("ò÷åò ïî ïîäàðî÷íûì ñåðòèôèêàòàì");
		startformat(15);
			outstring(0,0,"îäàðî÷íûå ñåðòèôèêàòû âûïóùåííûå",false);
		endformat;
		startformat(15);
			outstring(0,0,"îìåð â õàíñå",false);
			outstring(0,0,"àòà ñîçäàíèß",false);
			outstring(0,0,"óììà",false);
			outstring(0,0,"àãàçèí",false);
			outstring(0,0,"ðîê äåéñòâèß",false);
			outstring(0,0,"OK Flag",false);
			outstring(0,0,"àêðûò",false);
			outstring(0,0,"òðèõêîä",false);
		endformat;
		while(loopmain(GCr,1,true))begin
			startformat(15);
			outstring(0,0,GCr.SerNr,false);
			outstring(0,0,GCr.TransDate,false);
			outstring(0,0,GCr.Amount,false);
			outstring(0,0,GCr.Comment,false);
			outstring(0,0,GCr.ExpiryDate,false);
			outstring(0,0,GCr.OKFlag,false);
			outstring(0,0,GCr.Closed,false);
			outstring(0,0,GCr.BarCode,false);
		endformat;
		end;
		
		startformat(15);
		endformat;
		startformat(15);
			outstring(0,0,"îäàðî÷íûå ñåðòèôèêàòû ïðîäàííûå",false);
		endformat;
		startformat(15);
			outstring(0,0,"îìåð â õàíñå",false);
			outstring(0,0,"àòà",false);
			outstring(0,0,"óììà",false);
			outstring(0,0,"àãàçèí",false);
			outstring(0,0,"ðîê äåéñòâèß",false);
			outstring(0,0,"àêðûò",false);
			outstring(0,0,"îìåð ñ÷/ô",false);
			outstring(0,0,"òðèõêîä",false);
			outstring(0,0,"ñòàòîê",false);
			outstring(0,0,"àãàçèí",false);
		endformat;
		while(loopmain(GCSr,1,true))begin
			startformat(15);
			outstring(0,0,GCSr.SerNr,false);
			outstring(0,0,GCSr.TransDate,false);
			outstring(0,0,GCSr.Amount,false);
			outstring(0,0,GCSr.Comment,false);
			outstring(0,0,GCSr.ExpiryDate,false);
			outstring(0,0,GCSr.Closed,false);
			outstring(0,0,GCSr.InvSerNr,false);
			outstring(0,0,GCSr.BarCode,false);
			outstring(0,0,GCSr.Balance,false);
			for(comp=1;comp<29;comp=comp+1) begin
				SetCompany(comp,false);
				IVr.SerNr = GCSr.InvSerNr;
			
				readfirstmain(IVr,1,true);
				okflag=false;
				for(i=0;i<MatRowCnt(IVr);i=i+1) begin
					MatRowGet(IVr,i,IVrw);
					if(IVrw.stp==kInvoiceRowTypeGiftVoucherSold AND GCSr.SerNr==IVrw.GCNr) then begin
						outstring(0,0,IVr.Location,false);
						goto ENDLOOPFORCOMP;
					end;	
				end;
			end;	
			ENDLOOPFORCOMP:;
			SetCompany(curcomp,false);
			endformat;
		end;
		
		startformat(15);
		endformat;
		startformat(15);
			outstring(0,0,"îäàðî÷íûå ñåðòèôèêàòû ïîëó÷åííûå",false);
		endformat;
		startformat(15);
			outstring(0,0,"Ü",false);
			outstring(0,0,"àòà",false);
			outstring(0,0,"îìèíàë",false);
			outstring(0,0,"óììà îáíàëè÷èâàíèß",false);
			outstring(0,0,"àãàçèí",false);
			outstring(0,0,"òðèõêîä",false);
			outstring(0,0,"îìåð ñ÷/ô",false);
			outstring(0,0,"îìåð ïðîäàííîãî ",false);
			outstring(0,0,"àãàçèí",false);
			outstring(0,0,"óììà ÷åêà",false);
			outstring(0,0,"àëþòà",false);
		endformat;
		endformat;
		while(loopmain(GCRr,1,true))begin
			startformat(15);
			outstring(0,0,GCRr.SerNr,false);
			outstring(0,0,GCRr.TransDate,false);
			GCr.SerNr = GCRr.GCSSerNr;
			readfirstmain(GCr,1,true);
			outstring(0,0,GCr.Amount,false);// Edit ************************** BPI Ukraine - KramarAlexandr - 05, 08 06 2018 y. î 23:09:33
			outstring(0,0,GCRr.Amount,false);
			outstring(0,0,GCRr.Comment,false);
			outstring(0,0,GCRr.BarCode,false);
			outstring(0,0,GCRr.InvSerNr,false);
			outstring(0,0,GCRr.GCSSerNr,false);
			IVr.SerNr = GCRr.InvSerNr;
			readfirstmain(IVr,1,true);
			outstring(0,0,IVr.Location,false);
			outstring(0,0,IVr.Sum4,false);
			outstring(0,0,IVr.CurncyCode,false);
		endformat;
		end;
	endjob;
	LogProcTime("GiftCertRn",getcurtick() - curtick);
return;
end;


global procedure GlobSertStatRn(record RcVc RepSpec)
begin
	record GlobalGiftVaucherVc GGVr;
	row GlobalGiftVaucherVc GGVrw;
	integer mtrw,i;
	record CompaniesBlock Compb;
  row CompaniesBlock Comprw;
  string 255 compname;
  longint curtick;
	
	curtick = getcurtick();
  blockload(Compb);
	
	startreportnoheaderjob("íôîðìàöèß ïî âàó÷åðó");
		if(nonblank(RepSpec.f1))then begin
			GGVr.BarCode = RepSpec.f1;
			if(readfirstkey("BarCode",GGVr,1,true))then begin
				startformat(15);
					outstring(0,0,"òðèõêîä:",false);
					outstring(100,0,GGVr.BarCode,false);
				endformat;
				startformat(15);
					outstring(0,0,"àòà ñîçäàíèß:",false);
					outstring(100,0,GGVr.CreateDate,false);
				endformat;
				startformat(15);
					outstring(0,0,"àòà ïðîäàæè:",false);
					outstring(100,0,GGVr.StartDate,false);
				endformat;
				startformat(15);
					outstring(0,0,"åêóùèé áàëàíñ:",false);
					outstring(100,0,GGVr.Bal,false);
				endformat;
				startformat(15);
					outstring(0,0,"çíà÷àëüíûé áàëàíñ:",false);
					outstring(100,0,GGVr.TotBalance,false);
				endformat;
				
				startformat(15);
					outstring(0,0,"ñòîðèß",false);
				endformat;
				startformat(15);
					outstring(0,0,"îìàíèß",false);
					outstring(100,0,"÷/ô",false);
					outstring(200,0,"óììà",false);
				endformat;
				
				Gray_Divider(0,1);
				mtrw = matrowcnt(GGVr);
				for(i=0;i<mtrw;i=i+1)begin
					matrowget(GGVr,i,GGVrw);
				
					compname = "";
					if(GGVrw.CompNr>0 and GGVrw.CompNr<=matrowcnt(Compb))then begin
						matrowget(Compb,GGVrw.CompNr-1,Comprw);
						compname = Comprw.CompName;
					end;
										
					startformat(15);
						outstring(0,0,compname,false);
						outstring(100,0,GGVrw.InvoiceNr,false);
						outstring(200,0,GGVrw.Sum,false);
					endformat;
				end;
				
			end;
		end;
	endjob;
	LogProcTime("GlobSertStatRn",getcurtick() - curtick);
return;
end;


global procedure TestCUDatesRn(record RcVc RepSpec)
begin
	Record CUVc CUr;
	integer mtrw,i;
	record CompaniesBlock Compb;
  row CompaniesBlock Comprw;
  string 255 compname;
  longint curtick;
	
	curtick = getcurtick();
  blockload(Compb);
	
	startreportnoheaderjob("àòû");
		mtrw = matrowcnt(Compb);
		
		startformat(15);
			outstring(0,0,"CustCode",false);
			outstring(0,0,"Company",false);
			outstring(0,0,"DateChanged",false);
			outstring(0,0,"DateCreated",false);
			outstring(0,0,"UserDate1",false);
			outstring(0,0,"UserDate1",false);
			outstring(0,0,"UserDate3",false);
			outstring(0,0,"BirthDate",false);
			outstring(0,0,"VisaExpiry",false);
			outstring(0,0,"VATNrCheckDate",false);
			outstring(0,0,"BirthRebateLastDate",false);
			outstring(0,0,"WedDate",false);
			outstring(0,0,"SuprDate",false);
		endformat;
		
		for(i=1;i<mtrw+1;i=i+1)begin
			setcompany(i,false);
			
			if(i==1 or i==10)then begin
				CUr.Code = "";
				while(loopmain(CUr,1,true))begin
					startformat(15);
						outstring(0,0,CUr.Code,false);
						outstring(0,0,i+1,false);
						outstring(0,0,CUr.DateChanged,false);
						outstring(0,0,CUr.DateCreated,false);
						outstring(0,0,CUr.UserDate1,false);
						outstring(0,0,CUr.UserDate1,false);
						outstring(0,0,CUr.UserDate3,false);
						outstring(0,0,CUr.BirthDate,false);
						outstring(0,0,CUr.VisaExpiry,false);
						outstring(0,0,CUr.VATNrCheckDate,false);
						outstring(0,0,CUr.BirthRebateLastDate,false);
						outstring(0,0,CUr.WedDate,false);
						outstring(0,0,CUr.SuprDate,false);
					endformat;
				end;	
				resetloop(CUr);
			end;
			
		end;
		
	endjob;
	LogProcTime("TestCUDatesRn",getcurtick() - curtick);
return;
end;

global updating procedure ItemsBrendGRn()
begin
record BPIBrandVc BBr;
vector string 100 vbrand;
vector string 100 vgrp;
record INVc INr;
record ITVc ITr;
integer CompQty,i,OldComp;
record CompaniesBlock Compb;
row CompaniesBlock Comprw;
boolean TrHs,testf;

startreportnoheaderjob("îâàðû");
		
		startformat(15);
			outstring(0,0,"îìïàíèß",false);
			outstring(0,0,"êîä òîâàðà",false);
			outstring(0,0,"ãðóïà",false);
			outstring(0,0,"áðåíä",false);
		endformat;	
TrHs=true;
BBr.Code="";
while(LoopMain(BBr,1,TrHs)) begin
	vbrand[BBr.Code]=BBr.Name;
end;	

CompQty = 28;
OldComp = CurrentCompany;
BlockLoad(Compb);
	for (i=1;i<CompQty;i=i+1)begin
		matrowget(Compb,i+1,Comprw);
		if(Comprw.ActiveStatus==0)then begin
			SetCompany(i+1,false);
			ITr.Code="";
			TrHs=true;
			while(LoopMain(ITr,1,TrHs)) begin
				vgrp[ITr.Code]=ITr.Comment;
			end;
			ResetLoop(ITr);
			INr.Code="";
			TrHs=true;
			while(LoopMain(INr,1,TrHs)) begin
				testf = true;
				If(nonblank(INr.BPIBrand) And vgrp[INr.Group] != vbrand[INr.BPIBrand]) then begin
					If(vgrp[INr.Group] == "GLASHUTTE" and vbrand[INr.BPIBrand]== "GLASHUTTE ORIGINAL") then begin testf=false; end;
					If(vgrp[INr.Group] == "LÕEPEE" and vbrand[INr.BPIBrand]== "L'EPEE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Carrera Carrera" and vbrand[INr.BPIBrand]== "CARRERA Y CARRERA" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Zancan Silver/Steel" and vbrand[INr.BPIBrand]== "Zancan" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "LALIQUE PARFUME REGULAR" and vbrand[INr.BPIBrand]== "LALIQUE PARFUME" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Stephen Webster Silver" and vbrand[INr.BPIBrand]== "STEPHEN WEBSTER" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "SHAUNLEANE" and vbrand[INr.BPIBrand]== "SHAUN LEANE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "SIA Home Fashion" and vbrand[INr.BPIBrand]== "SIA HOME" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "ALEXANDRE TURPAULT(àõðà)" and vbrand[INr.BPIBrand]== "ALEXANDRE TURPAULT" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "ALEXANDRE TURPAULT(ïîêðûâàëî)" and vbrand[INr.BPIBrand]== "ALEXANDRE TURPAULT" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "ALEXANDRE TURPAULT(îñòåëü)" and vbrand[INr.BPIBrand]== "ALEXANDRE TURPAULT" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Andrea-house" and vbrand[INr.BPIBrand]== "ANDREA HOUSE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "ANVERSA(àêñåññóàðû)" and vbrand[INr.BPIBrand]== "ANDREA HOUSE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "ANVERSA(äåêîðàòèâíûå ïîäóøêè)" and vbrand[INr.BPIBrand]== "ANVERSA" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Antonini" and vbrand[INr.BPIBrand]== "ALEXANDRE TURPAULT" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "ALEXANDRE TURPAULT(àõðà)" and vbrand[INr.BPIBrand]== "ANVERSA" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "ANVERSA(ìàõðà)" and vbrand[INr.BPIBrand]== "ANVERSA" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "ANVERSA(îäåßëà)" and vbrand[INr.BPIBrand]== "ANVERSA" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "ANVERSA(ïîäóøêè)" and vbrand[INr.BPIBrand]== "ANVERSA" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "ANVERSA(ñêàòåðòè)" and vbrand[INr.BPIBrand]== "ANVERSA" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Apm ART DECO" and vbrand[INr.BPIBrand]== "APM MONACO" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Apm GRAPHITE" and vbrand[INr.BPIBrand]== "APM MONACO" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Apm LUMIERE" and vbrand[INr.BPIBrand]== "APM MONACO" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Apm XL" and vbrand[INr.BPIBrand]== "APM MONACO" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Aquanova (Terry)" and vbrand[INr.BPIBrand]== "AQUANOVA" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Aquanova (Accessories)" and vbrand[INr.BPIBrand]== "AQUANOVA" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "BACCARAT BARWARE" and vbrand[INr.BPIBrand]== "BACCARAT" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "BACCARAT BEAUTY" and vbrand[INr.BPIBrand]== "BACCARAT" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "BACCARAT CUT STEMWARE" and vbrand[INr.BPIBrand]== "BACCARAT" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "BACCARAT DECORATIVE ITEMS" and vbrand[INr.BPIBrand]== "BACCARAT" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "BACCARAT DECORATIVE PIECES" and vbrand[INr.BPIBrand]== "BACCARAT" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "BACCARAT DESK ITEMS" and vbrand[INr.BPIBrand]== "BACCARAT" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "BACCARAT JEWELLERY" and vbrand[INr.BPIBrand]== "BACCARAT" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "BACCARAT LIGHTS" and vbrand[INr.BPIBrand]== "BACCARAT" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "BACCARAT LIMITED EDITIONS" and vbrand[INr.BPIBrand]== "BACCARAT" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "BACCARAT PITCHER,JUGS,BOTTLES" and vbrand[INr.BPIBrand]== "BACCARAT" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "BACCARAT REPLACEMENT STEMWARE" and vbrand[INr.BPIBrand]== "BACCARAT" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "BACCARAT TABLEWARE SUNDRIES" and vbrand[INr.BPIBrand]== "BACCARAT" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "BEKA LOW COST" and vbrand[INr.BPIBrand]== "BEKA" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "BERNARDAUD GIFT" and vbrand[INr.BPIBrand]== "BERNARDAUD" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "BERNARDAUD PORCELAIN" and vbrand[INr.BPIBrand]== "BERNARDAUD" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "BERNARDAUD JEWELLERY" and vbrand[INr.BPIBrand]== "BERNARDAUD" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Bodum for Coin" and vbrand[INr.BPIBrand]== "BODUM" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "BOSS(ìàõðà)" and vbrand[INr.BPIBrand]== "BOSS" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "BOSS(ïîñòåëü)" and vbrand[INr.BPIBrand]== "BOSS" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "BRABANTIA KITCHEN" and vbrand[INr.BPIBrand]== "BRABANTIA" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "BRABANTIA LOW COST" and vbrand[INr.BPIBrand]== "BRABANTIA" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Brabantiya" and vbrand[INr.BPIBrand]== "BRABANTIA" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Buckley Accessories" and vbrand[INr.BPIBrand]== "BUCKLEY LONDON" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Buckley BOHO" and vbrand[INr.BPIBrand]== "BUCKLEY LONDON" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Buckley Rock" and vbrand[INr.BPIBrand]== "BUCKLEY LONDON" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Buckley romantic" and vbrand[INr.BPIBrand]== "BUCKLEY LONDON" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Buckley Timeless" and vbrand[INr.BPIBrand]== "BUCKLEY LONDON" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "BUGATTI LUXURY" and vbrand[INr.BPIBrand]== "BUGATTI" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Calvin Klein (ìàõðà)" and vbrand[INr.BPIBrand]== "CALVIN KLEIN" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Calvin Klein (ïîñòåëü)" and vbrand[INr.BPIBrand]== "CALVIN KLEIN" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Calvin Klein (ýêïîçèöèß)" and vbrand[INr.BPIBrand]== "CALVIN KLEIN" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "CHRISTOFLE (êñåññóàðû)" and vbrand[INr.BPIBrand]== "CHRISTOFLE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "CHRISTOFLE (ðèáîðû)" and vbrand[INr.BPIBrand]== "CHRISTOFLE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "CHRISTOFLE (òåêëî)" and vbrand[INr.BPIBrand]== "CHRISTOFLE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "CHRISTOFLE (àðôîð)" and vbrand[INr.BPIBrand]== "CHRISTOFLE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "CINELLI (Duvets)" and vbrand[INr.BPIBrand]== "CINELLI" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "CINELLI (Pillows)" and vbrand[INr.BPIBrand]== "CINELLI" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Cofur aht" and vbrand[INr.BPIBrand]== "COFUR" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Cogal Robe" and vbrand[INr.BPIBrand]== "COGAL" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "DEKORATIEF  LOW COST" and vbrand[INr.BPIBrand]== "DEKORATIEF" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "DESCAMPS()" and vbrand[INr.BPIBrand]== "DESCAMPS" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "DESCAMPS(äåòñêîå)" and vbrand[INr.BPIBrand]== "DESCAMPS" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "DESCAMPS(ìàõðà)" and vbrand[INr.BPIBrand]== "DESCAMPS" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "DESCAMPS(ïîäóøêè)" and vbrand[INr.BPIBrand]== "DESCAMPS" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "DESCAMPS(ïîñòåëü))" and vbrand[INr.BPIBrand]== "DESCAMPS" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "DIBBERN Porcelain" and vbrand[INr.BPIBrand]== "DIBBERN" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "DONDI SVAD (äåêîðîòèâíûå ïîäóøêè)" and vbrand[INr.BPIBrand]== "SVAD DONDI" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "DONDI SVAD (äåòñêîå  ìàõðà)" and vbrand[INr.BPIBrand]== "SVAD DONDI" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "DONDI SVAD (äåòñêîå  ïîñòåëü)" and vbrand[INr.BPIBrand]== "SVAD DONDI" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "DONDI SVAD (ìàõðà)" and vbrand[INr.BPIBrand]== "SVAD DONDI" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "DONDI SVAD (ïîñòåëü)" and vbrand[INr.BPIBrand]== "SVAD DONDI" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "DONDI SVAD (ñêàòåðòè)" and vbrand[INr.BPIBrand]== "SVAD DONDI" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "DONDI SVAD (Specail offer)" and vbrand[INr.BPIBrand]== "SVAD DONDI" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Dupon" and vbrand[INr.BPIBrand]== "Dupont" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "EDG Accessories" and vbrand[INr.BPIBrand]== "EDG" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "EDG FLOWERS" and vbrand[INr.BPIBrand]== "EDG" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Egizia Promo" and vbrand[INr.BPIBrand]== "EGIZIA" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Fischbacher (ìàõðà)" and vbrand[INr.BPIBrand]== "CHRISTIAN FISCHBACHER" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Fischbacher ()" and vbrand[INr.BPIBrand]== "CHRISTIAN FISCHBACHER" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Fischbacher (ïîäóøêè)" and vbrand[INr.BPIBrand]== "CHRISTIAN FISCHBACHER" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Fischbacher (ïîñòåëü)" and vbrand[INr.BPIBrand]== "CHRISTIAN FISCHBACHER" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "FFRETTE()" and vbrand[INr.BPIBrand]== "FRETTE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "FRETTE()" and vbrand[INr.BPIBrand]== "FRETTE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "FRETTE( )" and vbrand[INr.BPIBrand]== "FRETTE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "FRETTE()" and vbrand[INr.BPIBrand]== "FRETTE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "FRETTE()" and vbrand[INr.BPIBrand]== "FRETTE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "FRETTE(îñòåëü)" and vbrand[INr.BPIBrand]== "FRETTE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "GLASHUTTE" and vbrand[INr.BPIBrand]== "GLASHUTTE ORIGINAL" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "GREGGIO ARGENTO CORNICA" and vbrand[INr.BPIBrand]== "GREGGIO" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "GREGGIO CESA ACCESSORIES" and vbrand[INr.BPIBrand]== "GREGGIO" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "GREGGIO CESA CUTLERY" and vbrand[INr.BPIBrand]== "GREGGIO" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "GREGGIO DOGALE ACCESSORIES" and vbrand[INr.BPIBrand]== "GREGGIO" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "GREGGIO GREGGIO ACCESSORIES" and vbrand[INr.BPIBrand]== "GREGGIO" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "GREGGIO GREGGIO CUTLERY" and vbrand[INr.BPIBrand]== "GREGGIO" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "GREGGIO LOVELIES ACCESSORIES" and vbrand[INr.BPIBrand]== "GREGGIO" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "GREGGIO MASSINI ACCESSORIES" and vbrand[INr.BPIBrand]== "GREGGIO" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "GREGGIO OLRY ACCESSORIES" and vbrand[INr.BPIBrand]== "GREGGIO" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "GREGGIO OLRY CUTLERY" and vbrand[INr.BPIBrand]== "GREGGIO" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "GREGGIO ROYAL COLLECTION" and vbrand[INr.BPIBrand]== "GREGGIO" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "GREGGIO SILVERPLATE" and vbrand[INr.BPIBrand]== "GREGGIO" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "GREGGIO SILVERPLATE CUTLERY" and vbrand[INr.BPIBrand]== "GREGGIO" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "HEREND(êñåññóàðû)" and vbrand[INr.BPIBrand]== "HEREND" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "HAVILAND TABLEWARE" and vbrand[INr.BPIBrand]== "HAVILAND" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "GUZZINI FORME CASA" and vbrand[INr.BPIBrand]== "GUZZINI" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "HEREND(àðôîð)" and vbrand[INr.BPIBrand]== "HEREND" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "HEREND(èãóðêè)" and vbrand[INr.BPIBrand]== "HEREND" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "HERING ACCESSORIES" and vbrand[INr.BPIBrand]== "HEREND" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "HERING GLASSES" and vbrand[INr.BPIBrand]== "HEREND" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "HERING PORCELAIN" and vbrand[INr.BPIBrand]== "HEREND" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "HOMMERS" and vbrand[INr.BPIBrand]== "HOMERS" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "HOMMERS DS" and vbrand[INr.BPIBrand]== "HOMERS" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "IVV EVERYDAY" and vbrand[INr.BPIBrand]== "IVV" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "IVV Novelties " and vbrand[INr.BPIBrand]== "IVV" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "IVV POS" and vbrand[INr.BPIBrand]== "IVV" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "IVV PROMO" and vbrand[INr.BPIBrand]== "IVV" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "JAIMIES discounted" and vbrand[INr.BPIBrand]== "JAIMIES" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Jalla(ìàõðà)" and vbrand[INr.BPIBrand]== "JALLA" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Jalla(îäåßëà)" and vbrand[INr.BPIBrand]== "JALLA" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Jalla(ïîäóøêè)" and vbrand[INr.BPIBrand]== "JALLA" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Jalla(ïîñòåëü)" and vbrand[INr.BPIBrand]== "JALLA" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "JARDIN SECRET(ìàõðà)" and vbrand[INr.BPIBrand]== "JARDIN SECRET" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "JARDIN SECRET(ïîñòåëü)" and vbrand[INr.BPIBrand]== "JARDIN SECRET" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "JUDITH RIPKA SILVER" and vbrand[INr.BPIBrand]== "JUDITH RIPKA" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Kaiser Gourmet" and vbrand[INr.BPIBrand]== "KAISER" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "KARE Accessories" and vbrand[INr.BPIBrand]== "KARE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "KARE Furniture" and vbrand[INr.BPIBrand]== "KARE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "KARE Price Hero" and vbrand[INr.BPIBrand]== "KARE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Kate International Down production" and vbrand[INr.BPIBrand]== "KATE INTERNATIONAL" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Kate International Textile" and vbrand[INr.BPIBrand]== "KATE INTERNATIONAL" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Katrine Leuze" and vbrand[INr.BPIBrand]== "KATRIN LEUZE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Kauffman" and vbrand[INr.BPIBrand]== "KAUFFMANN" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "kauffman Duvet" and vbrand[INr.BPIBrand]== "KAUFFMANN" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "kauffman Pillow" and vbrand[INr.BPIBrand]== "KAUFFMANN" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "LA JACUARD FRANCAIS" and vbrand[INr.BPIBrand]== "LE JACQUARD" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "LALIQUE GENERAL" and vbrand[INr.BPIBrand]== "LALIQUE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "LALIQUE JEWELERY" and vbrand[INr.BPIBrand]== "LALIQUE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "LALIQUE PARFUME JAQUAR" and vbrand[INr.BPIBrand]== "LALIQUE PARFUME" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "LALIQUE PARFUME REGULAR" and vbrand[INr.BPIBrand]== "LALIQUE PARFUME" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "LALIQUE PARFUME CRYSTAL" and vbrand[INr.BPIBrand]== "LALIQUE PARFUME" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "LE_CREUSET_CAST" and vbrand[INr.BPIBrand]== "LE CREUSET" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "LE_CREUSET_CERA" and vbrand[INr.BPIBrand]== "LE CREUSET" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "LE_CREUSET_KET" and vbrand[INr.BPIBrand]== "LE CREUSET" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "LE_CREUSET_MIL" and vbrand[INr.BPIBrand]== "LE CREUSET" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "LE_CREUSET_STON" and vbrand[INr.BPIBrand]== "LE CREUSET" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "LENOX ACCESSORIES" and vbrand[INr.BPIBrand]== "LENOX" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "LENOX BUTTERFLY MEDOW" and vbrand[INr.BPIBrand]== "LENOX" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "LENOX CRYSTAL" and vbrand[INr.BPIBrand]== "LENOX" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "LENOX DISNEY" and vbrand[INr.BPIBrand]== "LENOX" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "LENOX NEW YEAR" and vbrand[INr.BPIBrand]== "LENOX" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "LENOX TABLEWARE" and vbrand[INr.BPIBrand]== "LENOX" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Louis De poortere" and vbrand[INr.BPIBrand]== "LOUIS DE POORTERE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Luxenter EDURNE" and vbrand[INr.BPIBrand]== "LUXENTER" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Luxenter HAPPY GEMS" and vbrand[INr.BPIBrand]== "LUXENTER" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Luxenter MOMENTS" and vbrand[INr.BPIBrand]== "LUXENTER" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Luxenter SILVER" and vbrand[INr.BPIBrand]== "LUXENTER" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "MILLEFIORI  MILLEFIORI" and vbrand[INr.BPIBrand]== "MILLEFIORI" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Misaki CULTURED GOLD" and vbrand[INr.BPIBrand]== "MISAKI" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Misaki CULTURED RHODIUM" and vbrand[INr.BPIBrand]== "MISAKI" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Misaki CULTURED ROSE GOLD" and vbrand[INr.BPIBrand]== "MISAKI" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Misaki HAND MADE GLASS PEARLS GOLD" and vbrand[INr.BPIBrand]== "MISAKI" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Misaki HAND MADE GLASS PEARLS RHODIUM" and vbrand[INr.BPIBrand]== "MISAKI" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Misaki HAND MADE GLASS PEARLS ROSE GOLD" and vbrand[INr.BPIBrand]== "MISAKI" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Misaki HAND MADE GLASS PEARLS STEEL" and vbrand[INr.BPIBrand]== "MISAKI" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "MOSER ARMUDU" and vbrand[INr.BPIBrand]== "MOSER" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "MOSER BAKU" and vbrand[INr.BPIBrand]== "MOSER" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "MOSER CRYSTAL SETS" and vbrand[INr.BPIBrand]== "MOSER" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "MOSER VASES&ACCESSORIES" and vbrand[INr.BPIBrand]== "MOSER" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "NINA RICCI(àõðà)" and vbrand[INr.BPIBrand]== "NINA RICCI" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "NINA RICCI(îñòåëü)" and vbrand[INr.BPIBrand]== "NINA RICCI" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "PLAUENER (îäåßëà)" and vbrand[INr.BPIBrand]== "PLAUENER" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "PLAUENER (ïîäóøêè)" and vbrand[INr.BPIBrand]== "PLAUENER" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "PLAUENER (ïîñòåëü)" and vbrand[INr.BPIBrand]== "PLAUENER" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "RALPH LAUIREN HOME()" and vbrand[INr.BPIBrand]== "RALPH LAUREN HOME" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "RALPH LAUREN HOME()" and vbrand[INr.BPIBrand]== "RALPH LAUREN HOME" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "RALPH LAUREN HOME()" and vbrand[INr.BPIBrand]== "RALPH LAUREN HOME" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "RALPH LAUREN HOME(åêîðàòèâíûå ïîäóøêè)" and vbrand[INr.BPIBrand]== "RALPH LAUREN HOME" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Raulph Lauren îáùèé" and vbrand[INr.BPIBrand]== "RALPH LAUREN HOME" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "ROBB&BERKING ACCESSORIES" and vbrand[INr.BPIBrand]== "ROBBE BERKING" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "ROBB&BERKING CUTLERY" and vbrand[INr.BPIBrand]== "ROBBE BERKING" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Rosenthal (êñåññóàðû)" and vbrand[INr.BPIBrand]== "ROSENTHAL" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Rosenthal (òåêëî)" and vbrand[INr.BPIBrand]== "ROSENTHAL" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Rosenthal Studio-Line (êñåññóàðû)" and vbrand[INr.BPIBrand]== "ROSENTHAL" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Rosenthal Studio-Line (òåêëî)" and vbrand[INr.BPIBrand]== "ROSENTHAL" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Rosenthal Studio-Line (àðôîð)" and vbrand[INr.BPIBrand]== "ROSENTHAL" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Sambonet Kids " and vbrand[INr.BPIBrand]== "SAMBONET" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Sambonet promo" and vbrand[INr.BPIBrand]== "SAMBONET" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Schlossberg (ìàõðà)" and vbrand[INr.BPIBrand]== "SCHLOSSBERG" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Schlossberg ()" and vbrand[INr.BPIBrand]== "SCHLOSSBERG" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Schlossberg ()" and vbrand[INr.BPIBrand]== "SCHLOSSBERG" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Schlossberg (ïîñòåëü)" and vbrand[INr.BPIBrand]== "SCHLOSSBERG" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Schlossberg (classic)" and vbrand[INr.BPIBrand]== "SCHLOSSBERG" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Schlossberg (Special Offer)" and vbrand[INr.BPIBrand]== "SCHLOSSBERG" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "SCHOTT ZWIESEL POS" and vbrand[INr.BPIBrand]== "SCHOTT ZWIESEL" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "SCHOTT ZWIESEL PROMO" and vbrand[INr.BPIBrand]== "SCHOTT ZWIESEL" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Schott Zwiesl Promo" and vbrand[INr.BPIBrand]== "SCHOTT ZWIESEL" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "SIA HOME FASHION" and vbrand[INr.BPIBrand]== "SIA HOME" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "SIA Home Fashion" and vbrand[INr.BPIBrand]== "SIA HOME" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Somma throws" and vbrand[INr.BPIBrand]== "SOMMA" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Stephen Webster Silver" and vbrand[INr.BPIBrand]== "STEPHEN WEBSTER" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Svad Dondi Bedcovers" and vbrand[INr.BPIBrand]== "SVAD DONDI" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Svad Dondi Textile" and vbrand[INr.BPIBrand]== "SVAD DONDI" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Thomas Sabo Charm Club" and vbrand[INr.BPIBrand]== "THOMAS SABO" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Thomas Sabo Sterling Silver" and vbrand[INr.BPIBrand]== "THOMAS SABO" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "TOMMY HILFIGER(ìàõðà)" and vbrand[INr.BPIBrand]== "TOMMY HILFIGER" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "TOMMY HILFIGER(ïîñòåëü)" and vbrand[INr.BPIBrand]== "TOMMY HILFIGER" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "TVS LOW COST" and vbrand[INr.BPIBrand]== "TVS" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "VAN_REMORT" and vbrand[INr.BPIBrand]== "VAN REMORTEL" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Versace (êñåññóàðû)" and vbrand[INr.BPIBrand]== "VERSACE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Versace (ðèáîðû)" and vbrand[INr.BPIBrand]== "VERSACE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Versace (òåêëî)" and vbrand[INr.BPIBrand]== "VERSACE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Versace (àðôîð)" and vbrand[INr.BPIBrand]== "VERSACE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "VILLEROY & BOCH Accessories" and vbrand[INr.BPIBrand]== "VILLEROY & BOCH" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "VILLEROY & BOCH Christmas" and vbrand[INr.BPIBrand]== "VILLEROY & BOCH" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "VILLEROY & BOCH Classic" and vbrand[INr.BPIBrand]== "VILLEROY & BOCH" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "VILLEROY & BOCH Country" and vbrand[INr.BPIBrand]== "VILLEROY & BOCH" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "VILLEROY & BOCH Cutlery" and vbrand[INr.BPIBrand]== "VILLEROY & BOCH" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "VILLEROY & BOCH Home Decor" and vbrand[INr.BPIBrand]== "VILLEROY & BOCH" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "VILLEROY & BOCH Kids" and vbrand[INr.BPIBrand]== "VILLEROY & BOCH" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "VILLEROY & BOCH Metropolitan" and vbrand[INr.BPIBrand]== "VILLEROY & BOCH" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "VILLEROY & BOCH Stemware" and vbrand[INr.BPIBrand]== "VILLEROY & BOCH" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "WEDGWOOD GIFTS&ACCESSORIES" and vbrand[INr.BPIBrand]== "WEDGWOOD" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "WEISSFEE GUESTBOOK " and vbrand[INr.BPIBrand]== "WEDGWOOD" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Weissfee bedlinen" and vbrand[INr.BPIBrand]== "WEISSFEE " ) then begin testf=false; end;
					If(vgrp[INr.Group] == "WEISSFEE NAPKIN" and vbrand[INr.BPIBrand]== "WEISSFEE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "WEISSFEE PLACEMAT" and vbrand[INr.BPIBrand]== "WEISSFEE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "WEISSFEE TABLECENTER" and vbrand[INr.BPIBrand]== "WEISSFEE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "WEISSFEE TABLECLOTH" and vbrand[INr.BPIBrand]== "WEISSFEE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Weissfee terry" and vbrand[INr.BPIBrand]== "WEISSFEE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "WMF Accessories" and vbrand[INr.BPIBrand]== "WMF" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "WMF Bistro" and vbrand[INr.BPIBrand]== "WMF" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "WMF Black Line" and vbrand[INr.BPIBrand]== "WMF" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "WMF COFFEE MACHINES" and vbrand[INr.BPIBrand]== "WMF" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "WMF Consumer electrics" and vbrand[INr.BPIBrand]== "WMF" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "WMF Cookware" and vbrand[INr.BPIBrand]== "WMF" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "WMF Cutlery" and vbrand[INr.BPIBrand]== "WMF" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "WMF Frying pans" and vbrand[INr.BPIBrand]== "WMF" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "WMF HOTEL" and vbrand[INr.BPIBrand]== "WMF" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "WMF Kettles" and vbrand[INr.BPIBrand]== "WMF" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "WMF Kids" and vbrand[INr.BPIBrand]== "WMF" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "WMF Knives" and vbrand[INr.BPIBrand]== "WMF" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "WMF Pressure cookers" and vbrand[INr.BPIBrand]== "WMF" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "WMF Profi" and vbrand[INr.BPIBrand]== "WMF" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "WMF Tea pots" and vbrand[INr.BPIBrand]== "WMF" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "y.Delorme îáùèé" and vbrand[INr.BPIBrand]== "YVES DELORME" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "YANKEE CANDLE  CLASSIC COLLECTION" and vbrand[INr.BPIBrand]== "YANKEE CANDLE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "YANKEE CANDLE ACCESSORIES" and vbrand[INr.BPIBrand]== "YANKEE CANDLE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "YANKEE CANDLE POS" and vbrand[INr.BPIBrand]== "YANKEE CANDLE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Yves Delorme ( Laurence Tavernier )" and vbrand[INr.BPIBrand]== "YVES DELORME" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "YVES DELORME (êñåññóàðû)" and vbrand[INr.BPIBrand]== "YVES DELORME" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "YVES DELORME (åòñêîå)" and vbrand[INr.BPIBrand]== "YVES DELORME" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "YVES DELORME (óõîí.ïîëîòåíöà è ñêàòåðòè)" and vbrand[INr.BPIBrand]== "YVES DELORME" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "YVES DELORME (äåßëà)" and vbrand[INr.BPIBrand]== "YVES DELORME" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "YVES DELORME (îäóøêè)" and vbrand[INr.BPIBrand]== "YVES DELORME" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "YVES DELORME (ïîñòåëè)" and vbrand[INr.BPIBrand]== "YVES DELORME" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "YVES DELORME(ìàõðà)" and vbrand[INr.BPIBrand]== "YVES DELORME" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Zancan Silver/Steel" and vbrand[INr.BPIBrand]== "Zancan" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "LE_CREUSET_CAST " and vbrand[INr.BPIBrand]== "LE CREUSET" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Louis De poortere" and vbrand[INr.BPIBrand]== "LOUIS DE POORTERE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "EDG FLOWERS " and vbrand[INr.BPIBrand]== "EDG" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "CoinCasa" and vbrand[INr.BPIBrand]== "COIN CASA" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "NACHTMANN FOR COIN" and vbrand[INr.BPIBrand]== "NACHTMANN" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "EDG Accessories" and vbrand[INr.BPIBrand]== "EDG" ) then begin testf=false; end;
					If(blank(vgrp[INr.Group])) then begin testf=false; end;
					If(vgrp[INr.Group] == "Bodum for Coin " and vbrand[INr.BPIBrand]== "BODUM" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "CINELLI (Duvets)  " and vbrand[INr.BPIBrand]== "CINELLI" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "CINELLI (Pillows)  " and vbrand[INr.BPIBrand]== "CINELLI" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Cogal Towel" and vbrand[INr.BPIBrand]== "COGAL" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "EDG FLOWERS" and vbrand[INr.BPIBrand]== "EDG " ) then begin testf=false; end;
					If(vgrp[INr.Group] == "EDG Accessories" and vbrand[INr.BPIBrand]== "EDG " ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Kaiser Gourmet " and vbrand[INr.BPIBrand]== "KAISER" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Buckley Timeless" and vbrand[INr.BPIBrand]== "BUCKLEY LONDON" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Buckley BOHO" and vbrand[INr.BPIBrand]== "BUCKLEY LONDON" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Aquanova (Terry)" and vbrand[INr.BPIBrand]== "AQUANOVA" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Schlossberg (ìàõðà)" and vbrand[INr.BPIBrand]== "SCHLOSSBERG" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "ANVERSA(ïîñòåëü)" and vbrand[INr.BPIBrand]== "ANVERSA" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Cofur aht" and vbrand[INr.BPIBrand]== "COFUR " ) then begin testf=false; end;
					If(vgrp[INr.Group] == "DEKORATIEF  LOW COST" and vbrand[INr.BPIBrand]== "DEKORATIEF  " ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Buckley Timeless" and vbrand[INr.BPIBrand]== "BUCKLEY LONDON " ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Buckley Rock" and vbrand[INr.BPIBrand]== "BUCKLEY LONDON " ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Buckley BOHO" and vbrand[INr.BPIBrand]== "BUCKLEY LONDON " ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Buckley Accessories" and vbrand[INr.BPIBrand]== "BUCKLEY LONDON " ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Schlossberg (ïîñòåëü)" and vbrand[INr.BPIBrand]== "SCHLOSSBERG " ) then begin testf=false; end;
					If(vgrp[INr.Group] == "DESCAMPS(ïîñòåëü)" and vbrand[INr.BPIBrand]== "DESCAMPS" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "ALEXANDRE TURPAULT(àõðà) " and vbrand[INr.BPIBrand]== "ALEXANDRE TURPAULT " ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Fischbacher (ïîñòåëü)" and vbrand[INr.BPIBrand]== "CHRISTIAN FISCHBACHER " ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Aquanova (Terry) " and vbrand[INr.BPIBrand]== "AQUANOVA" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Schlossberg (ìàõðà)" and vbrand[INr.BPIBrand]== "SCHLOSSBERG " ) then begin testf=false; end;
					If(vgrp[INr.Group] == "ALEXANDRE TURPAULT(îñòåëü) " and vbrand[INr.BPIBrand]== "ALEXANDRE TURPAULT " ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Yves Delorme ( Laurence Tavernier )  " and vbrand[INr.BPIBrand]== "YVES DELORME" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "FRETTE()" and vbrand[INr.BPIBrand]== "FRETTE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Somma throws" and vbrand[INr.BPIBrand]== "SOMMA " ) then begin testf=false; end;
					If(vgrp[INr.Group] == "WEDGWOOD TABLEWARE" and vbrand[INr.BPIBrand]== "WEDGWOOD" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "ALEXANDRE TURPAULT(ïîêðûâàëî) " and vbrand[INr.BPIBrand]== "ALEXANDRE TURPAULT " ) then begin testf=false; end;
					If(vgrp[INr.Group] == "HERING PORCELAIN" and vbrand[INr.BPIBrand]== "HERING" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "BACCARAT TABLEWARE" and vbrand[INr.BPIBrand]== "BACCARAT" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "WEISSFEE GUESTBOOK" and vbrand[INr.BPIBrand]== "WEISSFEE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "WEISSFEE NAPKIN " and vbrand[INr.BPIBrand]== "WEISSFEE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Rosenthal (àðôîð)" and vbrand[INr.BPIBrand]== "ROSENTHAL" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Andrea-house " and vbrand[INr.BPIBrand]== "ANDREA HOUSE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "SIA Home Fashion " and vbrand[INr.BPIBrand]== "SIA HOME" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "WEISSFEE NAPKIN " and vbrand[INr.BPIBrand]== "WEISSFEE" ) then begin testf=false; end;
					
					
					If(vgrp[INr.Group] == "ALESSI POS" and vbrand[INr.BPIBrand]== "ALESSI" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "ANVERSA(àêñåññóàðû)" and vbrand[INr.BPIBrand]== "ANVERSA" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Buckley romantic" and vbrand[INr.BPIBrand]== "BUCKLEY LONDON " ) then begin testf=false; end;
					If(vgrp[INr.Group] == "BUGATTI LUXURY" and vbrand[INr.BPIBrand]== "BUGATTI " ) then begin testf=false; end;
					If(vgrp[INr.Group] == "ChronoVision Movers" and vbrand[INr.BPIBrand]== "CHRONOVISION" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Classic Porcelain" and vbrand[INr.BPIBrand]== "LLADRO" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "CRISTOFLE JEWELLERY" and vbrand[INr.BPIBrand]== "CHRISTOFLE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "DAUM PRESTIGE" and vbrand[INr.BPIBrand]== "DAUM" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Dinh Van " and vbrand[INr.BPIBrand]== "DINH VAN" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Fischbacher (ìàõðà)" and vbrand[INr.BPIBrand]== "CHRISTIAN FISCHBACHER " ) then begin testf=false; end;
					If(vgrp[INr.Group] == "GREGGIO CUSTOMIZED" and vbrand[INr.BPIBrand]== "GREGGIO" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Gres" and vbrand[INr.BPIBrand]== "LLADRO" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "HELIO" and vbrand[INr.BPIBrand]== "HELIOS" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "HERING ACCESSORIES" and vbrand[INr.BPIBrand]== "HERING" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "HERING GLASSES" and vbrand[INr.BPIBrand]== "HERING" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "High Porcelain" and vbrand[INr.BPIBrand]== "LLADRO" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Hulchi Belluni " and vbrand[INr.BPIBrand]== "HULCHI BELLUNI" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "LE_CREUSET_MIL " and vbrand[INr.BPIBrand]== "LE CREUSET" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Lighting" and vbrand[INr.BPIBrand]== "LLADRO" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Light&Living*3" and vbrand[INr.BPIBrand]== "LIGHT&LIVING" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Louis De poortere  " and vbrand[INr.BPIBrand]== "LOUIS DE POORTERE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Luxenter EDURNE" and vbrand[INr.BPIBrand]== "LUXENTER " ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Matt Porcelain" and vbrand[INr.BPIBrand]== "LLADRO" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Naturo Fantastic" and vbrand[INr.BPIBrand]== "LLADRO" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Others" and vbrand[INr.BPIBrand]== "LLADRO" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "ReDeco" and vbrand[INr.BPIBrand]== "LLADRO" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Schlossberg ()" and vbrand[INr.BPIBrand]== "SCHLOSSBERG " ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Schlossberg ()" and vbrand[INr.BPIBrand]== "SCHLOSSBERG " ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Schlossberg ()" and vbrand[INr.BPIBrand]== "SCHLOSSBERG " ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Schlossberg (classic)" and vbrand[INr.BPIBrand]== "SCHLOSSBERG " ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Schlossberg (Special Offer)" and vbrand[INr.BPIBrand]== "SCHLOSSBERG " ) then begin testf=false; end;
					If(vgrp[INr.Group] == "SIA_High" and vbrand[INr.BPIBrand]== "SIA HOME" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Table Lamp" and vbrand[INr.BPIBrand]== "LLADRO" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Tag Heuer" and vbrand[INr.BPIBrand]== "TAG HEUER " ) then begin testf=false; end;
					If(vgrp[INr.Group] == "The Fifth Season" and vbrand[INr.BPIBrand]== "ROBERTO COIN" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "WEISSFEE GUESTBOOK " and vbrand[INr.BPIBrand]== "WEISSFEE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "WEISSFEE NAPKIN " and vbrand[INr.BPIBrand]== "WEISSFEE " ) then begin testf=false; end;
					If(vgrp[INr.Group] == "WEISSFEE NAPKINS" and vbrand[INr.BPIBrand]== "WEISSFEE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "WEISSFEE PLACEMAT " and vbrand[INr.BPIBrand]== "WEISSFEE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "WEISSFEE RUNNER " and vbrand[INr.BPIBrand]== "WEISSFEE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "WEISSFEE TABLECENTER " and vbrand[INr.BPIBrand]== "WEISSFEE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Weissfee terry" and vbrand[INr.BPIBrand]== "WEISSFEE " ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Zancan Watches " and vbrand[INr.BPIBrand]== "Zancan" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Consignment (ðåìåííûé  ââîç)" and vbrand[INr.BPIBrand]== "LLADRO" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "De Bethune CHF" and vbrand[INr.BPIBrand]== "DAUM" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Cento" and vbrand[INr.BPIBrand]== "ROBERTO COIN" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Morellato" and vbrand[INr.BPIBrand]== "JUST CAVALLI" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "ANDREA_ACC" and vbrand[INr.BPIBrand]== "KARE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Andrea Accessories" and vbrand[INr.BPIBrand]== "KARE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "ANDREA_EKS" and vbrand[INr.BPIBrand]== "KARE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "ANDREA_FU" and vbrand[INr.BPIBrand]== "KARE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Andrea-house " and vbrand[INr.BPIBrand]== "KARE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Andrea-K" and vbrand[INr.BPIBrand]== "KARE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Andrea-K-Accessories" and vbrand[INr.BPIBrand]== "KARE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Andrea-K-Ekspo                            " and vbrand[INr.BPIBrand]== "KARE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Andrea-K-Furniture" and vbrand[INr.BPIBrand]== "KARE" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Consignment (ðåìåííûé  ââîç)" and vbrand[INr.BPIBrand]== "LLADRO" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "SOHER" and vbrand[INr.BPIBrand]== "LLADRO" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Sambonet" and vbrand[INr.BPIBrand]== "Paderno" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "PADERNO" and vbrand[INr.BPIBrand]== "SAMBONET" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Morellato" and vbrand[INr.BPIBrand]== "MASERATI" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "KOSTA BODA" and vbrand[INr.BPIBrand]== "ORREFORS" ) then begin testf=false; end;
					If(vgrp[INr.Group] == "Morellato" and vbrand[INr.BPIBrand]== "TRUSSARDI" ) then begin testf=false; end;
					
					
					if(testf) then begin
						startformat(15);
						outstring(0,0,CurrentCompany,false);
						outstring(0,0,INr.Code,false);
						outstring(0,0,vgrp[INr.Group],false);
						outstring(0,0,vbrand[INr.BPIBrand],false);
						endformat;	
						INr.BPIBrand = "";
						INr.BPICollection = "";
						INr.BPIGroup = "";
						INr.BPISubGroup = "";
						INr.BPICategory = "";
						INr.BPIMaterial = "";
						INr.BPIColor = "";
						INr.BPIShape = "";
						INr.BPISize = "";
						INr.BPIUse = "";
						INr.BPISex = "";
						INr.BPIPlating = "";
						INr.BPIClarity = "";
						INr.BPIWeight = "";
						INr.BPICut = "";
						INr.BPIStone = "";
						INr.BPIStrap = "";
						INr.BPIOdour = "";
						recordstore(INr,true);
					end;
			  end;
			end;	
			ResetLoop(INr);
		end;
	end;
endjob;
return;
end;	

global updating procedure ItemsBrendCuvcGRn()
begin
record BPIBrandVc BBr;
array string 100 vbrand,vbrname,vit,vitname,vcu,vcuname;
record CUVc CUr;
record ITVc ITr;
integer CompQty,i,OldComp;
record CompaniesBlock Compb;
row CompaniesBlock Comprw;
boolean TrHs,testf;

startreportnoheaderjob("îâàðû");
		
		startformat(15);
			outstring(0,0,"Code br",false);
			outstring(50,0,"Name br",false);
			outstring(150,0,"Code gr",false);
			outstring(200,0,"Name gr",false);
			outstring(300,0,"Code Cu",false);
			outstring(350,0,"Name Cu",false);
		endformat;	
TrHs=true;
BBr.Code="";
i=0;
while(LoopMain(BBr,1,TrHs)) begin
 vbrand[i]=BBr.Code;
 vbrname[i]=BBr.Name;
 i=i+1;
end;
ResetLoop(BBr);
for(i=1;i<29;i=i+1)begin
	if(CompanyIsJWLikeCompany(i)==false or i==3)then begin
		TrHs=true;
		i=0;
		ITr.Code="";
		while(LoopMain(ITr,1,TrHs)) begin
			vit[i]=ITr.Code;
			vitname[i]=ITr.Comment;
			 i=i+1;
		end;	
		ResetLoop(ITr);
	end;
end;
TrHs=true;
i=0;
CUr.Code="";
CUr.VEType = 1;
while(Loopkey("VEActCode",CUr,1,TrHs)) begin
 testf=true;
 if(CUr.VEType!=1) then begin testf=false; TrHs = false; end;
 if(testf) then begin
		vcu[i]=CUr.Code;
		vcuname[i]=CUr.Name;
		i=i+1;
	end;
end;




for(i=0; i<vbrand.length  or i<vbrname.length or i<vit.length or i<vitname.length or i<vcu.length or i<vcuname.length;i=i+1) begin
	startformat(15);
			outstring(0,0,vbrand[i],false);
			outstring(50,0,vbrname[i],false);
			outstring(150,0,vit[i],false);
			outstring(200,0,vitname[i],false);
			outstring(300,0,vcu[i],false);
			outstring(350,0,vcuname[i],false);
		endformat;	
end;

endjob;

return; 
end;	



global function string 255 GetDITypeName(string diset,string Type)
begin
	record DIVc DIr;
	string 100 res,class;
	integer pos;
	
	pos = 0;
	class = "";
	ExtractObj(diset,pos,class);
	while(nonblank(class))begin
		DIr.Code = class;
		readfirstmain(DIr,1,true);
		if(DIr.CType==Type)then begin
			res = DIr.Name;
		end;
		
		ExtractObj(diset,pos,class);
	end;
	
	GetDITypeName = res;
	
return;
end;

global updating procedure UpLoyRn()
begin
  boolean TrHs;
	integer i;
	record LoyaltyCardVc LCr;
		i=0;
		TrHs=true;
		LCr.SerNr="";
		While(LoopMain(LCr,1,TrHs)) begin
			i=i+1;
			if(i==10) then begin TrHs=false; end;
			SendUpdateLoyaltyCardToCRM(LCr);
			logtext(0,LCr.SerNr);
			millisleep(1000);
		end;	
return;
end;



global procedure SHCompletedRn(record RcVc RepSpec)
begin
  record SHVc SHr;
	row SHVc SHrw;
	record CompaniesBlock Compb;
	row CompaniesBlock Comprw;
	integer OldComp,i,mtrw,shmtrw,j,LocComp,gORcnt,k;
	longint s, lcnt, l;
	string 255 CompName, Location;
	Boolean TrHs,testf;
	record ORVc ORr, GlobORr;
	row	ORVc ORrw, GlobORrw;
	array integer tab;
	val ECItSum;
	vector string 255 vComp, vStock, vSerNr, vOffORNr, vItemName, vItemCode;
	vector val vQuant, vSum;
	vector date vDate;
	vector integer vQtySpec;
	array string 255 SHarr, Locarr;
	vector boolean vLocf;
	longint curtick;
	
	curtick = getcurtick();
	LocComp = CurrentCompany;
	blockload(Compb);
	
	OldComp = CurrentCompany;
	
	startreportnoheaderjob("ñå îâàðû");
	tab[0] = 20;
	tab[1] = 60;
	tab[2] = 120;
	tab[3] = 170;
	tab[4] = 220;
	tab[5] = 270;
	tab[6] = 320;
	tab[7] = 420;
	
	StartFormat(15);
		outstring(20,0,"Date:",false);
		outstring(20,0,CurrentDate,false);
		outstring(20,0,CurrentTime,false);
	endformat;
	StartFormat(15);
	
		outstring(20,0,"Company",false);
		outstring(120,0,"Stock",false);
		outstring(220,0,"Serial Nr",false);
		outstring(320,0,"Official ORNr",false);
		outstring(420,0,"Date",false);
		outstring(420,0,"Item Name",false);
		outstring(420,0,"Item Code",false);
		outstring(420,0,"Quant",false);
		outstring(420,0,"Sum",false);
		

	
	endformat;
	
	lcnt = 0;
	s = 0;
	mtrw = matrowcnt(Compb);
	for (i=0;i<mtrw;i=i+1) begin
		CompName = "";
		MatRowGet(Compb,i,Comprw);
		if(Comprw.ActiveStatus==0)then begin
			CompName = Comprw.CompName;
			SetCompany(i+1,false);
			LocComp = i+1;
			TrHs = true;
			SHr.SerNr = "";
			SHr.Sorting = "COMPLETED";
			while (LoopKey("Sorting",SHr,2,TrHs)) begin
				Location = "";
				testf = true;
				logtext(0,Comprw.CompName);
				if(SHr.Sorting!="COMPLETED")then begin TrHs = false; testf = false; end;
				if(SHr.OKFlag!=0)then begin testf = false; end;
				if(testf)then begin
					if(!vLocf[SHr.Location])then begin
						Locarr[lcnt] = SHr.Location;
						lcnt = lcnt + 1;
						vLocf[SHr.Location] = true;
					end;
					SHarr[s] = SHr.SerNr & "-" & Comprw.CompName;
					vComp[SHr.SerNr & "-" & Comprw.CompName] = Comprw.CompName;
					shmtrw = matrowcnt(SHr);
					for(j=0;j<shmtrw;j=j+1)begin
						matrowget(SHr,j,SHrw);
						if(nonblank(Location) and !SetInSet(SHrw.Location,Location))then begin
							Location = Location & ", " & SHrw.Location;
						end;
						if(blank(Location))then begin
							Location = SHrw.Location;
						end;
					end;
					if(blank(Location))then begin
						Location = SHr.Location;
					end;
					vStock[SHr.SerNr & "-" & Comprw.CompName] = SHr.Location;
					vSerNr[SHr.SerNr & "-" & Comprw.CompName] = SHr.SerNr;
					ORr.SerNr = SHr.OrderNr;
					vDate[SHr.SerNr & "-" & Comprw.CompName] = SHr.ShipDate;
					shmtrw = matrowcnt(SHr);
					vQtySpec[SHr.SerNr & "-" & Comprw.CompName] = shmtrw;
					for(j=0;j<shmtrw;j=j+1)begin
						matrowget(SHr,j,SHrw);
						vItemName[SHr.SerNr & "-" & Comprw.CompName & "-" & j] = SHrw.Spec;
						vItemCode[SHr.SerNr & "-" & Comprw.CompName & "-" & j] = SHrw.ArtCode;
						vQuant[SHr.SerNr & "-" & Comprw.CompName & "-" & j] = SHrw.Ordered;
						ECItSum = 0;
						if(setcompany(29,false))then begin
							GlobORr.SerNr = mid(SHrw.SerialNr,3,len(SHrw.SerialNr)-12);
							if(ReadFirstMain(GlobORr,1,true))then begin
								vOffORNr[SHr.SerNr & "-" & Comprw.CompName] = GlobORr.CustOrdNr;
								gORcnt = matrowcnt(GlobORr);
								for (k=0;k<gORcnt;k=k+1)begin
									matrowget(GlobORr,k,GlobORrw);
									if(GlobORrw.ArtCode==right(SHrw.SerialNr,8))then begin
										ECItSum = GlobORrw.Sum / GlobORrw.Quant;
										k = gORcnt;
									end;
								end;
							end;
						end;
						vSum[SHr.SerNr & "-" & Comprw.CompName & "-" & j] = ECItSum*SHrw.Ordered;
						ResetCompany(LocComp);
					end;
					s = s + 1;
				end;
			end;
			resetloop(SHr);
		end;
	end;
	
	
	
	for(l=0;l<lcnt;l=l+1)begin
		for(i=0;i<s;i=i+1)begin
			testf = true;
			if(Locarr[l]!=vStock[SHarr[i]])then begin testf = false; end; 
			if(nonblank(RepSpec.f1) and Locarr[l]!=RepSpec.f1)then begin testf = false; end; 
			if(testf)then begin
				StartFormat(15);
					outstring(20,0,vComp[SHarr[i]],false);
					outstring(120,0,vStock[SHarr[i]],false);
					outstring(220,0,vSerNr[SHarr[i]],false);
					outstring(220,0,vOffORNr[SHarr[i]],false);
					outstring(420,0,vDate[SHarr[i]],false);
				endformat;
				for(j=0;j<vQtySpec[SHarr[i]];j=j+1)begin
					matrowget(SHr,j,SHrw);
					StartFormat(15);
						outstring(420,0,"",false);
						outstring(420,0,"",false);
						outstring(420,0,"",false);
						outstring(420,0,"",false);
						outstring(420,0,"",false);
						outstring(420,0,vItemName[SHarr[i] & "-" & j],false);
						outstring(420,0,vItemCode[SHarr[i] & "-" & j],false);
						outstring(420,0,vQuant[SHarr[i] & "-" & j],false);
						outstring(460,0,vSum[SHarr[i] & "-" & j],false);
					endformat;
				end;
			end;
		end;
	end;
	
	
	
	ResetCompany(OldComp);
	
	StartFormat(15);
		outstring(20,0,"óðüåð 1:",false);
	endformat;
	
	EndJob;
	
	LogProcTime("SHCompletedRn",getcurtick() - curtick);
return;
end;





global procedure AllMyGoodsRn(record RcVc RepSpec)
begin
record INVc INr;
record BPIBrandVc BBr;
record BPICollectionVC BCr;
record BPIColorVC BClr;
record BPIMaterialVc BMr;
record BPISizeVc BSr;
record BPIGroupVc BGr;
record BPISubGroupVc BSGr;
record BPICategoryVc BCatr;
string 255 companies;
string 255 text;
vector string 50 vit;
longint curcomp,i,qnt;
integer pos, OldComp;
array string 100 tags;
vector string 50 code;
vector string 50 group,groupn;
vector string 50 name;
vector string 50 size,sizen;
vector string 50 material,materialn;
vector string 50 collection,collectionn;
vector string 50 brand,brandn;
vector string 50 subgroup,subgroupn;
vector string 50 category,categoryn;
vector string 50 colour,colourn;
vector string 50 recepy,companiesn;
vector val qtInStock;
vector date lastupd; 
vector boolean flag;
boolean testf,compin;
record ItemStatusVc ISr;
longint curtick;

	curtick = getcurtick();
	OldComp = CurrentCompany;

	BBr.Code="";
	While(LoopMain(BBr,1,true)) begin
		brandn[BBr.Code]=BBr.Name;
	end;	

	BCr.Code="";
	While(LoopMain(BCr,1,true)) begin
		collectionn[BCr.Code]=BCr.Name;
	end;	
	
	BClr.Code="";
	While(LoopMain(BClr,1,true)) begin
		colourn[BClr.Code]=BClr.Name;
	end;	

	BMr.Code="";
	While(LoopMain(BMr,1,true)) begin
		materialn[BMr.Code]=BMr.Name;
	end;	
	
	BGr.Code="";
	While(LoopMain(BGr,1,true)) begin
		groupn[BGr.Code]=BGr.Name;
	end;
	
	BCatr.Code="";
	While(LoopMain(BCatr,1,true)) begin
		categoryn[BCatr.Code]=BCatr.Name;
	end;
	
	BSGr.Code="";
	While(LoopMain(BSGr,1,true)) begin
		subgroupn[BSGr.Code]=BSGr.Name;
	end;	

	for(i=0;i<29;i=i+1) begin
		companiesn[i]=GetCompanyShortCode(i);
	end;
	i=0;		
	startreportnoheaderjob("ñå îâàðû");
		startformat(15);
			outstring(0,0,"Code",false);
			outstring(0,0,"Name",false);
			outstring(0,0,"Model",false);
			outstring(0,0,"Colour",false);
			outstring(0,0,"Material",false);
			outstring(0,0,"Size",false);
			outstring(0,0,"Set Code",false);
			outstring(0,0,"Group",false);
			outstring(0,0,"SubGroup",false);
			outstring(0,0,"Category",false);
			outstring(50,0,"Brand",false);
			outstring(50,0,"Comp",false);
			outstring(0,0,"Last upd",false);
			outstring(0,0,"In stock",false);
		endformat;	
		
	for(curcomp=1;curcomp<33;curcomp=curcomp+1) begin
		compin = true;
		
		CompanyIsJWLikeCompany(curcomp);
		if(curcomp!=3 and CompanyIsJWLikeCompany(curcomp))begin compin = false; end;
		if(curcomp==10)begin compin = false; end;
		if(curcomp==11)begin compin = false; end;
		if(curcomp==12)begin compin = false; end;
		if(curcomp==18)begin compin = false; end;
		if(curcomp==29)begin compin = false; end;
		if(curcomp==18)begin compin = false; end;
		
		if(compin)then begin
			setcompany(curcomp,false);
			logtext(0,curcomp);
			INr.Code="";
			while (LoopMain(INr,1,true)) begin
				testf=true;
				if(nonblank(RepSpec.f1) and RepSpec.f1!=INr.BPIBrand) then begin testf = false; end;
				if(nonblank(RepSpec.f2) and RepSpec.f2!=INr.BPIGroup) then begin testf = false; end;
				if(nonblank(RepSpec.f3) and RepSpec.f3!=INr.BPISubGroup) then begin testf = false; end;
				if(testf) then begin
					if(nonblank(INr.BPIBrand)) then begin
						if(nonblank(vit[INr.Code & INr.BPIBrand])) then begin
							vit[INr.Code & INr.BPIBrand]=vit[INr.Code & INr.BPIBrand] & "," & CurrentCompany;
							name[INr.Code & INr.BPIBrand]=INr.Name;
							brand[INr.Code & INr.BPIBrand]=INr.BPIBrand;
							code[INr.Code & INr.BPIBrand]=INr.Code;
							size[INr.Code & INr.BPIBrand]=INr.BPISize;
							material[INr.Code & INr.BPIBrand]=INr.BPIMaterial;
							collection[INr.Code & INr.BPIBrand]=INr.BPICollection;
							subgroup[INr.Code & INr.BPIBrand]=INr.BPISubGroup;
							group[INr.Code & INr.BPIBrand]=INr.BPIGroup;
							colour[INr.Code & INr.BPIBrand]=INr.BPIColor;
							category[INr.Code & INr.BPIBrand]=INr.BPICategory;
							lastupd[INr.Code & INr.BPIBrand]=INr.LastPriceChange;
							recepy[INr.Code & INr.BPIBrand]=INr.Recepy;
							ISr.Code = INr.Code;
							ISr.Location = ";;;";
							If(readfirstmain(ISr,2,true))then begin
								qtInStock[INr.Code & INr.BPIBrand]=qtInStock[INr.Code & INr.BPIBrand]+ISr.Instock;
							end;	
							if(!flag[INr.Code & INr.BPIBrand])then begin
								tags[i] = INr.Code & INr.BPIBrand;
								i=i+1;
							end;	
							flag[INr.Code & INr.BPIBrand]=true;
						end else begin 
							vit[INr.Code & INr.BPIBrand]=CurrentCompany;
							name[INr.Code & INr.BPIBrand]=INr.Name;
							brand[INr.Code & INr.BPIBrand]=INr.BPIBrand;
							code[INr.Code & INr.BPIBrand]=INr.Code;
							size[INr.Code & INr.BPIBrand]=INr.BPISize;
							material[INr.Code & INr.BPIBrand]=INr.BPIMaterial;
							collection[INr.Code & INr.BPIBrand]=INr.BPICollection;
							subgroup[INr.Code & INr.BPIBrand]=INr.BPISubGroup;
							category[INr.Code & INr.BPIBrand]=INr.BPICategory;
							group[INr.Code & INr.BPIBrand]=INr.BPIGroup;
							lastupd[INr.Code & INr.BPIBrand]=INr.LastPriceChange;
							colour[INr.Code & INr.BPIBrand]=INr.BPIColor;
							recepy[INr.Code & INr.BPIBrand]=INr.Recepy;
							ISr.Code = INr.Code;
							ISr.Location = ";;;";
							If(readfirstmain(ISr,2,true)) then begin
								qtInStock[INr.Code & INr.BPIBrand]=qtInStock[INr.Code & INr.BPIBrand]+ISr.Instock;
							end;	
							if(!flag[INr.Code & INr.BPIBrand]) then begin
								tags[i] = INr.Code & INr.BPIBrand;
								i=i+1;
							end;	
							flag[INr.Code & INr.BPIBrand]=true;
						end;	
					end else begin
						if(nonblank(vit[INr.Code & INr.Group])) then begin
							vit[INr.Code & INr.Group]=vit[INr.Code & INr.Group] & "," & CurrentCompany;
							name[INr.Code & INr.Group]=INr.Name;
							brand[INr.Code & INr.Group]=INr.Group;
							code[INr.Code & INr.Group]=INr.Code;
							size[INr.Code & INr.Group]=INr.BPISize;
							material[INr.Code & INr.Group]=INr.BPIMaterial;
							group[INr.Code & INr.Group]=INr.BPIGroup;
							collection[INr.Code & INr.Group]=INr.BPICollection;
							subgroup[INr.Code & INr.Group]=INr.BPISubGroup;
							category[INr.Code & INr.Group]=INr.BPICategory;
							lastupd[INr.Code & INr.Group]=INr.LastPriceChange;
							colour[INr.Code & INr.Group]=INr.BPIColor;
							recepy[INr.Code & INr.Group]=INr.Recepy;
							ISr.Code = INr.Code;
							ISr.Location = ";;;";
							If(readfirstmain(ISr,2,true)) then begin
								qtInStock[INr.Code & INr.Group]=qtInStock[INr.Code & INr.Group]+ISr.Instock;
							end;	
							if(!flag[INr.Code & INr.Group]) then begin
								tags[i] = INr.Code & INr.Group;
								i=i+1;
							end;	
							flag[INr.Code & INr.Group]=true;
						end else begin 
							vit[INr.Code & INr.Group]=CurrentCompany;
							name[INr.Code & INr.Group]=INr.Name;
							brand[INr.Code & INr.Group]=INr.Group;
							code[INr.Code & INr.Group]=INr.Code;
							size[INr.Code & INr.Group]=INr.BPISize;
							material[INr.Code & INr.Group]=INr.BPIMaterial;
							collection[INr.Code & INr.Group]=INr.BPICollection;
							subgroup[INr.Code & INr.Group]=INr.BPISubGroup;
							category[INr.Code & INr.Group]=INr.BPICategory;
							lastupd[INr.Code & INr.Group]=INr.LastPriceChange;
							group[INr.Code & INr.Group]=INr.BPIGroup;
							colour[INr.Code & INr.Group]=INr.BPIColor;
							recepy[INr.Code & INr.Group]=INr.Recepy;
							ISr.Code = INr.Code; 
							ISr.Location = ";;;";
							If(readfirstmain(ISr,2,true)) then begin
								qtInStock[INr.Code & INr.Group]=qtInStock[INr.Code & INr.Group]+ISr.Instock;
							end;	
							if(!flag[INr.Code & INr.Group]) then begin
								tags[i]=INr.Code & INr.Group;
								i=i+1;
							end;	
							flag[INr.Code & INr.Group]=true;
						end;	
					end;
				end;	
			end;
			ResetLoop(INr);
		end;
	end;
	ResetCompany(OldComp);
	for(i=0;i<tags.length;i=i+1) begin
		startformat(15);
			outstring(0,0,code[tags[i]],false);
			outstring(0,0,name[tags[i]],false);
			outstring(0,0,collectionn[collection[tags[i]]],false);
			outstring(0,0,colourn[colour[tags[i]]],false);
			outstring(0,0,materialn[material[tags[i]]],false);
			outstring(0,0,sizen[size[tags[i]],false);
			outstring(0,0,recepy[tags[i]],false);
			outstring(50,0,groupn[group[tags[i]]],false);	
			outstring(50,0,subgroupn[subgroup[tags[i]]],false);
			outstring(50,0,categoryn[category[tags[i]]],false);
			outstring(50,0,brandn[brand[tags[i]]],false);
			pos=0;
			text="";
			companies="";
			ExtractObjWithSeparator(",",vit[tags[i]],true,pos,text);
			while (nonblank(text)) begin
				if(nonblank(companies)) then begin
					companies=companies &","&companiesn[stringtoint(text)];
				end else begin
					companies=companiesn[stringtoint(text)];
				end;	
				ExtractObjWithSeparator(",",vit[tags[i]],true,pos,text);
			end;	
			outstring(50,0,companies,false);	
			outstring(50,0,lastupd[tags[i]],false);
			outstring(50,0,qtInStock[tags[i]],false);
		endformat;	
	end;
	LogProcTime("AllMyGoodsRn",getcurtick() - curtick);
endjob;
return;
end;	



global procedure AllMyGoodsListRn(record RcVc RepSpec)
begin
	record INVc INr;
	record BPIBrandVc BPIBrandr;
	record BPICollectionVc BPICollectionr;
	record BPIGroupVc BPIGroupr;
	record BPISubGroupVc BPISubGroupr;
	record BPICategoryVc BPICategoryr;
	record BPIMaterialVc BPIMaterialr;
	record BPIColorVc BPIColorr;
	record BPIShapeVc BPIShaper;
	record BPISizeVc BPISizer;
	record BPIUseVc BPIUser;
	record BPISexVc BPISexr;
	record BPIPlatingVc BPIPlatingr;
	record BPIClarityVc BPIClarityr;
	record BPIWeightVc BPIWeightr;
	record BPICutVc BPICutr;
	record BPIStoneVc BPIStoner;
	record BPIStrapVc BPIStrapr;
	record BPIOdourVc BPIOdourr;
	
	string 255 companies;
	string 255 text;
	vector string 50 vit;
	longint curcomp,i,qnt;
	integer pos, OldComp;
	array string 100 tags;
	vector string 50 code;
	vector string 50 group,groupn;
	vector string 50 name;
	vector string 50 size;
	vector string 50 material,materialn;
	vector string 50 collection,collectionn;
	vector string 50 brand,brandn,shape,use,sex,plating,clar,weight,cut,stone,strap,odour;
	vector string 50 subgroup,subgroupn;
	vector string 50 category,categoryn;
	vector string 50 colour,colourn;
	vector string 50 recepy,companiesn;
	vector val qtInStock;
	vector date lastupd; 
	vector boolean flag;
	boolean testf,compin;
	record ItemStatusVc ISr;
	longint curtick;
	
	curtick = getcurtick();
	OldComp = CurrentCompany;
	
	BPIOdourr.Code="";
	While(LoopMain(BPIOdourr,1,true)) begin
		odour[BPIOdourr.Code]=BPIOdourr.Name;
	end;
	
	BPIStrapr.Code="";
	While(LoopMain(BPIStrapr,1,true)) begin
		strap[BPIStrapr.Code]=BPIStrapr.Name;
	end;
	
	BPIStoner.Code="";
	While(LoopMain(BPIStoner,1,true)) begin
		stone[BPIStoner.Code]=BPIStoner.Name;
	end;
	
	BPICutr.Code="";
	While(LoopMain(BPICutr,1,true)) begin
		cut[BPICutr.Code]=BPICutr.Name;
	end;
	
	BPIWeightr.Code="";
	While(LoopMain(BPIWeightr,1,true)) begin
		weight[BPIWeightr.Code]=BPIWeightr.Name;
	end;
	
	BPIClarityr.Code="";
	While(LoopMain(BPIClarityr,1,true)) begin
		clar[BPIClarityr.Code]=BPIClarityr.Name;
	end;
	
	BPIPlatingr.Code="";
	While(LoopMain(BPIPlatingr,1,true)) begin
		plating[BPIPlatingr.Code]=BPIPlatingr.Name;
	end;
	
	BPISexr.Code="";
	While(LoopMain(BPISexr,1,true)) begin
		sex[BPISexr.Code]=BPISexr.Name;
	end;
	
	BPIUser.Code="";
	While(LoopMain(BPIUser,1,true)) begin
		use[BPIUser.Code]=BPIUser.Name;
	end;
	
	BPISizer.Code="";
	While(LoopMain(BPISizer,1,true)) begin
		size[BPISizer.Code]=BPISizer.Name;
	end;
	
	BPIShaper.Code="";
	While(LoopMain(BPIShaper,1,true)) begin
		shape[BPIShaper.Code]=BPIShaper.Name;
	end;
	
	BPIBrandr.Code="";
	While(LoopMain(BPIBrandr,1,true)) begin
		brandn[BPIBrandr.Code]=BPIBrandr.Name;
	end;	

	BPICollectionr.Code="";
	While(LoopMain(BPICollectionr,1,true)) begin
		collectionn[BPICollectionr.Code]=BPICollectionr.Name;
	end;	
	
	BPIColorr.Code="";
	While(LoopMain(BPIColorr,1,true)) begin
		colourn[BPIColorr.Code]=BPIColorr.Name;
	end;	

	BPIMaterialr.Code="";
	While(LoopMain(BPIMaterialr,1,true)) begin
		materialn[BPIMaterialr.Code]=BPIMaterialr.Name;
	end;	
	
	BPIGroupr.Code="";
	While(LoopMain(BPIGroupr,1,true)) begin
		groupn[BPIGroupr.Code]=BPIGroupr.Name;
	end;
	
	BPICategoryr.Code="";
	While(LoopMain(BPICategoryr,1,true)) begin
		categoryn[BPICategoryr.Code]=BPICategoryr.Name;
	end;
	
	BPISubGroupr.Code="";
	While(LoopMain(BPISubGroupr,1,true)) begin
		subgroupn[BPISubGroupr.Code]=BPISubGroupr.Name;
	end;	


	i=0;		
	startreportnoheaderjob("ñå îâàðû");
		startformat(15);
			outstring(0,0,"Code",false);
			outstring(0,0,"Name",false);
			outstring(50,0,"Brand",false);
			outstring(0,0,"Group",false);
			outstring(0,0,"SubGroup",false);
			outstring(0,0,"Model",false);
			outstring(0,0,"Colour",false);
			outstring(0,0,"Material",false);
			outstring(0,0,"Size",false);
			outstring(0,0,"Category",false);
			outstring(0,0,"Shape",false);
			outstring(0,0,"Use",false);
			outstring(0,0,"Gender",false);
			outstring(0,0,"Plating",false);
			outstring(0,0,"Clarity",false);
			outstring(0,0,"Weight",false);
			outstring(0,0,"Cut",false);
			outstring(0,0,"Stone",false);
			outstring(0,0,"Strap",false);
			outstring(0,0,"Odour",false);			
		endformat;	
		
	for(curcomp=1;curcomp<33;curcomp=curcomp+1) begin
		compin = true;
		
		CompanyIsJWLikeCompany(curcomp);
		if(curcomp!=3 and CompanyIsJWLikeCompany(curcomp))begin compin = false; end;
		if(curcomp==10)begin compin = false; end;
		if(curcomp==11)begin compin = false; end;
		if(curcomp==12)begin compin = false; end;
		if(curcomp==18)begin compin = false; end;
		if(curcomp==29)begin compin = false; end;
		if(curcomp==18)begin compin = false; end;
		
		if(compin)then begin
			setcompany(curcomp,false);
			logtext(0,curcomp);
			INr.Code="";
			while (LoopMain(INr,1,true)) begin
				testf=true;
				if(nonblank(RepSpec.f1) and RepSpec.f1!=INr.BPIBrand) then begin testf = false; end;
				if(nonblank(RepSpec.f2) and RepSpec.f2!=INr.BPIGroup) then begin testf = false; end;
				if(nonblank(RepSpec.f3) and RepSpec.f3!=INr.BPISubGroup) then begin testf = false; end;
				if(testf) then begin
					if(nonblank(INr.BPIBrand) and flag[INr.Code & INr.BPIBrand]==false) then begin
							startformat(15);
								outstring(0,0,INr.Code,false);
								outstring(0,0,INr.Name,false);
								outstring(50,0,brandn[INr.BPIBrand],false);
								outstring(50,0,subgroupn[INr.BPISubGroup],false);
								outstring(50,0,categoryn[INr.BPICategory],false);
								outstring(0,0,collectionn[INr.BPICollection],false);
								outstring(0,0,colourn[INr.BPIColor],false);
								outstring(0,0,materialn[INr.BPIMaterial],false);
								outstring(0,0,size[INr.BPISize],false);
								outstring(50,0,groupn[INr.BPIGroup],false);	
								outstring(0,0,shape[INr.BPIShape],false);
								outstring(0,0,use[INr.BPIUse],false);
								outstring(0,0,sex[INr.BPISex],false);
								outstring(0,0,plating[INr.BPIPlating],false);
								outstring(0,0,clar[INr.BPIClarity],false);
								outstring(0,0,weight[INr.BPIWeight],false);
								outstring(0,0,cut[INr.BPICut],false);
								outstring(0,0,stone[INr.BPIStone],false);
								outstring(0,0,strap[INr.BPIStrap],false);
								outstring(0,0,odour[INr.BPIOdour],false);			
							endformat;	
							flag[INr.Code & INr.BPIBrand] = true;
					end;
				end;	
			end;
			ResetLoop(INr);
		end;
	end;
	ResetCompany(OldComp);
	
LogProcTime("AllMyGoodsListRn",getcurtick() - curtick);
endjob;
return;
end;	


global procedure AllCollectionsRn(record RcVc RepSpec)
begin
record INVc INr;
record BPIBrandVc BBr;
record BPICollectionVC BCr;
record BPIColorVC BClr;
record BPIMaterialVc BMr;
record BPISizeVc BSr;
record BPIGroupVc BGr;
record BPISubGroupVc BSGr;
record BPICategoryVc BCatr;
string 255 companies;
string 255 text;
vector string 50 vit;
longint curcomp,i,qnt;
integer pos, OldComp;
array string 100 tags;
vector string 50 code;
vector string 50 group,groupn;
vector string 50 name;
vector string 50 size,sizen;
vector string 50 material,materialn;
vector string 50 collection,collectionn;
vector string 50 brand,brandn;
vector string 50 subgroup,subgroupn;
vector string 50 category,categoryn;
vector string 50 colour,colourn;
vector string 50 recepy,companiesn;
vector val qtInStock;
vector date lastupd; 
vector boolean flag;
boolean testf,compin;
record ItemStatusVc ISr;
longint curtick;
	
	curtick = getcurtick();
	OldComp = CurrentCompany;

	BBr.Code="";
	While(LoopMain(BBr,1,true)) begin
		brandn[BBr.Code]=BBr.Name;
	end;	

	BCr.Code="";
	While(LoopMain(BCr,1,true)) begin
		collectionn[BCr.Code]=BCr.Name;
	end;	
	
	BClr.Code="";
	While(LoopMain(BClr,1,true)) begin
		colourn[BClr.Code]=BClr.Name;
	end;	

	BMr.Code="";
	While(LoopMain(BMr,1,true)) begin
		materialn[BMr.Code]=BMr.Name;
	end;	
	
	BGr.Code="";
	While(LoopMain(BGr,1,true)) begin
		groupn[BGr.Code]=BGr.Name;
	end;
	
	BCatr.Code="";
	While(LoopMain(BCatr,1,true)) begin
		categoryn[BCatr.Code]=BCatr.Name;
	end;
	
	BSGr.Code="";
	While(LoopMain(BSGr,1,true)) begin
		subgroupn[BSGr.Code]=BSGr.Name;
	end;	

	for(i=0;i<29;i=i+1) begin
		companiesn[i]=GetCompanyShortCode(i);
	end;
	i=0;		
	startreportnoheaderjob("ñå îâàðû");
		startformat(15);
			outstring(0,0,"Code",false);
			outstring(0,0,"Name",false);
			outstring(0,0,"Model",false);
			outstring(0,0,"Colour",false);
			outstring(0,0,"Material",false);
			outstring(0,0,"Size",false);
			outstring(0,0,"Set Code",false);
			outstring(0,0,"Group",false);
			outstring(0,0,"SubGroup",false);
			outstring(0,0,"Category",false);
			outstring(50,0,"Brand",false);
			outstring(50,0,"Comp",false);
			outstring(0,0,"Last upd",false);
			outstring(0,0,"In stock",false);
		endformat;	
		
	for(curcomp=1;curcomp<33;curcomp=curcomp+1) begin
		compin = true;
		
		CompanyIsJWLikeCompany(curcomp);
		if(curcomp!=3 and CompanyIsJWLikeCompany(curcomp))begin compin = false; end;
		if(curcomp==10)begin compin = false; end;
		if(curcomp==11)begin compin = false; end;
		if(curcomp==12)begin compin = false; end;
		if(curcomp==18)begin compin = false; end;
		if(curcomp==29)begin compin = false; end;
		if(curcomp==18)begin compin = false; end;
		
		if(compin)then begin
			setcompany(curcomp,false);
			logtext(0,curcomp);
			INr.Code="";
			while (LoopMain(INr,1,true)) begin
				testf=true;
				if(blank(INr.BPICollection)) then begin testf = false; end;
				if(blank(INr.BPIBrand)) then begin testf = false; end;
				
				if(testf) then begin
					if(flag[INr.BPICollection & INr.BPIBrand]==false) then begin
						flag[INr.BPICollection & INr.BPIBrand] = true;
						startformat(15);
							outstring(50,0,brandn[INr.BPIBrand],false);
							outstring(0,0,collectionn[INr.BPICollection],false);
						endformat;	
					end;
				end;	
			end;
			ResetLoop(INr);
		end;
	end;
	ResetCompany(OldComp);
	LogProcTime("AllCollectionsRn",getcurtick() - curtick);

endjob;
return;
end;	


global procedure ExportTableToExcelStockMovRn(record RcVc RepSpec)	//Edit--------Dima 
begin	
  record StockMovVc StockMovr;
  row	StockMovVc StockMovrw;
  Integer rwcnt,i,wn;
	longint curtick;
	
	curtick = getcurtick();
  logtext(0,"dfg");
  StockMovr.SerNr = RepSpec.long1;
  if (ReadFirstMain(StockMovr,1,true)) then begin	  
  rwcnt=MatRowCnt(StockMovr);
	StartReportJob("ExportToExcel");
	
	EndHeader;

	SetRepCol(2,50);
	SetRepCol(3,100);
	SetRepCol(4,150);
	SetRepCol(5,200);
	SetRepCol(6,250);
	SetRepCol(7,300);
	SetRepCol(8,350);
	SetRepCol(9,400);
	SetRepCol(10,450);
	SetRepCol(11,500);
	SetRepCol(12,550);
	SetRepCol(13,600);


	StartFormat(15);
	OutString(0,0,"Ü",true);
	OutString(2,0,"îâàð",true);
	OutString(3,0,"ðåá. êîë.",false);
	OutString(4,0,"òïð.êîë.",false);
	OutString(5,0,"îëó÷.êîë.",false);
	OutString(6,0,"àèìåíîâàíèå",false);
	OutString(7,0,"òàðàß öåíà",false);
	OutString(8,0,"àêë.ðàñõ.",false);
	OutString(9,0,"îâàß öåíà",false);
	EndFormat;
	Black_Divider(0,1);

	for(i=0;i<rwcnt;i=i+1) begin
		MatRowGet(StockMovr,i,StockMovrw)
		StartFormat(15);			
		OutString(0,0,i+1,false);
		OutString(2,0,StockMovrw.ArtCode,false);
		OutString(3,0,StockMovrw.OrdQuant,false);
		OutString(4,0,StockMovrw.SentQuant,false);
		OutString(5,0,StockMovrw.Quant,false);
		OutString(6,0,StockMovrw.Spec,false);
		//OutString(7,0,StockMovrw.OldPrice,false);
		OutVal(7,0,StockMovrw.OldPrice,M4Val,false);
		OutString(8,0,StockMovrw.ExtraSCost,false);
		//OutString(9,0,StockMovrw.NewPrice,false);
		OutVal(9,0,StockMovrw.NewPrice,M4Val,false);		
		


		EndFormat;	
	end;		
	EndJob;

  end;
	LogProcTime("ExportTableToExcelStockMovRn",getcurtick() - curtick);
return;
end;

global procedure ItemNewClassRn(record RcVc RepSpec)
begin
vector string 100 nameByCode;
record INVc INr;
integer i,oldComp;
vector boolean diff;
longint j,curtick;

	curtick = getcurtick();
	oldComp = CurrentCompany;
	CollectNameByCode(nameByCode);
	startreportnoheaderjob("ñå îâàðû");

	StartFormat(15);
	OutString(0,0,"Code",false);
	OutString(2,0,"Name",false);
	OutString(3,0,"BPIBrand",false);
	OutString(4,0,"BPICollection",false);
	OutString(5,0,"BPIGroup",false);
	OutString(6,0,"BPISubGroup",false);
	OutString(7,0,"BPICategory",false);
	OutString(8,0,"BPIMaterial",false);
	OutString(9,0,"BPIColor",false);
	OutString(10,0,"BPIShape",false);
	OutString(11,0,"BPISize",false);
	OutString(12,0,"BPIUse",false);
	OutString(13,0,"BPISex",false);
	OutString(14,0,"BPIPlating",false);
	OutString(15,0,"BPIClarity",false);
	OutString(16,0,"BPIWeight",false);
	OutString(17,0,"BPICut",false);
	OutString(18,0,"BPIStone",false);
	OutString(19,0,"BPIStrap",false);
	OutString(20,0,"BPIOdour",false);
	EndFormat;
	j=0;
for(i=1;i<29;i=i+1) begin

SetCompany(i,false);
ResetLoop(INr);
	INr.Code = "";
	While(LoopMain(INr,1,true)) begin
		if(nonblank(INr.BPISubGroup)and(nonblank(INr.BPICollection) or nonblank(INr.BPICategory) or nonblank(INr.BPIMaterial) or nonblank(INr.BPIColor) or nonblank(INr.BPIShape) or nonblank(INr.BPISize)or nonblank(INr.BPIUse)or nonblank(INr.BPISex)or nonblank(INr.BPIPlating)or nonblank(INr.BPIClarity)or nonblank(INr.BPIWeight)) and diff[INr.Code & INr.BPIBrand]==false ) then begin
			logtext(0,j);
			j=j+1;
			diff[INr.Code & INr.BPIBrand] = true;
			StartFormat(15);
			OutString(0,0,INr.Code,false);
			OutString(2,0,INr.Name,false);
			OutString(3,0,nameByCode[INr.BPIBrand],false);
			OutString(4,0,nameByCode[INr.BPICollection],false);
			OutString(5,0,nameByCode[INr.BPIGroup],false);
			OutString(6,0,nameByCode[INr.BPISubGroup],false);
			OutString(7,0,nameByCode[INr.BPICategory],false);
			OutString(8,0,nameByCode[INr.BPIMaterial],false);
			OutString(9,0,nameByCode[INr.BPIColor],false);
			OutString(10,0,nameByCode[INr.BPIShape],false);
			OutString(11,0,nameByCode[INr.BPISize],false);
			OutString(12,0,nameByCode[INr.BPIUse],false);
			OutString(13,0,nameByCode[INr.BPISex],false);
			OutString(14,0,nameByCode[INr.BPIPlating],false);
			OutString(15,0,nameByCode[INr.BPIClarity],false);
			OutString(16,0,nameByCode[INr.BPIWeight],false);
			OutString(17,0,nameByCode[INr.BPICut],false);
			OutString(18,0,nameByCode[INr.BPIStone],false);
			OutString(19,0,nameByCode[INr.BPIStrap],false);
			OutString(20,0,nameByCode[INr.BPIOdour],false);
			EndFormat;
		end;	
	end;
end;	
	EndJob;
	SetCompany(oldComp,false);
	LogProcTime("ItemNewClassRn",getcurtick() - curtick);
return;
end;	



global function boolean CheckUserBrands(string user, var vector boolean res)
begin
	record UserBrandsVc UBrandr;
	row UserBrandsVc UBrandrw;
	integer mtrw,i;
	boolean found;
	
	UBrandr.Code = user;
	if(readfirstmain(UBrandr,1,true))then begin
		mtrw = matrowcnt(UBrandr);
		For(i=0;i<mtrw;i=i+1) begin
			found = true;
	  	matrowget(UBrandr,i,UBrandrw);
	  	res[UBrandrw.Brand] = true;
		end; 
	end;	
	
	CheckUserBrands = found;
	
return;
end;

global procedure ExportTableToExcelPURn(record RcVc RepSpec)	//Edit--------Dima 
begin
  record PUVc PUr;
  row	PUVc PUrw;
  Integer rwcnt,i,wn;
  
  PUr.SerNr = RepSpec.long1;
  if (ReadFirstMain(PUr,1,true)) then begin	  
  rwcnt=MatRowCnt(PUr);
 
	StartReportJob("ExportToExcel");
	
	EndHeader;

	SetRepCol(2,50);
	SetRepCol(3,100);
	SetRepCol(4,150);
	SetRepCol(5,200);
	SetRepCol(6,250);
	SetRepCol(7,300);
	SetRepCol(8,350);
	SetRepCol(9,400);
	SetRepCol(10,450);
	SetRepCol(11,500);
	SetRepCol(12,550);
	SetRepCol(13,600);


	StartFormat(15);
	OutString(0,0,"Ü",true);
	OutString(2,0,"îâàð",true);
	OutString(3,0,"îë-âî",false);
	OutString(4,0,"ä.",false);
	OutString(5,0,"àèìåíîâàíèå",false);
	OutString(6,0,"åíà",false);
	OutString(7,0,"åáåñò.",false);
	OutString(8,0,"óììà",false);
	EndFormat;
	Black_Divider(0,1);

	for(i=0;i<rwcnt;i=i+1) begin
		MatRowGet(PUr,i,PUrw)
		StartFormat(15);			
		OutString(0,0,i+1,false);
		OutString(2,0,PUrw.ArtCode,false);
		OutString(3,0,PUrw.Quant,false);
		OutString(4,0,PUrw.UnitCode,false);
		OutString(5,0,PUrw.Spec,false);
		OutString(6,0,PUrw.UPrice,false);
		OutVal(7,0,PUrw.CostPrice,M4Val,false);//Edit----------------------Dima  26.04.2016
		OutString(8,0,PUrw.Sum,false);
		EndFormat;	
	end;		
	EndJob;

  end;

return;
end;

global procedure ExportTableToExcelPORn(record RcVc RepSpec)	//Edit--------Irkan
begin
  record POVc POr;
  row	POVc POrw;
  Integer rwcnt,i,wn;
  
  POr.SerNr = RepSpec.long1;
  if (ReadFirstMain(POr,1,true)) then begin	  
  rwcnt=MatRowCnt(POr);
 
	StartReportJob("ExportToExcel");
	
	EndHeader;

	SetRepCol(2,50);
	SetRepCol(3,100);
	SetRepCol(4,150);
	SetRepCol(5,200);
	SetRepCol(6,250);
	SetRepCol(7,300);
	SetRepCol(8,350);
	SetRepCol(9,400);
	SetRepCol(10,450);
	SetRepCol(11,500);
	SetRepCol(12,550);
	SetRepCol(13,600);


	StartFormat(15);
	OutString(0,0,"Ü",true);
	OutString(2,0,"îâàð",true);
	OutString(3,0,"îë-âî",false);
	OutString(4,0,"ä.",false);
	OutString(5,0,"àèìåíîâàíèå",false);
	OutString(6,0,"åíà",false);
	OutString(7,0,"%",false);
	OutString(8,0,"óììà",false);
	OutString(9,0,"",false);
	EndFormat;
	Black_Divider(0,1);

	for(i=0;i<rwcnt;i=i+1) begin
		MatRowGet(POr,i,POrw)
		StartFormat(15);			
		OutString(0,0,i+1,false);
		OutString(2,0,POrw.ArtCode,false);
		OutString(3,0,POrw.Quant,false);
		OutString(4,0,POrw.UnitCode,false);
		OutString(5,0,POrw.Spec,false);
		OutString(6,0,POrw.Price,false);
		OutString(7,0,POrw.vRebate,false);//Edit----------------------Irkan  26.04.2016
		OutString(8,0,POrw.Sum,false);
		OutString(9,0,POrw.VATCode,false);
		EndFormat;	
	end;		
	EndJob;

  end;

return;
end;

global
procedure PWrongRn(record RcVc RepSpec)
begin
  record RoundBlock RoundRec;
  record PUVc PUr;
  record POVc POr;
  record LocationVc Locr;
  Boolean TrHs;
  Boolean testf;
  LongInt frorder,toorder;
  val totsum,pursumval;// Edit ************************** BPI Ukraine - KramarAlexandr - Friday, 8 December 2017 15:25:24
  LongInt afr,ato;
  val rowsum;
  val totunitsum,totfreight,totcustoms,totextra;
  val t,t2;
  Integer rw;
  String 255 tstr;
  String 20 ckey;
  Integer i,rwcnt,k;
  row PUVc PUrw;
  row POVc POrw;
  val pursum;
  val unitsum,sumquant,freight,customs,extra,totsumquant;
  string 50 crncy;
  record INVc INr;
  string 20 frit,toit;
  string 20 frin,toin;
	longint curtick;
	record BPIBrandVc BPIBrandr;
	record CompaniesBlock Compb;
	row CompaniesBlock Comprw;
	integer comp,CompQty,oldComp;
	date sDate;
	val rowPrice;
	string 255 rowCost;
	record ItemHistVc IHr;
	
	
	logtext(0,"start");
	oldComp = currentCompany;
	BlockLoad(Compb);
	sDate = addDay(currentdate, -150);
	CompQty = matrowcnt(Compb);
	
	startreportnoheaderjob("Wrong PUr");
	
	StartFormat(15);
	OutString(0,0,"îìïàíèß",false);
	OutString(60,0,"îñòóïëåíèå",false);
	OutString(100,0,"àìîæíß ñòðîêè",false);
	OutString(140,0,"àìîæíß ïîñò.",false);
	OutString(200,0,"åíà ñòðîêè",false);
	OutString(250,0,"àêàç",false);
	OutString(300,0,"ñòàòîê ïî IH",false);
	EndFormat
	
	logtext(0,CompQty);
	logtext(0,sDate);
  for(comp=0;comp<CompQty;comp=comp+1) begin
		matrowget(Compb,comp,Comprw);
		if(Comprw.ActiveStatus==0) then begin
			logtext(0,comp+1);
			SetCompany(comp+1,false);
			PUr.TransDate = currentdate;
			TrHs = true;
			while(LoopBackKey("TransDate",PUr,1,TrHs)) begin
				testf = false;
				if(PUr.TransDate<sDate) then begin TrHs = false; end;
				rwcnt = matrowcnt(PUr);
				for(i=0;i<rwcnt;i=i+1) begin
					matrowget(PUr,i,PUrw);
					if(PUrw.UPrice>999 and StringToVal(PUrw.CustomsCost,M4Val)>=1 and StringToVal(PUrw.CustomsCost,M4Val)<=10)then begin 
						testf = true; 
						rowCost = PUrw.CustomsCost;
						rowPrice = PUrw.UPrice;
					end;
				end;
				if(testf) then begin
					
					StartFormat(15);
					OutString(0,0,Comprw.ShortName,false);
					OutString(60,"DblPUVc",PUr.SerNr,false);
					OutString(100,0,rowCost,false);
					OutString(140,0,PUr.CustomsCost,false);
					OutString(200,0,rowPrice,false);
					OutString(250,0,PUr.PONr,false);
					OutString(250,0,PUr.TransDate,false);
					EndFormat
					
					rwcnt = matrowcnt(PUr);
					for(i=0;i<rwcnt;i=i+1) begin
						matrowget(PUr,i,PUrw);
						if(PUrw.UPrice>999 and StringToVal(PUrw.CustomsCost,M4Val)>=1 and StringToVal(PUrw.CustomsCost,M4Val)<=10)then begin 
							IHr.FileName = "PUVc";
							IHr.TransNr = PUr.SerNr;
							IHr.Row = i;
							if(readfirstkey("FNTransNr",IHr,3,true))then begin
								StartFormat(15);
									OutString(200,0,IHr.ArtCode,false);
									OutString(300,0,IHr.RemQty,false);
									EndFormat
							end;
						end;
					end;
					
					
					
					
				end;	
			end;
			ResetLoop(PUr);
		end;
	end;	
	
	
	StartFormat(15);
	OutString(0,0,"îìïàíèß",false);
	OutString(60,0,"àêàç ïîñòàâùèêó",false);
	OutString(100,0,"àìîæíß ñòðîêè",false);
	OutString(140,0,"àìîæíß ïîñò.",false);
	OutString(200,0,"åíà ñòðîêè",false);
	EndFormat
	
  for(comp=0;comp<CompQty;comp=comp+1) begin
		matrowget(Compb,comp,Comprw);
		if(Comprw.ActiveStatus==0) then begin
			logtext(0,comp+1);
			SetCompany(comp+1,false);
			POr.TransDate = currentdate;
			TrHs = true;
			while(LoopBackKey("TransDate",POr,1,TrHs)) begin
				testf = false;
				if(POr.TransDate<sDate) then begin TrHs = false; end;
				rwcnt = matrowcnt(POr);
				for(i=0;i<rwcnt;i=i+1) begin
					matrowget(POr,i,POrw);
					if(POrw.Price>999 and StringToVal(POrw.CustomsCost,M4Val)>=1 and StringToVal(POrw.CustomsCost,M4Val)<=10)then begin 
						testf = true; 
						rowCost = POrw.CustomsCost;
						rowPrice = POrw.Price;
					end;
				end;
				if(testf) then begin
					StartFormat(15);
					OutString(0,0,Comprw.ShortName,false);
					OutString(60,"DblPOVc",POr.SerNr,false);
					OutString(100,0,rowCost,false);
					OutString(140,0,POr.CustomsCost,false);
					OutString(200,0,rowPrice,false);
					EndFormat
				end;	
			end;
			ResetLoop(POr);
		end;
	end;	
	
		
  EndJob;
	ResetCompany(oldComp);
	logtext(0,"end");
  return;
end;


global procedure CustBlankInfoRn(record RcVc RepSpec)
begin
	record CUVc CUr;
	boolean TrHs,testf;

	StartReportNoheaderJob("Ïóñòûå ÔÈÎ");
	
	
/* old structure	
	startformat(15);
		OutString(0,0,"îä",false);
		OutString(130,0,"àèìåíîâàíèå",false);
		OutString(300,0,"åëåôîí",false);
		OutString(300,0,"îï. òåëåôîí",false);
		OutString(300,0,"îá. òåëåôîí",false);
		OutString(300,0,"eMail",false);
		OutString(300,0,"êèäêà",false);
		OutString(300,0,"àòà ñîçäàíèß",false);
		OutString(300,0,"îçäàí â ìàãàçèíå(ñêëàä)",false);
		OutString(300,0,"àçâàíèå",false);
		OutString(300,0,"îììåíòàðèé ê ñîçäàíèþ",false);
		OutString(300,0,"îììåíòàðèé",false);
		OutString(300,0,"òêëþ÷åí îò ðàññûëêè",false);
		OutString(300,0,"òàòóñ",false);
		OutString(300,0,"äðåñ",false);
	endformat;
*/	
	
	
	
	startformat(15);
		OutString(0,0,"îä",false);
		OutString(100,0,"àèìåíîâàíèå",false);
		OutString(200,0,"ìß",false);
		OutString(300,0,"àìèëèß",false);
		OutString(400,0,"ò÷åñòâî",false);
	endformat;	
		
	TrHs = true;
	CUr.Code = "";
	CUr.CUType = 1;
	startformat(15);
		OutString(0,0,"ëèåòû:",false);
	EndFormat;		
	while(loopKey("ActCode",CUr,2,TrHs))begin
		testf = true;
		if(CUr.blockedFlag!=0) then begin testf = false; end;
		if(CUr.CUType==0) then begin testf = false; TrHs = false; end;
		if(nonblank(CUr.CRMLName)) then begin testf = false; end;
		if(testf)then begin		
		
		
			startformat(15);
				OutString(0,"DblCUVc",CUr.Code,false);
				OutString(100,0,CUr.Name,false);
				OutString(200,0,CUr.CRMName,false);
				OutString(300,0,CUr.CRMLName,false);
				OutString(400,0,CUr.CRMPatr,false);
			EndFormat;					
		end;
	end;
	Black_Divider(0,1);
	ResetLoop(CUr);
	TrHs = true;
	CUr.Code = "";
	CUr.EmployeeType = 1;
	startformat(15);
		OutString(0,0,"îòðóäíèêè:",false);
	EndFormat;		
	while(loopKey("EmployeeActCode",CUr,2,TrHs))begin
		testf = true;
		if(CUr.blockedFlag!=0) then begin testf = false; end;
		if(CUr.EmployeeType==0) then begin testf = false; TrHs = false; end;
		if(nonblank(CUr.CRMLName)) then begin testf = false; end;
		if(testf)then begin		
		
		
			startformat(15);
				OutString(0,"DblCUVc",CUr.Code,false);
				OutString(100,0,CUr.Name,false);
				OutString(200,0,CUr.CRMName,false);
				OutString(300,0,CUr.CRMLName,false);
				OutString(400,0,CUr.CRMPatr,false);
			EndFormat;					
		end;
	end;
	

	endjob;
return;
end;
